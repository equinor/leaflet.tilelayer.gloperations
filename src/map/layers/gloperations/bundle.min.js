this.L=this.L||{},this.L.TileLayer=this.L.TileLayer||{},this.L.TileLayer.GLOperations=function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};var n=function(){return(n=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function o(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function l(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}s((o=o.apply(t,e||[])).next())}))}function r(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}var i="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,l=i||a||Function("return this")(),s=l.Symbol,f=Object.prototype,u=f.hasOwnProperty,c=f.toString,h=s?s.toStringTag:void 0;var d=Object.prototype.toString;var p=s?s.toStringTag:void 0;function g(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":p&&p in Object(t)?function(t){var e=u.call(t,h),n=t[h];try{t[h]=void 0;var o=!0}catch(t){}var r=c.call(t);return o&&(e?t[h]=n:delete t[h]),r}(t):function(t){return d.call(t)}(t)}function m(t){return null!=t&&"object"==typeof t}function b(t){return"symbol"==typeof t||m(t)&&"[object Symbol]"==g(t)}function x(t,e){for(var n=-1,o=null==t?0:t.length,r=Array(o);++n<o;)r[n]=e(t[n],n,t);return r}var v=Array.isArray,y=s?s.prototype:void 0,w=y?y.toString:void 0;function _(t){if("string"==typeof t)return t;if(v(t))return x(t,_)+"";if(b(t))return w?w.call(t):"";var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}function C(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var A=/^\s+|\s+$/g,T=/^[-+]0x[0-9a-f]+$/i,L=/^0b[01]+$/i,E=/^0o[0-7]+$/i,B=parseInt;var D=1/0;function F(t){return t?(t=function(t){if("number"==typeof t)return t;if(b(t))return NaN;if(C(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=C(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(A,"");var n=L.test(t);return n||E.test(t)?B(t.slice(2),n?2:8):T.test(t)?NaN:+t}(t))===D||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function I(t){return t}function S(t){if(!C(t))return!1;var e=g(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var R,O=l["__core-js_shared__"],k=(R=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"";var N=Function.prototype.toString;function M(t){if(null!=t){try{return N.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var H=/^\[object .+?Constructor\]$/,z=Function.prototype,P=Object.prototype,V=z.toString,j=P.hasOwnProperty,U=RegExp("^"+V.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function G(t){return!(!C(t)||(e=t,k&&k in e))&&(S(t)?U:H).test(M(t));var e}function W(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return G(n)?n:void 0}var q=W(l,"WeakMap");function X(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Z(){}var Y=Date.now;var $=function(){try{var t=W(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),K=function(t){var e=0,n=0;return function(){var o=Y(),r=16-(o-n);if(n=o,r>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}($?function(t,e){return $(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:I),Q=/^(?:0|[1-9]\d*)$/;function J(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Q.test(t))&&t>-1&&t%1==0&&t<e}function tt(t,e,n){"__proto__"==e&&$?$(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function et(t,e){return t===e||t!=t&&e!=e}var nt=Object.prototype.hasOwnProperty;function ot(t,e,n){var o=t[e];nt.call(t,e)&&et(o,n)&&(void 0!==n||e in t)||tt(t,e,n)}var rt=Math.max;function it(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function at(t){return null!=t&&it(t.length)&&!S(t)}var lt=Object.prototype;function st(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||lt)}function ft(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}function ut(t){return m(t)&&"[object Arguments]"==g(t)}var ct=Object.prototype,ht=ct.hasOwnProperty,dt=ct.propertyIsEnumerable,pt=ut(function(){return arguments}())?ut:function(t){return m(t)&&ht.call(t,"callee")&&!dt.call(t,"callee")};var gt="object"==typeof exports&&exports&&!exports.nodeType&&exports,mt=gt&&"object"==typeof module&&module&&!module.nodeType&&module,bt=mt&&mt.exports===gt?l.Buffer:void 0,xt=(bt?bt.isBuffer:void 0)||function(){return!1},vt={};vt["[object Float32Array]"]=vt["[object Float64Array]"]=vt["[object Int8Array]"]=vt["[object Int16Array]"]=vt["[object Int32Array]"]=vt["[object Uint8Array]"]=vt["[object Uint8ClampedArray]"]=vt["[object Uint16Array]"]=vt["[object Uint32Array]"]=!0,vt["[object Arguments]"]=vt["[object Array]"]=vt["[object ArrayBuffer]"]=vt["[object Boolean]"]=vt["[object DataView]"]=vt["[object Date]"]=vt["[object Error]"]=vt["[object Function]"]=vt["[object Map]"]=vt["[object Number]"]=vt["[object Object]"]=vt["[object RegExp]"]=vt["[object Set]"]=vt["[object String]"]=vt["[object WeakMap]"]=!1;var yt,wt="object"==typeof exports&&exports&&!exports.nodeType&&exports,_t=wt&&"object"==typeof module&&module&&!module.nodeType&&module,Ct=_t&&_t.exports===wt&&i.process,At=function(){try{var t=_t&&_t.require&&_t.require("util").types;return t||Ct&&Ct.binding&&Ct.binding("util")}catch(t){}}(),Tt=At&&At.isTypedArray,Lt=Tt?(yt=Tt,function(t){return yt(t)}):function(t){return m(t)&&it(t.length)&&!!vt[g(t)]},Et=Object.prototype.hasOwnProperty;function Bt(t,e){var n=v(t),o=!n&&pt(t),r=!n&&!o&&xt(t),i=!n&&!o&&!r&&Lt(t),a=n||o||r||i,l=a?ft(t.length,String):[],s=l.length;for(var f in t)!e&&!Et.call(t,f)||a&&("length"==f||r&&("offset"==f||"parent"==f)||i&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||J(f,s))||l.push(f);return l}function Dt(t,e){return function(n){return t(e(n))}}var Ft=Dt(Object.keys,Object),It=Object.prototype.hasOwnProperty;function St(t){if(!st(t))return Ft(t);var e=[];for(var n in Object(t))It.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Rt(t){return at(t)?Bt(t):St(t)}var Ot=Object.prototype.hasOwnProperty;function kt(t){if(!C(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=st(t),n=[];for(var o in t)("constructor"!=o||!e&&Ot.call(t,o))&&n.push(o);return n}function Nt(t){return at(t)?Bt(t,!0):kt(t)}var Mt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ht=/^\w*$/;function zt(t,e){if(v(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!b(t))||(Ht.test(t)||!Mt.test(t)||null!=e&&t in Object(e))}var Pt=W(Object,"create");var Vt=Object.prototype.hasOwnProperty;var jt=Object.prototype.hasOwnProperty;function Ut(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function Gt(t,e){for(var n=t.length;n--;)if(et(t[n][0],e))return n;return-1}Ut.prototype.clear=function(){this.__data__=Pt?Pt(null):{},this.size=0},Ut.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ut.prototype.get=function(t){var e=this.__data__;if(Pt){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return Vt.call(e,t)?e[t]:void 0},Ut.prototype.has=function(t){var e=this.__data__;return Pt?void 0!==e[t]:jt.call(e,t)},Ut.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Pt&&void 0===e?"__lodash_hash_undefined__":e,this};var Wt=Array.prototype.splice;function qt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}qt.prototype.clear=function(){this.__data__=[],this.size=0},qt.prototype.delete=function(t){var e=this.__data__,n=Gt(e,t);return!(n<0)&&(n==e.length-1?e.pop():Wt.call(e,n,1),--this.size,!0)},qt.prototype.get=function(t){var e=this.__data__,n=Gt(e,t);return n<0?void 0:e[n][1]},qt.prototype.has=function(t){return Gt(this.__data__,t)>-1},qt.prototype.set=function(t,e){var n=this.__data__,o=Gt(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var Xt=W(l,"Map");function Zt(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function Yt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}Yt.prototype.clear=function(){this.size=0,this.__data__={hash:new Ut,map:new(Xt||qt),string:new Ut}},Yt.prototype.delete=function(t){var e=Zt(this,t).delete(t);return this.size-=e?1:0,e},Yt.prototype.get=function(t){return Zt(this,t).get(t)},Yt.prototype.has=function(t){return Zt(this,t).has(t)},Yt.prototype.set=function(t,e){var n=Zt(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this};function $t(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var o=arguments,r=e?e.apply(this,o):o[0],i=n.cache;if(i.has(r))return i.get(r);var a=t.apply(this,o);return n.cache=i.set(r,a)||i,a};return n.cache=new($t.Cache||Yt),n}$t.Cache=Yt;var Kt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qt=/\\(\\)?/g,Jt=function(t){var e=$t(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Kt,(function(t,n,o,r){e.push(o?r.replace(Qt,"$1"):n||t)})),e}));function te(t,e){return v(t)?t:zt(t,e)?[t]:Jt(function(t){return null==t?"":_(t)}(t))}function ee(t){if("string"==typeof t||b(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}function ne(t,e){for(var n=0,o=(e=te(e,t)).length;null!=t&&n<o;)t=t[ee(e[n++])];return n&&n==o?t:void 0}function oe(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}var re=s?s.isConcatSpreadable:void 0;function ie(t){return v(t)||pt(t)||!!(re&&t&&t[re])}var ae=Dt(Object.getPrototypeOf,Object);function le(t,e,n){var o=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(n=n>r?r:n)<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(r);++o<r;)i[o]=t[o+e];return i}var se=Math.ceil,fe=Math.max;function ue(t,e,n){e=(n?function(t,e,n){if(!C(n))return!1;var o=typeof e;return!!("number"==o?at(n)&&J(e,n.length):"string"==o&&e in n)&&et(n[e],t)}(t,e,n):void 0===e)?1:fe(function(t){var e=F(t),n=e%1;return e==e?n?e-n:e:0}(e),0);var o=null==t?0:t.length;if(!o||e<1)return[];for(var r=0,i=0,a=Array(se(o/e));r<o;)a[i++]=le(t,r,r+=e);return a}function ce(t){var e=this.__data__=new qt(t);this.size=e.size}function he(t,e){for(var n=-1,o=null==t?0:t.length,r=0,i=[];++n<o;){var a=t[n];e(a,n,t)&&(i[r++]=a)}return i}function de(){return[]}ce.prototype.clear=function(){this.__data__=new qt,this.size=0},ce.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ce.prototype.get=function(t){return this.__data__.get(t)},ce.prototype.has=function(t){return this.__data__.has(t)},ce.prototype.set=function(t,e){var n=this.__data__;if(n instanceof qt){var o=n.__data__;if(!Xt||o.length<199)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new Yt(o)}return n.set(t,e),this.size=n.size,this};var pe=Object.prototype.propertyIsEnumerable,ge=Object.getOwnPropertySymbols,me=ge?function(t){return null==t?[]:(t=Object(t),he(ge(t),(function(e){return pe.call(t,e)})))}:de,be=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)oe(e,me(t)),t=ae(t);return e}:de;function xe(t,e,n){var o=e(t);return v(t)?o:oe(o,n(t))}function ve(t){return xe(t,Rt,me)}var ye=W(l,"DataView"),we=W(l,"Promise"),_e=W(l,"Set"),Ce="[object Map]",Ae="[object Promise]",Te="[object Set]",Le="[object WeakMap]",Ee="[object DataView]",Be=M(ye),De=M(Xt),Fe=M(we),Ie=M(_e),Se=M(q),Re=g;(ye&&Re(new ye(new ArrayBuffer(1)))!=Ee||Xt&&Re(new Xt)!=Ce||we&&Re(we.resolve())!=Ae||_e&&Re(new _e)!=Te||q&&Re(new q)!=Le)&&(Re=function(t){var e=g(t),n="[object Object]"==e?t.constructor:void 0,o=n?M(n):"";if(o)switch(o){case Be:return Ee;case De:return Ce;case Fe:return Ae;case Ie:return Te;case Se:return Le}return e});var Oe=Re,ke=l.Uint8Array;function Ne(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Yt;++e<n;)this.add(t[e])}function Me(t,e){for(var n=-1,o=null==t?0:t.length;++n<o;)if(e(t[n],n,t))return!0;return!1}Ne.prototype.add=Ne.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ne.prototype.has=function(t){return this.__data__.has(t)};function He(t,e,n,o,r,i){var a=1&n,l=t.length,s=e.length;if(l!=s&&!(a&&s>l))return!1;var f=i.get(t);if(f&&i.get(e))return f==e;var u=-1,c=!0,h=2&n?new Ne:void 0;for(i.set(t,e),i.set(e,t);++u<l;){var d=t[u],p=e[u];if(o)var g=a?o(p,d,u,e,t,i):o(d,p,u,t,e,i);if(void 0!==g){if(g)continue;c=!1;break}if(h){if(!Me(e,(function(t,e){if(a=e,!h.has(a)&&(d===t||r(d,t,n,o,i)))return h.push(e);var a}))){c=!1;break}}else if(d!==p&&!r(d,p,n,o,i)){c=!1;break}}return i.delete(t),i.delete(e),c}function ze(t){var e=-1,n=Array(t.size);return t.forEach((function(t,o){n[++e]=[o,t]})),n}function Pe(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var Ve=s?s.prototype:void 0,je=Ve?Ve.valueOf:void 0;var Ue=Object.prototype.hasOwnProperty;var Ge="[object Arguments]",We="[object Array]",qe="[object Object]",Xe=Object.prototype.hasOwnProperty;function Ze(t,e,n,o,r,i){var a=v(t),l=v(e),s=a?We:Oe(t),f=l?We:Oe(e),u=(s=s==Ge?qe:s)==qe,c=(f=f==Ge?qe:f)==qe,h=s==f;if(h&&xt(t)){if(!xt(e))return!1;a=!0,u=!1}if(h&&!u)return i||(i=new ce),a||Lt(t)?He(t,e,n,o,r,i):function(t,e,n,o,r,i,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new ke(t),new ke(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return et(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var l=ze;case"[object Set]":var s=1&o;if(l||(l=Pe),t.size!=e.size&&!s)return!1;var f=a.get(t);if(f)return f==e;o|=2,a.set(t,e);var u=He(l(t),l(e),o,r,i,a);return a.delete(t),u;case"[object Symbol]":if(je)return je.call(t)==je.call(e)}return!1}(t,e,s,n,o,r,i);if(!(1&n)){var d=u&&Xe.call(t,"__wrapped__"),p=c&&Xe.call(e,"__wrapped__");if(d||p){var g=d?t.value():t,m=p?e.value():e;return i||(i=new ce),r(g,m,n,o,i)}}return!!h&&(i||(i=new ce),function(t,e,n,o,r,i){var a=1&n,l=ve(t),s=l.length;if(s!=ve(e).length&&!a)return!1;for(var f=s;f--;){var u=l[f];if(!(a?u in e:Ue.call(e,u)))return!1}var c=i.get(t);if(c&&i.get(e))return c==e;var h=!0;i.set(t,e),i.set(e,t);for(var d=a;++f<s;){var p=t[u=l[f]],g=e[u];if(o)var m=a?o(g,p,u,e,t,i):o(p,g,u,t,e,i);if(!(void 0===m?p===g||r(p,g,n,o,i):m)){h=!1;break}d||(d="constructor"==u)}if(h&&!d){var b=t.constructor,x=e.constructor;b==x||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x||(h=!1)}return i.delete(t),i.delete(e),h}(t,e,n,o,r,i))}function Ye(t,e,n,o,r){return t===e||(null==t||null==e||!m(t)&&!m(e)?t!=t&&e!=e:Ze(t,e,n,o,Ye,r))}function $e(t){return t==t&&!C(t)}function Ke(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}function Qe(t){var e=function(t){for(var e=Rt(t),n=e.length;n--;){var o=e[n],r=t[o];e[n]=[o,r,$e(r)]}return e}(t);return 1==e.length&&e[0][2]?Ke(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,o){var r=n.length,i=r,a=!o;if(null==t)return!i;for(t=Object(t);r--;){var l=n[r];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++r<i;){var s=(l=n[r])[0],f=t[s],u=l[1];if(a&&l[2]){if(void 0===f&&!(s in t))return!1}else{var c=new ce;if(o)var h=o(f,u,s,t,e,c);if(!(void 0===h?Ye(u,f,3,o,c):h))return!1}}return!0}(n,t,e)}}function Je(t,e){return null!=t&&e in Object(t)}function tn(t,e){return null!=t&&function(t,e,n){for(var o=-1,r=(e=te(e,t)).length,i=!1;++o<r;){var a=ee(e[o]);if(!(i=null!=t&&n(t,a)))break;t=t[a]}return i||++o!=r?i:!!(r=null==t?0:t.length)&&it(r)&&J(a,r)&&(v(t)||pt(t))}(t,e,Je)}function en(t,e){return zt(t)&&$e(e)?Ke(ee(t),e):function(n){var o=function(t,e,n){var o=null==t?void 0:ne(t,e);return void 0===o?n:o}(n,t);return void 0===o&&o===e?tn(n,t):Ye(e,o,3)}}function nn(t){return function(e){return null==e?void 0:e[t]}}function on(t){return zt(t)?nn(ee(t)):function(t){return function(e){return ne(e,t)}}(t)}function rn(t){return"function"==typeof t?t:null==t?I:"object"==typeof t?v(t)?en(t[0],t[1]):Qe(t):on(t)}var an,ln=function(t,e,n){for(var o=-1,r=Object(t),i=n(t),a=i.length;a--;){var l=i[an?a:++o];if(!1===e(r[l],l,r))break}return t};function sn(t,e){return t&&ln(t,e,Rt)}var fn=function(t,e){return function(n,o){if(null==n)return n;if(!at(n))return t(n,o);for(var r=n.length,i=e?r:-1,a=Object(n);(e?i--:++i<r)&&!1!==o(a[i],i,a););return n}}(sn);function un(t,e){var n=-1,o=at(t)?Array(t.length):[];return fn(t,(function(t,r,i){o[++n]=e(t,r,i)})),o}function cn(t,e){return function t(e,n,o,r,i){var a=-1,l=e.length;for(o||(o=ie),i||(i=[]);++a<l;){var s=e[a];n>0&&o(s)?n>1?t(s,n-1,o,r,i):oe(i,s):r||(i[i.length]=s)}return i}(function(t,e){return(v(t)?x:un)(t,rn(e))}(t,e),1)}function hn(t){return null==t?[]:function(t,e){return x(e,(function(e){return t[e]}))}(t,Rt(t))}var dn=Object.prototype.hasOwnProperty;function pn(t,e,n,o){if(!C(t))return t;for(var r=-1,i=(e=te(e,t)).length,a=i-1,l=t;null!=l&&++r<i;){var s=ee(e[r]),f=n;if(r!=a){var u=l[s];void 0===(f=o?o(u,s,l):void 0)&&(f=C(u)?u:J(e[r+1])?[]:{})}ot(l,s,f),l=l[s]}return t}function gn(t,e){if(null==t)return{};var n=x(function(t){return xe(t,Nt,be)}(t),(function(t){return[t]}));return e=rn(e),function(t,e,n){for(var o=-1,r=e.length,i={};++o<r;){var a=e[o],l=ne(t,a);n(l,a)&&pn(i,te(a,t),l)}return i}(t,n,(function(t,n){return e(t,n[0])}))}var mn=Math.max;function bn(t){if(!t||!t.length)return[];var e=0;return t=he(t,(function(t){if(m(n=t)&&at(n))return e=mn(t.length,e),!0;var n})),ft(e,(function(e){return x(t,nn(e))}))}var xn=function(t,e){return K(function(t,e,n){return e=rt(void 0===e?t.length-1:e,0),function(){for(var o=arguments,r=-1,i=rt(o.length-e,0),a=Array(i);++r<i;)a[r]=o[e+r];r=-1;for(var l=Array(e+1);++r<e;)l[r]=o[r];return l[e]=n(a),X(t,this,l)}}(t,e,I),t+"")}((function(t){var e=t.length,n=e>1?t[e-1]:void 0;return n="function"==typeof n?(t.pop(),n):void 0,function(t,e){if(!t||!t.length)return[];var n=bn(t);return null==e?n:x(n,(function(t){return X(e,void 0,t)}))}(t,n)}));!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}(".gl-tilelayer-tile {\n  -ms-interpolation-mode: nearest-neighbor;\n      image-rendering: -moz-crisp-edges;\n      image-rendering: pixelated;\n  image-rendering: crisp-edges;\n}\n");"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function vn(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return yn(null==e&&n.path)}},n.exports),n.exports}function yn(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var wn=vn((function(t,e){t.exports=function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var n=Object.keys(e),o=0;o<n.length;++o)t[n[o]]=e[n[o]];return t},n="\n";function o(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function r(t){var e=new Error("(regl) "+t);throw console.error(e),e}function i(t,e){t||r(e)}function a(t){return t?": "+t:""}function l(t,e,n){t in e||r("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join())}function s(e,n){t(e)||r("invalid parameter type"+a(n)+". must be a typed array")}function f(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function u(t,e,n){f(t,e)||r("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t)}function c(t,e){t>=0&&(0|t)===t||r("invalid parameter type, ("+t+")"+a(e)+". must be a nonnegative integer")}function h(t,e,n){e.indexOf(t)<0&&r("invalid value"+a(n)+". must be one of: "+e)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function p(t){Object.keys(t).forEach((function(t){d.indexOf(t)<0&&r('invalid regl constructor argument "'+t+'". must be one of '+d)}))}function g(t,e){for(t+="";t.length<e;)t=" "+t;return t}function m(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(t,e){this.number=t,this.line=e,this.errors=[]}function x(t,e,n){this.file=t,this.line=e,this.message=n}function v(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var o=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return o?o[1]:"unknown"}function y(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var o=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return o?o[1]:"unknown"}function w(t,e){var n=t.split("\n"),r=1,i=0,a={unknown:new m,0:new m};a.unknown.name=a[0].name=e||v(),a.unknown.lines.push(new b(0,""));for(var l=0;l<n.length;++l){var s=n[l],f=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(s);if(f)switch(f[1]){case"line":var u=/(\d+)(\s+\d+)?/.exec(f[2]);u&&(r=0|u[1],u[2]&&((i=0|u[2])in a||(a[i]=new m)));break;case"define":var c=/SHADER_NAME(_B64)?\s+(.*)$/.exec(f[2]);c&&(a[i].name=c[1]?o(c[2]):c[2])}a[i].lines.push(new b(r++,s))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function _(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new x(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new x("unknown",0,t))}})),e}function C(t,e){e.forEach((function(e){var n=t[e.file];if(n){var o=n.index[e.line];if(o)return o.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function A(t,e,o,r,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var l=t.getShaderInfoLog(e),s=r===t.FRAGMENT_SHADER?"fragment":"vertex";I(o,"string",s+" shader source must be a string",a);var f=w(o,a),u=_(l);C(f,u),Object.keys(f).forEach((function(t){var e=f[t];if(e.hasErrors){var o=[""],r=[""];i("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){i(g(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(t.line+n,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(o){var r=o.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(a){var l=a[1];switch(r=a[2],l){case"assign":l="="}e=Math.max(t.line.indexOf(l,e),0)}else e=0;i(g("| ",6)),i(g("^^^",e+3)+n,"font-weight:bold"),i(g("| ",6)),i(r+n,"font-weight:bold")})),i(g("| ",6)+n)}else i(g(t.number,4)+"|  "),i(t.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(o.join("")):(r[0]=o.join("%c"),console.log.apply(console,r))}function i(t,e){o.push(t),r.push(e||"")}})),i.raise("Error compiling "+s+" shader, "+f[0].name)}}function T(t,e,o,r,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var l=t.getProgramInfoLog(e),s=w(o,a),f='Error linking program with vertex shader, "'+w(r,a)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+f+n+"%c"+l,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(f+n+l),i.raise(f)}}function L(t){t._commandRef=v()}function E(t,e,n,o){function r(t){return t?o.id(t):0}function i(t,e){Object.keys(e).forEach((function(e){t[o.id(e)]=!0}))}L(t),t._fragId=r(t.static.frag),t._vertId=r(t.static.vert);var a=t._uniformSet={};i(a,e.static),i(a,e.dynamic);var l=t._attributeSet={};i(l,n.static),i(l,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function B(t,e){var n=y();r(t+" in command "+(e||v())+("unknown"===n?"":" called from "+n))}function D(t,e,n){t||B(e,n||v())}function F(t,e,n,o){t in e||B("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join(),o||v())}function I(t,e,n,o){f(t,e)||B("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t,o||v())}function S(t){t()}function R(t,e,n){t.texture?h(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):h(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var O=33071,k=9728,N=9984,M=9985,H=9986,z=9987,P=5121,V=5122,j=5123,U=5124,G=5125,W=5126,q=32819,X=32820,Z=33635,Y=34042,$=36193,K={};function Q(t,e){return t===X||t===q||t===Z?2:t===Y?4:K[t]*e}function J(t){return!(t&t-1||!t)}function tt(t,e,n){var o,r=e.width,a=e.height,l=e.channels;i(r>0&&r<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),t.wrapS===O&&t.wrapT===O||i(J(r)&&J(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==r&&1!==a&&i(t.minFilter!==N&&t.minFilter!==H&&t.minFilter!==M&&t.minFilter!==z,"min filter requires mipmap"):(i(J(r)&&J(a),"texture must be a square power of 2 to support mipmapping"),i(e.mipmask===(r<<1)-1,"missing or incomplete mipmap data")),e.type===W&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(t.minFilter===k&&t.magFilter===k,"filter not supported, must enable oes_texture_float_linear"),i(!t.genMipmaps,"mipmap generation not supported with float textures"));var s=e.images;for(o=0;o<16;++o)if(s[o]){var f=r>>o,u=a>>o;i(e.mipmask&1<<o,"missing mipmap data");var c=s[o];if(i(c.width===f&&c.height===u,"invalid shape for mip images"),i(c.format===e.format&&c.internalformat===e.internalformat&&c.type===e.type,"incompatible type for mip image"),c.compressed);else if(c.data){var h=Math.ceil(Q(c.type,l)*f/c.unpackAlignment)*c.unpackAlignment;i(c.data.byteLength===h*u,"invalid data for image, buffer size is inconsistent with image format")}else c.element||c.copy}else t.genMipmaps||i(0==(e.mipmask&1<<o),"extra mipmap data");e.compressed&&i(!t.genMipmaps,"mipmap generation for compressed images not supported")}function et(t,e,n,o){var r=t.width,a=t.height,l=t.channels;i(r>0&&r<=o.maxTextureSize&&a>0&&a<=o.maxTextureSize,"invalid texture shape"),i(r===a,"cube map must be square"),i(e.wrapS===O&&e.wrapT===O,"wrap mode not supported by cube map");for(var s=0;s<n.length;++s){var f=n[s];i(f.width===r&&f.height===a,"inconsistent cube map face shape"),e.genMipmaps&&(i(!f.compressed,"can not generate mipmap for compressed textures"),i(1===f.mipmask,"can not specify mipmaps and generate mipmaps"));for(var u=f.images,c=0;c<16;++c){var h=u[c];if(h){var d=r>>c,p=a>>c;i(f.mipmask&1<<c,"missing mipmap data"),i(h.width===d&&h.height===p,"invalid shape for mip images"),i(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===d*p*Math.max(Q(h.type,l),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}K[5120]=K[P]=1,K[V]=K[j]=K[$]=K[Z]=K[q]=K[X]=2,K[U]=K[G]=K[W]=K[Y]=4;var nt=e(i,{optional:S,raise:r,commandRaise:B,command:D,parameter:l,commandParameter:F,constructor:p,type:u,commandType:I,isTypedArray:s,nni:c,oneOf:h,shaderError:A,linkError:T,callSite:y,saveCommandRef:L,saveDrawInfo:E,framebufferFormat:R,guessCommand:v,texture2D:tt,textureCube:et}),ot=0,rt=0;function it(t,e){this.id=ot++,this.type=t,this.data=e}function at(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function lt(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+at(t.substr(1,t.length-2))+'"'];var o=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(o)return lt(t.substr(0,o.index)).concat(lt(o[1])).concat(lt(t.substr(o.index+o[0].length)));var r=t.split(".");if(1===r.length)return['"'+at(t)+'"'];for(var i=[],a=0;a<r.length;++a)i=i.concat(lt(r[a]));return i}function st(t){return"["+lt(t).join("][")+"]"}function ft(t,e){return new it(t,st(e+""))}function ut(t){return"function"==typeof t&&!t._reglType||t instanceof it}function ct(t,e){return"function"==typeof t?new it(rt,t):t}var ht={DynamicVariable:it,define:ft,isDynamic:ut,unbox:ct,accessor:st},dt={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},pt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function gt(){var t={"":0},e=[""];return{id:function(n){var o=t[n];return o||(o=t[n]=e.length,e.push(n),o)},str:function(t){return e[t]}}}function mt(t,n,o){var r,i=document.createElement("canvas");function a(){var n=window.innerWidth,r=window.innerHeight;if(t!==document.body){var a=t.getBoundingClientRect();n=a.right-a.left,r=a.bottom-a.top}i.width=o*n,i.height=o*r,e(i.style,{width:n+"px",height:r+"px"})}function l(){r?r.disconnect():window.removeEventListener("resize",a),t.removeChild(i)}return e(i.style,{border:0,margin:0,padding:0,top:0,left:0}),t.appendChild(i),t===document.body&&(i.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(r=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:i,onDestroy:l}}function bt(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function xt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function vt(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function yt(t){return"string"==typeof t?t.split():(nt(Array.isArray(t),"invalid extension array"),t)}function wt(t){return"string"==typeof t?(nt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function _t(t){var e,n,o,r,i=t||{},a={},l=[],s=[],f="undefined"==typeof window?1:window.devicePixelRatio,u=!1,c=function(t){t&&nt.raise(t)},h=function(){};if("string"==typeof i?(nt("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),e=document.querySelector(i),nt(e,"invalid query string for element")):"object"==typeof i?xt(i)?e=i:vt(i)?o=(r=i).canvas:(nt.constructor(i),"gl"in i?r=i.gl:"canvas"in i?o=wt(i.canvas):"container"in i&&(n=wt(i.container)),"attributes"in i&&(a=i.attributes,nt.type(a,"object","invalid context attributes")),"extensions"in i&&(l=yt(i.extensions)),"optionalExtensions"in i&&(s=yt(i.optionalExtensions)),"onDone"in i&&(nt.type(i.onDone,"function","invalid or missing onDone callback"),c=i.onDone),"profile"in i&&(u=!!i.profile),"pixelRatio"in i&&(f=+i.pixelRatio,nt(f>0,"invalid pixel ratio"))):nt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?o=e:n=e),!r){if(!o){nt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=mt(n||document.body,c,f);if(!d)return null;o=d.canvas,h=d.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),r=bt(o,a)}return r?{gl:r,canvas:o,container:n,extensions:l,optionalExtensions:s,pixelRatio:f,profile:u,onDone:c,onDestroy:h}:(h(),c("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ct(t,e){var n={};function o(e){nt.type(e,"string","extension name must be string");var o,r=e.toLowerCase();try{o=n[r]=t.getExtension(r)}catch(t){}return!!o}for(var r=0;r<e.extensions.length;++r){var i=e.extensions[r];if(!o(i))return e.onDestroy(),e.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(o),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!o(t))throw new Error("(regl): error restoring extension "+t)}))}}}function At(t,e){for(var n=Array(t),o=0;o<t;++o)n[o]=e(o);return n}var Tt=5120,Lt=5121,Et=5122,Bt=5123,Dt=5124,Ft=5125,It=5126;function St(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Rt(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function Ot(){var t=At(8,(function(){return[]}));function e(e){var n=St(e),o=t[Rt(n)>>2];return o.length>0?o.pop():new ArrayBuffer(n)}function n(e){t[Rt(e.byteLength)>>2].push(e)}function o(t,n){var o=null;switch(t){case Tt:o=new Int8Array(e(n),0,n);break;case Lt:o=new Uint8Array(e(n),0,n);break;case Et:o=new Int16Array(e(2*n),0,n);break;case Bt:o=new Uint16Array(e(2*n),0,n);break;case Dt:o=new Int32Array(e(4*n),0,n);break;case Ft:o=new Uint32Array(e(4*n),0,n);break;case It:o=new Float32Array(e(4*n),0,n);break;default:return null}return o.length!==n?o.subarray(0,n):o}function r(t){n(t.buffer)}return{alloc:e,free:n,allocType:o,freeType:r}}var kt=Ot();kt.zero=Ot();var Nt=3408,Mt=3410,Ht=3411,zt=3412,Pt=3413,Vt=3414,jt=3415,Ut=33901,Gt=33902,Wt=3379,qt=3386,Xt=34921,Zt=36347,Yt=36348,$t=35661,Kt=35660,Qt=34930,Jt=36349,te=34076,ee=34024,ne=7936,oe=7937,re=7938,ie=35724,ae=34047,le=36063,se=34852,fe=3553,ue=34067,ce=34069,he=33984,de=6408,pe=5126,ge=5121,me=36160,be=36053,xe=36064,ve=16384,ye=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ae));var o=1,r=1;e.webgl_draw_buffers&&(o=t.getParameter(se),r=t.getParameter(le));var i=!!e.oes_texture_float;if(i){var a=t.createTexture();t.bindTexture(fe,a),t.texImage2D(fe,0,de,1,1,0,de,pe,null);var l=t.createFramebuffer();if(t.bindFramebuffer(me,l),t.framebufferTexture2D(me,xe,fe,a,0),t.bindTexture(fe,null),t.checkFramebufferStatus(me)!==be)i=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(ve);var s=kt.allocType(pe,4);t.readPixels(0,0,1,1,de,pe,s),t.getError()?i=!1:(t.deleteFramebuffer(l),t.deleteTexture(a),i=1===s[0]),kt.freeType(s)}}var f=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var u=t.createTexture(),c=kt.allocType(ge,36);t.activeTexture(he),t.bindTexture(ue,u),t.texImage2D(ce,0,de,3,3,0,de,ge,c),kt.freeType(c),t.bindTexture(ue,null),t.deleteTexture(u),f=!t.getError()}return{colorBits:[t.getParameter(Mt),t.getParameter(Ht),t.getParameter(zt),t.getParameter(Pt)],depthBits:t.getParameter(Vt),stencilBits:t.getParameter(jt),subpixelBits:t.getParameter(Nt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:o,maxColorAttachments:r,pointSizeDims:t.getParameter(Ut),lineWidthDims:t.getParameter(Gt),maxViewportDims:t.getParameter(qt),maxCombinedTextureUnits:t.getParameter($t),maxCubeMapSize:t.getParameter(te),maxRenderbufferSize:t.getParameter(ee),maxTextureUnits:t.getParameter(Qt),maxTextureSize:t.getParameter(Wt),maxAttributes:t.getParameter(Xt),maxVertexUniforms:t.getParameter(Zt),maxVertexTextureUnits:t.getParameter(Kt),maxVaryingVectors:t.getParameter(Yt),maxFragmentUniforms:t.getParameter(Jt),glsl:t.getParameter(ie),renderer:t.getParameter(oe),vendor:t.getParameter(ne),version:t.getParameter(re),readFloat:i,npotTextureCube:f}};function we(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var _e=function(t){return Object.keys(t).map((function(e){return t[e]}))},Ce={shape:De,flatten:Be};function Ae(t,e,n){for(var o=0;o<e;++o)n[o]=t[o]}function Te(t,e,n,o){for(var r=0,i=0;i<e;++i)for(var a=t[i],l=0;l<n;++l)o[r++]=a[l]}function Le(t,e,n,o,r,i){for(var a=i,l=0;l<e;++l)for(var s=t[l],f=0;f<n;++f)for(var u=s[f],c=0;c<o;++c)r[a++]=u[c]}function Ee(t,e,n,o,r){for(var i=1,a=n+1;a<e.length;++a)i*=e[a];var l=e[n];if(e.length-n==4){var s=e[n+1],f=e[n+2],u=e[n+3];for(a=0;a<l;++a)Le(t[a],s,f,u,o,r),r+=i}else for(a=0;a<l;++a)Ee(t[a],e,n+1,o,r),r+=i}function Be(t,e,n,o){var r=1;if(e.length)for(var i=0;i<e.length;++i)r*=e[i];else r=0;var a=o||kt.allocType(n,r);switch(e.length){case 0:break;case 1:Ae(t,e[0],a);break;case 2:Te(t,e[0],e[1],a);break;case 3:Le(t,e[0],e[1],e[2],a,0);break;default:Ee(t,e,0,a,0)}return a}function De(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var Fe={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ie={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Se={dynamic:35048,stream:35040,static:35044},Re=Ce.flatten,Oe=Ce.shape,ke=35044,Ne=35040,Me=5121,He=5126,ze=[];function Pe(t){return 0|Fe[Object.prototype.toString.call(t)]}function Ve(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function je(t,e,n,o,r,i,a){for(var l=0,s=0;s<n;++s)for(var f=0;f<o;++f)t[l++]=e[r*s+i*f+a]}function Ue(e,n,o,r){var i=0,a={};function l(t){this.id=i++,this.buffer=e.createBuffer(),this.type=t,this.usage=ke,this.byteLength=0,this.dimension=1,this.dtype=Me,this.persistentData=null,o.profile&&(this.stats={size:0})}l.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},l.prototype.destroy=function(){d(this)};var s=[];function f(t,e){var n=s.pop();return n||(n=new l(t)),n.bind(),h(n,e,Ne,0,1,!1),n}function u(t){s.push(t)}function c(t,n,o){t.byteLength=n.byteLength,e.bufferData(t.type,n,o)}function h(e,n,o,r,i,a){var l,s;if(e.usage=o,Array.isArray(n)){if(e.dtype=r||He,n.length>0)if(Array.isArray(n[0])){l=Oe(n);for(var f=1,u=1;u<l.length;++u)f*=l[u];e.dimension=f,c(e,s=Re(n,l,e.dtype),o),a?e.persistentData=s:kt.freeType(s)}else if("number"==typeof n[0]){e.dimension=i;var h=kt.allocType(e.dtype,n.length);Ve(h,n),c(e,h,o),a?e.persistentData=h:kt.freeType(h)}else t(n[0])?(e.dimension=n[0].length,e.dtype=r||Pe(n[0])||He,c(e,s=Re(n,[n.length,n[0].length],e.dtype),o),a?e.persistentData=s:kt.freeType(s)):nt.raise("invalid buffer data")}else if(t(n))e.dtype=r||Pe(n),e.dimension=i,c(e,n,o),a&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(we(n)){l=n.shape;var d=n.stride,p=n.offset,g=0,m=0,b=0,x=0;1===l.length?(g=l[0],m=1,b=d[0],x=0):2===l.length?(g=l[0],m=l[1],b=d[0],x=d[1]):nt.raise("invalid shape"),e.dtype=r||Pe(n.data)||He,e.dimension=m;var v=kt.allocType(e.dtype,g*m);je(v,n.data,g,m,b,x,p),c(e,v,o),a?e.persistentData=v:kt.freeType(v)}else n instanceof ArrayBuffer?(e.dtype=Me,e.dimension=i,c(e,n,o),a&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):nt.raise("invalid buffer data")}function d(t){n.bufferCount--,r(t);var o=t.buffer;nt(o,"buffer must not be deleted already"),e.deleteBuffer(o),t.buffer=null,delete a[t.id]}function p(r,i,s,f){n.bufferCount++;var u=new l(i);function c(n){var r=ke,i=null,a=0,l=0,s=1;return Array.isArray(n)||t(n)||we(n)||n instanceof ArrayBuffer?i=n:"number"==typeof n?a=0|n:n&&(nt.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(nt(null===i||Array.isArray(i)||t(i)||we(i),"invalid data for buffer"),i=n.data),"usage"in n&&(nt.parameter(n.usage,Se,"invalid buffer usage"),r=Se[n.usage]),"type"in n&&(nt.parameter(n.type,Ie,"invalid buffer type"),l=Ie[n.type]),"dimension"in n&&(nt.type(n.dimension,"number","invalid dimension"),s=0|n.dimension),"length"in n&&(nt.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),u.bind(),i?h(u,i,r,l,s,f):(a&&e.bufferData(u.type,a,r),u.dtype=l||Me,u.usage=r,u.dimension=s,u.byteLength=a),o.profile&&(u.stats.size=u.byteLength*ze[u.dtype]),c}function p(t,n){nt(n+t.byteLength<=u.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+u.byteLength),e.bufferSubData(u.type,n,t)}function g(e,n){var o,r=0|(n||0);if(u.bind(),t(e)||e instanceof ArrayBuffer)p(e,r);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var i=kt.allocType(u.dtype,e.length);Ve(i,e),p(i,r),kt.freeType(i)}else if(Array.isArray(e[0])||t(e[0])){o=Oe(e);var a=Re(e,o,u.dtype);p(a,r),kt.freeType(a)}else nt.raise("invalid buffer data")}else if(we(e)){o=e.shape;var l=e.stride,s=0,f=0,h=0,d=0;1===o.length?(s=o[0],f=1,h=l[0],d=0):2===o.length?(s=o[0],f=o[1],h=l[0],d=l[1]):nt.raise("invalid shape");var g=Array.isArray(e.data)?u.dtype:Pe(e.data),m=kt.allocType(g,s*f);je(m,e.data,s,f,h,d,e.offset),p(m,r),kt.freeType(m)}else nt.raise("invalid data for buffer subdata");return c}return a[u.id]=u,s||c(r),c._reglType="buffer",c._buffer=u,c.subdata=g,o.profile&&(c.stats=u.stats),c.destroy=function(){d(u)},c}function g(){_e(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return o.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:p,createStream:f,destroyStream:u,clear:function(){_e(a).forEach(d),s.forEach(d)},getBuffer:function(t){return t&&t._buffer instanceof l?t._buffer:null},restore:g,_initBuffer:h}}ze[5120]=1,ze[5122]=2,ze[5124]=4,ze[5121]=1,ze[5123]=2,ze[5125]=4,ze[5126]=4;var Ge={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},We=0,qe=1,Xe=4,Ze=5120,Ye=5121,$e=5122,Ke=5123,Qe=5124,Je=5125,tn=34963,en=35040,nn=35044;function on(e,n,o,r){var i={},a=0,l={uint8:Ye,uint16:Ke};function s(t){this.id=a++,i[this.id]=this,this.buffer=t,this.primType=Xe,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(l.uint32=Je),s.prototype.bind=function(){this.buffer.bind()};var f=[];function u(t){var e=f.pop();return e||(e=new s(o.create(null,tn,!0,!1)._buffer)),h(e,t,en,-1,-1,0,0),e}function c(t){f.push(t)}function h(r,i,a,l,s,f,u){var c;if(r.buffer.bind(),i){var h=u;u||t(i)&&(!we(i)||t(i.data))||(h=n.oes_element_index_uint?Je:Ke),o._initBuffer(r.buffer,i,a,h,3)}else e.bufferData(tn,f,a),r.buffer.dtype=c||Ye,r.buffer.usage=a,r.buffer.dimension=3,r.buffer.byteLength=f;if(c=u,!u){switch(r.buffer.dtype){case Ye:case Ze:c=Ye;break;case Ke:case $e:c=Ke;break;case Je:case Qe:c=Je;break;default:nt.raise("unsupported type for element array")}r.buffer.dtype=c}r.type=c,nt(c!==Je||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=s;d<0&&(d=r.buffer.byteLength,c===Ke?d>>=1:c===Je&&(d>>=2)),r.vertCount=d;var p=l;if(l<0){p=Xe;var g=r.buffer.dimension;1===g&&(p=We),2===g&&(p=qe),3===g&&(p=Xe)}r.primType=p}function d(t){r.elementsCount--,nt(null!==t.buffer,"must not double destroy elements"),delete i[t.id],t.buffer.destroy(),t.buffer=null}function p(e,n){var i=o.create(null,tn,!0),a=new s(i._buffer);function f(e){if(e)if("number"==typeof e)i(e),a.primType=Xe,a.vertCount=0|e,a.type=Ye;else{var n=null,o=nn,r=-1,s=-1,u=0,c=0;Array.isArray(e)||t(e)||we(e)?n=e:(nt.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,nt(Array.isArray(n)||t(n)||we(n),"invalid data for element buffer")),"usage"in e&&(nt.parameter(e.usage,Se,"invalid element buffer usage"),o=Se[e.usage]),"primitive"in e&&(nt.parameter(e.primitive,Ge,"invalid element buffer primitive"),r=Ge[e.primitive]),"count"in e&&(nt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),s=0|e.count),"type"in e&&(nt.parameter(e.type,l,"invalid buffer type"),c=l[e.type]),"length"in e?u=0|e.length:(u=s,c===Ke||c===$e?u*=2:c!==Je&&c!==Qe||(u*=4))),h(a,n,o,r,s,u,c)}else i(),a.primType=Xe,a.vertCount=0,a.type=Ye;return f}return r.elementsCount++,f(e),f._reglType="elements",f._elements=a,f.subdata=function(t,e){return i.subdata(t,e),f},f.destroy=function(){d(a)},f}return{create:p,createStream:u,destroyStream:c,getElements:function(t){return"function"==typeof t&&t._elements instanceof s?t._elements:null},clear:function(){_e(i).forEach(d)}}}var rn=new Float32Array(1),an=new Uint32Array(rn.buffer),ln=5123;function sn(t){for(var e=kt.allocType(ln,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{rn[0]=t[n];var o=an[0],r=o>>>31<<15,i=(o<<1>>>24)-127,a=o>>13&1023;if(i<-24)e[n]=r;else if(i<-14){var l=-14-i;e[n]=r+(a+1024>>l)}else e[n]=i>15?r+31744:r+(i+15<<10)+a}return e}function fn(e){return Array.isArray(e)||t(e)}var un=function(t){return!(t&t-1||!t)},cn=34467,hn=3553,dn=34067,pn=34069,gn=6408,mn=6406,bn=6407,xn=6409,vn=6410,yn=32854,wn=32855,_n=36194,Cn=32819,An=32820,Tn=33635,Ln=34042,En=6402,Bn=34041,Dn=35904,Fn=35906,In=36193,Sn=33776,Rn=33777,On=33778,kn=33779,Nn=35986,Mn=35987,Hn=34798,zn=35840,Pn=35841,Vn=35842,jn=35843,Un=36196,Gn=5121,Wn=5123,qn=5125,Xn=5126,Zn=10242,Yn=10243,$n=10497,Kn=33071,Qn=33648,Jn=10240,to=10241,eo=9728,no=9729,oo=9984,ro=9985,io=9986,ao=9987,lo=33170,so=4352,fo=4353,uo=4354,co=34046,ho=3317,po=37440,go=37441,mo=37443,bo=37444,xo=33984,vo=[oo,io,ro,ao],yo=[0,xn,vn,bn,gn],wo={};function _o(t){return"[object "+t+"]"}wo[xn]=wo[mn]=wo[En]=1,wo[Bn]=wo[vn]=2,wo[bn]=wo[Dn]=3,wo[gn]=wo[Fn]=4;var Co=_o("HTMLCanvasElement"),Ao=_o("OffscreenCanvas"),To=_o("CanvasRenderingContext2D"),Lo=_o("ImageBitmap"),Eo=_o("HTMLImageElement"),Bo=_o("HTMLVideoElement"),Do=Object.keys(Fe).concat([Co,Ao,To,Lo,Eo,Bo]),Fo=[];Fo[Gn]=1,Fo[Xn]=4,Fo[In]=2,Fo[Wn]=2,Fo[qn]=4;var Io=[];function So(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Ro(t){return!!Array.isArray(t)&&!(0===t.length||!fn(t[0]))}function Oo(t){return Object.prototype.toString.call(t)}function ko(t){return Oo(t)===Co}function No(t){return Oo(t)===Ao}function Mo(t){return Oo(t)===To}function Ho(t){return Oo(t)===Lo}function zo(t){return Oo(t)===Eo}function Po(t){return Oo(t)===Bo}function Vo(t){if(!t)return!1;var e=Oo(t);return Do.indexOf(e)>=0||So(t)||Ro(t)||we(t)}function jo(t){return 0|Fe[Object.prototype.toString.call(t)]}function Uo(t,e){var n=e.length;switch(t.type){case Gn:case Wn:case qn:case Xn:var o=kt.allocType(t.type,n);o.set(e),t.data=o;break;case In:t.data=sn(e);break;default:nt.raise("unsupported texture type, must specify a typed array")}}function Go(t,e){return kt.allocType(t.type===In?Xn:t.type,e)}function Wo(t,e){t.type===In?(t.data=sn(e),kt.freeType(e)):t.data=e}function qo(t,e,n,o,r,i){for(var a=t.width,l=t.height,s=t.channels,f=Go(t,a*l*s),u=0,c=0;c<l;++c)for(var h=0;h<a;++h)for(var d=0;d<s;++d)f[u++]=e[n*h+o*c+r*d+i];Wo(t,f)}function Xo(t,e,n,o,r,i){var a;if(a=void 0!==Io[t]?Io[t]:wo[t]*Fo[e],i&&(a*=6),r){for(var l=0,s=n;s>=1;)l+=a*s*s,s/=2;return l}return a*n*o}function Zo(n,o,r,i,a,l,s){var f={"don't care":so,"dont care":so,nice:uo,fast:fo},u={repeat:$n,clamp:Kn,mirror:Qn},c={nearest:eo,linear:no},h=e({mipmap:ao,"nearest mipmap nearest":oo,"linear mipmap nearest":ro,"nearest mipmap linear":io,"linear mipmap linear":ao},c),d={none:0,browser:bo},p={uint8:Gn,rgba4:Cn,rgb565:Tn,"rgb5 a1":An},g={alpha:mn,luminance:xn,"luminance alpha":vn,rgb:bn,rgba:gn,rgba4:yn,"rgb5 a1":wn,rgb565:_n},m={};o.ext_srgb&&(g.srgb=Dn,g.srgba=Fn),o.oes_texture_float&&(p.float32=p.float=Xn),o.oes_texture_half_float&&(p.float16=p["half float"]=In),o.webgl_depth_texture&&(e(g,{depth:En,"depth stencil":Bn}),e(p,{uint16:Wn,uint32:qn,"depth stencil":Ln})),o.webgl_compressed_texture_s3tc&&e(m,{"rgb s3tc dxt1":Sn,"rgba s3tc dxt1":Rn,"rgba s3tc dxt3":On,"rgba s3tc dxt5":kn}),o.webgl_compressed_texture_atc&&e(m,{"rgb atc":Nn,"rgba atc explicit alpha":Mn,"rgba atc interpolated alpha":Hn}),o.webgl_compressed_texture_pvrtc&&e(m,{"rgb pvrtc 4bppv1":zn,"rgb pvrtc 2bppv1":Pn,"rgba pvrtc 4bppv1":Vn,"rgba pvrtc 2bppv1":jn}),o.webgl_compressed_texture_etc1&&(m["rgb etc1"]=Un);var b=Array.prototype.slice.call(n.getParameter(cn));Object.keys(m).forEach((function(t){var e=m[t];b.indexOf(e)>=0&&(g[t]=e)}));var x=Object.keys(g);r.textureFormats=x;var v=[];Object.keys(g).forEach((function(t){var e=g[t];v[e]=t}));var y=[];Object.keys(p).forEach((function(t){var e=p[t];y[e]=t}));var w=[];Object.keys(c).forEach((function(t){var e=c[t];w[e]=t}));var _=[];Object.keys(h).forEach((function(t){var e=h[t];_[e]=t}));var C=[];Object.keys(u).forEach((function(t){var e=u[t];C[e]=t}));var A=x.reduce((function(t,e){var n=g[e];return n===xn||n===mn||n===xn||n===vn||n===En||n===Bn||o.ext_srgb&&(n===Dn||n===Fn)?t[n]=n:n===wn||e.indexOf("rgba")>=0?t[n]=gn:t[n]=bn,t}),{});function T(){this.internalformat=gn,this.format=gn,this.type=Gn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=bo,this.width=0,this.height=0,this.channels=0}function L(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function E(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(nt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(nt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(nt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(nt.parameter(e.colorSpace,d,"invalid colorSpace"),t.colorSpace=d[e.colorSpace]),"type"in e){var n=e.type;nt(o.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),nt(o.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),nt(o.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(n,p,"invalid texture type"),t.type=p[n]}var i=t.width,a=t.height,l=t.channels,s=!1;"shape"in e?(nt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),i=e.shape[0],a=e.shape[1],3===e.shape.length&&(l=e.shape[2],nt(l>0&&l<=4,"invalid number of channels"),s=!0),nt(i>=0&&i<=r.maxTextureSize,"invalid width"),nt(a>=0&&a<=r.maxTextureSize,"invalid height")):("radius"in e&&(i=a=e.radius,nt(i>=0&&i<=r.maxTextureSize,"invalid radius")),"width"in e&&(i=e.width,nt(i>=0&&i<=r.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,nt(a>=0&&a<=r.maxTextureSize,"invalid height")),"channels"in e&&(l=e.channels,nt(l>0&&l<=4,"invalid number of channels"),s=!0)),t.width=0|i,t.height=0|a,t.channels=0|l;var f=!1;if("format"in e){var u=e.format;nt(o.webgl_depth_texture||!("depth"===u||"depth stencil"===u),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(u,g,"invalid texture format");var c=t.internalformat=g[u];t.format=A[c],u in p&&("type"in e||(t.type=p[u])),u in m&&(t.compressed=!0),f=!0}!s&&f?t.channels=wo[t.format]:s&&!f?t.channels!==yo[t.format]&&(t.format=t.internalformat=yo[t.channels]):f&&s&&nt(t.channels===wo[t.format],"number of channels inconsistent with specified format")}}function B(t){n.pixelStorei(po,t.flipY),n.pixelStorei(go,t.premultiplyAlpha),n.pixelStorei(mo,t.colorSpace),n.pixelStorei(ho,t.unpackAlignment)}function D(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function F(e,n){var o=null;if(Vo(n)?o=n:n&&(nt.type(n,"object","invalid pixel data type"),E(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Vo(n.data)&&(o=n.data)),nt(!e.compressed||o instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){nt(!o,"can not specify copy and data field for the same texture");var i=a.viewportWidth,l=a.viewportHeight;e.width=e.width||i-e.xOffset,e.height=e.height||l-e.yOffset,e.needsCopy=!0,nt(e.xOffset>=0&&e.xOffset<i&&e.yOffset>=0&&e.yOffset<l&&e.width>0&&e.width<=i&&e.height>0&&e.height<=l,"copy texture read out of bounds")}else if(o){if(t(o))e.channels=e.channels||4,e.data=o,"type"in n||e.type!==Gn||(e.type=jo(o));else if(So(o))e.channels=e.channels||4,Uo(e,o),e.alignment=1,e.needsFree=!0;else if(we(o)){var s=o.data;Array.isArray(s)||e.type!==Gn||(e.type=jo(s));var f,u,c,h,d,p,g=o.shape,m=o.stride;3===g.length?(c=g[2],p=m[2]):(nt(2===g.length,"invalid ndarray pixel data, must be 2 or 3D"),c=1,p=1),f=g[0],u=g[1],h=m[0],d=m[1],e.alignment=1,e.width=f,e.height=u,e.channels=c,e.format=e.internalformat=yo[c],e.needsFree=!0,qo(e,s,h,d,p,o.offset)}else if(ko(o)||No(o)||Mo(o))ko(o)||No(o)?e.element=o:e.element=o.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(Ho(o))e.element=o,e.width=o.width,e.height=o.height,e.channels=4;else if(zo(o))e.element=o,e.width=o.naturalWidth,e.height=o.naturalHeight,e.channels=4;else if(Po(o))e.element=o,e.width=o.videoWidth,e.height=o.videoHeight,e.channels=4;else if(Ro(o)){var b=e.width||o[0].length,x=e.height||o.length,v=e.channels;v=fn(o[0][0])?v||o[0][0].length:v||1;for(var y=Ce.shape(o),w=1,_=0;_<y.length;++_)w*=y[_];var C=Go(e,w);Ce.flatten(o,y,"",C),Wo(e,C),e.alignment=1,e.width=b,e.height=x,e.channels=v,e.format=e.internalformat=yo[v],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===Xn?nt(r.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===In&&nt(r.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function I(t,e,o){var r=t.element,a=t.data,l=t.internalformat,s=t.format,f=t.type,u=t.width,c=t.height;B(t),r?n.texImage2D(e,o,s,s,f,r):t.compressed?n.compressedTexImage2D(e,o,l,u,c,0,a):t.needsCopy?(i(),n.copyTexImage2D(e,o,s,t.xOffset,t.yOffset,u,c,0)):n.texImage2D(e,o,s,u,c,0,s,f,a||null)}function S(t,e,o,r,a){var l=t.element,s=t.data,f=t.internalformat,u=t.format,c=t.type,h=t.width,d=t.height;B(t),l?n.texSubImage2D(e,a,o,r,u,c,l):t.compressed?n.compressedTexSubImage2D(e,a,o,r,f,h,d,s):t.needsCopy?(i(),n.copyTexSubImage2D(e,a,o,r,t.xOffset,t.yOffset,h,d)):n.texSubImage2D(e,a,o,r,h,d,u,c,s)}var R=[];function O(){return R.pop()||new D}function k(t){t.needsFree&&kt.freeType(t.data),D.call(t),R.push(t)}function N(){T.call(this),this.genMipmaps=!1,this.mipmapHint=so,this.mipmask=0,this.images=Array(16)}function M(t,e,n){var o=t.images[0]=O();t.mipmask=1,o.width=t.width=e,o.height=t.height=n,o.channels=t.channels=4}function H(t,e){var n=null;if(Vo(e))L(n=t.images[0]=O(),t),F(n,e),t.mipmask=1;else if(E(t,e),Array.isArray(e.mipmap))for(var o=e.mipmap,r=0;r<o.length;++r)L(n=t.images[r]=O(),t),n.width>>=r,n.height>>=r,F(n,o[r]),t.mipmask|=1<<r;else L(n=t.images[0]=O(),t),F(n,e),t.mipmask=1;L(t,t.images[0]),!t.compressed||t.internalformat!==Sn&&t.internalformat!==Rn&&t.internalformat!==On&&t.internalformat!==kn||nt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function z(t,e){for(var n=t.images,o=0;o<n.length;++o){if(!n[o])return;I(n[o],e,o)}}var P=[];function V(){var t=P.pop()||new N;T.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function j(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&k(e[n]),e[n]=null;P.push(t)}function U(){this.minFilter=eo,this.magFilter=eo,this.wrapS=Kn,this.wrapT=Kn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=so}function G(t,e){if("min"in e){var n=e.min;nt.parameter(n,h),t.minFilter=h[n],vo.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var o=e.mag;nt.parameter(o,c),t.magFilter=c[o]}var i=t.wrapS,a=t.wrapT;if("wrap"in e){var l=e.wrap;"string"==typeof l?(nt.parameter(l,u),i=a=u[l]):Array.isArray(l)&&(nt.parameter(l[0],u),nt.parameter(l[1],u),i=u[l[0]],a=u[l[1]])}else{if("wrapS"in e){var s=e.wrapS;nt.parameter(s,u),i=u[s]}if("wrapT"in e){var d=e.wrapT;nt.parameter(d,u),a=u[d]}}if(t.wrapS=i,t.wrapT=a,"anisotropic"in e){var p=e.anisotropic;nt("number"==typeof p&&p>=1&&p<=r.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var g=!1;switch(typeof e.mipmap){case"string":nt.parameter(e.mipmap,f,"invalid mipmap hint"),t.mipmapHint=f[e.mipmap],t.genMipmaps=!0,g=!0;break;case"boolean":g=t.genMipmaps=e.mipmap;break;case"object":nt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,g=!0;break;default:nt.raise("invalid mipmap type")}g&&!("min"in e)&&(t.minFilter=oo)}}function W(t,e){n.texParameteri(e,to,t.minFilter),n.texParameteri(e,Jn,t.magFilter),n.texParameteri(e,Zn,t.wrapS),n.texParameteri(e,Yn,t.wrapT),o.ext_texture_filter_anisotropic&&n.texParameteri(e,co,t.anisotropic),t.genMipmaps&&(n.hint(lo,t.mipmapHint),n.generateMipmap(e))}var q=0,X={},Z=r.maxTextureUnits,Y=Array(Z).map((function(){return null}));function $(t){T.call(this),this.mipmask=0,this.internalformat=gn,this.id=q++,this.refCount=1,this.target=t,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new U,s.profile&&(this.stats={size:0})}function K(t){n.activeTexture(xo),n.bindTexture(t.target,t.texture)}function Q(){var t=Y[0];t?n.bindTexture(t.target,t.texture):n.bindTexture(hn,null)}function J(t){var e=t.texture;nt(e,"must not double destroy texture");var o=t.unit,r=t.target;o>=0&&(n.activeTexture(xo+o),n.bindTexture(r,null),Y[o]=null),n.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete X[t.id],l.textureCount--}function tt(t,e){var o=new $(hn);function i(t,e){var n=o.texInfo;U.call(n);var a=V();return"number"==typeof t?M(a,0|t,"number"==typeof e?0|e:0|t):t?(nt.type(t,"object","invalid arguments to regl.texture"),G(n,t),H(a,t)):M(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),o.mipmask=a.mipmask,L(o,a),nt.texture2D(n,a,r),o.internalformat=a.internalformat,i.width=a.width,i.height=a.height,K(o),z(a,hn),W(n,hn),Q(),j(a),s.profile&&(o.stats.size=Xo(o.internalformat,o.type,a.width,a.height,n.genMipmaps,!1)),i.format=v[o.internalformat],i.type=y[o.type],i.mag=w[n.magFilter],i.min=_[n.minFilter],i.wrapS=C[n.wrapS],i.wrapT=C[n.wrapT],i}function a(t,e,n,r){nt(!!t,"must specify image data");var a=0|e,l=0|n,s=0|r,f=O();return L(f,o),f.width=0,f.height=0,F(f,t),f.width=f.width||(o.width>>s)-a,f.height=f.height||(o.height>>s)-l,nt(o.type===f.type&&o.format===f.format&&o.internalformat===f.internalformat,"incompatible format for texture.subimage"),nt(a>=0&&l>=0&&a+f.width<=o.width&&l+f.height<=o.height,"texture.subimage write out of bounds"),nt(o.mipmask&1<<s,"missing mipmap data"),nt(f.data||f.element||f.needsCopy,"missing image data"),K(o),S(f,hn,a,l,s),Q(),k(f),i}function f(t,e){var r=0|t,a=0|e||r;if(r===o.width&&a===o.height)return i;i.width=o.width=r,i.height=o.height=a,K(o);for(var l=0;o.mipmask>>l;++l){var f=r>>l,u=a>>l;if(!f||!u)break;n.texImage2D(hn,l,o.format,f,u,0,o.format,o.type,null)}return Q(),s.profile&&(o.stats.size=Xo(o.internalformat,o.type,r,a,!1,!1)),i}return X[o.id]=o,l.textureCount++,i(t,e),i.subimage=a,i.resize=f,i._reglType="texture2d",i._texture=o,s.profile&&(i.stats=o.stats),i.destroy=function(){o.decRef()},i}function et(t,e,o,i,a,f){var u=new $(dn);X[u.id]=u,l.cubeCount++;var c=new Array(6);function h(t,e,n,o,i,a){var l,f=u.texInfo;for(U.call(f),l=0;l<6;++l)c[l]=V();if("number"!=typeof t&&t)if("object"==typeof t)if(e)H(c[0],t),H(c[1],e),H(c[2],n),H(c[3],o),H(c[4],i),H(c[5],a);else if(G(f,t),E(u,t),"faces"in t){var d=t.faces;for(nt(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),l=0;l<6;++l)nt("object"==typeof d[l]&&!!d[l],"invalid input for cube map face"),L(c[l],u),H(c[l],d[l])}else for(l=0;l<6;++l)H(c[l],t);else nt.raise("invalid arguments to cube map");else{var p=0|t||1;for(l=0;l<6;++l)M(c[l],p,p)}for(L(u,c[0]),r.npotTextureCube||nt(un(u.width)&&un(u.height),"your browser does not support non power or two texture dimensions"),f.genMipmaps?u.mipmask=(c[0].width<<1)-1:u.mipmask=c[0].mipmask,nt.textureCube(u,f,c,r),u.internalformat=c[0].internalformat,h.width=c[0].width,h.height=c[0].height,K(u),l=0;l<6;++l)z(c[l],pn+l);for(W(f,dn),Q(),s.profile&&(u.stats.size=Xo(u.internalformat,u.type,h.width,h.height,f.genMipmaps,!0)),h.format=v[u.internalformat],h.type=y[u.type],h.mag=w[f.magFilter],h.min=_[f.minFilter],h.wrapS=C[f.wrapS],h.wrapT=C[f.wrapT],l=0;l<6;++l)j(c[l]);return h}function d(t,e,n,o,r){nt(!!e,"must specify image data"),nt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var i=0|n,a=0|o,l=0|r,s=O();return L(s,u),s.width=0,s.height=0,F(s,e),s.width=s.width||(u.width>>l)-i,s.height=s.height||(u.height>>l)-a,nt(u.type===s.type&&u.format===s.format&&u.internalformat===s.internalformat,"incompatible format for texture.subimage"),nt(i>=0&&a>=0&&i+s.width<=u.width&&a+s.height<=u.height,"texture.subimage write out of bounds"),nt(u.mipmask&1<<l,"missing mipmap data"),nt(s.data||s.element||s.needsCopy,"missing image data"),K(u),S(s,pn+t,i,a,l),Q(),k(s),h}function p(t){var e=0|t;if(e!==u.width){h.width=u.width=e,h.height=u.height=e,K(u);for(var o=0;o<6;++o)for(var r=0;u.mipmask>>r;++r)n.texImage2D(pn+o,r,u.format,e>>r,e>>r,0,u.format,u.type,null);return Q(),s.profile&&(u.stats.size=Xo(u.internalformat,u.type,h.width,h.height,!1,!0)),h}}return h(t,e,o,i,a,f),h.subimage=d,h.resize=p,h._reglType="textureCube",h._texture=u,s.profile&&(h.stats=u.stats),h.destroy=function(){u.decRef()},h}function ot(){for(var t=0;t<Z;++t)n.activeTexture(xo+t),n.bindTexture(hn,null),Y[t]=null;_e(X).forEach(J),l.cubeCount=0,l.textureCount=0}function rt(){for(var t=0;t<Z;++t){var e=Y[t];e&&(e.bindCount=0,e.unit=-1,Y[t]=null)}_e(X).forEach((function(t){t.texture=n.createTexture(),n.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(0!=(t.mipmask&1<<e))if(t.target===hn)n.texImage2D(hn,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var o=0;o<6;++o)n.texImage2D(pn+o,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);W(t.texInfo,t.target)}))}return e($.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var o=0;o<Z;++o){var r=Y[o];if(r){if(r.bindCount>0)continue;r.unit=-1}Y[o]=t,e=o;break}e>=Z&&nt.raise("insufficient number of texture units"),s.profile&&l.maxTextureUnits<e+1&&(l.maxTextureUnits=e+1),t.unit=e,n.activeTexture(xo+e),n.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&J(this)}}),s.profile&&(l.getTotalTextureSize=function(){var t=0;return Object.keys(X).forEach((function(e){t+=X[e].stats.size})),t}),{create2D:tt,createCube:et,clear:ot,getTexture:function(t){return null},restore:rt}}Io[yn]=2,Io[wn]=2,Io[_n]=2,Io[Bn]=4,Io[Sn]=.5,Io[Rn]=.5,Io[On]=1,Io[kn]=1,Io[Nn]=.5,Io[Mn]=1,Io[Hn]=1,Io[zn]=.5,Io[Pn]=.25,Io[Vn]=.5,Io[jn]=.25,Io[Un]=.5;var Yo=36161,$o=32854,Ko=32855,Qo=36194,Jo=33189,tr=36168,er=34041,nr=35907,or=34836,rr=34842,ir=34843,ar=[];function lr(t,e,n){return ar[t]*e*n}ar[$o]=2,ar[Ko]=2,ar[Qo]=2,ar[Jo]=2,ar[tr]=1,ar[er]=4,ar[nr]=4,ar[or]=16,ar[rr]=8,ar[ir]=6;var sr=function(t,e,n,o,r){var i={rgba4:$o,rgb565:Qo,"rgb5 a1":Ko,depth:Jo,stencil:tr,"depth stencil":er};e.ext_srgb&&(i.srgba=nr),e.ext_color_buffer_half_float&&(i.rgba16f=rr,i.rgb16f=ir),e.webgl_color_buffer_float&&(i.rgba32f=or);var a=[];Object.keys(i).forEach((function(t){var e=i[t];a[e]=t}));var l=0,s={};function f(t){this.id=l++,this.refCount=1,this.renderbuffer=t,this.format=$o,this.width=0,this.height=0,r.profile&&(this.stats={size:0})}function u(e){var n=e.renderbuffer;nt(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(Yo,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete s[e.id],o.renderbufferCount--}function c(e,l){var u=new f(t.createRenderbuffer());function c(e,o){var l=0,s=0,f=$o;if("object"==typeof e&&e){var h=e;if("shape"in h){var d=h.shape;nt(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),l=0|d[0],s=0|d[1]}else"radius"in h&&(l=s=0|h.radius),"width"in h&&(l=0|h.width),"height"in h&&(s=0|h.height);"format"in h&&(nt.parameter(h.format,i,"invalid renderbuffer format"),f=i[h.format])}else"number"==typeof e?(l=0|e,s="number"==typeof o?0|o:l):e?nt.raise("invalid arguments to renderbuffer constructor"):l=s=1;if(nt(l>0&&s>0&&l<=n.maxRenderbufferSize&&s<=n.maxRenderbufferSize,"invalid renderbuffer size"),l!==u.width||s!==u.height||f!==u.format)return c.width=u.width=l,c.height=u.height=s,u.format=f,t.bindRenderbuffer(Yo,u.renderbuffer),t.renderbufferStorage(Yo,f,l,s),nt(0===t.getError(),"invalid render buffer format"),r.profile&&(u.stats.size=lr(u.format,u.width,u.height)),c.format=a[u.format],c}function h(e,o){var i=0|e,a=0|o||i;return i===u.width&&a===u.height||(nt(i>0&&a>0&&i<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),c.width=u.width=i,c.height=u.height=a,t.bindRenderbuffer(Yo,u.renderbuffer),t.renderbufferStorage(Yo,u.format,i,a),nt(0===t.getError(),"invalid render buffer format"),r.profile&&(u.stats.size=lr(u.format,u.width,u.height))),c}return s[u.id]=u,o.renderbufferCount++,c(e,l),c.resize=h,c._reglType="renderbuffer",c._renderbuffer=u,r.profile&&(c.stats=u.stats),c.destroy=function(){u.decRef()},c}function h(){_e(s).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Yo,e.renderbuffer),t.renderbufferStorage(Yo,e.format,e.width,e.height)})),t.bindRenderbuffer(Yo,null)}return f.prototype.decRef=function(){--this.refCount<=0&&u(this)},r.profile&&(o.getTotalRenderbufferSize=function(){var t=0;return Object.keys(s).forEach((function(e){t+=s[e].stats.size})),t}),{create:c,clear:function(){_e(s).forEach(u)},restore:h}},fr=36160,ur=36161,cr=3553,hr=34069,dr=36064,pr=36096,gr=36128,mr=33306,br=36053,xr=36054,vr=36055,yr=36057,wr=36061,_r=36193,Cr=5121,Ar=5126,Tr=6407,Lr=6408,Er=6402,Br=[Tr,Lr],Dr=[];Dr[Lr]=4,Dr[Tr]=3;var Fr=[];Fr[Cr]=1,Fr[Ar]=4,Fr[_r]=2;var Ir=33189,Sr=36168,Rr=34041,Or=[32854,32855,36194,35907,34842,34843,34836],kr={};function Nr(t,n,o,r,i,a){var l={cur:null,next:null,dirty:!1,setFBO:null},s=["rgba"],f=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&f.push("srgba"),n.ext_color_buffer_half_float&&f.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&f.push("rgba32f");var u=["uint8"];function c(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var o=0,r=0;e?(o=e.width,r=e.height):n&&(o=n.width,r=n.height),this.width=o,this.height=r}function h(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function d(t,e,n){if(t)if(t.texture){var o=t.texture._texture,r=Math.max(1,o.width),i=Math.max(1,o.height);nt(r===e&&i===n,"inconsistent width/height for supplied texture"),o.refCount+=1}else{var a=t.renderbuffer._renderbuffer;nt(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(e,n){n&&(n.texture?t.framebufferTexture2D(fr,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(fr,e,ur,n.renderbuffer._renderbuffer.renderbuffer))}function g(t){var e=cr,n=null,o=null,r=t;"object"==typeof t&&(r=t.data,"target"in t&&(e=0|t.target)),nt.type(r,"function","invalid attachment data");var i=r._reglType;return"texture2d"===i?(n=r,nt(e===cr)):"textureCube"===i?(n=r,nt(e>=hr&&e<hr+6,"invalid cube map target")):"renderbuffer"===i?(o=r,e=ur):nt.raise("invalid regl object for attachment"),new c(e,n,o)}function m(t,e,n,o,a){if(n){var l=r.create2D({width:t,height:e,format:o,type:a});return l._texture.refCount=0,new c(cr,l,null)}var s=i.create({width:t,height:e,format:o});return s._renderbuffer.refCount=0,new c(ur,null,s)}function b(t){return t&&(t.texture||t.renderbuffer)}function x(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}n.oes_texture_half_float&&u.push("half float","float16"),n.oes_texture_float&&u.push("float","float32");var v=0,y={};function w(){this.id=v++,y[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function _(t){t.colorAttachments.forEach(h),h(t.depthAttachment),h(t.stencilAttachment),h(t.depthStencilAttachment)}function C(e){var n=e.framebuffer;nt(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete y[e.id]}function A(e){var n;t.bindFramebuffer(fr,e.framebuffer);var r=e.colorAttachments;for(n=0;n<r.length;++n)p(dr+n,r[n]);for(n=r.length;n<o.maxColorAttachments;++n)t.framebufferTexture2D(fr,dr+n,cr,null,0);t.framebufferTexture2D(fr,mr,cr,null,0),t.framebufferTexture2D(fr,pr,cr,null,0),t.framebufferTexture2D(fr,gr,cr,null,0),p(pr,e.depthAttachment),p(gr,e.stencilAttachment),p(mr,e.depthStencilAttachment);var i=t.checkFramebufferStatus(fr);t.isContextLost()||i===br||nt.raise("framebuffer configuration not supported, status = "+kr[i]),t.bindFramebuffer(fr,l.next?l.next.framebuffer:null),l.cur=l.next,t.getError()}function T(t,r){var i=new w;function c(t,e){var r;nt(l.next!==i,"can not update framebuffer which is currently in use");var a=0,h=0,p=!0,x=!0,v=null,y=!0,w="rgba",C="uint8",T=1,L=null,E=null,B=null,D=!1;if("number"==typeof t)a=0|t,h=0|e||a;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var F=t;if("shape"in F){var I=F.shape;nt(Array.isArray(I)&&I.length>=2,"invalid shape for framebuffer"),a=I[0],h=I[1]}else"radius"in F&&(a=h=F.radius),"width"in F&&(a=F.width),"height"in F&&(h=F.height);("color"in F||"colors"in F)&&(v=F.color||F.colors,Array.isArray(v)&&nt(1===v.length||n.webgl_draw_buffers,"multiple render targets not supported")),v||("colorCount"in F&&(T=0|F.colorCount,nt(T>0,"invalid color buffer count")),"colorTexture"in F&&(y=!!F.colorTexture,w="rgba4"),"colorType"in F&&(C=F.colorType,y?(nt(n.oes_texture_float||!("float"===C||"float32"===C),"you must enable OES_texture_float in order to use floating point framebuffer objects"),nt(n.oes_texture_half_float||!("half float"===C||"float16"===C),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===C||"float16"===C?(nt(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),w="rgba16f"):"float"!==C&&"float32"!==C||(nt(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),w="rgba32f"),nt.oneOf(C,u,"invalid color type")),"colorFormat"in F&&(w=F.colorFormat,s.indexOf(w)>=0?y=!0:f.indexOf(w)>=0?y=!1:y?nt.oneOf(F.colorFormat,s,"invalid color format for texture"):nt.oneOf(F.colorFormat,f,"invalid color format for renderbuffer"))),("depthTexture"in F||"depthStencilTexture"in F)&&(D=!(!F.depthTexture&&!F.depthStencilTexture),nt(!D||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in F&&("boolean"==typeof F.depth?p=F.depth:(L=F.depth,x=!1)),"stencil"in F&&("boolean"==typeof F.stencil?x=F.stencil:(E=F.stencil,p=!1)),"depthStencil"in F&&("boolean"==typeof F.depthStencil?p=x=F.depthStencil:(B=F.depthStencil,p=!1,x=!1))}else a=h=1;var S=null,R=null,O=null,k=null;if(Array.isArray(v))S=v.map(g);else if(v)S=[g(v)];else for(S=new Array(T),r=0;r<T;++r)S[r]=m(a,h,y,w,C);nt(n.webgl_draw_buffers||S.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),nt(S.length<=o.maxColorAttachments,"too many color attachments, not supported"),a=a||S[0].width,h=h||S[0].height,L?R=g(L):p&&!x&&(R=m(a,h,D,"depth","uint32")),E?O=g(E):x&&!p&&(O=m(a,h,!1,"stencil","uint8")),B?k=g(B):!L&&!E&&x&&p&&(k=m(a,h,D,"depth stencil","depth stencil")),nt(!!L+!!E+!!B<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var N=null;for(r=0;r<S.length;++r)if(d(S[r],a,h),nt(!S[r]||S[r].texture&&Br.indexOf(S[r].texture._texture.format)>=0||S[r].renderbuffer&&Or.indexOf(S[r].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+r+" is invalid"),S[r]&&S[r].texture){var M=Dr[S[r].texture._texture.format]*Fr[S[r].texture._texture.type];null===N?N=M:nt(N===M,"all color attachments much have the same number of bits per pixel.")}return d(R,a,h),nt(!R||R.texture&&R.texture._texture.format===Er||R.renderbuffer&&R.renderbuffer._renderbuffer.format===Ir,"invalid depth attachment for framebuffer object"),d(O,a,h),nt(!O||O.renderbuffer&&O.renderbuffer._renderbuffer.format===Sr,"invalid stencil attachment for framebuffer object"),d(k,a,h),nt(!k||k.texture&&k.texture._texture.format===Rr||k.renderbuffer&&k.renderbuffer._renderbuffer.format===Rr,"invalid depth-stencil attachment for framebuffer object"),_(i),i.width=a,i.height=h,i.colorAttachments=S,i.depthAttachment=R,i.stencilAttachment=O,i.depthStencilAttachment=k,c.color=S.map(b),c.depth=b(R),c.stencil=b(O),c.depthStencil=b(k),c.width=i.width,c.height=i.height,A(i),c}function h(t,e){nt(l.next!==i,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),o=Math.max(0|e||n,1);if(n===i.width&&o===i.height)return c;for(var r=i.colorAttachments,a=0;a<r.length;++a)x(r[a],n,o);return x(i.depthAttachment,n,o),x(i.stencilAttachment,n,o),x(i.depthStencilAttachment,n,o),i.width=c.width=n,i.height=c.height=o,A(i),c}return a.framebufferCount++,c(t,r),e(c,{resize:h,_reglType:"framebuffer",_framebuffer:i,destroy:function(){C(i),_(i)},use:function(t){l.setFBO({framebuffer:c},t)}})}function L(t){var i=Array(6);function a(t){var o;nt(i.indexOf(l.next)<0,"can not update framebuffer which is currently in use");var f,c={color:null},h=0,d=null,p="rgba",g="uint8",m=1;if("number"==typeof t)h=0|t;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var b=t;if("shape"in b){var x=b.shape;nt(Array.isArray(x)&&x.length>=2,"invalid shape for framebuffer"),nt(x[0]===x[1],"cube framebuffer must be square"),h=x[0]}else"radius"in b&&(h=0|b.radius),"width"in b?(h=0|b.width,"height"in b&&nt(b.height===h,"must be square")):"height"in b&&(h=0|b.height);("color"in b||"colors"in b)&&(d=b.color||b.colors,Array.isArray(d)&&nt(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in b&&(m=0|b.colorCount,nt(m>0,"invalid color buffer count")),"colorType"in b&&(nt.oneOf(b.colorType,u,"invalid color type"),g=b.colorType),"colorFormat"in b&&(p=b.colorFormat,nt.oneOf(b.colorFormat,s,"invalid color format for texture"))),"depth"in b&&(c.depth=b.depth),"stencil"in b&&(c.stencil=b.stencil),"depthStencil"in b&&(c.depthStencil=b.depthStencil)}else h=1;if(d)if(Array.isArray(d))for(f=[],o=0;o<d.length;++o)f[o]=d[o];else f=[d];else{f=Array(m);var v={radius:h,format:p,type:g};for(o=0;o<m;++o)f[o]=r.createCube(v)}for(c.color=Array(f.length),o=0;o<f.length;++o){var y=f[o];nt("function"==typeof y&&"textureCube"===y._reglType,"invalid cube map"),h=h||y.width,nt(y.width===h&&y.height===h,"invalid cube map shape"),c.color[o]={target:hr,data:f[o]}}for(o=0;o<6;++o){for(var w=0;w<f.length;++w)c.color[w].target=hr+o;o>0&&(c.depth=i[0].depth,c.stencil=i[0].stencil,c.depthStencil=i[0].depthStencil),i[o]?i[o](c):i[o]=T(c)}return e(a,{width:h,height:h,color:f})}function f(t){var e,n=0|t;if(nt(n>0&&n<=o.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var r=a.color;for(e=0;e<r.length;++e)r[e].resize(n);for(e=0;e<6;++e)i[e].resize(n);return a.width=a.height=n,a}return a(t),e(a,{faces:i,resize:f,_reglType:"framebufferCube",destroy:function(){i.forEach((function(t){t.destroy()}))}})}function E(){l.cur=null,l.next=null,l.dirty=!0,_e(y).forEach((function(e){e.framebuffer=t.createFramebuffer(),A(e)}))}return e(l,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof w)return e}return null},create:T,createCube:L,clear:function(){_e(y).forEach(C)},restore:E})}kr[br]="complete",kr[xr]="incomplete attachment",kr[yr]="incomplete dimensions",kr[vr]="incomplete, missing attachment",kr[wr]="unsupported";var Mr=5126,Hr=34962;function zr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Mr,this.offset=0,this.stride=0,this.divisor=0}function Pr(e,n,o,r,i){for(var a=o.maxAttributes,l=new Array(a),s=0;s<a;++s)l[s]=new zr;var f=0,u={},c={Record:zr,scope:{},state:l,currentVAO:null,targetVAO:null,restore:d()?y:function(){},createVAO:w,getVAO:g,destroyBuffer:h,setVAO:d()?m:b,clear:d()?x:function(){}};function h(t){for(var n=0;n<l.length;++n){var o=l[n];o.buffer===t&&(e.disableVertexAttribArray(n),o.buffer=null)}}function d(){return n.oes_vertex_array_object}function p(){return n.angle_instanced_arrays}function g(t){return"function"==typeof t&&t._vao?t._vao:null}function m(t){if(t!==c.currentVAO){var e=d();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),c.currentVAO=t}}function b(t){if(t!==c.currentVAO){if(t)t.bindAttrs();else for(var n=p(),o=0;o<l.length;++o){var r=l[o];r.buffer?(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,r.size,r.type,r.normalized,r.stride,r.offfset),n&&n.vertexAttribDivisorANGLE(o,r.divisor)):(e.disableVertexAttribArray(o),e.vertexAttrib4f(o,r.x,r.y,r.z,r.w))}c.currentVAO=t}}function x(){_e(u).forEach((function(t){t.destroy()}))}function v(){this.id=++f,this.attributes=[];var t=d();this.vao=t?t.createVertexArrayOES():null,u[this.id]=this,this.buffers=[]}function y(){d()&&_e(u).forEach((function(t){t.refresh()}))}function w(e){var o=new v;function l(e){nt(Array.isArray(e),"arguments to vertex array constructor must be an array"),nt(e.length<a,"too many attributes"),nt(e.length>0,"must specify at least one attribute");for(var r=0;r<o.buffers.length;++r)o.buffers[r].destroy();o.buffers.length=0;var s=o.attributes;s.length=e.length;for(var f=0;f<e.length;++f){var u=e[f],c=s[f]=new zr;if(Array.isArray(u)||t(u)||we(u)){var h=i.create(u,Hr,!1,!0);c.buffer=i.getBuffer(h),c.size=0|c.buffer.dimension,c.normalized=!1,c.type=c.buffer.dtype,c.offset=0,c.stride=0,c.divisor=0,c.state=1,o.buffers.push(h)}else i.getBuffer(u)?(c.buffer=i.getBuffer(u),c.size=0|c.buffer.dimension,c.normalized=!1,c.type=c.buffer.dtype,c.offset=0,c.stride=0,c.divisor=0,c.state=1):i.getBuffer(u.buffer)?(c.buffer=i.getBuffer(u.buffer),c.size=0|(+u.size||c.buffer.dimension),c.normalized=!!u.normalized||!1,"type"in u?(nt.parameter(u.type,Ie,"invalid buffer type"),c.type=Ie[u.type]):c.type=c.buffer.dtype,c.offset=0|(u.offset||0),c.stride=0|(u.stride||0),c.divisor=0|(u.divisor||0),c.state=1,nt(c.size>=1&&c.size<=4,"size must be between 1 and 4"),nt(c.offset>=0,"invalid offset"),nt(c.stride>=0&&c.stride<=255,"stride must be between 0 and 255"),nt(c.divisor>=0,"divisor must be positive"),nt(!c.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in u?(nt(f>0,"first attribute must not be a constant"),c.x=+u.x||0,c.y=+u.y||0,c.z=+u.z||0,c.w=+u.w||0,c.state=2):nt(!1,"invalid attribute spec for location "+f)}return o.refresh(),l}return r.vaoCount+=1,l.destroy=function(){o.destroy()},l._vao=o,l._reglType="vao",l(e)}return v.prototype.bindAttrs=function(){for(var t=p(),n=this.attributes,o=0;o<n.length;++o){var r=n[o];r.buffer?(e.enableVertexAttribArray(o),e.bindBuffer(Hr,r.buffer.buffer),e.vertexAttribPointer(o,r.size,r.type,r.normalized,r.stride,r.offset),t&&t.vertexAttribDivisorANGLE(o,r.divisor)):(e.disableVertexAttribArray(o),e.vertexAttrib4f(o,r.x,r.y,r.z,r.w))}for(var i=n.length;i<a;++i)e.disableVertexAttribArray(i)},v.prototype.refresh=function(){var t=d();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),c.currentVAO=this)},v.prototype.destroy=function(){if(this.vao){var t=d();this===c.currentVAO&&(c.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}u[this.id]&&(delete u[this.id],r.vaoCount-=1)},c}var Vr=35632,jr=35633,Ur=35718,Gr=35721;function Wr(t,e,n,o){var r={},i={};function a(t,e,n,o){this.name=t,this.id=e,this.location=n,this.info=o}function l(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function s(n,o,a){var l=n===Vr?r:i,s=l[o];if(!s){var f=e.str(o);s=t.createShader(n),t.shaderSource(s,f),t.compileShader(s),nt.shaderError(t,s,f,n,a),l[o]=s}return s}var f={},u=[],c=0;function h(t,e){this.id=c++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],o.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,i){var f,u,c=s(Vr,n.fragId),h=s(jr,n.vertId),d=n.program=t.createProgram();if(t.attachShader(d,c),t.attachShader(d,h),i)for(f=0;f<i.length;++f){var p=i[f];t.bindAttribLocation(d,p[0],p[1])}t.linkProgram(d),nt.linkError(t,d,e.str(n.fragId),e.str(n.vertId),r);var g=t.getProgramParameter(d,Ur);o.profile&&(n.stats.uniformsCount=g);var m=n.uniforms;for(f=0;f<g;++f)if(u=t.getActiveUniform(d,f))if(u.size>1)for(var b=0;b<u.size;++b){var x=u.name.replace("[0]","["+b+"]");l(m,new a(x,e.id(x),t.getUniformLocation(d,x),u))}else l(m,new a(u.name,e.id(u.name),t.getUniformLocation(d,u.name),u));var v=t.getProgramParameter(d,Gr);o.profile&&(n.stats.attributesCount=v);var y=n.attributes;for(f=0;f<v;++f)(u=t.getActiveAttrib(d,f))&&l(y,new a(u.name,e.id(u.name),t.getAttribLocation(d,u.name),u))}function p(){r={},i={};for(var t=0;t<u.length;++t)d(u[t],null,u[t].attributes.map((function(t){return[t.location,t.name]})))}return o.profile&&(n.getMaxUniformsCount=function(){var t=0;return u.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},n.getMaxAttributesCount=function(){var t=0;return u.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);_e(r).forEach(e),r={},_e(i).forEach(e),i={},u.forEach((function(e){t.deleteProgram(e.program)})),u.length=0,f={},n.shaderCount=0},program:function(t,e,o,r){nt.command(t>=0,"missing vertex shader",o),nt.command(e>=0,"missing fragment shader",o);var i=f[e];i||(i=f[e]={});var a=i[t];if(a&&!r)return a;var l=new h(e,t);return n.shaderCount++,d(l,o,r),a||(i[t]=l),u.push(l),l},restore:p,shader:s,frag:-1,vert:-1}}var qr=6408,Xr=5121,Zr=3333,Yr=5126;function $r(e,n,o,r,i,a,l){function s(s){var f;null===n.next?(nt(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),f=Xr):(nt(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),f=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(nt(f===Xr||f===Yr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),f===Yr&&nt(l.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):nt(f===Xr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var u=0,c=0,h=r.framebufferWidth,d=r.framebufferHeight,p=null;t(s)?p=s:s&&(nt.type(s,"object","invalid arguments to regl.read()"),u=0|s.x,c=0|s.y,nt(u>=0&&u<r.framebufferWidth,"invalid x offset for regl.read"),nt(c>=0&&c<r.framebufferHeight,"invalid y offset for regl.read"),h=0|(s.width||r.framebufferWidth-u),d=0|(s.height||r.framebufferHeight-c),p=s.data||null),p&&(f===Xr?nt(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):f===Yr&&nt(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),nt(h>0&&h+u<=r.framebufferWidth,"invalid width for read pixels"),nt(d>0&&d+c<=r.framebufferHeight,"invalid height for read pixels"),o();var g=h*d*4;return p||(f===Xr?p=new Uint8Array(g):f===Yr&&(p=p||new Float32Array(g))),nt.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),nt(p.byteLength>=g,"data buffer for regl.read() too small"),e.pixelStorei(Zr,4),e.readPixels(u,c,h,d,qr,f,p),p}function f(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=s(t)})),e}function u(t){return t&&"framebuffer"in t?f(t):s(t)}return u}function Kr(t){return Array.prototype.slice.call(t)}function Qr(t){return Kr(t).join("")}function Jr(){var t=0,n=[],o=[];function r(e){for(var r=0;r<o.length;++r)if(o[r]===e)return n[r];var i="g"+t++;return n.push(i),o.push(e),i}function i(){var n=[];function o(){n.push.apply(n,Kr(arguments))}var r=[];function i(){var e="v"+t++;return r.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,Kr(arguments)),n.push(";")),e}return e(o,{def:i,toString:function(){return Qr([r.length>0?"var "+r.join(",")+";":"",Qr(n)])}})}function a(){var t=i(),n=i(),o=t.toString,r=n.toString;function a(e,o){n(e,o,"=",t.def(e,o),";")}return e((function(){t.apply(t,Kr(arguments))}),{def:t.def,entry:t,exit:n,save:a,set:function(e,n,o){a(e,n),t(e,n,"=",o,";")},toString:function(){return o()+r()}})}function l(){var t=Qr(arguments),n=a(),o=a(),r=n.toString,i=o.toString;return e(n,{then:function(){return n.apply(n,Kr(arguments)),this},else:function(){return o.apply(o,Kr(arguments)),this},toString:function(){var e=i();return e&&(e="else{"+e+"}"),Qr(["if(",t,"){",r(),"}",e])}})}var s=i(),f={};function u(t,n){var o=[];function r(){var t="a"+o.length;return o.push(t),t}n=n||0;for(var i=0;i<n;++i)r();var l=a(),s=l.toString;return f[t]=e(l,{arg:r,toString:function(){return Qr(["function(",o.join(),"){",s(),"}"])}})}function c(){var t=['"use strict";',s,"return {"];Object.keys(f).forEach((function(e){t.push('"',e,'":',f[e].toString(),",")})),t.push("}");var e=Qr(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,o)}return{global:s,link:r,block:i,proc:u,scope:a,cond:l,compile:c}}var ti="xyzw".split(""),ei=5121,ni=1,oi=2,ri=0,ii=1,ai=2,li=3,si=4,fi="dither",ui="blend.enable",ci="blend.color",hi="blend.equation",di="blend.func",pi="depth.enable",gi="depth.func",mi="depth.range",bi="depth.mask",xi="colorMask",vi="cull.enable",yi="cull.face",wi="frontFace",_i="lineWidth",Ci="polygonOffset.enable",Ai="polygonOffset.offset",Ti="sample.alpha",Li="sample.enable",Ei="sample.coverage",Bi="stencil.enable",Di="stencil.mask",Fi="stencil.func",Ii="stencil.opFront",Si="stencil.opBack",Ri="scissor.enable",Oi="scissor.box",ki="viewport",Ni="profile",Mi="framebuffer",Hi="vert",zi="frag",Pi="elements",Vi="primitive",ji="count",Ui="offset",Gi="instances",Wi="vao",qi="Width",Xi="Height",Zi=Mi+qi,Yi=Mi+Xi,$i=ki+qi,Ki=ki+Xi,Qi="drawingBuffer",Ji=Qi+qi,ta=Qi+Xi,ea=[di,hi,Fi,Ii,Si,Ei,ki,Oi,Ai],na=34962,oa=34963,ra=3553,ia=34067,aa=2884,la=3042,sa=3024,fa=2960,ua=2929,ca=3089,ha=32823,da=32926,pa=32928,ga=5126,ma=35664,ba=35665,xa=35666,va=5124,ya=35667,wa=35668,_a=35669,Ca=35670,Aa=35671,Ta=35672,La=35673,Ea=35674,Ba=35675,Da=35676,Fa=35678,Ia=35680,Sa=4,Ra=1028,Oa=1029,ka=2304,Na=2305,Ma=32775,Ha=32776,za=519,Pa=7680,Va=0,ja=1,Ua=32774,Ga=513,Wa=36160,qa=36064,Xa={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Za=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ya={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$a={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ka={frag:35632,vert:35633},Qa={cw:ka,ccw:Na};function Ja(e){return Array.isArray(e)||t(e)||we(e)}function tl(t){return t.sort((function(t,e){return t===ki?-1:e===ki?1:t<e?-1:1}))}function el(t,e,n,o){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=o}function nl(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function ol(t){return new el(!1,!1,!1,t)}function rl(t,e){var n=t.type;if(n===ri){var o=t.data.length;return new el(!0,o>=1,o>=2,e)}if(n===si){var r=t.data;return new el(r.thisDep,r.contextDep,r.propDep,e)}return new el(n===li,n===ai,n===ii,e)}var il=new el(!1,!1,!1,(function(){}));function al(t,e,n,o,r,i,a,l,s,f,u,c,h,d,p){var g=f.Record,m={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(m.min=Ma,m.max=Ha);var b=n.angle_instanced_arrays,x=n.webgl_draw_buffers,v={dirty:!0,profile:p.profile},y={},w=[],_={},C={};function A(t){return t.replace(".","_")}function T(t,e,n){var o=A(t);w.push(t),y[o]=v[o]=!!n,_[o]=e}function L(t,e,n){var o=A(t);w.push(t),Array.isArray(n)?(v[o]=n.slice(),y[o]=n.slice()):v[o]=y[o]=n,C[o]=e}T(fi,sa),T(ui,la),L(ci,"blendColor",[0,0,0,0]),L(hi,"blendEquationSeparate",[Ua,Ua]),L(di,"blendFuncSeparate",[ja,Va,ja,Va]),T(pi,ua,!0),L(gi,"depthFunc",Ga),L(mi,"depthRange",[0,1]),L(bi,"depthMask",!0),L(xi,xi,[!0,!0,!0,!0]),T(vi,aa),L(yi,"cullFace",Oa),L(wi,wi,Na),L(_i,_i,1),T(Ci,ha),L(Ai,"polygonOffset",[0,0]),T(Ti,da),T(Li,pa),L(Ei,"sampleCoverage",[1,!1]),T(Bi,fa),L(Di,"stencilMask",-1),L(Fi,"stencilFunc",[za,0,-1]),L(Ii,"stencilOpSeparate",[Ra,Pa,Pa,Pa]),L(Si,"stencilOpSeparate",[Oa,Pa,Pa,Pa]),T(Ri,ca),L(Oi,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),L(ki,ki,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var E={gl:t,context:h,strings:e,next:y,current:v,draw:c,elements:i,buffer:r,shader:u,attributes:f.state,vao:f,uniforms:s,framebuffer:l,extensions:n,timer:d,isBufferArgs:Ja},B={primTypes:Ge,compareFuncs:Ya,blendFuncs:Xa,blendEquations:m,stencilOps:$a,glTypes:Ie,orientationType:Qa};nt.optional((function(){E.isArrayLike=fn})),x&&(B.backBuffer=[Oa],B.drawBuffer=At(o.maxDrawbuffers,(function(t){return 0===t?[0]:At(t,(function(t){return qa+t}))})));var D=0;function F(){var t=Jr(),n=t.link,o=t.global;t.id=D++,t.batchId="0";var r=n(E),i=t.shared={props:"a0"};Object.keys(E).forEach((function(t){i[t]=o.def(r,".",t)})),nt.optional((function(){t.CHECK=n(nt),t.commandStr=nt.guessCommand(),t.command=n(t.commandStr),t.assert=function(t,e,o){t("if(!(",e,"))",this.CHECK,".commandRaise(",n(o),",",this.command,");")},B.invalidBlendCombinations=Za}));var a=t.next={},l=t.current={};Object.keys(C).forEach((function(t){Array.isArray(v[t])&&(a[t]=o.def(i.next,".",t),l[t]=o.def(i.current,".",t))}));var s=t.constants={};Object.keys(B).forEach((function(t){s[t]=o.def(JSON.stringify(B[t]))})),t.invoke=function(e,o){switch(o.type){case ri:var r=["this",i.context,i.props,t.batchId];return e.def(n(o.data),".call(",r.slice(0,Math.max(o.data.length+1,4)),")");case ii:return e.def(i.props,o.data);case ai:return e.def(i.context,o.data);case li:return e.def("this",o.data);case si:return o.data.append(t,e),o.data.ref}},t.attribCache={};var u={};return t.scopeAttrib=function(t){var o=e.id(t);if(o in u)return u[o];var r=f.scope[o];return r||(r=f.scope[o]=new g),u[o]=n(r)},t}function I(t){var e,n=t.static,o=t.dynamic;if(Ni in n){var r=!!n[Ni];(e=ol((function(t,e){return r}))).enable=r}else if(Ni in o){var i=o[Ni];e=rl(i,(function(t,e){return t.invoke(e,i)}))}return e}function S(t,e){var n=t.static,o=t.dynamic;if(Mi in n){var r=n[Mi];return r?(r=l.getFramebuffer(r),nt.command(r,"invalid framebuffer object"),ol((function(t,e){var n=t.link(r),o=t.shared;e.set(o.framebuffer,".next",n);var i=o.context;return e.set(i,"."+Zi,n+".width"),e.set(i,"."+Yi,n+".height"),n}))):ol((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var o=n.context;return e.set(o,"."+Zi,o+"."+Ji),e.set(o,"."+Yi,o+"."+ta),"null"}))}if(Mi in o){var i=o[Mi];return rl(i,(function(t,e){var n=t.invoke(e,i),o=t.shared,r=o.framebuffer,a=e.def(r,".getFramebuffer(",n,")");nt.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(r,".next",a);var l=o.context;return e.set(l,"."+Zi,a+"?"+a+".width:"+l+"."+Ji),e.set(l,"."+Yi,a+"?"+a+".height:"+l+"."+ta),a}))}return null}function R(t,e,n){var o=t.static,r=t.dynamic;function i(t){if(t in o){var i=o[t];nt.commandType(i,"object","invalid "+t,n.commandStr);var a,l,s=!0,f=0|i.x,u=0|i.y;return"width"in i?(a=0|i.width,nt.command(a>=0,"invalid "+t,n.commandStr)):s=!1,"height"in i?(l=0|i.height,nt.command(l>=0,"invalid "+t,n.commandStr)):s=!1,new el(!s&&e&&e.thisDep,!s&&e&&e.contextDep,!s&&e&&e.propDep,(function(t,e){var n=t.shared.context,o=a;"width"in i||(o=e.def(n,".",Zi,"-",f));var r=l;return"height"in i||(r=e.def(n,".",Yi,"-",u)),[f,u,o,r]}))}if(t in r){var c=r[t],h=rl(c,(function(e,n){var o=e.invoke(n,c);nt.optional((function(){e.assert(n,o+"&&typeof "+o+'==="object"',"invalid "+t)}));var r=e.shared.context,i=n.def(o,".x|0"),a=n.def(o,".y|0"),l=n.def('"width" in ',o,"?",o,".width|0:","(",r,".",Zi,"-",i,")"),s=n.def('"height" in ',o,"?",o,".height|0:","(",r,".",Yi,"-",a,")");return nt.optional((function(){e.assert(n,l+">=0&&"+s+">=0","invalid "+t)})),[i,a,l,s]}));return e&&(h.thisDep=h.thisDep||e.thisDep,h.contextDep=h.contextDep||e.contextDep,h.propDep=h.propDep||e.propDep),h}return e?new el(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Zi),e.def(n,".",Yi)]})):null}var a=i(ki);if(a){var l=a;a=new el(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=l.append(t,e),o=t.shared.context;return e.set(o,"."+$i,n[2]),e.set(o,"."+Ki,n[3]),n}))}return{viewport:a,scissor_box:i(Oi)}}function O(t,e){var n=t.static;if("string"==typeof n[zi]&&"string"==typeof n[Hi]){if(Object.keys(e.dynamic).length>0)return null;var o=e.static,r=Object.keys(o);if(r.length>0&&"number"==typeof o[r[0]]){for(var i=[],a=0;a<r.length;++a)nt("number"==typeof o[r[a]],"must specify all vertex attribute locations when using vaos"),i.push([0|o[r[a]],r[a]]);return i}}return null}function k(t,n,o){var r=t.static,i=t.dynamic;function a(t){if(t in r){var n=e.id(r[t]);nt.optional((function(){u.shader(Ka[t],n,nt.guessCommand())}));var o=ol((function(){return n}));return o.id=n,o}if(t in i){var a=i[t];return rl(a,(function(e,n){var o=e.invoke(n,a),r=n.def(e.shared.strings,".id(",o,")");return nt.optional((function(){n(e.shared.shader,".shader(",Ka[t],",",r,",",e.command,");")})),r}))}return null}var l,s=a(zi),f=a(Hi),c=null;return nl(s)&&nl(f)?(c=u.program(f.id,s.id,null,o),l=ol((function(t,e){return t.link(c)}))):l=new el(s&&s.thisDep||f&&f.thisDep,s&&s.contextDep||f&&f.contextDep,s&&s.propDep||f&&f.propDep,(function(t,e){var n,o=t.shared.shader;n=s?s.append(t,e):e.def(o,".",zi);var r=o+".program("+(f?f.append(t,e):e.def(o,".",Hi))+","+n;return nt.optional((function(){r+=","+t.command})),e.def(r+")")})),{frag:s,vert:f,progVar:l,program:c}}function N(t,e){var n=t.static,o=t.dynamic;function r(){if(Pi in n){var t=n[Pi];Ja(t)?t=i.getElements(i.create(t,!0)):t&&(t=i.getElements(t),nt.command(t,"invalid elements",e.commandStr));var r=ol((function(e,n){if(t){var o=e.link(t);return e.ELEMENTS=o,o}return e.ELEMENTS=null,null}));return r.value=t,r}if(Pi in o){var a=o[Pi];return rl(a,(function(t,e){var n=t.shared,o=n.isBufferArgs,r=n.elements,i=t.invoke(e,a),l=e.def("null"),s=e.def(o,"(",i,")"),f=t.cond(s).then(l,"=",r,".createStream(",i,");").else(l,"=",r,".getElements(",i,");");return nt.optional((function(){t.assert(f.else,"!"+i+"||"+l,"invalid elements")})),e.entry(f),e.exit(t.cond(s).then(r,".destroyStream(",l,");")),t.ELEMENTS=l,l}))}return null}var a=r();function l(){if(Vi in n){var t=n[Vi];return nt.commandParameter(t,Ge,"invalid primitve",e.commandStr),ol((function(e,n){return Ge[t]}))}if(Vi in o){var r=o[Vi];return rl(r,(function(t,e){var n=t.constants.primTypes,o=t.invoke(e,r);return nt.optional((function(){t.assert(e,o+" in "+n,"invalid primitive, must be one of "+Object.keys(Ge))})),e.def(n,"[",o,"]")}))}return a?nl(a)?a.value?ol((function(t,e){return e.def(t.ELEMENTS,".primType")})):ol((function(){return Sa})):new el(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",Sa)})):null}function s(t,r){if(t in n){var i=0|n[t];return nt.command(!r||i>=0,"invalid "+t,e.commandStr),ol((function(t,e){return r&&(t.OFFSET=i),i}))}if(t in o){var l=o[t];return rl(l,(function(e,n){var o=e.invoke(n,l);return r&&(e.OFFSET=o,nt.optional((function(){e.assert(n,o+">=0","invalid "+t)}))),o}))}return r&&a?ol((function(t,e){return t.OFFSET="0",0})):null}var f=s(Ui,!0);function u(){if(ji in n){var t=0|n[ji];return nt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),ol((function(){return t}))}if(ji in o){var r=o[ji];return rl(r,(function(t,e){var n=t.invoke(e,r);return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(a){if(nl(a)){if(a)return f?new el(f.thisDep,f.contextDep,f.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return nt.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):ol((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var i=ol((function(){return-1}));return nt.optional((function(){i.MISSING=!0})),i}var l=new el(a.thisDep||f.thisDep,a.contextDep||f.contextDep,a.propDep||f.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return nt.optional((function(){l.DYNAMIC=!0})),l}return null}return{elements:a,primitive:l(),count:u(),instances:s(Gi,!1),offset:f}}function M(t,e){var n=t.static,r=t.dynamic,i={};return w.forEach((function(t){var a=A(t);function l(e,o){if(t in n){var l=e(n[t]);i[a]=ol((function(){return l}))}else if(t in r){var s=r[t];i[a]=rl(s,(function(t,e){return o(t,e,t.invoke(e,s))}))}}switch(t){case vi:case ui:case fi:case Bi:case pi:case Ri:case Ci:case Ti:case Li:case bi:return l((function(n){return nt.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,o){return nt.optional((function(){e.assert(n,"typeof "+o+'==="boolean"',"invalid flag "+t,e.commandStr)})),o}));case gi:return l((function(n){return nt.commandParameter(n,Ya,"invalid "+t,e.commandStr),Ya[n]}),(function(e,n,o){var r=e.constants.compareFuncs;return nt.optional((function(){e.assert(n,o+" in "+r,"invalid "+t+", must be one of "+Object.keys(Ya))})),n.def(r,"[",o,"]")}));case mi:return l((function(t){return nt.command(fn(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case di:return l((function(t){nt.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,o="srcAlpha"in t?t.srcAlpha:t.src,r="dstRGB"in t?t.dstRGB:t.dst,i="dstAlpha"in t?t.dstAlpha:t.dst;return nt.commandParameter(n,Xa,a+".srcRGB",e.commandStr),nt.commandParameter(o,Xa,a+".srcAlpha",e.commandStr),nt.commandParameter(r,Xa,a+".dstRGB",e.commandStr),nt.commandParameter(i,Xa,a+".dstAlpha",e.commandStr),nt.command(-1===Za.indexOf(n+", "+r),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+r+")",e.commandStr),[Xa[n],Xa[r],Xa[o],Xa[i]]}),(function(e,n,o){var r=e.constants.blendFuncs;function i(i,a){var l=n.def('"',i,a,'" in ',o,"?",o,".",i,a,":",o,".",i);return nt.optional((function(){e.assert(n,l+" in "+r,"invalid "+t+"."+i+a+", must be one of "+Object.keys(Xa))})),l}nt.optional((function(){e.assert(n,o+"&&typeof "+o+'==="object"',"invalid blend func, must be an object")}));var a=i("src","RGB"),l=i("dst","RGB");nt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+l+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var s=n.def(r,"[",a,"]"),f=n.def(r,"[",i("src","Alpha"),"]");return[s,n.def(r,"[",l,"]"),f,n.def(r,"[",i("dst","Alpha"),"]")]}));case hi:return l((function(n){return"string"==typeof n?(nt.commandParameter(n,m,"invalid "+t,e.commandStr),[m[n],m[n]]):"object"==typeof n?(nt.commandParameter(n.rgb,m,t+".rgb",e.commandStr),nt.commandParameter(n.alpha,m,t+".alpha",e.commandStr),[m[n.rgb],m[n.alpha]]):void nt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,o){var r=e.constants.blendEquations,i=n.def(),a=n.def(),l=e.cond("typeof ",o,'==="string"');return nt.optional((function(){function n(t,n,o){e.assert(t,o+" in "+r,"invalid "+n+", must be one of "+Object.keys(m))}n(l.then,t,o),e.assert(l.else,o+"&&typeof "+o+'==="object"',"invalid "+t),n(l.else,t+".rgb",o+".rgb"),n(l.else,t+".alpha",o+".alpha")})),l.then(i,"=",a,"=",r,"[",o,"];"),l.else(i,"=",r,"[",o,".rgb];",a,"=",r,"[",o,".alpha];"),n(l),[i,a]}));case ci:return l((function(t){return nt.command(fn(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),At(4,(function(e){return+t[e]}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),At(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case Di:return l((function(t){return nt.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case Fi:return l((function(n){nt.commandType(n,"object",a,e.commandStr);var o=n.cmp||"keep",r=n.ref||0,i="mask"in n?n.mask:-1;return nt.commandParameter(o,Ya,t+".cmp",e.commandStr),nt.commandType(r,"number",t+".ref",e.commandStr),nt.commandType(i,"number",t+".mask",e.commandStr),[Ya[o],r,i]}),(function(t,e,n){var o=t.constants.compareFuncs;return nt.optional((function(){function r(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}r(n+"&&typeof ",n,'==="object"'),r('!("cmp" in ',n,")||(",n,".cmp in ",o,")")})),[e.def('"cmp" in ',n,"?",o,"[",n,".cmp]",":",Pa),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Ii:case Si:return l((function(n){nt.commandType(n,"object",a,e.commandStr);var o=n.fail||"keep",r=n.zfail||"keep",i=n.zpass||"keep";return nt.commandParameter(o,$a,t+".fail",e.commandStr),nt.commandParameter(r,$a,t+".zfail",e.commandStr),nt.commandParameter(i,$a,t+".zpass",e.commandStr),[t===Si?Oa:Ra,$a[o],$a[r],$a[i]]}),(function(e,n,o){var r=e.constants.stencilOps;function i(i){return nt.optional((function(){e.assert(n,'!("'+i+'" in '+o+")||("+o+"."+i+" in "+r+")","invalid "+t+"."+i+", must be one of "+Object.keys($a))})),n.def('"',i,'" in ',o,"?",r,"[",o,".",i,"]:",Pa)}return nt.optional((function(){e.assert(n,o+"&&typeof "+o+'==="object"',"invalid "+t)})),[t===Si?Oa:Ra,i("fail"),i("zfail"),i("zpass")]}));case Ai:return l((function(t){nt.commandType(t,"object",a,e.commandStr);var n=0|t.factor,o=0|t.units;return nt.commandType(n,"number",a+".factor",e.commandStr),nt.commandType(o,"number",a+".units",e.commandStr),[n,o]}),(function(e,n,o){return nt.optional((function(){e.assert(n,o+"&&typeof "+o+'==="object"',"invalid "+t)})),[n.def(o,".factor|0"),n.def(o,".units|0")]}));case yi:return l((function(t){var n=0;return"front"===t?n=Ra:"back"===t&&(n=Oa),nt.command(!!n,a,e.commandStr),n}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',Ra,":",Oa)}));case _i:return l((function(t){return nt.command("number"==typeof t&&t>=o.lineWidthDims[0]&&t<=o.lineWidthDims[1],"invalid line width, must be a positive number between "+o.lineWidthDims[0]+" and "+o.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+o.lineWidthDims[0]+"&&"+n+"<="+o.lineWidthDims[1],"invalid line width")})),n}));case wi:return l((function(t){return nt.commandParameter(t,Qa,a,e.commandStr),Qa[t]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+ka+":"+Na)}));case xi:return l((function(t){return nt.command(fn(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),At(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Ei:return l((function(t){nt.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,o=!!t.invert;return nt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,o]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),i}function H(t,e){var n=t.static,o=t.dynamic,r={};return Object.keys(n).forEach((function(t){var o,i=n[t];if("number"==typeof i||"boolean"==typeof i)o=ol((function(){return i}));else if("function"==typeof i){var a=i._reglType;"texture2d"===a||"textureCube"===a?o=ol((function(t){return t.link(i)})):"framebuffer"===a||"framebufferCube"===a?(nt.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),o=ol((function(t){return t.link(i.color[0])}))):nt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else fn(i)?o=ol((function(e){return e.global.def("[",At(i.length,(function(n){return nt.command("number"==typeof i[n]||"boolean"==typeof i[n],"invalid uniform "+t,e.commandStr),i[n]})),"]")})):nt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);o.value=i,r[t]=o})),Object.keys(o).forEach((function(t){var e=o[t];r[t]=rl(e,(function(t,n){return t.invoke(n,e)}))})),r}function z(t,n){var o=t.static,i=t.dynamic,a={};return Object.keys(o).forEach((function(t){var i=o[t],l=e.id(t),s=new g;if(Ja(i))s.state=ni,s.buffer=r.getBuffer(r.create(i,na,!1,!0)),s.type=0;else{var f=r.getBuffer(i);if(f)s.state=ni,s.buffer=f,s.type=0;else if(nt.command("object"==typeof i&&i,"invalid data for attribute "+t,n.commandStr),"constant"in i){var u=i.constant;s.buffer="null",s.state=oi,"number"==typeof u?s.x=u:(nt.command(fn(u)&&u.length>0&&u.length<=4,"invalid constant for attribute "+t,n.commandStr),ti.forEach((function(t,e){e<u.length&&(s[t]=u[e])})))}else{f=Ja(i.buffer)?r.getBuffer(r.create(i.buffer,na,!1,!0)):r.getBuffer(i.buffer),nt.command(!!f,'missing buffer for attribute "'+t+'"',n.commandStr);var c=0|i.offset;nt.command(c>=0,'invalid offset for attribute "'+t+'"',n.commandStr);var h=0|i.stride;nt.command(h>=0&&h<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',n.commandStr);var d=0|i.size;nt.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',n.commandStr);var p=!!i.normalized,m=0;"type"in i&&(nt.commandParameter(i.type,Ie,"invalid type for attribute "+t,n.commandStr),m=Ie[i.type]);var x=0|i.divisor;"divisor"in i&&(nt.command(0===x||b,'cannot specify divisor for attribute "'+t+'", instancing not supported',n.commandStr),nt.command(x>=0,'invalid divisor for attribute "'+t+'"',n.commandStr)),nt.optional((function(){var e=n.commandStr,o=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(n){nt.command(o.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+t+'" (valid parameters are '+o+")",e)}))})),s.buffer=f,s.state=ni,s.size=d,s.normalized=p,s.type=m||f.dtype,s.offset=c,s.stride=h,s.divisor=x}}a[t]=ol((function(t,e){var n=t.attribCache;if(l in n)return n[l];var o={isStream:!1};return Object.keys(s).forEach((function(t){o[t]=s[t]})),s.buffer&&(o.buffer=t.link(s.buffer),o.type=o.type||o.buffer+".dtype"),n[l]=o,o}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,o){var r=n.invoke(o,e),i=n.shared,a=n.constants,l=i.isBufferArgs,s=i.buffer;nt.optional((function(){n.assert(o,r+"&&(typeof "+r+'==="object"||typeof '+r+'==="function")&&('+l+"("+r+")||"+s+".getBuffer("+r+")||"+s+".getBuffer("+r+".buffer)||"+l+"("+r+'.buffer)||("constant" in '+r+"&&(typeof "+r+'.constant==="number"||'+i.isArrayLike+"("+r+".constant))))",'invalid dynamic attribute "'+t+'"')}));var f={isStream:o.def(!1)},u=new g;u.state=ni,Object.keys(u).forEach((function(t){f[t]=o.def(""+u[t])}));var c=f.buffer,h=f.type;function d(t){o(f[t],"=",r,".",t,"|0;")}return o("if(",l,"(",r,")){",f.isStream,"=true;",c,"=",s,".createStream(",na,",",r,");",h,"=",c,".dtype;","}else{",c,"=",s,".getBuffer(",r,");","if(",c,"){",h,"=",c,".dtype;",'}else if("constant" in ',r,"){",f.state,"=",oi,";","if(typeof "+r+'.constant === "number"){',f[ti[0]],"=",r,".constant;",ti.slice(1).map((function(t){return f[t]})).join("="),"=0;","}else{",ti.map((function(t,e){return f[t]+"="+r+".constant.length>"+e+"?"+r+".constant["+e+"]:0;"})).join(""),"}}else{","if(",l,"(",r,".buffer)){",c,"=",s,".createStream(",na,",",r,".buffer);","}else{",c,"=",s,".getBuffer(",r,".buffer);","}",h,'="type" in ',r,"?",a.glTypes,"[",r,".type]:",c,".dtype;",f.normalized,"=!!",r,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),o("}}"),o.exit("if(",f.isStream,"){",s,".destroyStream(",c,");","}"),f}a[t]=rl(e,n)})),a}function P(t,e){var n=t.static,o=t.dynamic;if(Wi in n){var r=n[Wi];return null!==r&&null===f.getVAO(r)&&(r=f.createVAO(r)),ol((function(t){return t.link(f.getVAO(r))}))}if(Wi in o){var i=o[Wi];return rl(i,(function(t,e){var n=t.invoke(e,i);return e.def(t.shared.vao+".getVAO("+n+")")}))}return null}function V(t){var e=t.static,n=t.dynamic,o={};return Object.keys(e).forEach((function(t){var n=e[t];o[t]=ol((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];o[t]=rl(e,(function(t,n){return t.invoke(n,e)}))})),o}function j(t,e,o,r,i){var a=t.static,l=t.dynamic;nt.optional((function(){var t=[Mi,Hi,zi,Pi,Vi,Ui,ji,Gi,Ni,Wi].concat(w);function e(e){Object.keys(e).forEach((function(e){nt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',i.commandStr)}))}e(a),e(l)}));var s=O(t,e),u=S(t),c=R(t,u,i),h=N(t,i),d=M(t,i),p=k(t,i,s);function g(t){var e=c[t];e&&(d[t]=e)}g(ki),g(A(Oi));var m=Object.keys(d).length>0,b={framebuffer:u,draw:h,shader:p,state:d,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(b.profile=I(t),b.uniforms=H(o,i),b.drawVAO=b.scopeVAO=P(t),!b.drawVAO&&p.program&&!s&&n.angle_instanced_arrays){var x=!0,v=p.program.attributes.map((function(t){var n=e.static[t];return x=x&&!!n,n}));if(x&&v.length>0){var y=f.getVAO(f.createVAO(v));b.drawVAO=new el(null,null,null,(function(t,e){return t.link(y)})),b.useVAO=!0}}return s?b.useVAO=!0:b.attributes=z(e,i),b.context=V(r),b}function U(t,e,n){var o=t.shared.context,r=t.scope();Object.keys(n).forEach((function(i){e.save(o,"."+i);var a=n[i];r(o,".",i,"=",a.append(t,e),";")})),e(r)}function G(t,e,n,o){var r,i=t.shared,a=i.gl,l=i.framebuffer;x&&(r=e.def(i.extensions,".webgl_draw_buffers"));var s,f=t.constants,u=f.drawBuffer,c=f.backBuffer;s=n?n.append(t,e):e.def(l,".next"),o||e("if(",s,"!==",l,".cur){"),e("if(",s,"){",a,".bindFramebuffer(",Wa,",",s,".framebuffer);"),x&&e(r,".drawBuffersWEBGL(",u,"[",s,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",Wa,",null);"),x&&e(r,".drawBuffersWEBGL(",c,");"),e("}",l,".cur=",s,";"),o||e("}")}function W(t,e,n){var o=t.shared,r=o.gl,i=t.current,a=t.next,l=o.current,s=o.next,f=t.cond(l,".dirty");w.forEach((function(e){var o,u,c=A(e);if(!(c in n.state))if(c in a){o=a[c],u=i[c];var h=At(v[c].length,(function(t){return f.def(o,"[",t,"]")}));f(t.cond(h.map((function(t,e){return t+"!=="+u+"["+e+"]"})).join("||")).then(r,".",C[c],"(",h,");",h.map((function(t,e){return u+"["+e+"]="+t})).join(";"),";"))}else{o=f.def(s,".",c);var d=t.cond(o,"!==",l,".",c);f(d),c in _?d(t.cond(o).then(r,".enable(",_[c],");").else(r,".disable(",_[c],");"),l,".",c,"=",o,";"):d(r,".",C[c],"(",o,");",l,".",c,"=",o,";")}})),0===Object.keys(n.state).length&&f(l,".dirty=false;"),e(f)}function q(t,e,n,o){var r=t.shared,i=t.current,a=r.current,l=r.gl;tl(Object.keys(n)).forEach((function(r){var s=n[r];if(!o||o(s)){var f=s.append(t,e);if(_[r]){var u=_[r];nl(s)?e(l,f?".enable(":".disable(",u,");"):e(t.cond(f).then(l,".enable(",u,");").else(l,".disable(",u,");")),e(a,".",r,"=",f,";")}else if(fn(f)){var c=i[r];e(l,".",C[r],"(",f,");",f.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";")}else e(l,".",C[r],"(",f,");",a,".",r,"=",f,";")}}))}function X(t,e){b&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function Z(t,e,n,o,r){var i,a,l,s=t.shared,f=t.stats,u=s.current,c=s.timer,h=n.profile;function p(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(t){t(i=e.def(),"=",p(),";"),"string"==typeof r?t(f,".count+=",r,";"):t(f,".count++;"),d&&(o?t(a=e.def(),"=",c,".getNumPendingQueries();"):t(c,".beginQuery(",f,");"))}function m(t){t(f,".cpuTime+=",p(),"-",i,";"),d&&(o?t(c,".pushScopeStats(",a,",",c,".getNumPendingQueries(),",f,");"):t(c,".endQuery();"))}function b(t){var n=e.def(u,".profile");e(u,".profile=",t,";"),e.exit(u,".profile=",n,";")}if(h){if(nl(h))return void(h.enable?(g(e),m(e.exit),b("true")):b("false"));b(l=h.append(t,e))}else l=e.def(u,".profile");var x=t.block();g(x),e("if(",l,"){",x,"}");var v=t.block();m(v),e.exit("if(",l,"){",v,"}")}function Y(t,e,n,o,r){var i=t.shared;function a(t){switch(t){case ma:case ya:case Aa:return 2;case ba:case wa:case Ta:return 3;case xa:case _a:case La:return 4;default:return 1}}function l(n,o,r){var a=i.gl,l=e.def(n,".location"),s=e.def(i.attributes,"[",l,"]"),f=r.state,u=r.buffer,c=[r.x,r.y,r.z,r.w],h=["buffer","normalized","offset","stride"];function d(){e("if(!",s,".buffer){",a,".enableVertexAttribArray(",l,");}");var n,i=r.type;if(n=r.size?e.def(r.size,"||",o):o,e("if(",s,".type!==",i,"||",s,".size!==",n,"||",h.map((function(t){return s+"."+t+"!=="+r[t]})).join("||"),"){",a,".bindBuffer(",na,",",u,".buffer);",a,".vertexAttribPointer(",[l,n,i,r.normalized,r.stride,r.offset],");",s,".type=",i,";",s,".size=",n,";",h.map((function(t){return s+"."+t+"="+r[t]+";"})).join(""),"}"),b){var f=r.divisor;e("if(",s,".divisor!==",f,"){",t.instancing,".vertexAttribDivisorANGLE(",[l,f],");",s,".divisor=",f,";}")}}function p(){e("if(",s,".buffer){",a,".disableVertexAttribArray(",l,");",s,".buffer=null;","}if(",ti.map((function(t,e){return s+"."+t+"!=="+c[e]})).join("||"),"){",a,".vertexAttrib4f(",l,",",c,");",ti.map((function(t,e){return s+"."+t+"="+c[e]+";"})).join(""),"}")}f===ni?d():f===oi?p():(e("if(",f,"===",ni,"){"),d(),e("}else{"),p(),e("}"))}o.forEach((function(o){var i,s=o.name,f=n.attributes[s];if(f){if(!r(f))return;i=f.append(t,e)}else{if(!r(il))return;var u=t.scopeAttrib(s);nt.optional((function(){t.assert(e,u+".state","missing attribute "+s)})),i={},Object.keys(new g).forEach((function(t){i[t]=e.def(u,".",t)}))}l(t.link(o),a(o.info.type),i)}))}function $(t,n,o,r,i){for(var a,l=t.shared,s=l.gl,f=0;f<r.length;++f){var u,c=r[f],h=c.name,d=c.info.type,p=o.uniforms[h],g=t.link(c)+".location";if(p){if(!i(p))continue;if(nl(p)){var m=p.value;if(nt.command(null!=m,'missing uniform "'+h+'"',t.commandStr),d===Fa||d===Ia){nt.command("function"==typeof m&&(d===Fa&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||d===Ia&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+h,t.commandStr);var b=t.link(m._texture||m.color[0]._texture);n(s,".uniform1i(",g,",",b+".bind());"),n.exit(b,".unbind();")}else if(d===Ea||d===Ba||d===Da){nt.optional((function(){nt.command(fn(m),"invalid matrix for uniform "+h,t.commandStr),nt.command(d===Ea&&4===m.length||d===Ba&&9===m.length||d===Da&&16===m.length,"invalid length for matrix uniform "+h,t.commandStr)}));var x=t.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),v=2;d===Ba?v=3:d===Da&&(v=4),n(s,".uniformMatrix",v,"fv(",g,",false,",x,");")}else{switch(d){case ga:nt.commandType(m,"number","uniform "+h,t.commandStr),a="1f";break;case ma:nt.command(fn(m)&&2===m.length,"uniform "+h,t.commandStr),a="2f";break;case ba:nt.command(fn(m)&&3===m.length,"uniform "+h,t.commandStr),a="3f";break;case xa:nt.command(fn(m)&&4===m.length,"uniform "+h,t.commandStr),a="4f";break;case Ca:nt.commandType(m,"boolean","uniform "+h,t.commandStr),a="1i";break;case va:nt.commandType(m,"number","uniform "+h,t.commandStr),a="1i";break;case Aa:case ya:nt.command(fn(m)&&2===m.length,"uniform "+h,t.commandStr),a="2i";break;case Ta:case wa:nt.command(fn(m)&&3===m.length,"uniform "+h,t.commandStr),a="3i";break;case La:case _a:nt.command(fn(m)&&4===m.length,"uniform "+h,t.commandStr),a="4i"}n(s,".uniform",a,"(",g,",",fn(m)?Array.prototype.slice.call(m):m,");")}continue}u=p.append(t,n)}else{if(!i(il))continue;u=n.def(l.uniforms,"[",e.id(h),"]")}d===Fa?n("if(",u,"&&",u,'._reglType==="framebuffer"){',u,"=",u,".color[0];","}"):d===Ia&&n("if(",u,"&&",u,'._reglType==="framebufferCube"){',u,"=",u,".color[0];","}"),nt.optional((function(){function e(e,o){t.assert(n,e,'bad data or missing for uniform "'+h+'".  '+o)}function o(t){e("typeof "+u+'==="'+t+'"',"invalid type, expected "+t)}function r(n,o){e(l.isArrayLike+"("+u+")&&"+u+".length==="+n,"invalid vector, should have length "+n,t.commandStr)}function i(n){e("typeof "+u+'==="function"&&'+u+'._reglType==="texture'+(n===ra?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case va:o("number");break;case ya:r(2);break;case wa:r(3);break;case _a:r(4);break;case ga:o("number");break;case ma:r(2);break;case ba:r(3);break;case xa:r(4);break;case Ca:o("boolean");break;case Aa:r(2);break;case Ta:r(3);break;case La:case Ea:r(4);break;case Ba:r(9);break;case Da:r(16);break;case Fa:i(ra);break;case Ia:i(ia)}}));var y=1;switch(d){case Fa:case Ia:var w=n.def(u,"._texture");n(s,".uniform1i(",g,",",w,".bind());"),n.exit(w,".unbind();");continue;case va:case Ca:a="1i";break;case ya:case Aa:a="2i",y=2;break;case wa:case Ta:a="3i",y=3;break;case _a:case La:a="4i",y=4;break;case ga:a="1f";break;case ma:a="2f",y=2;break;case ba:a="3f",y=3;break;case xa:a="4f",y=4;break;case Ea:a="Matrix2fv";break;case Ba:a="Matrix3fv";break;case Da:a="Matrix4fv"}if(n(s,".uniform",a,"(",g,","),"M"===a.charAt(0)){var _=Math.pow(d-Ea+2,2),C=t.global.def("new Float32Array(",_,")");n("false,(Array.isArray(",u,")||",u," instanceof Float32Array)?",u,":(",At(_,(function(t){return C+"["+t+"]="+u+"["+t+"]"})),",",C,")")}else n(y>1?At(y,(function(t){return u+"["+t+"]"})):u);n(");")}}function K(t,e,n,o){var r=t.shared,i=r.gl,a=r.draw,l=o.draw;function s(){var r,s=l.elements,f=e;return s?((s.contextDep&&o.contextDynamic||s.propDep)&&(f=n),r=s.append(t,f)):r=f.def(a,".",Pi),r&&f("if("+r+")"+i+".bindBuffer("+oa+","+r+".buffer.buffer);"),r}function f(){var r,i=l.count,s=e;return i?((i.contextDep&&o.contextDynamic||i.propDep)&&(s=n),r=i.append(t,s),nt.optional((function(){i.MISSING&&t.assert(e,"false","missing vertex count"),i.DYNAMIC&&t.assert(s,r+">=0","missing vertex count")}))):(r=s.def(a,".",ji),nt.optional((function(){t.assert(s,r+">=0","missing vertex count")}))),r}var u=s();function c(r){var i=l[r];return i?i.contextDep&&o.contextDynamic||i.propDep?i.append(t,n):i.append(t,e):e.def(a,".",r)}var h,d,p=c(Vi),g=c(Ui),m=f();if("number"==typeof m){if(0===m)return}else n("if(",m,"){"),n.exit("}");b&&(h=c(Gi),d=t.instancing);var x=u+".type",v=l.elements&&nl(l.elements);function y(){function t(){n(d,".drawElementsInstancedANGLE(",[p,m,x,g+"<<(("+x+"-"+ei+")>>1)",h],");")}function e(){n(d,".drawArraysInstancedANGLE(",[p,g,m,h],");")}u?v?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}function w(){function t(){n(i+".drawElements("+[p,m,x,g+"<<(("+x+"-"+ei+")>>1)"]+");")}function e(){n(i+".drawArrays("+[p,g,m]+");")}u?v?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}b&&("number"!=typeof h||h>=0)?"string"==typeof h?(n("if(",h,">0){"),y(),n("}else if(",h,"<0){"),w(),n("}")):y():w()}function Q(t,e,n,o,r){var i=F(),a=i.proc("body",r);return nt.optional((function(){i.commandStr=e.commandStr,i.command=i.link(e.commandStr)})),b&&(i.instancing=a.def(i.shared.extensions,".angle_instanced_arrays")),t(i,a,n,o),i.compile().body}function J(t,e,n,o){X(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),Y(t,e,n,o.attributes,(function(){return!0}))),$(t,e,n,o.uniforms,(function(){return!0})),K(t,e,e,n)}function tt(t,e){var n=t.proc("draw",1);X(t,n),U(t,n,e.context),G(t,n,e.framebuffer),W(t,n,e),q(t,n,e.state),Z(t,n,e,!1,!0);var o=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",o,".program);"),e.shader.program)J(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var r=t.global.def("{}"),i=n.def(o,".id"),a=n.def(r,"[",i,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",r,"[",i,"]=",t.link((function(n){return Q(J,t,e,n,1)})),"(",o,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;")}function et(t,e,n,o){function r(){return!0}t.batchId="a1",X(t,e),Y(t,e,n,o.attributes,r),$(t,e,n,o.uniforms,r),K(t,e,e,n)}function ot(t,e,n,o){X(t,e);var r=n.contextDep,i=e.def(),a="a0",l="a1",s=e.def();t.shared.props=s,t.batchId=i;var f=t.scope(),u=t.scope();function c(t){return t.contextDep&&r||t.propDep}function h(t){return!c(t)}if(e(f.entry,"for(",i,"=0;",i,"<",l,";++",i,"){",s,"=",a,"[",i,"];",u,"}",f.exit),n.needsContext&&U(t,u,n.context),n.needsFramebuffer&&G(t,u,n.framebuffer),q(t,u,n.state,c),n.profile&&c(n.profile)&&Z(t,u,n,!1,!0),o)n.useVAO?n.drawVAO?c(n.drawVAO)?u(t.shared.vao,".setVAO(",n.drawVAO.append(t,u),");"):f(t.shared.vao,".setVAO(",n.drawVAO.append(t,f),");"):f(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(f(t.shared.vao,".setVAO(null);"),Y(t,f,n,o.attributes,h),Y(t,u,n,o.attributes,c)),$(t,f,n,o.uniforms,h),$(t,u,n,o.uniforms,c),K(t,f,u,n);else{var d=t.global.def("{}"),p=n.shader.progVar.append(t,u),g=u.def(p,".id"),m=u.def(d,"[",g,"]");u(t.shared.gl,".useProgram(",p,".program);","if(!",m,"){",m,"=",d,"[",g,"]=",t.link((function(e){return Q(et,t,n,e,2)})),"(",p,");}",m,".call(this,a0[",i,"],",i,");")}}function rt(t,e){var n=t.proc("batch",2);t.batchId="0",X(t,n);var o=!1,r=!0;Object.keys(e.context).forEach((function(t){o=o||e.context[t].propDep})),o||(U(t,n,e.context),r=!1);var i=e.framebuffer,a=!1;function l(t){return t.contextDep&&o||t.propDep}i?(i.propDep?o=a=!0:i.contextDep&&o&&(a=!0),a||G(t,n,i)):G(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(o=!0),W(t,n,e),q(t,n,e.state,(function(t){return!l(t)})),e.profile&&l(e.profile)||Z(t,n,e,!1,"a1"),e.contextDep=o,e.needsContext=r,e.needsFramebuffer=a;var s=e.shader.progVar;if(s.contextDep&&o||s.propDep)ot(t,n,e,null);else{var f=s.append(t,n);if(n(t.shared.gl,".useProgram(",f,".program);"),e.shader.program)ot(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var u=t.global.def("{}"),c=n.def(f,".id"),h=n.def(u,"[",c,"]");n(t.cond(h).then(h,".call(this,a0,a1);").else(h,"=",u,"[",c,"]=",t.link((function(n){return Q(ot,t,e,n,2)})),"(",f,");",h,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;")}function it(t,n){var o=t.proc("scope",3);t.batchId="a2";var r=t.shared,i=r.current;function a(e){var i=n.shader[e];i&&o.set(r.shader,"."+e,i.append(t,o))}U(t,o,n.context),n.framebuffer&&n.framebuffer.append(t,o),tl(Object.keys(n.state)).forEach((function(e){var i=n.state[e].append(t,o);fn(i)?i.forEach((function(n,r){o.set(t.next[e],"["+r+"]",n)})):o.set(r.next,"."+e,i)})),Z(t,o,n,!0,!0),[Pi,Ui,ji,Gi,Vi].forEach((function(e){var i=n.draw[e];i&&o.set(r.draw,"."+e,""+i.append(t,o))})),Object.keys(n.uniforms).forEach((function(i){o.set(r.uniforms,"["+e.id(i)+"]",n.uniforms[i].append(t,o))})),Object.keys(n.attributes).forEach((function(e){var r=n.attributes[e].append(t,o),i=t.scopeAttrib(e);Object.keys(new g).forEach((function(t){o.set(i,"."+t,r[t])}))})),n.scopeVAO&&o.set(r.vao,".targetVAO",n.scopeVAO.append(t,o)),a(Hi),a(zi),Object.keys(n.state).length>0&&(o(i,".dirty=true;"),o.exit(i,".dirty=true;")),o("a1(",t.shared.context,",a0,",t.batchId,");")}function at(t){if("object"==typeof t&&!fn(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(ht.isDynamic(t[e[n]]))return!0;return!1}}function lt(t,e,n){var o=e.static[n];if(o&&at(o)){var r=t.global,i=Object.keys(o),a=!1,l=!1,s=!1,f=t.global.def("{}");i.forEach((function(e){var n=o[e];if(ht.isDynamic(n)){"function"==typeof n&&(n=o[e]=ht.unbox(n));var i=rl(n,null);a=a||i.thisDep,s=s||i.propDep,l=l||i.contextDep}else{switch(r(f,".",e,"="),typeof n){case"number":r(n);break;case"string":r('"',n,'"');break;case"object":Array.isArray(n)&&r("[",n.join(),"]");break;default:r(t.link(n))}r(";")}})),e.dynamic[n]=new ht.DynamicVariable(si,{thisDep:a,contextDep:l,propDep:s,ref:f,append:u}),delete e.static[n]}function u(t,e){i.forEach((function(n){var r=o[n];if(ht.isDynamic(r)){var i=t.invoke(e,r);e(f,".",n,"=",i,";")}}))}}function st(t,e,n,o,r){var i=F();i.stats=i.link(r),Object.keys(e.static).forEach((function(t){lt(i,e,t)})),ea.forEach((function(e){lt(i,t,e)}));var a=j(t,e,n,o,i);return tt(i,a),it(i,a),rt(i,a),i.compile()}return{next:y,current:v,procs:function(){var t=F(),e=t.proc("poll"),r=t.proc("refresh"),i=t.block();e(i),r(i);var a,l=t.shared,s=l.gl,f=l.next,u=l.current;i(u,".dirty=false;"),G(t,e),G(t,r,null,!0),b&&(a=t.link(b)),n.oes_vertex_array_object&&r(t.link(n.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var c=0;c<o.maxAttributes;++c){var h=r.def(l.attributes,"[",c,"]"),d=t.cond(h,".buffer");d.then(s,".enableVertexAttribArray(",c,");",s,".bindBuffer(",na,",",h,".buffer.buffer);",s,".vertexAttribPointer(",c,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(s,".disableVertexAttribArray(",c,");",s,".vertexAttrib4f(",c,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),r(d),b&&r(a,".vertexAttribDivisorANGLE(",c,",",h,".divisor);")}return r(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(_).forEach((function(n){var o=_[n],a=i.def(f,".",n),l=t.block();l("if(",a,"){",s,".enable(",o,")}else{",s,".disable(",o,")}",u,".",n,"=",a,";"),r(l),e("if(",a,"!==",u,".",n,"){",l,"}")})),Object.keys(C).forEach((function(n){var o,a,l=C[n],c=v[n],h=t.block();if(h(s,".",l,"("),fn(c)){var d=c.length;o=t.global.def(f,".",n),a=t.global.def(u,".",n),h(At(d,(function(t){return o+"["+t+"]"})),");",At(d,(function(t){return a+"["+t+"]="+o+"["+t+"];"})).join("")),e("if(",At(d,(function(t){return o+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",h,"}")}else o=i.def(f,".",n),a=i.def(u,".",n),h(o,");",u,".",n,"=",o,";"),e("if(",o,"!==",a,"){",h,"}");r(h)})),t.compile()}(),compile:st}}function ll(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var sl=34918,fl=34919,ul=35007,cl=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function o(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function r(t){n.push(t)}var i=[];function a(t){var n=o();e.ext_disjoint_timer_query.beginQueryEXT(ul,n),i.push(n),d(i.length-1,i.length,t)}function l(){e.ext_disjoint_timer_query.endQueryEXT(ul)}function s(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var f=[];function u(){return f.pop()||new s}function c(t){f.push(t)}var h=[];function d(t,e,n){var o=u();o.startQueryIndex=t,o.endQueryIndex=e,o.sum=0,o.stats=n,h.push(o)}var p=[],g=[];function m(){var t,n,o=i.length;if(0!==o){g.length=Math.max(g.length,o+1),p.length=Math.max(p.length,o+1),p[0]=0,g[0]=0;var a=0;for(t=0,n=0;n<i.length;++n){var l=i[n];e.ext_disjoint_timer_query.getQueryObjectEXT(l,fl)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(l,sl),r(l)):i[t++]=l,p[n+1]=a,g[n+1]=t}for(i.length=t,t=0,n=0;n<h.length;++n){var s=h[n],f=s.startQueryIndex,u=s.endQueryIndex;s.sum+=p[u]-p[f];var d=g[f],m=g[u];m===d?(s.stats.gpuTime+=s.sum/1e6,c(s)):(s.startQueryIndex=d,s.endQueryIndex=m,h[t++]=s)}h.length=t}}return{beginQuery:a,endQuery:l,pushScopeStats:d,update:m,getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},hl=16384,dl=256,pl=1024,gl=34962,ml="webglcontextlost",bl="webglcontextrestored",xl=1,vl=2,yl=3;function wl(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function _l(t){var n=_t(t);if(!n)return null;var o=n.gl,r=o.getContextAttributes(),i=o.isContextLost(),a=Ct(o,n);if(!a)return null;var l=gt(),s=ll(),f=a.extensions,u=cl(o,f),c=pt(),h=o.drawingBufferWidth,d=o.drawingBufferHeight,p={tick:0,time:0,viewportWidth:h,viewportHeight:d,framebufferWidth:h,framebufferHeight:d,drawingBufferWidth:h,drawingBufferHeight:d,pixelRatio:n.pixelRatio},g={},m={elements:null,primitive:4,count:-1,offset:0,instances:-1},b=ye(o,f),x=Ue(o,s,n,y),v=Pr(o,f,b,s,x);function y(t){return v.destroyBuffer(t)}var w=on(o,f,x,s),_=Wr(o,l,s,n),C=Zo(o,f,b,(function(){L.procs.poll()}),p,s,n),A=sr(o,f,b,s,n),T=Nr(o,f,b,C,A,s),L=al(o,l,f,b,x,w,C,T,g,v,_,m,p,u,n),E=$r(o,T,L.procs.poll,p,r,f,b),B=L.next,D=o.canvas,F=[],I=[],S=[],R=[n.onDestroy],O=null;function k(){if(0===F.length)return u&&u.update(),void(O=null);O=dt.next(k),X();for(var t=F.length-1;t>=0;--t){var e=F[t];e&&e(p,null,0)}o.flush(),u&&u.update()}function N(){!O&&F.length>0&&(O=dt.next(k))}function M(){O&&(dt.cancel(k),O=null)}function H(t){t.preventDefault(),i=!0,M(),I.forEach((function(t){t()}))}function z(t){o.getError(),i=!1,a.restore(),_.restore(),x.restore(),C.restore(),A.restore(),T.restore(),v.restore(),u&&u.restore(),L.procs.refresh(),N(),S.forEach((function(t){t()}))}function P(){F.length=0,M(),D&&(D.removeEventListener(ml,H),D.removeEventListener(bl,z)),_.clear(),T.clear(),A.clear(),C.clear(),w.clear(),x.clear(),v.clear(),u&&u.clear(),R.forEach((function(t){t()}))}function V(t){function n(t){var n=e({},t);function o(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(o){n[t+"."+o]=e[o]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),o("blend"),o("depth"),o("cull"),o("stencil"),o("polygonOffset"),o("scissor"),o("sample"),"vao"in t&&(n.vao=t.vao),n}function o(t){var e={},n={};return Object.keys(t).forEach((function(o){var r=t[o];ht.isDynamic(r)?n[o]=ht.unbox(r,o):e[o]=r})),{dynamic:n,static:e}}nt(!!t,"invalid args to regl({...})"),nt.type(t,"object","invalid args to regl({...})");var r=o(t.context||{}),a=o(t.uniforms||{}),l=o(t.attributes||{}),s=o(n(t)),f={gpuTime:0,cpuTime:0,count:0},u=L.compile(s,l,a,r,f),c=u.draw,h=u.batch,d=u.scope,p=[];function g(t){for(;p.length<t;)p.push(null);return p}function m(t,e){var n;if(i&&nt.raise("context lost"),"function"==typeof t)return d.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)d.call(this,null,e,n);else{if(!Array.isArray(t))return d.call(this,t,e,0);for(n=0;n<t.length;++n)d.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return h.call(this,g(0|t),0|t)}else{if(!Array.isArray(t))return c.call(this,t);if(t.length)return h.call(this,t,t.length)}}return e(m,{stats:f})}D&&(D.addEventListener(ml,H,!1),D.addEventListener(bl,z,!1));var j=T.setFBO=V({framebuffer:ht.define.call(null,xl,"framebuffer")});function U(t,e){var n=0;L.procs.poll();var r=e.color;r&&(o.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=hl),"depth"in e&&(o.clearDepth(+e.depth),n|=dl),"stencil"in e&&(o.clearStencil(0|e.stencil),n|=pl),nt(!!n,"called regl.clear with no buffer specified"),o.clear(n)}function G(t){if(nt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var n=0;n<6;++n)j(e({framebuffer:t.framebuffer.faces[n]},t),U);else j(t,U);else U(null,t)}function W(t){function e(){var e=wl(F,t);function n(){var t=wl(F,n);F[t]=F[F.length-1],F.length-=1,F.length<=0&&M()}nt(e>=0,"cannot cancel a frame twice"),F[e]=n}return nt.type(t,"function","regl.frame() callback must be a function"),F.push(t),N(),{cancel:e}}function q(){var t=B.viewport,e=B.scissor_box;t[0]=t[1]=e[0]=e[1]=0,p.viewportWidth=p.framebufferWidth=p.drawingBufferWidth=t[2]=e[2]=o.drawingBufferWidth,p.viewportHeight=p.framebufferHeight=p.drawingBufferHeight=t[3]=e[3]=o.drawingBufferHeight}function X(){p.tick+=1,p.time=Y(),q(),L.procs.poll()}function Z(){q(),L.procs.refresh(),u&&u.update()}function Y(){return(pt()-c)/1e3}function $(t,e){var n;switch(nt.type(e,"function","listener callback must be a function"),t){case"frame":return W(e);case"lost":n=I;break;case"restore":n=S;break;case"destroy":n=R;break;default:nt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}Z();var K=e(V,{clear:G,prop:ht.define.bind(null,xl),context:ht.define.bind(null,vl),this:ht.define.bind(null,yl),draw:V({}),buffer:function(t){return x.create(t,gl,!1,!1)},elements:function(t){return w.create(t,!1)},texture:C.create2D,cube:C.createCube,renderbuffer:A.create,framebuffer:T.create,framebufferCube:T.createCube,vao:v.createVAO,attributes:r,frame:W,on:$,limits:b,hasExtension:function(t){return b.extensions.indexOf(t.toLowerCase())>=0},read:E,destroy:P,_gl:o,_refresh:Z,poll:function(){X(),u&&u.update()},now:Y,stats:s});return n.onDone(null,K),K}return _l}()})),_n=[0,0,0,0],Cn=1024,An="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\n// use same coords for all textures?\nattribute vec2 texCoordB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Tn="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = texCoord;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Ln="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",En="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Bn="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\nattribute vec2 texCoordE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  vTexCoordE = texCoordE;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Dn="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\nattribute vec2 texCoordE;\nattribute vec2 texCoordF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  vTexCoordE = texCoordE;\n  vTexCoordE = texCoordF;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Fn="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D texture;\nuniform bool littleEndian;\nuniform bool enableSimpleHillshade;\n\nuniform float textureSize;\nuniform float tileSize;\nuniform vec4 textureBounds;\nvarying vec2 vTexCoord;\n\nuniform float offset;\nuniform float slopescale;\nuniform float slopeFactor;\nuniform float deg2rad;\nuniform float azimuth;\nuniform float altitude;\n\nfloat getTexelValue(vec2 pos) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat getRelativeHeight(vec2 pos, float v, vec4 textureBounds) {\n  // if (pos.x < textureBounds[0]) {\n  //   pos = vec2(textureBounds[0], pos.y);\n  // }\n  // if (pos.x > textureBounds[2]) {\n  //   pos = vec2(textureBounds[2], pos.y);\n  // }\n  // if (pos.y < textureBounds[1]) {\n  //   pos = vec2(pos.x, textureBounds[1]);\n  // }\n  // if (pos.y > textureBounds[3]) {\n  //   pos = vec2(pos.x, textureBounds[3]);\n  // }\n  float pixelFloatValue = getTexelValue(pos);\n  float test = step(0.0, pixelFloatValue);\n  float testReturn = ((test * pixelFloatValue) + ((1.0 - test) * v)) * (slopescale*slopeFactor);\n  return testReturn;\n}\n\nfloat hillshade(vec2 pos, float v, float offset, vec4 textureBounds) {\n  float cv = v * (slopescale * slopeFactor);\n  vec4 nv = vec4(\n  getRelativeHeight(vec2(pos.x + offset, pos.y), v, textureBounds),\n  getRelativeHeight(vec2(pos.x - offset, pos.y), v, textureBounds),\n  getRelativeHeight(vec2(pos.x, pos.y + offset), v, textureBounds),\n  getRelativeHeight(vec2(pos.x, pos.y - offset), v, textureBounds)\n  );\n\n  vec2 grad = vec2(\n    (nv[0] - cv) / 2.0 + (cv - nv[1]) / 2.0,\n    (nv[2] - cv) / 2.0 + (cv - nv[3]) / 2.0\n  );\n\n  float slope = max(3.141593 / 2.0 - atan(sqrt(dot(grad, grad))), 0.0);\n  float aspect = atan(-grad.y, grad.x);\n\n  float hs = sin(altitude * deg2rad) * sin(slope) +\n    cos(altitude * deg2rad) * cos(slope) *\n    cos((azimuth * deg2rad) - aspect);\n\n  return clamp(hs, 0.0, 1.0);\n}\n\nvoid main() {\n  float texelFloat = getTexelValue(vTexCoord);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  vec4 clr = computeColor(\n    texelFloat,\n    scaleColormap,\n    sentinelColormap,\n    scaleLength,\n    sentinelLength,\n    littleEndian\n  );\n\n  if (enableSimpleHillshade) {\n    float hs = hillshade(vTexCoord, texelFloat, offset, textureBounds);\n    clr.rgb = clr.rgb * hs;\n  }\n\n  gl_FragColor = clr;\n}\n",In=vn((function(t,e){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)o(n,r)&&(t[r]=n[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,n,o,r){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+o),r);else for(var i=0;i<o;i++)t[r+i]=e[n+i]},flattenChunks:function(t){var e,n,o,r,i,a;for(o=0,e=0,n=t.length;e<n;e++)o+=t[e].length;for(a=new Uint8Array(o),r=0,e=0,n=t.length;e<n;e++)i=t[e],a.set(i,r),r+=i.length;return a}},i={arraySet:function(t,e,n,o,r){for(var i=0;i<o;i++)t[r+i]=e[n+i]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(n)}));function Sn(t){for(var e=t.length;--e>=0;)t[e]=0}var Rn=256,On=286,kn=30,Nn=15,Mn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Hn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],zn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Pn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Vn=new Array(576);Sn(Vn);var jn=new Array(60);Sn(jn);var Un=new Array(512);Sn(Un);var Gn=new Array(256);Sn(Gn);var Wn=new Array(29);Sn(Wn);var qn,Xn,Zn,Yn=new Array(kn);function $n(t,e,n,o,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=o,this.max_length=r,this.has_stree=t&&t.length}function Kn(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function Qn(t){return t<256?Un[t]:Un[256+(t>>>7)]}function Jn(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function to(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,Jn(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function eo(t,e,n){to(t,n[2*e],n[2*e+1])}function no(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function oo(t,e,n){var o,r,i=new Array(16),a=0;for(o=1;o<=Nn;o++)i[o]=a=a+n[o-1]<<1;for(r=0;r<=e;r++){var l=t[2*r+1];0!==l&&(t[2*r]=no(i[l]++,l))}}function ro(t){var e;for(e=0;e<On;e++)t.dyn_ltree[2*e]=0;for(e=0;e<kn;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function io(t){t.bi_valid>8?Jn(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function ao(t,e,n,o){var r=2*e,i=2*n;return t[r]<t[i]||t[r]===t[i]&&o[e]<=o[n]}function lo(t,e,n){for(var o=t.heap[n],r=n<<1;r<=t.heap_len&&(r<t.heap_len&&ao(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!ao(e,o,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=o}function so(t,e,n){var o,r,i,a,l=0;if(0!==t.last_lit)do{o=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],r=t.pending_buf[t.l_buf+l],l++,0===o?eo(t,r,e):(eo(t,(i=Gn[r])+Rn+1,e),0!==(a=Mn[i])&&to(t,r-=Wn[i],a),eo(t,i=Qn(--o),n),0!==(a=Hn[i])&&to(t,o-=Yn[i],a))}while(l<t.last_lit);eo(t,256,e)}function fo(t,e){var n,o,r,i=e.dyn_tree,a=e.stat_desc.static_tree,l=e.stat_desc.has_stree,s=e.stat_desc.elems,f=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<s;n++)0!==i[2*n]?(t.heap[++t.heap_len]=f=n,t.depth[n]=0):i[2*n+1]=0;for(;t.heap_len<2;)i[2*(r=t.heap[++t.heap_len]=f<2?++f:0)]=1,t.depth[r]=0,t.opt_len--,l&&(t.static_len-=a[2*r+1]);for(e.max_code=f,n=t.heap_len>>1;n>=1;n--)lo(t,i,n);r=s;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],lo(t,i,1),o=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=o,i[2*r]=i[2*n]+i[2*o],t.depth[r]=(t.depth[n]>=t.depth[o]?t.depth[n]:t.depth[o])+1,i[2*n+1]=i[2*o+1]=r,t.heap[1]=r++,lo(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,o,r,i,a,l,s=e.dyn_tree,f=e.max_code,u=e.stat_desc.static_tree,c=e.stat_desc.has_stree,h=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(i=0;i<=Nn;i++)t.bl_count[i]=0;for(s[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)(i=s[2*s[2*(o=t.heap[n])+1]+1]+1)>p&&(i=p,g++),s[2*o+1]=i,o>f||(t.bl_count[i]++,a=0,o>=d&&(a=h[o-d]),l=s[2*o],t.opt_len+=l*(i+a),c&&(t.static_len+=l*(u[2*o+1]+a)));if(0!==g){do{for(i=p-1;0===t.bl_count[i];)i--;t.bl_count[i]--,t.bl_count[i+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(i=p;0!==i;i--)for(o=t.bl_count[i];0!==o;)(r=t.heap[--n])>f||(s[2*r+1]!==i&&(t.opt_len+=(i-s[2*r+1])*s[2*r],s[2*r+1]=i),o--)}}(t,e),oo(i,f,t.bl_count)}function uo(t,e,n){var o,r,i=-1,a=e[1],l=0,s=7,f=4;for(0===a&&(s=138,f=3),e[2*(n+1)+1]=65535,o=0;o<=n;o++)r=a,a=e[2*(o+1)+1],++l<s&&r===a||(l<f?t.bl_tree[2*r]+=l:0!==r?(r!==i&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,i=r,0===a?(s=138,f=3):r===a?(s=6,f=3):(s=7,f=4))}function co(t,e,n){var o,r,i=-1,a=e[1],l=0,s=7,f=4;for(0===a&&(s=138,f=3),o=0;o<=n;o++)if(r=a,a=e[2*(o+1)+1],!(++l<s&&r===a)){if(l<f)do{eo(t,r,t.bl_tree)}while(0!=--l);else 0!==r?(r!==i&&(eo(t,r,t.bl_tree),l--),eo(t,16,t.bl_tree),to(t,l-3,2)):l<=10?(eo(t,17,t.bl_tree),to(t,l-3,3)):(eo(t,18,t.bl_tree),to(t,l-11,7));l=0,i=r,0===a?(s=138,f=3):r===a?(s=6,f=3):(s=7,f=4)}}Sn(Yn);var ho=!1;function po(t,e,n,o){to(t,0+(o?1:0),3),function(t,e,n,o){io(t),o&&(Jn(t,n),Jn(t,~n)),In.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}var go={_tr_init:function(t){ho||(!function(){var t,e,n,o,r,i=new Array(16);for(n=0,o=0;o<28;o++)for(Wn[o]=n,t=0;t<1<<Mn[o];t++)Gn[n++]=o;for(Gn[n-1]=o,r=0,o=0;o<16;o++)for(Yn[o]=r,t=0;t<1<<Hn[o];t++)Un[r++]=o;for(r>>=7;o<kn;o++)for(Yn[o]=r<<7,t=0;t<1<<Hn[o]-7;t++)Un[256+r++]=o;for(e=0;e<=Nn;e++)i[e]=0;for(t=0;t<=143;)Vn[2*t+1]=8,t++,i[8]++;for(;t<=255;)Vn[2*t+1]=9,t++,i[9]++;for(;t<=279;)Vn[2*t+1]=7,t++,i[7]++;for(;t<=287;)Vn[2*t+1]=8,t++,i[8]++;for(oo(Vn,287,i),t=0;t<kn;t++)jn[2*t+1]=5,jn[2*t]=no(t,5);qn=new $n(Vn,Mn,257,On,Nn),Xn=new $n(jn,Hn,0,kn,Nn),Zn=new $n(new Array(0),zn,0,19,7)}(),ho=!0),t.l_desc=new Kn(t.dyn_ltree,qn),t.d_desc=new Kn(t.dyn_dtree,Xn),t.bl_desc=new Kn(t.bl_tree,Zn),t.bi_buf=0,t.bi_valid=0,ro(t)},_tr_stored_block:po,_tr_flush_block:function(t,e,n,o){var r,i,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<Rn;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),fo(t,t.l_desc),fo(t,t.d_desc),a=function(t){var e;for(uo(t,t.dyn_ltree,t.l_desc.max_code),uo(t,t.dyn_dtree,t.d_desc.max_code),fo(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*Pn[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(i=t.static_len+3+7>>>3)<=r&&(r=i)):r=i=n+5,n+4<=r&&-1!==e?po(t,e,n,o):4===t.strategy||i===r?(to(t,2+(o?1:0),3),so(t,Vn,jn)):(to(t,4+(o?1:0),3),function(t,e,n,o){var r;for(to(t,e-257,5),to(t,n-1,5),to(t,o-4,4),r=0;r<o;r++)to(t,t.bl_tree[2*Pn[r]+1],3);co(t,t.dyn_ltree,e-1),co(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),so(t,t.dyn_ltree,t.dyn_dtree)),ro(t),o&&io(t)},_tr_tally:function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Gn[n]+Rn+1)]++,t.dyn_dtree[2*Qn(e)]++),t.last_lit===t.lit_bufsize-1},_tr_align:function(t){to(t,2,3),eo(t,256,Vn),function(t){16===t.bi_valid?(Jn(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}};var mo=function(t,e,n,o){for(var r=65535&t|0,i=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{i=i+(r=r+e[o++]|0)|0}while(--a);r%=65521,i%=65521}return r|i<<16|0};var bo=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();var xo,vo=function(t,e,n,o){var r=bo,i=o+n;t^=-1;for(var a=o;a<i;a++)t=t>>>8^r[255&(t^e[a])];return-1^t},yo={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},wo=-2,_o=258,Co=262,Ao=103,To=113,Lo=666;function Eo(t,e){return t.msg=yo[e],e}function Bo(t){return(t<<1)-(t>4?9:0)}function Do(t){for(var e=t.length;--e>=0;)t[e]=0}function Fo(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(In.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function Io(t,e){go._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Fo(t.strm)}function So(t,e){t.pending_buf[t.pending++]=e}function Ro(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function Oo(t,e){var n,o,r=t.max_chain_length,i=t.strstart,a=t.prev_length,l=t.nice_match,s=t.strstart>t.w_size-Co?t.strstart-(t.w_size-Co):0,f=t.window,u=t.w_mask,c=t.prev,h=t.strstart+_o,d=f[i+a-1],p=f[i+a];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do{if(f[(n=e)+a]===p&&f[n+a-1]===d&&f[n]===f[i]&&f[++n]===f[i+1]){i+=2,n++;do{}while(f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&i<h);if(o=_o-(h-i),i=h-_o,o>a){if(t.match_start=e,a=o,o>=l)break;d=f[i+a-1],p=f[i+a]}}}while((e=c[e&u])>s&&0!=--r);return a<=t.lookahead?a:t.lookahead}function ko(t){var e,n,o,r,i,a,l,s,f,u,c=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=c+(c-Co)){In.arraySet(t.window,t.window,c,c,0),t.match_start-=c,t.strstart-=c,t.block_start-=c,e=n=t.hash_size;do{o=t.head[--e],t.head[e]=o>=c?o-c:0}while(--n);e=n=c;do{o=t.prev[--e],t.prev[e]=o>=c?o-c:0}while(--n);r+=c}if(0===t.strm.avail_in)break;if(a=t.strm,l=t.window,s=t.strstart+t.lookahead,f=r,u=void 0,(u=a.avail_in)>f&&(u=f),n=0===u?0:(a.avail_in-=u,In.arraySet(l,a.input,a.next_in,u,s),1===a.state.wrap?a.adler=mo(a.adler,l,u,s):2===a.state.wrap&&(a.adler=vo(a.adler,l,u,s)),a.next_in+=u,a.total_in+=u,u),t.lookahead+=n,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=(t.ins_h<<t.hash_shift^t.window[i+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[i+3-1])&t.hash_mask,t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Co&&0!==t.strm.avail_in)}function No(t,e){for(var n,o;;){if(t.lookahead<Co){if(ko(t),t.lookahead<Co&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-Co&&(t.match_length=Oo(t,n)),t.match_length>=3)if(o=go._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else o=go._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(Io(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(Io(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Io(t,!1),0===t.strm.avail_out)?1:2}function Mo(t,e){for(var n,o,r;;){if(t.lookahead<Co){if(ko(t),t.lookahead<Co&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Co&&(t.match_length=Oo(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,o=go._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(Io(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((o=go._tr_tally(t,0,t.window[t.strstart-1]))&&Io(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=go._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(Io(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Io(t,!1),0===t.strm.avail_out)?1:2}function Ho(t,e,n,o,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=o,this.func=r}function zo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new In.Buf16(1146),this.dyn_dtree=new In.Buf16(122),this.bl_tree=new In.Buf16(78),Do(this.dyn_ltree),Do(this.dyn_dtree),Do(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new In.Buf16(16),this.heap=new In.Buf16(573),Do(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new In.Buf16(573),Do(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Po(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:To,t.adler=2===e.wrap?0:1,e.last_flush=0,go._tr_init(e),0):Eo(t,wo)}function Vo(t){var e,n=Po(t);return 0===n&&((e=t.state).window_size=2*e.w_size,Do(e.head),e.max_lazy_match=xo[e.level].max_lazy,e.good_match=xo[e.level].good_length,e.nice_match=xo[e.level].nice_length,e.max_chain_length=xo[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n}function jo(t,e,n,o,r,i){if(!t)return wo;var a=1;if(-1===e&&(e=6),o<0?(a=0,o=-o):o>15&&(a=2,o-=16),r<1||r>9||8!==n||o<8||o>15||e<0||e>9||i<0||i>4)return Eo(t,wo);8===o&&(o=9);var l=new zo;return t.state=l,l.strm=t,l.wrap=a,l.gzhead=null,l.w_bits=o,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new In.Buf8(2*l.w_size),l.head=new In.Buf16(l.hash_size),l.prev=new In.Buf16(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new In.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=i,l.method=n,Vo(t)}xo=[new Ho(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ko(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var o=t.block_start+n;if((0===t.strstart||t.strstart>=o)&&(t.lookahead=t.strstart-o,t.strstart=o,Io(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-Co&&(Io(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Io(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Io(t,!1),t.strm.avail_out),1)})),new Ho(4,4,8,4,No),new Ho(4,5,16,8,No),new Ho(4,6,32,32,No),new Ho(4,4,16,16,Mo),new Ho(8,16,32,32,Mo),new Ho(8,16,128,128,Mo),new Ho(8,32,128,256,Mo),new Ho(32,128,258,1024,Mo),new Ho(32,258,258,4096,Mo)];var Uo={deflateInit:function(t,e){return jo(t,e,8,15,8,0)},deflateInit2:jo,deflateReset:Vo,deflateResetKeep:Po,deflateSetHeader:function(t,e){return t&&t.state?2!==t.state.wrap?wo:(t.state.gzhead=e,0):wo},deflate:function(t,e){var n,o,r,i;if(!t||!t.state||e>5||e<0)return t?Eo(t,wo):wo;if(o=t.state,!t.output||!t.input&&0!==t.avail_in||o.status===Lo&&4!==e)return Eo(t,0===t.avail_out?-5:wo);if(o.strm=t,n=o.last_flush,o.last_flush=e,42===o.status)if(2===o.wrap)t.adler=0,So(o,31),So(o,139),So(o,8),o.gzhead?(So(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),So(o,255&o.gzhead.time),So(o,o.gzhead.time>>8&255),So(o,o.gzhead.time>>16&255),So(o,o.gzhead.time>>24&255),So(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),So(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(So(o,255&o.gzhead.extra.length),So(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(t.adler=vo(t.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(So(o,0),So(o,0),So(o,0),So(o,0),So(o,0),So(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),So(o,3),o.status=To);else{var a=8+(o.w_bits-8<<4)<<8;a|=(o.strategy>=2||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(a|=32),a+=31-a%31,o.status=To,Ro(o,a),0!==o.strstart&&(Ro(o,t.adler>>>16),Ro(o,65535&t.adler)),t.adler=1}if(69===o.status)if(o.gzhead.extra){for(r=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>r&&(t.adler=vo(t.adler,o.pending_buf,o.pending-r,r)),Fo(t),r=o.pending,o.pending!==o.pending_buf_size));)So(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>r&&(t.adler=vo(t.adler,o.pending_buf,o.pending-r,r)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(t.adler=vo(t.adler,o.pending_buf,o.pending-r,r)),Fo(t),r=o.pending,o.pending===o.pending_buf_size)){i=1;break}i=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,So(o,i)}while(0!==i);o.gzhead.hcrc&&o.pending>r&&(t.adler=vo(t.adler,o.pending_buf,o.pending-r,r)),0===i&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(t.adler=vo(t.adler,o.pending_buf,o.pending-r,r)),Fo(t),r=o.pending,o.pending===o.pending_buf_size)){i=1;break}i=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,So(o,i)}while(0!==i);o.gzhead.hcrc&&o.pending>r&&(t.adler=vo(t.adler,o.pending_buf,o.pending-r,r)),0===i&&(o.status=Ao)}else o.status=Ao;if(o.status===Ao&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&Fo(t),o.pending+2<=o.pending_buf_size&&(So(o,255&t.adler),So(o,t.adler>>8&255),t.adler=0,o.status=To)):o.status=To),0!==o.pending){if(Fo(t),0===t.avail_out)return o.last_flush=-1,0}else if(0===t.avail_in&&Bo(e)<=Bo(n)&&4!==e)return Eo(t,-5);if(o.status===Lo&&0!==t.avail_in)return Eo(t,-5);if(0!==t.avail_in||0!==o.lookahead||0!==e&&o.status!==Lo){var l=2===o.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(ko(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=go._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Io(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Io(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Io(t,!1),0===t.strm.avail_out)?1:2}(o,e):3===o.strategy?function(t,e){for(var n,o,r,i,a=t.window;;){if(t.lookahead<=_o){if(ko(t),t.lookahead<=_o&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(o=a[r=t.strstart-1])===a[++r]&&o===a[++r]&&o===a[++r]){i=t.strstart+_o;do{}while(o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&r<i);t.match_length=_o-(i-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=go._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=go._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Io(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Io(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Io(t,!1),0===t.strm.avail_out)?1:2}(o,e):xo[o.level].func(o,e);if(3!==l&&4!==l||(o.status=Lo),1===l||3===l)return 0===t.avail_out&&(o.last_flush=-1),0;if(2===l&&(1===e?go._tr_align(o):5!==e&&(go._tr_stored_block(o,0,0,!1),3===e&&(Do(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),Fo(t),0===t.avail_out))return o.last_flush=-1,0}return 4!==e?0:o.wrap<=0?1:(2===o.wrap?(So(o,255&t.adler),So(o,t.adler>>8&255),So(o,t.adler>>16&255),So(o,t.adler>>24&255),So(o,255&t.total_in),So(o,t.total_in>>8&255),So(o,t.total_in>>16&255),So(o,t.total_in>>24&255)):(Ro(o,t.adler>>>16),Ro(o,65535&t.adler)),Fo(t),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?0:1)},deflateEnd:function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&e!==Ao&&e!==To&&e!==Lo?Eo(t,wo):(t.state=null,e===To?Eo(t,-3):0):wo},deflateSetDictionary:function(t,e){var n,o,r,i,a,l,s,f,u=e.length;if(!t||!t.state)return wo;if(2===(i=(n=t.state).wrap)||1===i&&42!==n.status||n.lookahead)return wo;for(1===i&&(t.adler=mo(t.adler,e,u,0)),n.wrap=0,u>=n.w_size&&(0===i&&(Do(n.head),n.strstart=0,n.block_start=0,n.insert=0),f=new In.Buf8(n.w_size),In.arraySet(f,e,u-n.w_size,n.w_size,0),e=f,u=n.w_size),a=t.avail_in,l=t.next_in,s=t.input,t.avail_in=u,t.next_in=0,t.input=e,ko(n);n.lookahead>=3;){o=n.strstart,r=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[o+3-1])&n.hash_mask,n.prev[o&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=o,o++}while(--r);n.strstart=o,n.lookahead=2,ko(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=l,t.input=s,t.avail_in=a,n.wrap=i,0},deflateInfo:"pako deflate (from Nodeca project)"},Go=!0,Wo=!0;try{String.fromCharCode.apply(null,[0])}catch(t){Go=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Wo=!1}for(var qo=new In.Buf8(256),Xo=0;Xo<256;Xo++)qo[Xo]=Xo>=252?6:Xo>=248?5:Xo>=240?4:Xo>=224?3:Xo>=192?2:1;qo[254]=qo[254]=1;function Zo(t,e){if(e<65534&&(t.subarray&&Wo||!t.subarray&&Go))return String.fromCharCode.apply(null,In.shrinkBuf(t,e));for(var n="",o=0;o<e;o++)n+=String.fromCharCode(t[o]);return n}var Yo=function(t){var e,n,o,r,i,a=t.length,l=0;for(r=0;r<a;r++)55296==(64512&(n=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(o=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new In.Buf8(l),i=0,r=0;i<l;r++)55296==(64512&(n=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(o=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),n<128?e[i++]=n:n<2048?(e[i++]=192|n>>>6,e[i++]=128|63&n):n<65536?(e[i++]=224|n>>>12,e[i++]=128|n>>>6&63,e[i++]=128|63&n):(e[i++]=240|n>>>18,e[i++]=128|n>>>12&63,e[i++]=128|n>>>6&63,e[i++]=128|63&n);return e},$o=function(t){return Zo(t,t.length)},Ko=function(t){for(var e=new In.Buf8(t.length),n=0,o=e.length;n<o;n++)e[n]=t.charCodeAt(n);return e},Qo=function(t,e){var n,o,r,i,a=e||t.length,l=new Array(2*a);for(o=0,n=0;n<a;)if((r=t[n++])<128)l[o++]=r;else if((i=qo[r])>4)l[o++]=65533,n+=i-1;else{for(r&=2===i?31:3===i?15:7;i>1&&n<a;)r=r<<6|63&t[n++],i--;i>1?l[o++]=65533:r<65536?l[o++]=r:(r-=65536,l[o++]=55296|r>>10&1023,l[o++]=56320|1023&r)}return Zo(l,o)},Jo=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+qo[t[n]]>e?n:e};var tr=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},er=Object.prototype.toString;function nr(t){if(!(this instanceof nr))return new nr(t);this.options=In.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tr,this.strm.avail_out=0;var n=Uo.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(yo[n]);if(e.header&&Uo.deflateSetHeader(this.strm,e.header),e.dictionary){var o;if(o="string"==typeof e.dictionary?Yo(e.dictionary):"[object ArrayBuffer]"===er.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=Uo.deflateSetDictionary(this.strm,o)))throw new Error(yo[n]);this._dict_set=!0}}function or(t,e){var n=new nr(e);if(n.push(t,!0),n.err)throw n.msg||yo[n.err];return n.result}nr.prototype.push=function(t,e){var n,o,r=this.strm,i=this.options.chunkSize;if(this.ended)return!1;o=e===~~e?e:!0===e?4:0,"string"==typeof t?r.input=Yo(t):"[object ArrayBuffer]"===er.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new In.Buf8(i),r.next_out=0,r.avail_out=i),1!==(n=Uo.deflate(r,o))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData($o(In.shrinkBuf(r.output,r.next_out))):this.onData(In.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&1!==n);return 4===o?(n=Uo.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==o||(this.onEnd(0),r.avail_out=0,!0)},nr.prototype.onData=function(t){this.chunks.push(t)},nr.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=In.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var rr={Deflate:nr,deflate:or,deflateRaw:function(t,e){return(e=e||{}).raw=!0,or(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,or(t,e)}},ir=function(t,e){var n,o,r,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y,w,_,C,A,T,L;n=t.state,o=t.next_in,T=t.input,r=o+(t.avail_in-5),i=t.next_out,L=t.output,a=i-(e-t.avail_out),l=i+(t.avail_out-257),s=n.dmax,f=n.wsize,u=n.whave,c=n.wnext,h=n.window,d=n.hold,p=n.bits,g=n.lencode,m=n.distcode,b=(1<<n.lenbits)-1,x=(1<<n.distbits)-1;t:do{p<15&&(d+=T[o++]<<p,p+=8,d+=T[o++]<<p,p+=8),v=g[d&b];e:for(;;){if(d>>>=y=v>>>24,p-=y,0===(y=v>>>16&255))L[i++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=g[(65535&v)+(d&(1<<y)-1)];continue e}if(32&y){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}w=65535&v,(y&=15)&&(p<y&&(d+=T[o++]<<p,p+=8),w+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=T[o++]<<p,p+=8,d+=T[o++]<<p,p+=8),v=m[d&x];n:for(;;){if(d>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=m[(65535&v)+(d&(1<<y)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(_=65535&v,p<(y&=15)&&(d+=T[o++]<<p,(p+=8)<y&&(d+=T[o++]<<p,p+=8)),(_+=d&(1<<y)-1)>s){t.msg="invalid distance too far back",n.mode=30;break t}if(d>>>=y,p-=y,_>(y=i-a)){if((y=_-y)>u&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(C=0,A=h,0===c){if(C+=f-y,y<w){w-=y;do{L[i++]=h[C++]}while(--y);C=i-_,A=L}}else if(c<y){if(C+=f+c-y,(y-=c)<w){w-=y;do{L[i++]=h[C++]}while(--y);if(C=0,c<w){w-=y=c;do{L[i++]=h[C++]}while(--y);C=i-_,A=L}}}else if(C+=c-y,y<w){w-=y;do{L[i++]=h[C++]}while(--y);C=i-_,A=L}for(;w>2;)L[i++]=A[C++],L[i++]=A[C++],L[i++]=A[C++],w-=3;w&&(L[i++]=A[C++],w>1&&(L[i++]=A[C++]))}else{C=i-_;do{L[i++]=L[C++],L[i++]=L[C++],L[i++]=L[C++],w-=3}while(w>2);w&&(L[i++]=L[C++],w>1&&(L[i++]=L[C++]))}break}}break}}while(o<r&&i<l);o-=w=p>>3,d&=(1<<(p-=w<<3))-1,t.next_in=o,t.next_out=i,t.avail_in=o<r?r-o+5:5-(o-r),t.avail_out=i<l?l-i+257:257-(i-l),n.hold=d,n.bits=p},ar=15,lr=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],sr=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],fr=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],ur=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],cr=function(t,e,n,o,r,i,a,l){var s,f,u,c,h,d,p,g,m,b=l.bits,x=0,v=0,y=0,w=0,_=0,C=0,A=0,T=0,L=0,E=0,B=null,D=0,F=new In.Buf16(16),I=new In.Buf16(16),S=null,R=0;for(x=0;x<=ar;x++)F[x]=0;for(v=0;v<o;v++)F[e[n+v]]++;for(_=b,w=ar;w>=1&&0===F[w];w--);if(_>w&&(_=w),0===w)return r[i++]=20971520,r[i++]=20971520,l.bits=1,0;for(y=1;y<w&&0===F[y];y++);for(_<y&&(_=y),T=1,x=1;x<=ar;x++)if(T<<=1,(T-=F[x])<0)return-1;if(T>0&&(0===t||1!==w))return-1;for(I[1]=0,x=1;x<ar;x++)I[x+1]=I[x]+F[x];for(v=0;v<o;v++)0!==e[n+v]&&(a[I[e[n+v]]++]=v);if(0===t?(B=S=a,d=19):1===t?(B=lr,D-=257,S=sr,R-=257,d=256):(B=fr,S=ur,d=-1),E=0,v=0,x=y,h=i,C=_,A=0,u=-1,c=(L=1<<_)-1,1===t&&L>852||2===t&&L>592)return 1;for(;;){p=x-A,a[v]<d?(g=0,m=a[v]):a[v]>d?(g=S[R+a[v]],m=B[D+a[v]]):(g=96,m=0),s=1<<x-A,y=f=1<<C;do{r[h+(E>>A)+(f-=s)]=p<<24|g<<16|m|0}while(0!==f);for(s=1<<x-1;E&s;)s>>=1;if(0!==s?(E&=s-1,E+=s):E=0,v++,0==--F[x]){if(x===w)break;x=e[n+a[v]]}if(x>_&&(E&c)!==u){for(0===A&&(A=_),h+=y,T=1<<(C=x-A);C+A<w&&!((T-=F[C+A])<=0);)C++,T<<=1;if(L+=1<<C,1===t&&L>852||2===t&&L>592)return 1;r[u=E&c]=_<<24|C<<16|h-i|0}}return 0!==E&&(r[h+E]=x-A<<24|64<<16|0),l.bits=_,0},hr=-2,dr=12,pr=30;function gr(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function mr(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new In.Buf16(320),this.work=new In.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function br(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new In.Buf32(852),e.distcode=e.distdyn=new In.Buf32(592),e.sane=1,e.back=-1,0):hr}function xr(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,br(t)):hr}function vr(t,e){var n,o;return t&&t.state?(o=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?hr:(null!==o.window&&o.wbits!==e&&(o.window=null),o.wrap=n,o.wbits=e,xr(t))):hr}function yr(t,e){var n,o;return t?(o=new mr,t.state=o,o.window=null,0!==(n=vr(t,e))&&(t.state=null),n):hr}var wr,_r,Cr=!0;function Ar(t){if(Cr){var e;for(wr=new In.Buf32(512),_r=new In.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(cr(1,t.lens,0,288,wr,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;cr(2,t.lens,0,32,_r,0,t.work,{bits:5}),Cr=!1}t.lencode=wr,t.lenbits=9,t.distcode=_r,t.distbits=5}function Tr(t,e,n,o){var r,i=t.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new In.Buf8(i.wsize)),o>=i.wsize?(In.arraySet(i.window,e,n-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):((r=i.wsize-i.wnext)>o&&(r=o),In.arraySet(i.window,e,n-o,r,i.wnext),(o-=r)?(In.arraySet(i.window,e,n-o,o,0),i.wnext=o,i.whave=i.wsize):(i.wnext+=r,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=r))),0}var Lr={inflateReset:xr,inflateReset2:vr,inflateResetKeep:br,inflateInit:function(t){return yr(t,15)},inflateInit2:yr,inflate:function(t,e){var n,o,r,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y,w,_,C,A,T,L=0,E=new In.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return hr;(n=t.state).mode===dr&&(n.mode=13),a=t.next_out,r=t.output,s=t.avail_out,i=t.next_in,o=t.input,l=t.avail_in,f=n.hold,u=n.bits,c=l,h=s,C=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(2&n.wrap&&35615===f){n.check=0,E[0]=255&f,E[1]=f>>>8&255,n.check=vo(n.check,E,2,0),f=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){t.msg="incorrect header check",n.mode=pr;break}if(8!=(15&f)){t.msg="unknown compression method",n.mode=pr;break}if(u-=4,_=8+(15&(f>>>=4)),0===n.wbits)n.wbits=_;else if(_>n.wbits){t.msg="invalid window size",n.mode=pr;break}n.dmax=1<<_,t.adler=n.check=1,n.mode=512&f?10:dr,f=0,u=0;break;case 2:for(;u<16;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(n.flags=f,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=pr;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=pr;break}n.head&&(n.head.text=f>>8&1),512&n.flags&&(E[0]=255&f,E[1]=f>>>8&255,n.check=vo(n.check,E,2,0)),f=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}n.head&&(n.head.time=f),512&n.flags&&(E[0]=255&f,E[1]=f>>>8&255,E[2]=f>>>16&255,E[3]=f>>>24&255,n.check=vo(n.check,E,4,0)),f=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&n.flags&&(E[0]=255&f,E[1]=f>>>8&255,n.check=vo(n.check,E,2,0)),f=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}n.length=f,n.head&&(n.head.extra_len=f),512&n.flags&&(E[0]=255&f,E[1]=f>>>8&255,n.check=vo(n.check,E,2,0)),f=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((d=n.length)>l&&(d=l),d&&(n.head&&(_=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),In.arraySet(n.head.extra,o,i,d,_)),512&n.flags&&(n.check=vo(n.check,o,d,i)),l-=d,i+=d,n.length-=d),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===l)break t;d=0;do{_=o[i+d++],n.head&&_&&n.length<65536&&(n.head.name+=String.fromCharCode(_))}while(_&&d<l);if(512&n.flags&&(n.check=vo(n.check,o,d,i)),l-=d,i+=d,_)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===l)break t;d=0;do{_=o[i+d++],n.head&&_&&n.length<65536&&(n.head.comment+=String.fromCharCode(_))}while(_&&d<l);if(512&n.flags&&(n.check=vo(n.check,o,d,i)),l-=d,i+=d,_)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(f!==(65535&n.check)){t.msg="header crc mismatch",n.mode=pr;break}f=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=dr;break;case 10:for(;u<32;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}t.adler=n.check=gr(f),f=0,u=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=a,t.avail_out=s,t.next_in=i,t.avail_in=l,n.hold=f,n.bits=u,2;t.adler=n.check=1,n.mode=dr;case dr:if(5===e||6===e)break t;case 13:if(n.last){f>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}switch(n.last=1&f,u-=1,3&(f>>>=1)){case 0:n.mode=14;break;case 1:if(Ar(n),n.mode=20,6===e){f>>>=2,u-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=pr}f>>>=2,u-=2;break;case 14:for(f>>>=7&u,u-=7&u;u<32;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if((65535&f)!=(f>>>16^65535)){t.msg="invalid stored block lengths",n.mode=pr;break}if(n.length=65535&f,f=0,u=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(d=n.length){if(d>l&&(d=l),d>s&&(d=s),0===d)break t;In.arraySet(r,o,i,d,a),l-=d,i+=d,s-=d,a+=d,n.length-=d;break}n.mode=dr;break;case 17:for(;u<14;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(n.nlen=257+(31&f),f>>>=5,u-=5,n.ndist=1+(31&f),f>>>=5,u-=5,n.ncode=4+(15&f),f>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=pr;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}n.lens[B[n.have++]]=7&f,f>>>=3,u-=3}for(;n.have<19;)n.lens[B[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},C=cr(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,C){t.msg="invalid code lengths set",n.mode=pr;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;b=(L=n.lencode[f&(1<<n.lenbits)-1])>>>16&255,x=65535&L,!((m=L>>>24)<=u);){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(x<16)f>>>=m,u-=m,n.lens[n.have++]=x;else{if(16===x){for(T=m+2;u<T;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(f>>>=m,u-=m,0===n.have){t.msg="invalid bit length repeat",n.mode=pr;break}_=n.lens[n.have-1],d=3+(3&f),f>>>=2,u-=2}else if(17===x){for(T=m+3;u<T;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}u-=m,_=0,d=3+(7&(f>>>=m)),f>>>=3,u-=3}else{for(T=m+7;u<T;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}u-=m,_=0,d=11+(127&(f>>>=m)),f>>>=7,u-=7}if(n.have+d>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=pr;break}for(;d--;)n.lens[n.have++]=_}}if(n.mode===pr)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=pr;break}if(n.lenbits=9,A={bits:n.lenbits},C=cr(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,C){t.msg="invalid literal/lengths set",n.mode=pr;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},C=cr(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,C){t.msg="invalid distances set",n.mode=pr;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(l>=6&&s>=258){t.next_out=a,t.avail_out=s,t.next_in=i,t.avail_in=l,n.hold=f,n.bits=u,ir(t,h),a=t.next_out,r=t.output,s=t.avail_out,i=t.next_in,o=t.input,l=t.avail_in,f=n.hold,u=n.bits,n.mode===dr&&(n.back=-1);break}for(n.back=0;b=(L=n.lencode[f&(1<<n.lenbits)-1])>>>16&255,x=65535&L,!((m=L>>>24)<=u);){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(b&&0==(240&b)){for(v=m,y=b,w=x;b=(L=n.lencode[w+((f&(1<<v+y)-1)>>v)])>>>16&255,x=65535&L,!(v+(m=L>>>24)<=u);){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}f>>>=v,u-=v,n.back+=v}if(f>>>=m,u-=m,n.back+=m,n.length=x,0===b){n.mode=26;break}if(32&b){n.back=-1,n.mode=dr;break}if(64&b){t.msg="invalid literal/length code",n.mode=pr;break}n.extra=15&b,n.mode=22;case 22:if(n.extra){for(T=n.extra;u<T;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;b=(L=n.distcode[f&(1<<n.distbits)-1])>>>16&255,x=65535&L,!((m=L>>>24)<=u);){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(0==(240&b)){for(v=m,y=b,w=x;b=(L=n.distcode[w+((f&(1<<v+y)-1)>>v)])>>>16&255,x=65535&L,!(v+(m=L>>>24)<=u);){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}f>>>=v,u-=v,n.back+=v}if(f>>>=m,u-=m,n.back+=m,64&b){t.msg="invalid distance code",n.mode=pr;break}n.offset=x,n.extra=15&b,n.mode=24;case 24:if(n.extra){for(T=n.extra;u<T;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=pr;break}n.mode=25;case 25:if(0===s)break t;if(d=h-s,n.offset>d){if((d=n.offset-d)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=pr;break}d>n.wnext?(d-=n.wnext,p=n.wsize-d):p=n.wnext-d,d>n.length&&(d=n.length),g=n.window}else g=r,p=a-n.offset,d=n.length;d>s&&(d=s),s-=d,n.length-=d;do{r[a++]=g[p++]}while(--d);0===n.length&&(n.mode=21);break;case 26:if(0===s)break t;r[a++]=n.length,s--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===l)break t;l--,f|=o[i++]<<u,u+=8}if(h-=s,t.total_out+=h,n.total+=h,h&&(t.adler=n.check=n.flags?vo(n.check,r,h,a-h):mo(n.check,r,h,a-h)),h=s,(n.flags?f:gr(f))!==n.check){t.msg="incorrect data check",n.mode=pr;break}f=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===l)break t;l--,f+=o[i++]<<u,u+=8}if(f!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=pr;break}f=0,u=0}n.mode=29;case 29:C=1;break t;case pr:C=-3;break t;case 31:return-4;case 32:default:return hr}return t.next_out=a,t.avail_out=s,t.next_in=i,t.avail_in=l,n.hold=f,n.bits=u,(n.wsize||h!==t.avail_out&&n.mode<pr&&(n.mode<27||4!==e))&&Tr(t,t.output,t.next_out,h-t.avail_out),c-=t.avail_in,h-=t.avail_out,t.total_in+=c,t.total_out+=h,n.total+=h,n.wrap&&h&&(t.adler=n.check=n.flags?vo(n.check,r,h,t.next_out-h):mo(n.check,r,h,t.next_out-h)),t.data_type=n.bits+(n.last?64:0)+(n.mode===dr?128:0)+(20===n.mode||15===n.mode?256:0),(0===c&&0===h||4===e)&&0===C&&(C=-5),C},inflateEnd:function(t){if(!t||!t.state)return hr;var e=t.state;return e.window&&(e.window=null),t.state=null,0},inflateGetHeader:function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?hr:(n.head=e,e.done=!1,0):hr},inflateSetDictionary:function(t,e){var n,o=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?hr:11===n.mode&&mo(1,e,o,0)!==n.check?-3:Tr(t,e,o,o)?(n.mode=31,-4):(n.havedict=1,0):hr},inflateInfo:"pako inflate (from Nodeca project)"},Er={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Br=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Dr=Object.prototype.toString;function Fr(t){if(!(this instanceof Fr))return new Fr(t);this.options=In.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tr,this.strm.avail_out=0;var n=Lr.inflateInit2(this.strm,e.windowBits);if(n!==Er.Z_OK)throw new Error(yo[n]);if(this.header=new Br,Lr.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Yo(e.dictionary):"[object ArrayBuffer]"===Dr.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Lr.inflateSetDictionary(this.strm,e.dictionary))!==Er.Z_OK))throw new Error(yo[n])}function Ir(t,e){var n=new Fr(e);if(n.push(t,!0),n.err)throw n.msg||yo[n.err];return n.result}Fr.prototype.push=function(t,e){var n,o,r,i,a,l=this.strm,s=this.options.chunkSize,f=this.options.dictionary,u=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?Er.Z_FINISH:Er.Z_NO_FLUSH,"string"==typeof t?l.input=Ko(t):"[object ArrayBuffer]"===Dr.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new In.Buf8(s),l.next_out=0,l.avail_out=s),(n=Lr.inflate(l,Er.Z_NO_FLUSH))===Er.Z_NEED_DICT&&f&&(n=Lr.inflateSetDictionary(this.strm,f)),n===Er.Z_BUF_ERROR&&!0===u&&(n=Er.Z_OK,u=!1),n!==Er.Z_STREAM_END&&n!==Er.Z_OK)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&n!==Er.Z_STREAM_END&&(0!==l.avail_in||o!==Er.Z_FINISH&&o!==Er.Z_SYNC_FLUSH)||("string"===this.options.to?(r=Jo(l.output,l.next_out),i=l.next_out-r,a=Qo(l.output,r),l.next_out=i,l.avail_out=s-i,i&&In.arraySet(l.output,l.output,r,i,0),this.onData(a)):this.onData(In.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(u=!0)}while((l.avail_in>0||0===l.avail_out)&&n!==Er.Z_STREAM_END);return n===Er.Z_STREAM_END&&(o=Er.Z_FINISH),o===Er.Z_FINISH?(n=Lr.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Er.Z_OK):o!==Er.Z_SYNC_FLUSH||(this.onEnd(Er.Z_OK),l.avail_out=0,!0)},Fr.prototype.onData=function(t){this.chunks.push(t)},Fr.prototype.onEnd=function(t){t===Er.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=In.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Sr={Inflate:Fr,inflate:Ir,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Ir(t,e)},ungzip:Ir},Rr={};(0,In.assign)(Rr,rr,Sr,Er);var Or=Rr,kr=vn((function(t){!function(){var e={};t.exports=e,function(t,e){t.toRGBA8=function(e){var n=e.width,o=e.height;if(null==e.tabs.acTL)return[t.toRGBA8.decodeImage(e.data,n,o,e).buffer];var r=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var i,a=new Uint8Array(n*o*4),l=0;l<e.frames.length;l++){var s=e.frames[l],f=s.rect.x,u=s.rect.y,c=s.rect.width,h=s.rect.height,d=t.toRGBA8.decodeImage(s.data,c,h,e);if(0==l?i=d:0==s.blend?t._copyTile(d,c,h,i,n,o,f,u,0):1==s.blend&&t._copyTile(d,c,h,i,n,o,f,u,1),r.push(i.buffer),i=i.slice(0),0==s.dispose);else if(1==s.dispose)t._copyTile(a,c,h,i,n,o,f,u,0);else if(2==s.dispose){for(var p=l-1;2==e.frames[p].dispose;)p--;i=new Uint8Array(r[p]).slice(0)}}return r},t.toRGBA8.decodeImage=function(e,n,o,r){var i=n*o,a=t.decode._getBPP(r),l=Math.ceil(n*a/8),s=new Uint8Array(4*i),f=new Uint32Array(s.buffer),u=r.ctype,c=r.depth,h=t._bin.readUshort;if(6==u){var d=i<<2;if(8==c)for(var p=0;p<d;p++)s[p]=e[p];if(16==c)for(p=0;p<d;p++)s[p]=e[p<<1]}else if(2==u){var g=r.tabs.tRNS,m=-1,b=-1,x=-1;if(g&&(m=g[0],b=g[1],x=g[2]),8==c)for(p=0;p<i;p++){var v=3*p;s[L=p<<2]=e[v],s[L+1]=e[v+1],s[L+2]=e[v+2],s[L+3]=255,-1!=m&&e[v]==m&&e[v+1]==b&&e[v+2]==x&&(s[L+3]=0)}if(16==c)for(p=0;p<i;p++){v=6*p;s[L=p<<2]=e[v],s[L+1]=e[v+2],s[L+2]=e[v+4],s[L+3]=255,-1!=m&&h(e,v)==m&&h(e,v+2)==b&&h(e,v+4)==x&&(s[L+3]=0)}}else if(3==u){var y=r.tabs.PLTE,w=r.tabs.tRNS,_=w?w.length:0;if(1==c)for(var C=0;C<o;C++){var A=C*l,T=C*n;for(p=0;p<n;p++){var L=T+p<<2,E=3*(B=e[A+(p>>3)]>>7-((7&p)<<0)&1);s[L]=y[E],s[L+1]=y[E+1],s[L+2]=y[E+2],s[L+3]=B<_?w[B]:255}}if(2==c)for(C=0;C<o;C++)for(A=C*l,T=C*n,p=0;p<n;p++){L=T+p<<2,E=3*(B=e[A+(p>>2)]>>6-((3&p)<<1)&3);s[L]=y[E],s[L+1]=y[E+1],s[L+2]=y[E+2],s[L+3]=B<_?w[B]:255}if(4==c)for(C=0;C<o;C++)for(A=C*l,T=C*n,p=0;p<n;p++){L=T+p<<2,E=3*(B=e[A+(p>>1)]>>4-((1&p)<<2)&15);s[L]=y[E],s[L+1]=y[E+1],s[L+2]=y[E+2],s[L+3]=B<_?w[B]:255}if(8==c)for(p=0;p<i;p++){var B;L=p<<2,E=3*(B=e[p]);s[L]=y[E],s[L+1]=y[E+1],s[L+2]=y[E+2],s[L+3]=B<_?w[B]:255}}else if(4==u){if(8==c)for(p=0;p<i;p++){L=p<<2;var D=e[F=p<<1];s[L]=D,s[L+1]=D,s[L+2]=D,s[L+3]=e[F+1]}if(16==c)for(p=0;p<i;p++){var F;L=p<<2,D=e[F=p<<2];s[L]=D,s[L+1]=D,s[L+2]=D,s[L+3]=e[F+2]}}else if(0==u){m=r.tabs.tRNS?r.tabs.tRNS:-1;if(1==c)for(p=0;p<i;p++){var I=(D=255*(e[p>>3]>>7-(7&p)&1))==255*m?0:255;f[p]=I<<24|D<<16|D<<8|D}if(2==c)for(p=0;p<i;p++){I=(D=85*(e[p>>2]>>6-((3&p)<<1)&3))==85*m?0:255;f[p]=I<<24|D<<16|D<<8|D}if(4==c)for(p=0;p<i;p++){I=(D=17*(e[p>>1]>>4-((1&p)<<2)&15))==17*m?0:255;f[p]=I<<24|D<<16|D<<8|D}if(8==c)for(p=0;p<i;p++){I=(D=e[p])==m?0:255;f[p]=I<<24|D<<16|D<<8|D}if(16==c)for(p=0;p<i;p++){D=e[p<<1],I=h(e,p<<1)==m?0:255;f[p]=I<<24|D<<16|D<<8|D}}return s},t.decode=function(e){for(var n,o=new Uint8Array(e),r=8,i=t._bin,a=i.readUshort,l=i.readUint,s={tabs:{},frames:[]},f=new Uint8Array(o.length),u=0,c=0,h=[137,80,78,71,13,10,26,10],d=0;d<8;d++)if(o[d]!=h[d])throw"The input is not a PNG file!";for(;r<o.length;){var p=i.readUint(o,r);r+=4;var g=i.readASCII(o,r,4);if(r+=4,"IHDR"==g)t.decode._IHDR(o,r,s);else if("IDAT"==g){for(d=0;d<p;d++)f[u+d]=o[r+d];u+=p}else if("acTL"==g)s.tabs[g]={num_frames:l(o,r),num_plays:l(o,r+4)},n=new Uint8Array(o.length);else if("fcTL"==g){if(0!=c)(A=s.frames[s.frames.length-1]).data=t.decode._decompress(s,n.slice(0,c),A.rect.width,A.rect.height),c=0;var m={x:l(o,r+12),y:l(o,r+16),width:l(o,r+4),height:l(o,r+8)},b=a(o,r+22);b=a(o,r+20)/(0==b?100:b);var x={rect:m,delay:Math.round(1e3*b),dispose:o[r+24],blend:o[r+25]};s.frames.push(x)}else if("fdAT"==g){for(d=0;d<p-4;d++)n[c+d]=o[r+d+4];c+=p-4}else if("pHYs"==g)s.tabs[g]=[i.readUint(o,r),i.readUint(o,r+4),o[r+8]];else if("cHRM"==g){s.tabs[g]=[];for(d=0;d<8;d++)s.tabs[g].push(i.readUint(o,r+4*d))}else if("tEXt"==g){null==s.tabs[g]&&(s.tabs[g]={});var v=i.nextZero(o,r),y=i.readASCII(o,r,v-r),w=i.readASCII(o,v+1,r+p-v-1);s.tabs[g][y]=w}else if("iTXt"==g){null==s.tabs[g]&&(s.tabs[g]={});v=0;var _=r;v=i.nextZero(o,_);y=i.readASCII(o,_,v-_);_=v+1,_+=2,v=i.nextZero(o,_);i.readASCII(o,_,v-_);_=v+1,v=i.nextZero(o,_);i.readUTF8(o,_,v-_);_=v+1;w=i.readUTF8(o,_,p-(_-r));s.tabs[g][y]=w}else if("PLTE"==g)s.tabs[g]=i.readBytes(o,r,p);else if("hIST"==g){var C=s.tabs.PLTE.length/3;s.tabs[g]=[];for(d=0;d<C;d++)s.tabs[g].push(a(o,r+2*d))}else if("tRNS"==g)3==s.ctype?s.tabs[g]=i.readBytes(o,r,p):0==s.ctype?s.tabs[g]=a(o,r):2==s.ctype&&(s.tabs[g]=[a(o,r),a(o,r+2),a(o,r+4)]);else if("gAMA"==g)s.tabs[g]=i.readUint(o,r)/1e5;else if("sRGB"==g)s.tabs[g]=o[r];else if("bKGD"==g)0==s.ctype||4==s.ctype?s.tabs[g]=[a(o,r)]:2==s.ctype||6==s.ctype?s.tabs[g]=[a(o,r),a(o,r+2),a(o,r+4)]:3==s.ctype&&(s.tabs[g]=o[r]);else if("IEND"==g){var A;if(0!=c)(A=s.frames[s.frames.length-1]).data=t.decode._decompress(s,n.slice(0,c),A.rect.width,A.rect.height),c=0;s.data=t.decode._decompress(s,f,s.width,s.height);break}r+=p;i.readUint(o,r);r+=4}return delete s.compress,delete s.interlace,delete s.filter,s},t.decode._decompress=function(e,n,o,r){return 0==e.compress&&(n=t.decode._inflate(n)),0==e.interlace?n=t.decode._filterZero(n,e,0,o,r):1==e.interlace&&(n=t.decode._readInterlace(n,e)),n},t.decode._inflate=function(t){return e.inflate(t)},t.decode._readInterlace=function(e,n){for(var o=n.width,r=n.height,i=t.decode._getBPP(n),a=i>>3,l=Math.ceil(o*i/8),s=new Uint8Array(r*l),f=0,u=[0,0,4,0,2,0,1],c=[0,4,0,2,0,1,0],h=[8,8,8,4,4,2,2],d=[8,8,4,4,2,2,1],p=0;p<7;){for(var g=h[p],m=d[p],b=0,x=0,v=u[p];v<r;)v+=g,x++;for(var y=c[p];y<o;)y+=m,b++;var w=Math.ceil(b*i/8);t.decode._filterZero(e,n,f,b,x);for(var _=0,C=u[p];C<r;){for(var A=c[p],T=f+_*w<<3;A<o;){var L;if(1==i)L=(L=e[T>>3])>>7-(7&T)&1,s[C*l+(A>>3)]|=L<<7-((3&A)<<0);if(2==i)L=(L=e[T>>3])>>6-(7&T)&3,s[C*l+(A>>2)]|=L<<6-((3&A)<<1);if(4==i)L=(L=e[T>>3])>>4-(7&T)&15,s[C*l+(A>>1)]|=L<<4-((1&A)<<2);if(i>=8)for(var E=C*l+A*a,B=0;B<a;B++)s[E+B]=e[(T>>3)+B];T+=i,A+=m}_++,C+=g}b*x!=0&&(f+=x*(1+w)),p+=1}return s},t.decode._getBPP=function(t){return[1,null,3,1,2,null,4][t.ctype]*t.depth},t.decode._filterZero=function(e,n,o,r,i){var a=t.decode._getBPP(n),l=Math.ceil(r*a/8),s=t.decode._paeth;a=Math.ceil(a/8);for(var f=0;f<i;f++){var u=o+f*l,c=u+f+1,h=e[c-1];if(0==h)for(var d=0;d<l;d++)e[u+d]=e[c+d];else if(1==h){for(d=0;d<a;d++)e[u+d]=e[c+d];for(d=a;d<l;d++)e[u+d]=e[c+d]+e[u+d-a]&255}else if(0==f){for(d=0;d<a;d++)e[u+d]=e[c+d];if(2==h)for(d=a;d<l;d++)e[u+d]=255&e[c+d];if(3==h)for(d=a;d<l;d++)e[u+d]=e[c+d]+(e[u+d-a]>>1)&255;if(4==h)for(d=a;d<l;d++)e[u+d]=e[c+d]+s(e[u+d-a],0,0)&255}else{if(2==h)for(d=0;d<l;d++)e[u+d]=e[c+d]+e[u+d-l]&255;if(3==h){for(d=0;d<a;d++)e[u+d]=e[c+d]+(e[u+d-l]>>1)&255;for(d=a;d<l;d++)e[u+d]=e[c+d]+(e[u+d-l]+e[u+d-a]>>1)&255}if(4==h){for(d=0;d<a;d++)e[u+d]=e[c+d]+s(0,e[u+d-l],0)&255;for(d=a;d<l;d++)e[u+d]=e[c+d]+s(e[u+d-a],e[u+d-l],e[u+d-a-l])&255}}}return e},t.decode._paeth=function(t,e,n){var o=t+e-n,r=Math.abs(o-t),i=Math.abs(o-e),a=Math.abs(o-n);return r<=i&&r<=a?t:i<=a?e:n},t.decode._IHDR=function(e,n,o){var r=t._bin;o.width=r.readUint(e,n),n+=4,o.height=r.readUint(e,n),n+=4,o.depth=e[n],n++,o.ctype=e[n],n++,o.compress=e[n],n++,o.filter=e[n],n++,o.interlace=e[n],n++},t._bin={nextZero:function(t,e){for(;0!=t[e];)e++;return e},readUshort:function(t,e){return t[e]<<8|t[e+1]},writeUshort:function(t,e,n){t[e]=n>>8&255,t[e+1]=255&n},readUint:function(t,e){return 16777216*t[e]+(t[e+1]<<16|t[e+2]<<8|t[e+3])},writeUint:function(t,e,n){t[e]=n>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n},readASCII:function(t,e,n){for(var o="",r=0;r<n;r++)o+=String.fromCharCode(t[e+r]);return o},writeASCII:function(t,e,n){for(var o=0;o<n.length;o++)t[e+o]=n.charCodeAt(o)},readBytes:function(t,e,n){for(var o=[],r=0;r<n;r++)o.push(t[e+r]);return o},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(e,n,o){for(var r,i="",a=0;a<o;a++)i+="%"+t._bin.pad(e[n+a].toString(16));try{r=decodeURIComponent(i)}catch(r){return t._bin.readASCII(e,n,o)}return r}},t._copyTile=function(t,e,n,o,r,i,a,l,s){for(var f=Math.min(e,r),u=Math.min(n,i),c=0,h=0,d=0;d<u;d++)for(var p=0;p<f;p++)if(a>=0&&l>=0?(c=d*e+p<<2,h=(l+d)*r+a+p<<2):(c=(-l+d)*e-a+p<<2,h=d*r+p<<2),0==s)o[h]=t[c],o[h+1]=t[c+1],o[h+2]=t[c+2],o[h+3]=t[c+3];else if(1==s){var g=t[c+3]*(1/255),m=t[c]*g,b=t[c+1]*g,x=t[c+2]*g,v=o[h+3]*(1/255),y=o[h]*v,w=o[h+1]*v,_=o[h+2]*v,C=1-g,A=g+v*C,T=0==A?0:1/A;o[h+3]=255*A,o[h+0]=(m+y*C)*T,o[h+1]=(b+w*C)*T,o[h+2]=(x+_*C)*T}else if(2==s){g=t[c+3],m=t[c],b=t[c+1],x=t[c+2],v=o[h+3],y=o[h],w=o[h+1],_=o[h+2];g==v&&m==y&&b==w&&x==_?(o[h]=0,o[h+1]=0,o[h+2]=0,o[h+3]=0):(o[h]=m,o[h+1]=b,o[h+2]=x,o[h+3]=g)}else if(3==s){g=t[c+3],m=t[c],b=t[c+1],x=t[c+2],v=o[h+3],y=o[h],w=o[h+1],_=o[h+2];if(g==v&&m==y&&b==w&&x==_)continue;if(g<220&&v>20)return!1}return!0},t.encode=function(e,n,o,r,i,a){null==r&&(r=0),null==a&&(a=!1);for(var l=new Uint8Array(e[0].byteLength*e.length+100),s=[137,80,78,71,13,10,26,10],f=0;f<8;f++)l[f]=s[f];var u=8,c=t._bin,h=t.crc.crc,d=c.writeUint,p=c.writeUshort,g=c.writeASCII,m=t.encode.compressPNG(e,n,o,r,a);d(l,u,13),g(l,u+=4,"IHDR"),d(l,u+=4,n),d(l,u+=4,o),l[u+=4]=m.depth,l[++u]=m.ctype,l[++u]=0,l[++u]=0,l[++u]=0,d(l,++u,h(l,u-17,17)),d(l,u+=4,1),g(l,u+=4,"sRGB"),l[u+=4]=1,d(l,++u,h(l,u-5,5)),u+=4;var b=e.length>1;if(b&&(d(l,u,8),g(l,u+=4,"acTL"),d(l,u+=4,e.length),d(l,u+=4,0),d(l,u+=4,h(l,u-12,12)),u+=4),3==m.ctype){d(l,u,3*(L=m.plte.length)),g(l,u+=4,"PLTE"),u+=4;for(f=0;f<L;f++){var x=3*f,v=m.plte[f],y=255&v,w=v>>8&255,_=v>>16&255;l[u+x+0]=y,l[u+x+1]=w,l[u+x+2]=_}if(d(l,u+=3*L,h(l,u-3*L-4,3*L+4)),u+=4,m.gotAlpha){d(l,u,L),g(l,u+=4,"tRNS"),u+=4;for(f=0;f<L;f++)l[u+f]=m.plte[f]>>24&255;d(l,u+=L,h(l,u-L-4,L+4)),u+=4}}for(var C=0,A=0;A<m.frames.length;A++){var T=m.frames[A];b&&(d(l,u,26),g(l,u+=4,"fcTL"),d(l,u+=4,C++),d(l,u+=4,T.rect.width),d(l,u+=4,T.rect.height),d(l,u+=4,T.rect.x),d(l,u+=4,T.rect.y),p(l,u+=4,i[A]),p(l,u+=2,1e3),l[u+=2]=T.dispose,l[++u]=T.blend,d(l,++u,h(l,u-30,30)),u+=4);var L,E=T.cimg;d(l,u,(L=E.length)+(0==A?0:4));var B=u+=4;g(l,u,0==A?"IDAT":"fdAT"),u+=4,0!=A&&(d(l,u,C++),u+=4);for(f=0;f<L;f++)l[u+f]=E[f];d(l,u+=L,h(l,B,u-B)),u+=4}return d(l,u,0),g(l,u+=4,"IEND"),d(l,u+=4,h(l,u-4,4)),u+=4,l.buffer.slice(0,u)},t.encode.compressPNG=function(e,n,o,r,i){for(var a=t.encode.compress(e,n,o,r,!1,i),l=0;l<e.length;l++){var s=a.frames[l],f=(s.rect.width,s.rect.height),u=s.bpl,c=s.bpp,h=new Uint8Array(f*u+f);s.cimg=t.encode._filterZero(s.img,f,c,u,h)}return a},t.encode.compress=function(e,n,o,r,i,a){null==a&&(a=!1);for(var l=6,s=8,f=4,u=255,c=0;c<e.length;c++)for(var h=new Uint8Array(e[c]),d=h.length,p=0;p<d;p+=4)u&=h[p+3];var g=255!=u,m={},b=[];if(0!=e.length&&(m[0]=0,b.push(0),0!=r&&r--),0!=r){var x=t.quantize(e,r,i);e=x.bufs;for(p=0;p<x.plte.length;p++){null==m[y=x.plte[p].est.rgba]&&(m[y]=b.length,b.push(y))}}else for(c=0;c<e.length;c++){var v=new Uint32Array(e[c]);for(d=v.length,p=0;p<d;p++){var y=v[p];if((p<n||y!=v[p-1]&&y!=v[p-n])&&null==m[y]&&(m[y]=b.length,b.push(y),b.length>=300))break}}var w=!!g&&i,_=b.length;_<=256&&0==a&&(s=_<=2?1:_<=4?2:_<=16?4:8,i&&(s=8),g=!0);var C=[];for(c=0;c<e.length;c++){var A=new Uint8Array(e[c]),T=new Uint32Array(A.buffer),L=0,E=0,B=n,D=o,F=0;if(0!=c&&!w){for(var I=i||1==c||2==C[C.length-2].dispose?1:2,S=0,R=1e9,O=0;O<I;O++){for(var k=new Uint8Array(e[c-1-O]),N=new Uint32Array(e[c-1-O]),M=n,H=o,z=-1,P=-1,V=0;V<o;V++)for(var j=0;j<n;j++){T[p=V*n+j]!=N[p]&&(j<M&&(M=j),j>z&&(z=j),V<H&&(H=V),V>P&&(P=V))}var U=-1==z?1:(z-M+1)*(P-H+1);U<R&&(R=U,S=O,-1==z?(L=E=0,B=D=1):(L=M,E=H,B=z-M+1,D=P-H+1))}k=new Uint8Array(e[c-1-S]);1==S&&(C[C.length-1].dispose=2);var G=new Uint8Array(B*D*4);new Uint32Array(G.buffer);t._copyTile(k,n,o,G,B,D,-L,-E,0),t._copyTile(A,n,o,G,B,D,-L,-E,3)?(t._copyTile(A,n,o,G,B,D,-L,-E,2),F=1):(t._copyTile(A,n,o,G,B,D,-L,-E,0),F=0),A=G,T=new Uint32Array(A.buffer)}var W=4*B;if(_<=256&&0==a){W=Math.ceil(s*B/8);for(G=new Uint8Array(W*D),V=0;V<D;V++){p=V*W;var q=V*B;if(8==s)for(j=0;j<B;j++)G[p+j]=m[T[q+j]];else if(4==s)for(j=0;j<B;j++)G[p+(j>>1)]|=m[T[q+j]]<<4-4*(1&j);else if(2==s)for(j=0;j<B;j++)G[p+(j>>2)]|=m[T[q+j]]<<6-2*(3&j);else if(1==s)for(j=0;j<B;j++)G[p+(j>>3)]|=m[T[q+j]]<<7-1*(7&j)}A=G,l=3,f=1}else if(0==g&&1==e.length){G=new Uint8Array(B*D*3);var X=B*D;for(p=0;p<X;p++){var Z=3*p,Y=4*p;G[Z]=A[Y],G[Z+1]=A[Y+1],G[Z+2]=A[Y+2]}A=G,l=2,f=3,W=3*B}C.push({rect:{x:L,y:E,width:B,height:D},img:A,bpl:W,bpp:f,blend:F,dispose:w?1:0})}return{ctype:l,depth:s,plte:b,gotAlpha:g,frames:C}},t.encode._filterZero=function(n,o,r,i,a){for(var l=[],s=0;s<5;s++)if(!(o*i>5e5)||2!=s&&3!=s&&4!=s){for(var f=0;f<o;f++)t.encode._filterLine(a,n,f,i,r,s);if(l.push(e.deflate(a)),1==r)break}for(var u,c=1e9,h=0;h<l.length;h++)l[h].length<c&&(u=h,c=l[h].length);return l[u]},t.encode._filterLine=function(e,n,o,r,i,a){var l=o*r,s=l+o,f=t.decode._paeth;if(e[s]=a,s++,0==a)for(var u=0;u<r;u++)e[s+u]=n[l+u];else if(1==a){for(u=0;u<i;u++)e[s+u]=n[l+u];for(u=i;u<r;u++)e[s+u]=n[l+u]-n[l+u-i]+256&255}else if(0==o){for(u=0;u<i;u++)e[s+u]=n[l+u];if(2==a)for(u=i;u<r;u++)e[s+u]=n[l+u];if(3==a)for(u=i;u<r;u++)e[s+u]=n[l+u]-(n[l+u-i]>>1)+256&255;if(4==a)for(u=i;u<r;u++)e[s+u]=n[l+u]-f(n[l+u-i],0,0)+256&255}else{if(2==a)for(u=0;u<r;u++)e[s+u]=n[l+u]+256-n[l+u-r]&255;if(3==a){for(u=0;u<i;u++)e[s+u]=n[l+u]+256-(n[l+u-r]>>1)&255;for(u=i;u<r;u++)e[s+u]=n[l+u]+256-(n[l+u-r]+n[l+u-i]>>1)&255}if(4==a){for(u=0;u<i;u++)e[s+u]=n[l+u]+256-f(0,n[l+u-r],0)&255;for(u=i;u<r;u++)e[s+u]=n[l+u]+256-f(n[l+u-i],n[l+u-r],n[l+u-i-r])&255}}},t.crc={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var n=e,o=0;o<8;o++)1&n?n=3988292384^n>>>1:n>>>=1;t[e]=n}return t}(),update:function(e,n,o,r){for(var i=0;i<r;i++)e=t.crc.table[255&(e^n[o+i])]^e>>>8;return e},crc:function(e,n,o){return 4294967295^t.crc.update(4294967295,e,n,o)}},t.quantize=function(e,n,o){for(var r=[],i=0,a=0;a<e.length;a++)r.push(t.encode.alphaMul(new Uint8Array(e[a]),o)),i+=e[a].byteLength;var l=new Uint8Array(i),s=new Uint32Array(l.buffer),f=0;for(a=0;a<r.length;a++){for(var u=r[a],c=u.length,h=0;h<c;h++)l[f+h]=u[h];f+=c}var d={i0:0,i1:l.length,bst:null,est:null,tdst:0,left:null,right:null};d.bst=t.quantize.stats(l,d.i0,d.i1),d.est=t.quantize.estats(d.bst);for(var p=[d];p.length<n;){var g=0,m=0;for(a=0;a<p.length;a++)p[a].est.L>g&&(g=p[a].est.L,m=a);if(g<.001)break;var b=p[m],x=t.quantize.splitPixels(l,s,b.i0,b.i1,b.est.e,b.est.eMq255),v={i0:b.i0,i1:x,bst:null,est:null,tdst:0,left:null,right:null};v.bst=t.quantize.stats(l,v.i0,v.i1),v.est=t.quantize.estats(v.bst);var y={i0:x,i1:b.i1,bst:null,est:null,tdst:0,left:null,right:null};y.bst={R:[],m:[],N:b.bst.N-v.bst.N};for(a=0;a<16;a++)y.bst.R[a]=b.bst.R[a]-v.bst.R[a];for(a=0;a<4;a++)y.bst.m[a]=b.bst.m[a]-v.bst.m[a];y.est=t.quantize.estats(y.bst),b.left=v,b.right=y,p[m]=v,p.push(y)}p.sort((function(t,e){return e.bst.N-t.bst.N}));for(var w=0;w<r.length;w++){var _=t.quantize.planeDst,C=new Uint8Array(r[w].buffer),A=new Uint32Array(r[w].buffer),T=C.length;for(a=0;a<T;a+=4){for(var L=C[a]*(1/255),E=C[a+1]*(1/255),B=C[a+2]*(1/255),D=C[a+3]*(1/255),F=d;F.left;)F=_(F.est,L,E,B,D)<=0?F.left:F.right;A[a>>2]=F.est.rgba}r[w]=A.buffer}return{bufs:r,plte:p}},t.quantize.getNearest=function(e,n,o,r,i){if(null==e.left)return e.tdst=t.quantize.dist(e.est.q,n,o,r,i),e;var a=t.quantize.planeDst(e.est,n,o,r,i),l=e.left,s=e.right;a>0&&(l=e.right,s=e.left);var f=t.quantize.getNearest(l,n,o,r,i);if(f.tdst<=a*a)return f;var u=t.quantize.getNearest(s,n,o,r,i);return u.tdst<f.tdst?u:f},t.quantize.planeDst=function(t,e,n,o,r){var i=t.e;return i[0]*e+i[1]*n+i[2]*o+i[3]*r-t.eMq},t.quantize.dist=function(t,e,n,o,r){var i=e-t[0],a=n-t[1],l=o-t[2],s=r-t[3];return i*i+a*a+l*l+s*s},t.quantize.splitPixels=function(e,n,o,r,i,a){var l=t.quantize.vecDot;for(r-=4;o<r;){for(;l(e,o,i)<=a;)o+=4;for(;l(e,r,i)>a;)r-=4;if(o>=r)break;var s=n[o>>2];n[o>>2]=n[r>>2],n[r>>2]=s,o+=4,r-=4}for(;l(e,o,i)>a;)o-=4;return o+4},t.quantize.vecDot=function(t,e,n){return t[e]*n[0]+t[e+1]*n[1]+t[e+2]*n[2]+t[e+3]*n[3]},t.quantize.stats=function(t,e,n){for(var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0],i=n-e>>2,a=e;a<n;a+=4){var l=t[a]*(1/255),s=t[a+1]*(1/255),f=t[a+2]*(1/255),u=t[a+3]*(1/255);r[0]+=l,r[1]+=s,r[2]+=f,r[3]+=u,o[0]+=l*l,o[1]+=l*s,o[2]+=l*f,o[3]+=l*u,o[5]+=s*s,o[6]+=s*f,o[7]+=s*u,o[10]+=f*f,o[11]+=f*u,o[15]+=u*u}return o[4]=o[1],o[8]=o[2],o[12]=o[3],o[9]=o[6],o[13]=o[7],o[14]=o[11],{R:o,m:r,N:i}},t.quantize.estats=function(e){var n=e.R,o=e.m,r=e.N,i=o[0],a=o[1],l=o[2],s=o[3],f=0==r?0:1/r,u=[n[0]-i*i*f,n[1]-i*a*f,n[2]-i*l*f,n[3]-i*s*f,n[4]-a*i*f,n[5]-a*a*f,n[6]-a*l*f,n[7]-a*s*f,n[8]-l*i*f,n[9]-l*a*f,n[10]-l*l*f,n[11]-l*s*f,n[12]-s*i*f,n[13]-s*a*f,n[14]-s*l*f,n[15]-s*s*f],c=u,h=t.M4,d=[.5,.5,.5,.5],p=0,g=0;if(0!=r)for(var m=0;m<10&&(d=h.multVec(c,d),g=Math.sqrt(h.dot(d,d)),d=h.sml(1/g,d),!(Math.abs(g-p)<1e-9));m++)p=g;var b=[i*f,a*f,l*f,s*f],x=h.dot(h.sml(255,b),d),v=b[3]<.001?0:1/b[3];return{Cov:u,q:b,e:d,L:p,eMq255:x,eMq:h.dot(d,b),rgba:(Math.round(255*b[3])<<24|Math.round(255*b[2]*v)<<16|Math.round(255*b[1]*v)<<8|Math.round(255*b[0]*v)<<0)>>>0}},t.M4={multVec:function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},sml:function(t,e){return[t*e[0],t*e[1],t*e[2],t*e[3]]}},t.encode.alphaMul=function(t,e){for(var n=new Uint8Array(t.length),o=t.length>>2,r=0;r<o;r++){var i=r<<2,a=t[i+3];e&&(a=a<128?0:255);var l=a*(1/255);n[i+0]=t[i+0]*l,n[i+1]=t[i+1]*l,n[i+2]=t[i+2]*l,n[i+3]=a}return n}}(e,Or)}()}));function Nr(){var t=new Uint8Array([170,187]);return 48042===new Uint16Array(t.buffer)[0]}function Mr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];return new Array(n).fill(void 0).map((function(t,e){return e}))}var o=t[0],r=(n=t[1],t[2]),i=void 0===r?1:r;if(0===i)throw new Error("Argument step must be nonzero.");for(var a=[],l=o;i>0?l<n:l>n;l+=i)a.push(l);return a}function Hr(t){var e=t[0],n=e.x,o=e.y,r=t[1],i=r.x,a=r.y;return[[n,o],[i,o],[n,a],[i,a]]}function zr(t){return new Promise((function(e){return setTimeout(e,t)}))}function Pr(t,e){var n=t.z-e.z,o=t.x-e.x,r=t.y-e.y;return 0!==n?n:0!==o?o:r}var Vr=$t((function(t,e){void 0===e&&(e=256);var n=new Float32Array(e*e);return n.fill(t),new Uint8Array(n.buffer)}));function jr(t,e){return Object.keys(e).map((function(t){return"#define "+t+" "+e[t]+"\n"})).join("")+"\n"+t}var Ur=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/,Gr=/(?:#)[0-9a-f]{8}|(?:#)[0-9a-f]{6}|(?:#)[0-9a-f]{4}|(?:#)[0-9a-f]{3}/gi;function Wr(t){if("transparent"===t)return[0,0,0,0];var e=t.match(Ur),n=t.match(Gr);if(null!==e)return[+e[1],+e[2],+e[3],255];if(null!==n)return function(t){var e=9===t.length,n=e?24:16,o=parseInt(t.slice(1),16);return[o>>n&255,o>>n-8&255,o>>n-16&255,e?o>>n-24&255:255]}(t);throw new Error("'"+t+"' is not a valid RGB or hex color expression.")}function qr(t,e){var n=function(t){for(var e=[],n=[],o=0;o<t.length;o++){e.push(t[o].offset);var r=Wr(t[o].color);n=n.concat(r)}var i=new Float32Array(e),a=new Uint8Array(i.buffer),l=Array.from(a);return n.concat(l)}(t);return 0===t.length?e.texture({shape:[2,2]}):e.texture({width:t.length,height:2,data:n})}var Xr=Nr();var Zr=.017453292519943295,Yr=.0333334;function $r(t,e,o){return t(n(n({},e),{vert:Tn,frag:jr(Fn,o),uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),texture:function(t,e){return e.texture},enableSimpleHillshade:function(t,e){return e.enableSimpleHillshade},offset:0,azimuth:0,altitude:0,slopescale:0,deg2rad:Zr,slopeFactor:Yr,tileSize:0,textureSize:0,textureBounds:[0,0,0,0]}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Hr(e.textureBounds)}})}))}function Kr(t,e,o){return t(n(n({},e),{vert:Tn,frag:jr(Fn,o),uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),texture:function(t,e){return e.texture},enableSimpleHillshade:function(t,e){return e.enableSimpleHillshade},azimuth:function(t,e){return e.azimuth},altitude:function(t,e){return e.altitude},slopescale:function(t,e){return e.slopescale},deg2rad:Zr,slopeFactor:Yr,offset:function(t,e){return e.offset},textureBounds:function(t,e){var n=e.textureBounds;return[[n[0].x],[n[0].y],[n[1].x],[n[1].y]]},textureSize:function(t,e){return e.textureSize},tileSize:function(t,e){return e.tileSize}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Hr(e.textureBounds)}})}))}function Qr(t,e,o){return t(n(n({},e),{vert:An,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D texture;\nuniform bool littleEndian;\nuniform sampler2D hillshadePregenTexture;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgba = texture2D(texture, vTexCoordA);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  vec4 clr = computeColor(\n    texelFloat,\n    scaleColormap,\n    sentinelColormap,\n    scaleLength,\n    sentinelLength,\n    littleEndian\n  );\n\n  // Hillshade\n  float l = texture2D(hillshadePregenTexture, vTexCoordB).r;\n  clr.rgb = l * pow(clr.rgb, vec3(2.0));\n  clr.rgb = pow(clr.rgb, vec3(1.0/2.2));\n\n  gl_FragColor = clr;\n}\n",o),uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),texture:function(t,e){return e.texture},hillshadePregenTexture:function(t,e){return e.hillshadePregenTexture}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBounds)},texCoordB:function(t,e){return Hr(e.textureBoundsHs)}})}))}function Jr(t,e,o){return t(n(n({},e),{vert:Tn,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float multiplierA;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoord);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n\n  if (aIsNodata || texelFloatA < filterLowA || texelFloatA > filterHighA) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA;\n    gl_FragColor = computeColor(\n      texelFloatFinal,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",o),depth:{enable:!1},uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},multiplierA:function(t,e){return e.multiplierA},textureA:function(t,e){return e.textureA}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Hr(e.textureBoundsA)}})}))}function ti(t,e){return t(n(n({},e),{vert:Tn,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float multiplierA;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoord);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n\n  if (aIsNodata || texelFloatA < filterLowA || texelFloatA > filterHighA) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},multiplierA:function(t,e){return e.multiplierA},textureA:function(t,e){return e.textureA}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Hr(e.textureBoundsA)}})}))}function ei(t,e,o){return t(n(n({},e),{vert:An,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float multiplierA;\nuniform float multiplierB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB;\n    gl_FragColor = computeColor(\n      texelFloatFinal,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",o),depth:{enable:!1},uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)}})}))}function ni(t,e){return t(n(n({},e),{vert:An,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float multiplierA;\nuniform float multiplierB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)}})}))}function oi(t,e,o){return t(n(n({},e),{vert:Ln,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC;\n    gl_FragColor = computeColor(\n      texelFloatFinal,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",o),depth:{enable:!1},uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)}})}))}function ri(t,e){return t(n(n({},e),{vert:Ln,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)}})}))}function ii(t,e,o){return t(n(n({},e),{vert:En,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD;\n    gl_FragColor = computeColor(\n      texelFloatFinal,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",o),depth:{enable:!1},uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)},texCoordD:function(t,e){return Hr(e.textureBoundsD)}})}))}function ai(t,e){return t(n(n({},e),{vert:En,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)},texCoordD:function(t,e){return Hr(e.textureBoundsD)}})}))}function li(t,e,o){return t(n(n({},e),{vert:Bn,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE;\n    gl_FragColor = computeColor(\n      texelFloatFinal,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",o),depth:{enable:!1},uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)},texCoordD:function(t,e){return Hr(e.textureBoundsD)},texCoordE:function(t,e){return Hr(e.textureBoundsE)}})}))}function si(t,e){return t(n(n({},e),{vert:Bn,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)},texCoordD:function(t,e){return Hr(e.textureBoundsD)},texCoordE:function(t,e){return Hr(e.textureBoundsE)}})}))}function fi(t,e,o){return t(n(n({},e),{vert:Dn,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\nuniform sampler2D textureF;\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float filterLowF;\nuniform float filterHighF;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\nuniform float multiplierF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n  vec4 texelRgbaF = texture2D(textureF, vTexCoordF);\n  float texelFloatF = rgbaToFloat(texelRgbaF, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n  bool fIsNodata = isCloseEnough(texelFloatF, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata || fIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE ||\n      texelFloatF < filterLowF || texelFloatF > filterHighF\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE + texelFloatF * multiplierF;\n    gl_FragColor = computeColor(\n      texelFloatFinal,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",o),depth:{enable:!1},uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},filterLowF:function(t,e){return e.filterLowF},filterHighF:function(t,e){return e.filterHighF},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},multiplierF:function(t,e){return e.multiplierF},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE},textureF:function(t,e){return e.textureF}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)},texCoordD:function(t,e){return Hr(e.textureBoundsD)},texCoordE:function(t,e){return Hr(e.textureBoundsE)},texCoordF:function(t,e){return Hr(e.textureBoundsF)}})}))}function ui(t,e){return t(n(n({},e),{vert:Dn,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\nuniform sampler2D textureF;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float filterLowF;\nuniform float filterHighF;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\nuniform float multiplierF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n  vec4 texelRgbaF = texture2D(textureF, vTexCoordF);\n  float texelFloatF = rgbaToFloat(texelRgbaF, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n  bool fIsNodata = isCloseEnough(texelFloatF, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata || fIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE ||\n      texelFloatF < filterLowF || texelFloatF > filterHighF\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE + texelFloatF * multiplierF;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},filterLowF:function(t,e){return e.filterLowF},filterHighF:function(t,e){return e.filterHighF},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},multiplierF:function(t,e){return e.multiplierF},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE},textureF:function(t,e){return e.textureF}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)},texCoordC:function(t,e){return Hr(e.textureBoundsC)},texCoordD:function(t,e){return Hr(e.textureBoundsD)},texCoordE:function(t,e){return Hr(e.textureBoundsE)},texCoordF:function(t,e){return Hr(e.textureBoundsF)}})}))}function ci(t,e){return t(n(n({},e),{vert:An,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  // vec4 texelRgbaA = texture2D(textureA, vec2(vTexCoordA.x, 1.0 - vTexCoordA.y));\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  // vec4 texelRgbaB = texture2D(textureB, vec2(vTexCoordB.x, 1.0 - vTexCoordB.y));\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float diff = texelFloatB - texelFloatA;\n    gl_FragColor = floatToRgba(diff, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)}})}))}function hi(t,e,o){return t(n(n({},e),{vert:An,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform bool littleEndian;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata) {\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float diff = texelFloatB - texelFloatA;\n    gl_FragColor = computeColor(\n      diff,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",o),depth:{enable:!1},uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),textureA:t.prop("textureA"),textureB:t.prop("textureB")}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)}})}))}function di(t,e,o){return t(n(n({},e),{vert:An,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nbool isSentinelValue(sampler2D sentinelColormap, int len, float value) {\n  for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n    if (i == len) {\n      break;\n    }\n    float i_f = float(i);\n    float lenFloat = float(len);\n    vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / lenFloat, 0.75));\n    float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n    if (isCloseEnough(sentinelOffset, value)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nvoid main() {\n  if (interpolationFraction <= 0.0) {\n    vec4 texelRgba = texture2D(textureA, vTexCoordA);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(\n      texelFloat,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  } else if (interpolationFraction >= 1.0) {\n    vec4 texelRgba = texture2D(textureB, vTexCoordB);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(\n      texelFloat,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  } else {\n    // retrieve and decode pixel value from both tiles\n    vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n    float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n    vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n    float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n    bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n    bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n    if (aIsNodata && bIsNodata) {\n      discard;\n    } else if (\n      aIsNodata\n      || bIsNodata\n      || scaleLength == 0\n      || isSentinelValue(sentinelColormap, sentinelLength, texelFloatA)\n      || isSentinelValue(sentinelColormap, sentinelLength, texelFloatB)\n    ) {\n      vec4 colorA = (\n        aIsNodata\n        ? TRANSPARENT\n        : computeColor(\n            texelFloatA,\n            scaleColormap,\n            sentinelColormap,\n            scaleLength,\n            sentinelLength,\n            littleEndian\n          )\n      );\n      vec4 colorB = (\n        bIsNodata\n        ? TRANSPARENT\n        : computeColor(\n            texelFloatB,\n            scaleColormap,\n            sentinelColormap,\n            scaleLength,\n            sentinelLength,\n            littleEndian\n          )\n      );\n      gl_FragColor = mix(colorA, colorB, interpolationFraction);\n    } else {\n      float interpolated = mix(texelFloatA, texelFloatB, interpolationFraction);\n      gl_FragColor = computeColor(\n        interpolated,\n        scaleColormap,\n        sentinelColormap,\n        scaleLength,\n        sentinelLength,\n        littleEndian\n      );\n    }\n  }\n}\n",o),uniforms:n(n({},e.uniforms),{scaleLength:t.prop("scaleLength"),sentinelLength:t.prop("sentinelLength"),scaleColormap:t.prop("scaleColormap"),sentinelColormap:t.prop("sentinelColormap"),textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},interpolationFraction:function(t,e){return e.interpolationFraction}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)}})}))}function pi(t,e,o){return t(n(n({},e),{vert:An,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nuniform int scaleLengthA;\nuniform int sentinelLengthA;\nuniform sampler2D scaleColormapA;\nuniform sampler2D sentinelColormapA;\n\nuniform int scaleLengthB;\nuniform int sentinelLengthB;\nuniform sampler2D scaleColormapB;\nuniform sampler2D sentinelColormapB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  if (interpolationFraction <= 0.0) {\n    vec4 texelRgba = texture2D(textureA, vTexCoordA);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian);\n  } else if (interpolationFraction >= 1.0) {\n    vec4 texelRgba = texture2D(textureB, vTexCoordB);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian);\n  } else {\n    vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n    float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n    vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n    float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n    vec4 colorA = (\n      isCloseEnough(texelFloatA, nodataValue)\n      ? TRANSPARENT\n      : computeColor(texelFloatA, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian)\n    );\n    vec4 colorB = (\n      isCloseEnough(texelFloatB, nodataValue)\n      ? TRANSPARENT\n      : computeColor(texelFloatB, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian)\n    );\n    gl_FragColor = mix(colorA, colorB, interpolationFraction);\n  }\n}",o),uniforms:n(n({},e.uniforms),{scaleLengthA:t.prop("scaleLengthA"),sentinelLengthA:t.prop("sentinelLengthA"),scaleColormapA:t.prop("scaleColormapA"),sentinelColormapA:t.prop("sentinelColormapA"),scaleLengthB:t.prop("scaleLengthB"),sentinelLengthB:t.prop("sentinelLengthB"),scaleColormapB:t.prop("scaleColormapB"),sentinelColormapB:t.prop("sentinelColormapB"),textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},interpolationFraction:function(t,e){return e.interpolationFraction}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Hr(e.textureBoundsA)},texCoordB:function(t,e){return Hr(e.textureBoundsB)}})}))}function gi(t,e,o){return t(n(n({},e),{vert:Tn,frag:jr("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// Make sure this is included in the shader where computeColor is used?\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\n// float getTexelValue(vec2 pos) {\n//   vec4 texelRgba = texture2D(texture, pos);\n//   float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n//   return texelFloat;\n// }\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // float sentinelOffset = sentinelOffsets[i];\n      vec4 offsetRgba = texture2D(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow));\n      float sentinelOffset = rgbaToFloat(offsetRgba, littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    vec4 scaleOffsetLowestRgba = texture2D(scaleColormap, vec2(0.0, offsetRow));\n    float scaleOffsetLowest = rgbaToFloat(scaleOffsetLowestRgba, littleEndian);\n    vec4 scaleOffsetHighestRgba = texture2D(scaleColormap, vec2(1.0, offsetRow));\n    float scaleOffsetHighest = rgbaToFloat(scaleOffsetHighestRgba, littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      // return colorScale[0].color;\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n        \n        vec4 scaleOffsetNextRgba = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow));\n        float scaleOffsetNext = rgbaToFloat(scaleOffsetNextRgba, littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          vec4 scaleOffsetRgba = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow));\n          float scaleOffset = rgbaToFloat(scaleOffsetRgba, littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        } \n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D texture;\n\nuniform int scaleLengthA;\nuniform int sentinelLengthA;\nuniform sampler2D scaleColormapA;\nuniform sampler2D sentinelColormapA;\n\nuniform int scaleLengthB;\nuniform int sentinelLengthB;\nuniform sampler2D scaleColormapB;\nuniform sampler2D sentinelColormapB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec4 texelRgba = texture2D(texture, vTexCoord);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  if (interpolationFraction <= 0.0) {\n    gl_FragColor = computeColor(texelFloat, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian);\n  } else if (interpolationFraction >= 1.0) {\n    gl_FragColor = computeColor(texelFloat, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian);\n  } else {\n    vec4 colorA = computeColor(texelFloat, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian);\n    vec4 colorB = computeColor(texelFloat, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian);\n    gl_FragColor = mix(colorA, colorB, interpolationFraction);\n  }\n}",o),uniforms:n(n({},e.uniforms),{scaleLengthA:t.prop("scaleLengthA"),sentinelLengthA:t.prop("sentinelLengthA"),scaleColormapA:t.prop("scaleColormapA"),sentinelColormapA:t.prop("sentinelColormapA"),scaleLengthB:t.prop("scaleLengthB"),sentinelLengthB:t.prop("sentinelLengthB"),scaleColormapB:t.prop("scaleColormapB"),sentinelColormapB:t.prop("sentinelColormapB"),texture:function(t,e){return e.texture},interpolationFraction:function(t,e){return e.interpolationFraction}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Hr(e.textureBounds)}})}))}function mi(t,e){return t({vert:"#define GLSLIFY 1\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = texCoord;\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n",frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#define GLSLIFY 1\n#endif\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D texture;\nuniform float textureSize;\nuniform bool littleEndian;\nuniform float nodataValue;\nvarying vec2 vTexCoord;\nuniform int kernelSize;\n\nint kernelEnd = int(kernelSize/2);\nint kernelStart = kernelEnd * -1;\n\nfloat getTexelValue(vec2 pos) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat runConvKernel(vec2 pos, vec2 onePixel) {\n  float convKernelWeight = 0.0;\n  float sum = 0.0;\n\n  for (int i = -20; i < 20; i ++) {\n    if (i < kernelStart) continue;\n    if (i > kernelEnd) break;\n    for (int j = -20; j < 20; j ++) {\n      if (j < kernelStart) continue;\n      if (j > kernelEnd) break;\n      float texelValue = getTexelValue(pos + onePixel * vec2(i, j));\n      if (!isCloseEnough(texelValue, nodataValue)) {\n        sum = sum + texelValue;\n        convKernelWeight = convKernelWeight + 1.0;\n      }\n    }\n  }\n  return (sum / convKernelWeight);\n}\n\nvoid main() {\n  float texelFloat = getTexelValue(vTexCoord);\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    vec2 onePixel = vec2(1.0, 1.0) / textureSize;\n    float texelFloatSmoothed = runConvKernel(vTexCoord, onePixel);\n    gl_FragColor = floatToRgba(texelFloatSmoothed, littleEndian);\n  }\n}\n",uniforms:n(n({},e.uniforms),{texture:t.prop("texture"),textureSize:t.prop("textureSize"),kernelSize:t.prop("kernelSize")}),attributes:{texCoord:[0,1,1,1,0,0,1,0],position:[-1,1,1,1,-1,-1,1,-1]},depth:{enable:!1},primitive:"triangle strip",count:4})}var bi=function(){function t(t,e,n,o){var r=Math.floor(n/e),i=r*e,a=r*r,l=t.texture({width:i,height:i,flipY:o,format:"rgba",type:"uint8"}),s=new Map,f=this.allTextureCoordinates(r,e);Object.assign(this,{tileSize:e,tilesAcross:r,pixelsAcross:i,tileCapacity:a,texture:l,contents:s,available:f})}return t.prototype.addTile=function(t,e){var n=this,o=n.available,r=n.contents,i=n.texture,a=n.tileSize,l=this.hashTileCoordinates(t);if(r.has(l)){var s=r.get(l);return r.delete(l),r.set(l,s),this.formatOutputTextureCoordinates(s)}if(function(t){if(null==t)return!0;if(at(t)&&(v(t)||"string"==typeof t||"function"==typeof t.splice||xt(t)||Lt(t)||pt(t)))return!t.length;var e=Oe(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(st(t))return!St(t).length;for(var n in t)if(dn.call(t,n))return!1;return!0}(o)){var f=r.keys().next().value;this.removeByHashKey(f)}var u=o.pop();r.set(l,u);var c=u.x,h=u.y;return i.subimage({data:e,width:a,height:a},c,h),this.formatOutputTextureCoordinates(u)},t.prototype.removeTile=function(t){this.removeByHashKey(this.hashTileCoordinates(t))},t.prototype.clearTiles=function(){for(var t=0,e=Array.from(this.contents.keys());t<e.length;t++){var n=e[t];this.removeByHashKey(n)}},t.prototype.destroy=function(){this.texture.destroy()},t.prototype.removeByHashKey=function(t){if(this.contents.has(t)){var e=this.contents.get(t);this.contents.delete(t),this.available.push(e)}},t.prototype.formatOutputTextureCoordinates=function(t){var e=t.x,n=t.y,o=this.pixelsAcross,r=this.tileSize;return[{x:e/o,y:n/o},{x:(e+r)/o,y:(n+r)/o}]},t.prototype.hashTileCoordinates=function(t){return t.x+":"+t.y+":"+t.z},t.prototype.allTextureCoordinates=function(t,e){return cn(Mr(t),(function(n){return Mr(t).map((function(t){return{x:n*e,y:t*e}}))}))},t}(),xi=function(){function e(e,n,o,r,i,a){var l=t.DomUtil.create("canvas"),s=Cn,f=wn({canvas:l,onDone:function(t,e){t?console.log(t):(e.limits.maxTextureSize>2048?s=2048:e.limits.maxTextureSize>4096?s=4096:e.limits.maxTextureSize>8192&&(s=8192),261===e.limits.maxFragmentUniforms&&console.warn("Software rendering detected and not supported with GLOperations plugin. If you have a GPU, check if drivers are installed ok?"))}}),u=function(t,e){return{uniforms:{nodataValue:e,littleEndian:Xr,transformMatrix:function(t){return[2/t.viewportWidth,0,0,0,0,-2/t.viewportHeight,0,0,0,0,1,0,-1,1,0,1]}},attributes:{position:function(e,n){var o=n.canvasCoordinates,r=o[0],i=o[1],a=[r+t,i+t],l=a[0],s=a[1];return[[r,i],[l,i],[r,s],[l,s]]}},depth:{enable:!1},primitive:"triangle strip",count:4,viewport:function(t,e){var n=e.canvasSize;return{width:n[0],height:n[1]}}}}(e,n),c={SCALE_MAX_LENGTH:i,SENTINEL_MAX_LENGTH:a};Object.assign(this,{canvas:l,regl:f,tileSize:e,maxTextureDimension:s,scaleInput:o,sentinelInput:r,scaleColormap:qr(o,f),sentinelColormap:qr(r,f),textureManager:new bi(f,e,s,!1),textureManagerA:new bi(f,e,s,!1),textureManagerB:new bi(f,e,s,!1),textureManagerC:new bi(f,e,s,!1),textureManagerD:new bi(f,e,s,!1),textureManagerE:new bi(f,e,s,!1),textureManagerF:new bi(f,e,s,!1),textureManagerHillshade:new bi(f,e,s,!1),drawTile:$r(f,u,c),drawTileHsSimple:Kr(f,u,c),drawTileHsPregen:Qr(f,u,c),drawTileInterpolateColor:pi(f,u,c),drawTileInterpolateColorOnly:gi(f,u,c),drawTileInterpolateValue:di(f,u,c),calcTileMultiAnalyze1:ti(f,u),drawTileMultiAnalyze1:Jr(f,u,c),calcTileMultiAnalyze2:ni(f,u),drawTileMultiAnalyze2:ei(f,u,c),calcTileMultiAnalyze3:ri(f,u),drawTileMultiAnalyze3:oi(f,u,c),calcTileMultiAnalyze4:ai(f,u),drawTileMultiAnalyze4:ii(f,u,c),calcTileMultiAnalyze5:si(f,u),drawTileMultiAnalyze5:li(f,u,c),calcTileMultiAnalyze6:ui(f,u),drawTileMultiAnalyze6:fi(f,u,c),drawTileDiff:hi(f,u,c),calcTileDiff:ci(f,u),convolutionSmooth:mi(f,u)})}return e.prototype.findMaxTextureDimension=function(){var t=this.regl,e=Cn;return t.limits.maxTextureSize>2048?e=2048:t.limits.maxTextureSize>4096?e=4096:t.limits.maxTextureSize>8192&&(e=8192),e},e.prototype.setMaxTextureDimension=function(t){var e=this,n=e.textureManager,o=e.tileSize,r=e.regl;n.destroy(),Object.assign(this,{maxTextureDimension:t,textureManager:new bi(r,o,t,!1)})},e.prototype.updateColorscale=function(t){this.scaleInputPrevious=this.scaleInput,this.scaleInput=t,this.scaleColormapPrevious=this.scaleColormap,this.scaleColormap=qr(t,this.regl)},e.prototype.updateSentinels=function(t){this.sentinelInputPrevious=this.sentinelInput,this.sentinelInput=t,this.sentinelColormapPrevious=this.sentinelColormap,this.sentinelColormap=qr(t,this.regl)},e.prototype.renderTile=function(t,e,n){var o=t.coords,r=t.pixelData;void 0===n&&(n=0);var i=this,a=i.regl,l=i.textureManager,s=i.tileSize;this.setCanvasSize(s,s);var f=l.addTile(o,r);a.clear({color:_n});var u=e.hsSimpleZoomdelta||0,c=Math.max(.5,Math.pow(2,n+u)/2048)/l.texture.width;return"none"===e.hillshadeType?this.drawTile({canvasSize:[s,s],canvasCoordinates:[0,0],textureBounds:f,texture:l.texture,scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,enableSimpleHillshade:!1}):"simple"===e.hillshadeType&&this.drawTileHsSimple({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[s,s],canvasCoordinates:[0,0],textureBounds:f,texture:l.texture,textureSize:l.texture.width,tileSize:s,offset:c,enableSimpleHillshade:!0,azimuth:e.hsSimpleAzimuth,altitude:e.hsSimpleAltitude,slopescale:e.hsSimpleSlopescale}),[0,0]},e.prototype.renderTileHsPregen=function(t,e,n){var o=this,r=o.regl,i=o.textureManager,a=o.textureManagerHillshade,l=o.tileSize;this.setCanvasSize(l,l);var s=i.addTile(t.coords,t.pixelData),f=a.addTile(e.coords,e.pixelData);return r.clear({color:_n}),this.drawTileHsPregen({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[l,l],canvasCoordinates:[0,0],textureBounds:s,textureBoundsHs:f,texture:i.texture,hillshadePregenTexture:a.texture}),[0,0]},e.prototype.flipReadPixelsUint=function(t,e,n){for(var o=e/2|0,r=4*t,i=new Uint8Array(4*t),a=0;a<o;++a){var l=a*r,s=(e-a-1)*r;i.set(n.subarray(l,l+r)),n.copyWithin(l,s,s+r),n.set(i,s)}return n},e.prototype.renderTileDiff=function(t,e){var n=this,o=this,r=o.regl,i=o.textureManagerA,a=o.textureManagerB,l=o.tileSize;this.setCanvasSize(l,l);var s=i.addTile(t.coords,t.pixelData),f=a.addTile(e.coords,e.pixelData),u=r.framebuffer({width:l,height:l,depth:!1,colorFormat:"rgba",colorType:"uint8"}),c=new Uint8Array(l*l*4);return u.use((function(){n.calcTileDiff({canvasSize:[l,l],canvasCoordinates:[0,0],textureA:i.texture,textureB:a.texture,textureBoundsA:s,textureBoundsB:f}),r.read({data:c})})),c=this.flipReadPixelsUint(l,l,c),this.drawTileDiff({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[l,l],canvasCoordinates:[0,0],textureA:i.texture,textureB:a.texture,textureBoundsA:s,textureBoundsB:f}),u.destroy(),[0,0,c]},e.prototype.renderConvolutionSmooth=function(t,e,n,o){var r=this,i=this.regl;this.setCanvasSize(e,n);var a=i.texture({data:t,width:e,height:n,flipY:!1}),l=i.framebuffer({width:e,height:n,depth:!1,colorFormat:"rgba",colorType:"uint8"}),s=new Uint8Array(e*n*4);return l.use((function(){r.convolutionSmooth({texture:a,textureSize:e,kernelSize:o}),i.read({data:s})})),s=new Float32Array(s.buffer),l.destroy(),s},e.prototype.renderTileMulti1=function(t,e,n,o){var r=this,i=this,a=i.regl,l=i.textureManagerA,s=i.tileSize;this.setCanvasSize(s,s);var f=l.addTile(t.coords,t.pixelData),u=a.framebuffer({width:s,height:s,depth:!1,colorFormat:"rgba",colorType:"uint8"}),c=new Uint8Array(s*s*4);return u.use((function(){r.calcTileMultiAnalyze1({canvasSize:[s,s],canvasCoordinates:[0,0],textureA:l.texture,textureBoundsA:f,filterLowA:e,filterHighA:n,multiplierA:o}),a.read({data:c})})),c=this.flipReadPixelsUint(s,s,c),this.drawTileMultiAnalyze1({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[s,s],canvasCoordinates:[0,0],textureA:l.texture,textureBoundsA:f,filterLowA:e,filterHighA:n,multiplierA:o}),u.destroy(),[0,0,c]},e.prototype.renderTileMulti2=function(t,e,n,o,r,i,a,l){var s=this,f=this,u=f.regl,c=f.textureManagerA,h=f.textureManagerB,d=f.tileSize;this.setCanvasSize(d,d);var p=c.addTile(t.coords,t.pixelData),g=h.addTile(e.coords,e.pixelData),m=u.framebuffer({width:d,height:d,depth:!1,colorFormat:"rgba",colorType:"uint8"}),b=new Uint8Array(d*d*4);return m.use((function(){s.calcTileMultiAnalyze2({canvasSize:[d,d],canvasCoordinates:[0,0],textureA:c.texture,textureB:h.texture,textureBoundsA:p,textureBoundsB:g,filterLowA:n,filterHighA:o,filterLowB:r,filterHighB:i,multiplierA:a,multiplierB:l}),u.read({data:b})})),b=this.flipReadPixelsUint(d,d,b),this.drawTileMultiAnalyze2({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[d,d],canvasCoordinates:[0,0],textureA:c.texture,textureB:h.texture,textureBoundsA:p,textureBoundsB:g,filterLowA:n,filterHighA:o,filterLowB:r,filterHighB:i,multiplierA:a,multiplierB:l}),m.destroy(),[0,0,b]},e.prototype.renderTileMulti3=function(t,e,n,o,r,i,a,l,s,f,u,c){var h=this,d=this,p=d.regl,g=d.textureManagerA,m=d.textureManagerB,b=d.textureManagerC,x=d.tileSize;this.setCanvasSize(x,x);var v=g.addTile(t.coords,t.pixelData),y=m.addTile(e.coords,e.pixelData),w=b.addTile(n.coords,n.pixelData),_=p.framebuffer({width:x,height:x,depth:!1,colorFormat:"rgba",colorType:"uint8"}),C=new Uint8Array(x*x*4);return _.use((function(){h.calcTileMultiAnalyze3({canvasSize:[x,x],canvasCoordinates:[0,0],textureA:g.texture,textureB:m.texture,textureC:b.texture,textureBoundsA:v,textureBoundsB:y,textureBoundsC:w,filterLowA:o,filterHighA:r,filterLowB:i,filterHighB:a,filterLowC:l,filterHighC:s,multiplierA:f,multiplierB:u,multiplierC:c}),p.read({data:C})})),C=this.flipReadPixelsUint(x,x,C),this.drawTileMultiAnalyze3({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[x,x],canvasCoordinates:[0,0],textureA:g.texture,textureB:m.texture,textureC:b.texture,textureBoundsA:v,textureBoundsB:y,textureBoundsC:w,filterLowA:o,filterHighA:r,filterLowB:i,filterHighB:a,filterLowC:l,filterHighC:s,multiplierA:f,multiplierB:u,multiplierC:c}),_.destroy(),[0,0,C]},e.prototype.renderTileMulti4=function(t,e,n,o,r,i,a,l,s,f,u,c,h,d,p,g){var m=this,b=this,x=b.regl,v=b.textureManagerA,y=b.textureManagerB,w=b.textureManagerC,_=b.textureManagerD,C=b.tileSize;this.setCanvasSize(C,C);var A=v.addTile(t.coords,t.pixelData),T=y.addTile(e.coords,e.pixelData),L=w.addTile(n.coords,n.pixelData),E=_.addTile(o.coords,o.pixelData),B=x.framebuffer({width:C,height:C,depth:!1,colorFormat:"rgba",colorType:"uint8"}),D=new Uint8Array(C*C*4);return B.use((function(){m.calcTileMultiAnalyze4({canvasSize:[C,C],canvasCoordinates:[0,0],textureA:v.texture,textureB:y.texture,textureC:w.texture,textureD:_.texture,textureBoundsA:A,textureBoundsB:T,textureBoundsC:L,textureBoundsD:E,filterLowA:r,filterHighA:i,filterLowB:a,filterHighB:l,filterLowC:s,filterHighC:f,filterLowD:u,filterHighD:c,multiplierA:h,multiplierB:d,multiplierC:p,multiplierD:g}),x.read({data:D})})),D=this.flipReadPixelsUint(C,C,D),this.drawTileMultiAnalyze4({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[C,C],canvasCoordinates:[0,0],textureA:v.texture,textureB:y.texture,textureC:w.texture,textureD:_.texture,textureBoundsA:A,textureBoundsB:T,textureBoundsC:L,textureBoundsD:E,filterLowA:r,filterHighA:i,filterLowB:a,filterHighB:l,filterLowC:s,filterHighC:f,filterLowD:u,filterHighD:c,multiplierA:h,multiplierB:d,multiplierC:p,multiplierD:g}),B.destroy(),[0,0,D]},e.prototype.renderTileMulti5=function(t,e,n,o,r,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v){var y=this,w=this,_=w.regl,C=w.textureManagerA,A=w.textureManagerB,T=w.textureManagerC,L=w.textureManagerD,E=w.textureManagerE,B=w.tileSize;this.setCanvasSize(B,B);var D=C.addTile(t.coords,t.pixelData),F=A.addTile(e.coords,e.pixelData),I=T.addTile(n.coords,n.pixelData),S=L.addTile(o.coords,o.pixelData),R=E.addTile(r.coords,r.pixelData),O=_.framebuffer({width:B,height:B,depth:!1,colorFormat:"rgba",colorType:"uint8"}),k=new Uint8Array(B*B*4);return O.use((function(){y.calcTileMultiAnalyze5({canvasSize:[B,B],canvasCoordinates:[0,0],textureA:C.texture,textureB:A.texture,textureC:T.texture,textureD:L.texture,textureE:E.texture,textureBoundsA:D,textureBoundsB:F,textureBoundsC:I,textureBoundsD:S,textureBoundsE:R,filterLowA:i,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:f,filterHighC:u,filterLowD:c,filterHighD:h,filterLowE:d,filterHighE:p,multiplierA:g,multiplierB:m,multiplierC:b,multiplierD:x,multiplierE:v}),_.read({data:k})})),k=this.flipReadPixelsUint(B,B,k),this.drawTileMultiAnalyze5({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[B,B],canvasCoordinates:[0,0],textureA:C.texture,textureB:A.texture,textureC:T.texture,textureD:L.texture,textureE:E.texture,textureBoundsA:D,textureBoundsB:F,textureBoundsC:I,textureBoundsD:S,textureBoundsE:R,filterLowA:i,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:f,filterHighC:u,filterLowD:c,filterHighD:h,filterLowE:d,filterHighE:p,multiplierA:g,multiplierB:m,multiplierC:b,multiplierD:x,multiplierE:v}),O.destroy(),[0,0,k]},e.prototype.renderTileMulti6=function(t,e,n,o,r,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y,w,_,C){var A=this,T=this,L=T.regl,E=T.textureManagerA,B=T.textureManagerB,D=T.textureManagerC,F=T.textureManagerD,I=T.textureManagerE,S=T.textureManagerF,R=T.tileSize;this.setCanvasSize(R,R);var O=E.addTile(t.coords,t.pixelData),k=B.addTile(e.coords,e.pixelData),N=D.addTile(n.coords,n.pixelData),M=F.addTile(o.coords,o.pixelData),H=I.addTile(r.coords,r.pixelData),z=I.addTile(i.coords,i.pixelData),P=L.framebuffer({width:R,height:R,depth:!1,colorFormat:"rgba",colorType:"uint8"}),V=new Uint8Array(R*R*4);return P.use((function(){A.calcTileMultiAnalyze6({canvasSize:[R,R],canvasCoordinates:[0,0],textureA:E.texture,textureB:B.texture,textureC:D.texture,textureD:F.texture,textureE:I.texture,textureF:S.texture,textureBoundsA:O,textureBoundsB:k,textureBoundsC:N,textureBoundsD:M,textureBoundsE:H,textureBoundsF:z,filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:f,filterLowC:u,filterHighC:c,filterLowD:h,filterHighD:d,filterLowE:p,filterHighE:g,filterLowF:m,filterHighF:b,multiplierA:x,multiplierB:v,multiplierC:y,multiplierD:w,multiplierE:_,multiplierF:C}),L.read({data:V})})),V=this.flipReadPixelsUint(R,R,V),this.drawTileMultiAnalyze6({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[R,R],canvasCoordinates:[0,0],textureA:E.texture,textureB:B.texture,textureC:D.texture,textureD:F.texture,textureE:I.texture,textureF:S.texture,textureBoundsA:O,textureBoundsB:k,textureBoundsC:N,textureBoundsD:M,textureBoundsE:H,textureBoundsF:z,filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:f,filterLowC:u,filterHighC:c,filterLowD:h,filterHighD:d,filterLowE:p,filterHighE:g,filterLowF:m,filterHighF:b,multiplierA:x,multiplierB:v,multiplierC:y,multiplierD:w,multiplierE:_,multiplierF:C}),P.destroy(),[0,0,V]},e.prototype.renderTiles=function(t,e,o){var r=this;void 0===o&&(o=0);var i=this,a=i.regl,l=i.textureManager,s=i.tileSize,f=this.computeRequiredCanvasDimensions(t.length),u=f[0],c=f[1];this.setCanvasSize(u,c);var h=this.getCanvasCoordinates(u,c,t.length),d=xn(t,h,(function(t,e){return n(n({},t),{canvasCoords:e})})),p=[u,c];l.clearTiles(),a.clear({color:_n});for(var g=ue(d,l.tileCapacity),m=e.hsSimpleZoomdelta||0,b=function(t){var n=t.map((function(t){var e=t.coords,n=t.pixelData;return l.addTile(e,n)})),i=Math.max(.5,Math.pow(2,o+m)/2048)/l.texture.width;"none"===e.hillshadeType?x.drawTile(t.map((function(t,e){var o=t.canvasCoords;return{canvasSize:p,canvasCoordinates:o,textureBounds:n[e],texture:l.texture,scaleLength:r.scaleInput.length,sentinelLength:r.sentinelInput.length,scaleColormap:r.scaleColormap,sentinelColormap:r.sentinelColormap,enableSimpleHillshade:!1}}))):"simple"===e.hillshadeType&&x.drawTileHsSimple(t.map((function(t,o){var a=t.canvasCoords;return{scaleLength:r.scaleInput.length,sentinelLength:r.sentinelInput.length,scaleColormap:r.scaleColormap,sentinelColormap:r.sentinelColormap,canvasSize:p,canvasCoordinates:a,textureBounds:n[o],textureSize:l.texture.width,texture:l.texture,tileSize:s,offset:i,enableSimpleHillshade:!0,azimuth:e.hsSimpleAzimuth,altitude:e.hsSimpleAltitude,slopescale:e.hsSimpleSlopescale}})))},x=this,v=0,y=g;v<y.length;v++){b(y[v])}return h},e.prototype.renderTilesHsPregen=function(t,e,n){var o=this,r=this,i=r.regl,a=r.textureManager,l=r.textureManagerHillshade,s=this.computeRequiredCanvasDimensions(t.length),f=s[0],u=s[1];this.setCanvasSize(f,u);var c=this.getCanvasCoordinates(f,u,t.length),h=xn(t,e,c,(function(t,e,n){return{coords:t.coords,tilesPixelData:t.pixelData,tilesHsPixelData:e.pixelData,canvasCoords:n}})),d=[f,u];a.clearTiles(),l.clearTiles(),i.clear({color:_n});for(var p=ue(h,a.tileCapacity),g=function(t){var e=t.map((function(t){var e=t.coords,n=t.tilesPixelData;return a.addTile(e,n)})),n=t.map((function(t){var e=t.coords,n=t.tilesHsPixelData;return l.addTile(e,n)}));m.drawTileHsPregen(t.map((function(t,r){var i=t.canvasCoords;return{scaleLength:o.scaleInput.length,sentinelLength:o.sentinelInput.length,scaleColormap:o.scaleColormap,sentinelColormap:o.sentinelColormap,canvasSize:d,canvasCoordinates:i,textureBounds:e[r],textureBoundsHs:n[r],texture:a.texture,hillshadePregenTexture:l.texture}})))},m=this,b=0,x=p;b<x.length;b++){g(x[b])}return c},e.prototype.renderTilesWithDiff=function(t,e,n){var o=this,r=this,i=r.regl,a=r.textureManagerA,l=r.textureManagerB,s=r.tileSize,f=this.computeRequiredCanvasDimensions(t.length),u=f[0],c=f[1];this.setCanvasSize(u,c);var h=this.getCanvasCoordinates(u,c,t.length),d=xn(t,e,h,(function(t,e,n){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,canvasCoords:n}})),p=[];return function(){var t=ue(d,a.tileCapacity);i.clear({color:_n});for(var e=0,r=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return a.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return l.addTile(e,n)}));t.forEach((function(t,u){var c=t.canvasCoords,h=i.framebuffer({width:s,height:s,depth:!1,colorFormat:"rgba",colorType:"uint8"}),d=new Uint8Array(s*s*4);h.use((function(){o.calcTileDiff({canvasSize:[s,s],canvasCoordinates:[0,0],textureA:a.texture,textureB:l.texture,textureBoundsA:n[u],textureBoundsB:r[u]}),i.read({data:d})})),d=o.flipReadPixelsUint(s,s,d),p[e]=d,e+=1,o.drawTileDiff({scaleLength:o.scaleInput.length,sentinelLength:o.sentinelInput.length,scaleColormap:o.scaleColormap,sentinelColormap:o.sentinelColormap,canvasSize:f,canvasCoordinates:c,textureA:a.texture,textureB:l.texture,textureBoundsA:n[u],textureBoundsB:r[u]}),h.destroy()}))},u=0,c=t;u<c.length;u++){r(c[u])}n(h)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerA=new bi(i,s,Cn,!1),this.textureManagerB=new bi(i,s,Cn,!1),p},e.prototype.renderTilesWithMultiAnalyze1=function(t,e,n,o,r){var i=this,a=this,l=a.regl,s=a.textureManagerA,f=a.tileSize,u=this.computeRequiredCanvasDimensions(t.length),c=u[0],h=u[1];this.setCanvasSize(c,h);var d=this.getCanvasCoordinates(c,h,t.length),p=xn(t,d,(function(t,e){return{coords:t.coords,tilesAPixelData:t.pixelData,canvasCoords:e}})),g=[];return function(){var t=ue(p,s.tileCapacity);l.clear({color:_n});for(var a=0,c=function(t){var r=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return s.addTile(e,n)}));t.forEach((function(t,c){var h=t.canvasCoords,d=l.framebuffer({width:f,height:f,depth:!1,colorFormat:"rgba",colorType:"uint8"}),p=new Uint8Array(f*f*4);d.use((function(){i.calcTileMultiAnalyze1({canvasSize:[f,f],canvasCoordinates:[0,0],textureA:s.texture,textureBoundsA:r[c],filterLowA:e,filterHighA:n,multiplierA:o}),l.read({data:p})})),p=i.flipReadPixelsUint(f,f,p),g[a]=p,a+=1,i.drawTileMultiAnalyze1({scaleLength:i.scaleInput.length,sentinelLength:i.sentinelInput.length,scaleColormap:i.scaleColormap,sentinelColormap:i.sentinelColormap,canvasSize:u,canvasCoordinates:h,textureA:s.texture,textureBoundsA:r[c],filterLowA:e,filterHighA:n,multiplierA:o}),d.destroy()}))},h=0,m=t;h<m.length;h++){c(m[h])}r(d)}(),this.textureManagerA.destroy(),this.textureManagerA=new bi(l,f,Cn,!1),g},e.prototype.renderTilesWithMultiAnalyze2=function(t,e,n,o,r,i,a,l,s){var f=this,u=this,c=u.regl,h=u.textureManagerA,d=u.textureManagerB,p=u.tileSize,g=this.computeRequiredCanvasDimensions(t.length),m=g[0],b=g[1];this.setCanvasSize(m,b);var x=this.getCanvasCoordinates(m,b,t.length),v=xn(t,e,x,(function(t,e,n){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,canvasCoords:n}})),y=[];return function(){var t=ue(v,h.tileCapacity);c.clear({color:_n});for(var e=0,u=function(t){var s=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return h.addTile(e,n)})),u=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return d.addTile(e,n)}));t.forEach((function(t,m){var b=t.canvasCoords,x=c.framebuffer({width:p,height:p,depth:!1,colorFormat:"rgba",colorType:"uint8"}),v=new Uint8Array(p*p*4);x.use((function(){f.calcTileMultiAnalyze2({canvasSize:[p,p],canvasCoordinates:[0,0],textureA:h.texture,textureB:d.texture,textureBoundsA:s[m],textureBoundsB:u[m],filterLowA:n,filterHighA:o,filterLowB:r,filterHighB:i,multiplierA:a,multiplierB:l}),c.read({data:v})})),v=f.flipReadPixelsUint(p,p,v),y[e]=v,e+=1,f.drawTileMultiAnalyze2({scaleLength:f.scaleInput.length,sentinelLength:f.sentinelInput.length,scaleColormap:f.scaleColormap,sentinelColormap:f.sentinelColormap,canvasSize:g,canvasCoordinates:b,textureA:h.texture,textureB:d.texture,textureBoundsA:s[m],textureBoundsB:u[m],filterLowA:n,filterHighA:o,filterLowB:r,filterHighB:i,multiplierA:a,multiplierB:l}),x.destroy()}))},m=0,b=t;m<b.length;m++){u(b[m])}s(x)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerA=new bi(c,p,Cn,!1),this.textureManagerB=new bi(c,p,Cn,!1),y},e.prototype.renderTilesWithMultiAnalyze3=function(t,e,n,o,r,i,a,l,s,f,u,c,h){var d=this,p=this,g=p.regl,m=p.textureManagerA,b=p.textureManagerB,x=p.textureManagerC,v=p.tileSize,y=this.computeRequiredCanvasDimensions(t.length),w=y[0],_=y[1];this.setCanvasSize(w,_);var C=this.getCanvasCoordinates(w,_,t.length),A=xn(t,e,n,C,(function(t,e,n,o){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,canvasCoords:o}})),T=[];return function(){var t=ue(A,m.tileCapacity);g.clear({color:_n});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return m.addTile(e,n)})),h=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return b.addTile(e,n)})),p=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return x.addTile(e,n)}));t.forEach((function(t,w){var _=t.canvasCoords,C=g.framebuffer({width:v,height:v,depth:!1,colorFormat:"rgba",colorType:"uint8"}),A=new Uint8Array(v*v*4);C.use((function(){d.calcTileMultiAnalyze3({canvasSize:[v,v],canvasCoordinates:[0,0],textureA:m.texture,textureB:b.texture,textureC:x.texture,textureBoundsA:n[w],textureBoundsB:h[w],textureBoundsC:p[w],filterLowA:o,filterHighA:r,filterLowB:i,filterHighB:a,filterLowC:l,filterHighC:s,multiplierA:f,multiplierB:u,multiplierC:c}),g.read({data:A})})),A=d.flipReadPixelsUint(v,v,A),T[e]=A,e+=1,d.drawTileMultiAnalyze3({scaleLength:d.scaleInput.length,sentinelLength:d.sentinelInput.length,scaleColormap:d.scaleColormap,sentinelColormap:d.sentinelColormap,canvasSize:y,canvasCoordinates:_,textureA:m.texture,textureB:b.texture,textureC:x.texture,textureBoundsA:n[w],textureBoundsB:h[w],textureBoundsC:p[w],filterLowA:o,filterHighA:r,filterLowB:i,filterHighB:a,filterLowC:l,filterHighC:s,multiplierA:f,multiplierB:u,multiplierC:c}),C.destroy()}))},p=0,w=t;p<w.length;p++){n(w[p])}h(C)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerA=new bi(g,v,Cn,!1),this.textureManagerB=new bi(g,v,Cn,!1),this.textureManagerC=new bi(g,v,Cn,!1),T},e.prototype.renderTilesWithMultiAnalyze4=function(t,e,n,o,r,i,a,l,s,f,u,c,h,d,p,g,m){var b=this,x=this,v=x.regl,y=x.textureManagerA,w=x.textureManagerB,_=x.textureManagerC,C=x.textureManagerD,A=x.tileSize,T=this.computeRequiredCanvasDimensions(t.length),L=T[0],E=T[1];this.setCanvasSize(L,E);var B=this.getCanvasCoordinates(L,E,t.length),D=xn(t,e,n,o,B,(function(t,e,n,o,r){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:o.pixelData,canvasCoords:r}})),F=[];return function(){var t=ue(D,y.tileCapacity);v.clear({color:_n});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return y.addTile(e,n)})),o=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return w.addTile(e,n)})),m=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return _.addTile(e,n)})),x=t.map((function(t){var e=t.coords,n=t.tilesDPixelData;return C.addTile(e,n)}));t.forEach((function(t,L){var E=t.canvasCoords,B=v.framebuffer({width:A,height:A,depth:!1,colorFormat:"rgba",colorType:"uint8"}),D=new Uint8Array(A*A*4);B.use((function(){b.calcTileMultiAnalyze4({canvasSize:[A,A],canvasCoordinates:[0,0],textureA:y.texture,textureB:w.texture,textureC:_.texture,textureD:C.texture,textureBoundsA:n[L],textureBoundsB:o[L],textureBoundsC:m[L],textureBoundsD:x[L],filterLowA:r,filterHighA:i,filterLowB:a,filterHighB:l,filterLowC:s,filterHighC:f,filterLowD:u,filterHighD:c,multiplierA:h,multiplierB:d,multiplierC:p,multiplierD:g}),v.read({data:D})})),D=b.flipReadPixelsUint(A,A,D),F[e]=D,e+=1,b.drawTileMultiAnalyze4({scaleLength:b.scaleInput.length,sentinelLength:b.sentinelInput.length,scaleColormap:b.scaleColormap,sentinelColormap:b.sentinelColormap,canvasSize:T,canvasCoordinates:E,textureA:y.texture,textureB:w.texture,textureC:_.texture,textureD:C.texture,textureBoundsA:n[L],textureBoundsB:o[L],textureBoundsC:m[L],textureBoundsD:x[L],filterLowA:r,filterHighA:i,filterLowB:a,filterHighB:l,filterLowC:s,filterHighC:f,filterLowD:u,filterHighD:c,multiplierA:h,multiplierB:d,multiplierC:p,multiplierD:g}),B.destroy()}))},o=0,x=t;o<x.length;o++){n(x[o])}m(B)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerA=new bi(v,A,Cn,!1),this.textureManagerB=new bi(v,A,Cn,!1),this.textureManagerC=new bi(v,A,Cn,!1),this.textureManagerD=new bi(v,A,Cn,!1),F},e.prototype.renderTilesWithMultiAnalyze5=function(t,e,n,o,r,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y){var w=this,_=this,C=_.regl,A=_.textureManagerA,T=_.textureManagerB,L=_.textureManagerC,E=_.textureManagerD,B=_.textureManagerE,D=_.tileSize,F=this.computeRequiredCanvasDimensions(t.length),I=F[0],S=F[1];this.setCanvasSize(I,S);var R=this.getCanvasCoordinates(I,S,t.length),O=xn(t,e,n,o,r,R,(function(t,e,n,o,r,i){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:o.pixelData,tilesEPixelData:r.pixelData,canvasCoords:i}})),k=[];return function(){var t=ue(O,A.tileCapacity);C.clear({color:_n});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return A.addTile(e,n)})),o=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return T.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return L.addTile(e,n)})),y=t.map((function(t){var e=t.coords,n=t.tilesDPixelData;return E.addTile(e,n)})),_=t.map((function(t){var e=t.coords,n=t.tilesEPixelData;return B.addTile(e,n)}));t.forEach((function(t,I){var S=t.canvasCoords,R=C.framebuffer({width:D,height:D,depth:!1,colorFormat:"rgba",colorType:"uint8"}),O=new Uint8Array(D*D*4);R.use((function(){w.calcTileMultiAnalyze5({canvasSize:[D,D],canvasCoordinates:[0,0],textureA:A.texture,textureB:T.texture,textureC:L.texture,textureD:E.texture,textureE:B.texture,textureBoundsA:n[I],textureBoundsB:o[I],textureBoundsC:r[I],textureBoundsD:y[I],textureBoundsE:_[I],filterLowA:i,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:f,filterHighC:u,filterLowD:c,filterHighD:h,filterLowE:d,filterHighE:p,multiplierA:g,multiplierB:m,multiplierC:b,multiplierD:x,multiplierE:v}),C.read({data:O})})),O=w.flipReadPixelsUint(D,D,O),k[e]=O,e+=1,w.drawTileMultiAnalyze5({scaleLength:w.scaleInput.length,sentinelLength:w.sentinelInput.length,scaleColormap:w.scaleColormap,sentinelColormap:w.sentinelColormap,canvasSize:F,canvasCoordinates:S,textureA:A.texture,textureB:T.texture,textureC:L.texture,textureD:E.texture,textureE:B.texture,textureBoundsA:n[I],textureBoundsB:o[I],textureBoundsC:r[I],textureBoundsD:y[I],textureBoundsE:_[I],filterLowA:i,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:f,filterHighC:u,filterLowD:c,filterHighD:h,filterLowE:d,filterHighE:p,multiplierA:g,multiplierB:m,multiplierC:b,multiplierD:x,multiplierE:v}),R.destroy()}))},o=0,r=t;o<r.length;o++){n(r[o])}y(R)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerE.destroy(),this.textureManagerA=new bi(C,D,Cn,!1),this.textureManagerB=new bi(C,D,Cn,!1),this.textureManagerC=new bi(C,D,Cn,!1),this.textureManagerD=new bi(C,D,Cn,!1),this.textureManagerE=new bi(C,D,Cn,!1),k},e.prototype.renderTilesWithMultiAnalyze6=function(t,e,n,o,r,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y,w,_,C,A){var T=this,L=this,E=L.regl,B=L.textureManagerA,D=L.textureManagerB,F=L.textureManagerC,I=L.textureManagerD,S=L.textureManagerE,R=L.textureManagerF,O=L.tileSize,k=this.computeRequiredCanvasDimensions(t.length),N=k[0],M=k[1];this.setCanvasSize(N,M);var H=this.getCanvasCoordinates(N,M,t.length),z=xn(t,e,n,o,r,i,H,(function(t,e,n,o,r,i,a){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:o.pixelData,tilesEPixelData:r.pixelData,tilesFPixelData:i.pixelData,canvasCoords:a}})),P=[];return function(){var t=ue(z,B.tileCapacity);E.clear({color:_n});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return B.addTile(e,n)})),o=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return D.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return F.addTile(e,n)})),i=t.map((function(t){var e=t.coords,n=t.tilesDPixelData;return I.addTile(e,n)})),A=t.map((function(t){var e=t.coords,n=t.tilesEPixelData;return S.addTile(e,n)})),L=t.map((function(t){var e=t.coords,n=t.tilesFPixelData;return R.addTile(e,n)}));t.forEach((function(t,N){var M=t.canvasCoords,H=E.framebuffer({width:O,height:O,depth:!1,colorFormat:"rgba",colorType:"uint8"}),z=new Uint8Array(O*O*4);H.use((function(){T.calcTileMultiAnalyze6({canvasSize:[O,O],canvasCoordinates:[0,0],textureA:B.texture,textureB:D.texture,textureC:F.texture,textureD:I.texture,textureE:S.texture,textureF:R.texture,textureBoundsA:n[N],textureBoundsB:o[N],textureBoundsC:r[N],textureBoundsD:i[N],textureBoundsE:A[N],textureBoundsF:L[N],filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:f,filterLowC:u,filterHighC:c,filterLowD:h,filterHighD:d,filterLowE:p,filterHighE:g,filterLowF:m,filterHighF:b,multiplierA:x,multiplierB:v,multiplierC:y,multiplierD:w,multiplierE:_,multiplierF:C}),E.read({data:z})})),z=T.flipReadPixelsUint(O,O,z),P[e]=z,e+=1,T.drawTileMultiAnalyze6({scaleLength:T.scaleInput.length,sentinelLength:T.sentinelInput.length,scaleColormap:T.scaleColormap,sentinelColormap:T.sentinelColormap,canvasSize:k,canvasCoordinates:M,textureA:B.texture,textureB:D.texture,textureC:F.texture,textureD:I.texture,textureE:S.texture,textureF:R.texture,textureBoundsA:n[N],textureBoundsB:o[N],textureBoundsC:r[N],textureBoundsD:i[N],textureBoundsE:A[N],textureBoundsF:L[N],filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:f,filterLowC:u,filterHighC:c,filterLowD:h,filterHighD:d,filterLowE:p,filterHighE:g,filterLowF:m,filterHighF:b,multiplierA:x,multiplierB:v,multiplierC:y,multiplierD:w,multiplierE:_,multiplierF:C}),H.destroy()}))},o=0,r=t;o<r.length;o++){n(r[o])}A(H)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerE.destroy(),this.textureManagerF.destroy(),this.textureManagerA=new bi(E,O,Cn,!1),this.textureManagerB=new bi(E,O,Cn,!1),this.textureManagerC=new bi(E,O,Cn,!1),this.textureManagerD=new bi(E,O,Cn,!1),this.textureManagerE=new bi(E,O,Cn,!1),this.textureManagerF=new bi(E,O,Cn,!1),P},e.prototype.renderTilesWithTransition=function(t,e,n,i){return o(this,void 0,void 0,(function(){var o,a,l,s,f,u,c,h,d,p,g,m,b,x,v=this;return r(this,(function(r){switch(r.label){case 0:return a=(o=this).regl,l=o.textureManager,s=o.tileSize,f=o.maxTextureDimension,u=this.computeRequiredCanvasDimensions(t.length),c=u[0],h=u[1],this.setCanvasSize(c,h),d=this.getCanvasCoordinates(c,h,t.length),p=xn(t,e,d,(function(t,e,n){return{coords:t.coords,oldPixelData:t.pixelData,newPixelData:e.pixelData,canvasCoords:n}})),g=new bi(a,s,f,!1),m=a.now(),b=function(t){var e=ue(p,l.tileCapacity);a.clear({color:_n});for(var n=function(e){var n=e.map((function(t){var e=t.coords,n=t.oldPixelData;return l.addTile(e,n)})),o=e.map((function(t){var e=t.coords,n=t.newPixelData;return g.addTile(e,n)}));v.drawTileInterpolateValue(e.map((function(e,r){var i=e.canvasCoords;return{scaleLength:v.scaleInput.length,sentinelLength:v.sentinelInput.length,scaleColormap:v.scaleColormap,sentinelColormap:v.sentinelColormap,canvasSize:u,canvasCoordinates:i,textureA:l.texture,textureB:g.texture,textureBoundsA:n[r],textureBoundsB:o[r],interpolationFraction:t}})))},o=0,r=e;o<r.length;o++){n(r[o])}i(d)},x=a.frame((function(t){var e=t.time;b(1e3*(e-m)/n)})),[4,zr(n)];case 1:return r.sent(),x.cancel(),b(1),this.textureManager.destroy(),this.textureManager=g,[2]}}))}))},e.prototype.renderTilesWithTransitionAndNewColorScale=function(t,e,n,i){return o(this,void 0,void 0,(function(){var o,a,l,s,f,u,c,h,d,p,g,m,b,x,v=this;return r(this,(function(r){switch(r.label){case 0:return a=(o=this).regl,l=o.textureManager,s=o.tileSize,f=o.maxTextureDimension,u=this.computeRequiredCanvasDimensions(t.length),c=u[0],h=u[1],this.setCanvasSize(c,h),d=this.getCanvasCoordinates(c,h,t.length),p=xn(t,e,d,(function(t,e,n){return{coords:t.coords,oldPixelData:t.pixelData,newPixelData:e.pixelData,canvasCoords:n}})),g=new bi(a,s,f,!1),m=a.now(),b=function(t){var e=ue(p,l.tileCapacity);a.clear({color:_n});for(var n=function(e){var n=e.map((function(t){var e=t.coords,n=t.oldPixelData;return l.addTile(e,n)})),o=e.map((function(t){var e=t.coords,n=t.newPixelData;return g.addTile(e,n)}));v.drawTileInterpolateColor(e.map((function(e,r){var i=e.canvasCoords;return{scaleLengthA:v.scaleInputPrevious.length,sentinelLengthA:v.sentinelInputPrevious.length,scaleColormapA:v.scaleColormapPrevious,sentinelColormapA:v.sentinelColormapPrevious,scaleLengthB:v.scaleInput.length,sentinelLengthB:v.sentinelInput.length,scaleColormapB:v.scaleColormap,sentinelColormapB:v.sentinelColormap,canvasSize:u,canvasCoordinates:i,textureA:l.texture,textureB:g.texture,textureBoundsA:n[r],textureBoundsB:o[r],interpolationFraction:t}})))},o=0,r=e;o<r.length;o++){n(r[o])}i(d)},x=a.frame((function(t){var e=t.time;b(1e3*(e-m)/n)})),[4,zr(n)];case 1:return r.sent(),x.cancel(),b(1),this.textureManager.destroy(),this.textureManager=g,[2]}}))}))},e.prototype.renderTilesWithTransitionAndNewColorScaleOnly=function(t,e,i){return o(this,void 0,void 0,(function(){var o,a,l,s,f,u,c,h,d,p,g,m,b,x,v=this;return r(this,(function(r){switch(r.label){case 0:return a=(o=this).regl,l=o.textureManager,s=o.tileSize,f=o.maxTextureDimension,u=this.computeRequiredCanvasDimensions(t.length),c=u[0],h=u[1],this.setCanvasSize(c,h),d=this.getCanvasCoordinates(c,h,t.length),p=xn(t,d,(function(t,e){return n(n({},t),{canvasCoords:e})})),g=new bi(a,s,f,!1),m=a.now(),b=function(t){var e=ue(p,l.tileCapacity);a.clear({color:_n});for(var n=function(e){var n=e.map((function(t){var e=t.coords,n=t.pixelData;return l.addTile(e,n)}));v.drawTileInterpolateColorOnly(e.map((function(e,o){var r=e.canvasCoords;return{scaleLengthA:v.scaleInputPrevious.length,sentinelLengthA:v.sentinelInputPrevious.length,scaleColormapA:v.scaleColormapPrevious,sentinelColormapA:v.sentinelColormapPrevious,scaleLengthB:v.scaleInput.length,sentinelLengthB:v.sentinelInput.length,scaleColormapB:v.scaleColormap,sentinelColormapB:v.sentinelColormap,canvasSize:u,canvasCoordinates:r,texture:l.texture,textureBounds:n[o],interpolationFraction:t}})))},o=0,r=e;o<r.length;o++){n(r[o])}i(d)},x=a.frame((function(t){var n=t.time;b(1e3*(n-m)/e)})),[4,zr(e)];case 1:return r.sent(),x.cancel(),b(1),this.textureManager.destroy(),this.textureManager=g,[2]}}))}))},e.prototype.removeTile=function(t){this.textureManager.removeTile(t)},e.prototype.setCanvasSize=function(t,e){Object.assign(this.canvas,{width:t,height:e})},e.prototype.computeRequiredCanvasDimensions=function(t){var e=this.tileSize,n=Math.ceil(Math.sqrt(t));return[n*e,Math.ceil(t/n)*e]},e.prototype.getCanvasCoordinates=function(t,e,n){var o=this.tileSize;return cn(Mr(0,e,o),(function(e){return Mr(0,t,o).map((function(t){return[t,e]}))})).slice(0,n)},e}(),vi="http://www.w3.org/1999/xhtml",yi={svg:"http://www.w3.org/2000/svg",xhtml:vi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function wi(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),yi.hasOwnProperty(e)?{space:yi[e],local:t}:t}function _i(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===vi&&e.documentElement.namespaceURI===vi?e.createElement(t):e.createElementNS(n,t)}}function Ci(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ai(t){var e=wi(t);return(e.local?Ci:_i)(e)}function Ti(){}function Li(t){return null==t?Ti:function(){return this.querySelector(t)}}function Ei(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Bi(){return[]}function Di(t){return function(e){return e.matches(t)}}var Fi=Array.prototype.find;function Ii(){return this.firstElementChild}var Si=Array.prototype.filter;function Ri(){return this.children}function Oi(t){return new Array(t.length)}function ki(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function Ni(t){return function(){return t}}function Mi(t,e,n,o,r,i){for(var a,l=0,s=e.length,f=i.length;l<f;++l)(a=e[l])?(a.__data__=i[l],o[l]=a):n[l]=new ki(t,i[l]);for(;l<s;++l)(a=e[l])&&(r[l]=a)}function Hi(t,e,n,o,r,i,a){var l,s,f,u=new Map,c=e.length,h=i.length,d=new Array(c);for(l=0;l<c;++l)(s=e[l])&&(d[l]=f=a.call(s,s.__data__,l,e)+"",u.has(f)?r[l]=s:u.set(f,s));for(l=0;l<h;++l)f=a.call(t,i[l],l,i)+"",(s=u.get(f))?(o[l]=s,s.__data__=i[l],u.delete(f)):n[l]=new ki(t,i[l]);for(l=0;l<c;++l)(s=e[l])&&u.get(d[l])===s&&(r[l]=s)}function zi(t){return t.__data__}function Pi(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Vi(t){return function(){this.removeAttribute(t)}}function ji(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ui(t,e){return function(){this.setAttribute(t,e)}}function Gi(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Wi(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function qi(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Xi(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Zi(t){return function(){this.style.removeProperty(t)}}function Yi(t,e,n){return function(){this.style.setProperty(t,e,n)}}function $i(t,e,n){return function(){var o=e.apply(this,arguments);null==o?this.style.removeProperty(t):this.style.setProperty(t,o,n)}}function Ki(t,e){return t.style.getPropertyValue(e)||Xi(t).getComputedStyle(t,null).getPropertyValue(e)}function Qi(t){return function(){delete this[t]}}function Ji(t,e){return function(){this[t]=e}}function ta(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function ea(t){return t.trim().split(/^|\s+/)}function na(t){return t.classList||new oa(t)}function oa(t){this._node=t,this._names=ea(t.getAttribute("class")||"")}function ra(t,e){for(var n=na(t),o=-1,r=e.length;++o<r;)n.add(e[o])}function ia(t,e){for(var n=na(t),o=-1,r=e.length;++o<r;)n.remove(e[o])}function aa(t){return function(){ra(this,t)}}function la(t){return function(){ia(this,t)}}function sa(t,e){return function(){(e.apply(this,arguments)?ra:ia)(this,t)}}function fa(){this.textContent=""}function ua(t){return function(){this.textContent=t}}function ca(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function ha(){this.innerHTML=""}function da(t){return function(){this.innerHTML=t}}function pa(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function ga(){this.nextSibling&&this.parentNode.appendChild(this)}function ma(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ba(){return null}function xa(){var t=this.parentNode;t&&t.removeChild(this)}function va(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ya(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function wa(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function _a(t){return function(){var e=this.__on;if(e){for(var n,o=0,r=-1,i=e.length;o<i;++o)n=e[o],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function Ca(t,e,n){return function(){var o,r=this.__on,i=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var a=0,l=r.length;a<l;++a)if((o=r[a]).type===t.type&&o.name===t.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),void(o.value=e);this.addEventListener(t.type,i,n),o={type:t.type,name:t.name,value:e,listener:i,options:n},r?r.push(o):this.__on=[o]}}function Aa(t,e,n){var o=Xi(t),r=o.CustomEvent;"function"==typeof r?r=new r(e,n):(r=o.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Ta(t,e){return function(){return Aa(this,t,e)}}function La(t,e){return function(){return Aa(this,t,e.apply(this,arguments))}}ki.prototype={constructor:ki,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},oa.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Ea=[null];function Ba(t,e){this._groups=t,this._parents=e}function Da(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}Ba.prototype=function(){return new Ba([[document.documentElement]],Ea)}.prototype={constructor:Ba,select:function(t){"function"!=typeof t&&(t=Li(t));for(var e=this._groups,n=e.length,o=new Array(n),r=0;r<n;++r)for(var i,a,l=e[r],s=l.length,f=o[r]=new Array(s),u=0;u<s;++u)(i=l[u])&&(a=t.call(i,i.__data__,u,l))&&("__data__"in i&&(a.__data__=i.__data__),f[u]=a);return new Ba(o,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:Ei(e)}}(t):function(t){return null==t?Bi:function(){return this.querySelectorAll(t)}}(t);for(var e=this._groups,n=e.length,o=[],r=[],i=0;i<n;++i)for(var a,l=e[i],s=l.length,f=0;f<s;++f)(a=l[f])&&(o.push(t.call(a,a.__data__,f,l)),r.push(a));return new Ba(o,r)},selectChild:function(t){return this.select(null==t?Ii:function(t){return function(){return Fi.call(this.children,t)}}("function"==typeof t?t:Di(t)))},selectChildren:function(t){return this.selectAll(null==t?Ri:function(t){return function(){return Si.call(this.children,t)}}("function"==typeof t?t:Di(t)))},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,n=e.length,o=new Array(n),r=0;r<n;++r)for(var i,a=e[r],l=a.length,s=o[r]=[],f=0;f<l;++f)(i=a[f])&&t.call(i,i.__data__,f,a)&&s.push(i);return new Ba(o,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,zi);var n=e?Hi:Mi,o=this._parents,r=this._groups;"function"!=typeof t&&(t=Ni(t));for(var i=r.length,a=new Array(i),l=new Array(i),s=new Array(i),f=0;f<i;++f){var u=o[f],c=r[f],h=c.length,d=Ei(t.call(u,u&&u.__data__,f,o)),p=d.length,g=l[f]=new Array(p),m=a[f]=new Array(p),b=s[f]=new Array(h);n(u,c,g,m,b,d,e);for(var x,v,y=0,w=0;y<p;++y)if(x=g[y]){for(y>=w&&(w=y+1);!(v=m[w])&&++w<p;);x._next=v||null}}return(a=new Ba(a,o))._enter=l,a._exit=s,a},enter:function(){return new Ba(this._enter||this._groups.map(Oi),this._parents)},exit:function(){return new Ba(this._exit||this._groups.map(Oi),this._parents)},join:function(t,e,n){var o=this.enter(),r=this,i=this.exit();return o="function"==typeof t?t(o):o.append(t+""),null!=e&&(r=e(r)),null==n?i.remove():n(i),o&&r?o.merge(r).order():r},merge:function(t){if(!(t instanceof Ba))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,o=e.length,r=n.length,i=Math.min(o,r),a=new Array(o),l=0;l<i;++l)for(var s,f=e[l],u=n[l],c=f.length,h=a[l]=new Array(c),d=0;d<c;++d)(s=f[d]||u[d])&&(h[d]=s);for(;l<o;++l)a[l]=e[l];return new Ba(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var o,r=t[e],i=r.length-1,a=r[i];--i>=0;)(o=r[i])&&(a&&4^o.compareDocumentPosition(a)&&a.parentNode.insertBefore(o,a),a=o);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Pi);for(var n=this._groups,o=n.length,r=new Array(o),i=0;i<o;++i){for(var a,l=n[i],s=l.length,f=r[i]=new Array(s),u=0;u<s;++u)(a=l[u])&&(f[u]=a);f.sort(e)}return new Ba(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var o=t[e],r=0,i=o.length;r<i;++r){var a=o[r];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,o=e.length;n<o;++n)for(var r,i=e[n],a=0,l=i.length;a<l;++a)(r=i[a])&&t.call(r,r.__data__,a,i);return this},attr:function(t,e){var n=wi(t);if(arguments.length<2){var o=this.node();return n.local?o.getAttributeNS(n.space,n.local):o.getAttribute(n)}return this.each((null==e?n.local?ji:Vi:"function"==typeof e?n.local?qi:Wi:n.local?Gi:Ui)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Zi:"function"==typeof e?$i:Yi)(t,e,null==n?"":n)):Ki(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Qi:"function"==typeof e?ta:Ji)(t,e)):this.node()[t]},classed:function(t,e){var n=ea(t+"");if(arguments.length<2){for(var o=na(this.node()),r=-1,i=n.length;++r<i;)if(!o.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?sa:e?aa:la)(n,e))},text:function(t){return arguments.length?this.each(null==t?fa:("function"==typeof t?ca:ua)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?ha:("function"==typeof t?pa:da)(t)):this.node().innerHTML},raise:function(){return this.each(ga)},lower:function(){return this.each(ma)},append:function(t){var e="function"==typeof t?t:Ai(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Ai(t),o=null==e?ba:"function"==typeof e?e:Li(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),o.apply(this,arguments)||null)}))},remove:function(){return this.each(xa)},clone:function(t){return this.select(t?ya:va)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var o,r,i=wa(t+""),a=i.length;if(!(arguments.length<2)){for(l=e?Ca:_a,o=0;o<a;++o)this.each(l(i[o],e,n));return this}var l=this.node().__on;if(l)for(var s,f=0,u=l.length;f<u;++f)for(o=0,s=l[f];o<a;++o)if((r=i[o]).type===s.type&&r.name===s.name)return s.value},dispatch:function(t,e){return this.each(("function"==typeof e?La:Ta)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var o,r=t[e],i=0,a=r.length;i<a;++i)(o=r[i])&&(yield o)}};var Fa=function(t){let e=t,n=t;function o(t,e,o,r){for(null==o&&(o=0),null==r&&(r=t.length);o<r;){const i=o+r>>>1;n(t[i],e)<0?o=i+1:r=i}return o}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>Da(t(e),n)}(t)),{left:o,center:function(t,n,r,i){null==r&&(r=0),null==i&&(i=t.length);const a=o(t,n,r,i);return a>r&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,o,r){for(null==o&&(o=0),null==r&&(r=t.length);o<r;){const i=o+r>>>1;n(t[i],e)>0?r=i:o=i+1}return o}}}(Da).right;class Ia{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let o=0;o<this._n&&o<32;o++){const r=e[o],i=t+r,a=Math.abs(t)<Math.abs(r)?t-(i-r):r-(i-t);a&&(e[n++]=a),t=i}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,o,r=this._n,i=0;if(r>0){for(i=t[--r];r>0&&(e=i,n=t[--r],i=e+n,o=n-(i-e),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(n=2*o,e=i+n,n==e-i&&(i=e))}return i}}function Sa(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var o=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),i=new Array(r);++o<r;)i[o]=t+o*n;return i}var Ra=Math.sqrt(50),Oa=Math.sqrt(10),ka=Math.sqrt(2);function Na(t,e,n){var o=(e-t)/Math.max(0,n),r=Math.floor(Math.log(o)/Math.LN10),i=o/Math.pow(10,r);return r>=0?(i>=Ra?10:i>=Oa?5:i>=ka?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(i>=Ra?10:i>=Oa?5:i>=ka?2:1)}function Ma(t,e,n){var o=Math.abs(e-t)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),i=o/r;return i>=Ra?r*=10:i>=Oa?r*=5:i>=ka&&(r*=2),e<t?-r:r}function Ha(t){return Math.ceil(Math.log(function(t,e){let n=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++n;else{let o=-1;for(let r of t)null!=(r=e(r,++o,t))&&(r=+r)>=r&&++n}return n}(t))/Math.LN2)+1}function za(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Pa(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Va(t,e){var n=Object.create(t.prototype);for(var o in e)n[o]=e[o];return n}function ja(){}var Ua=.7,Ga=1/Ua,Wa="\\s*([+-]?\\d+)\\s*",qa="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Xa="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Za=/^#([0-9a-f]{3,8})$/,Ya=new RegExp("^rgb\\("+[Wa,Wa,Wa]+"\\)$"),$a=new RegExp("^rgb\\("+[Xa,Xa,Xa]+"\\)$"),Ka=new RegExp("^rgba\\("+[Wa,Wa,Wa,qa]+"\\)$"),Qa=new RegExp("^rgba\\("+[Xa,Xa,Xa,qa]+"\\)$"),Ja=new RegExp("^hsl\\("+[qa,Xa,Xa]+"\\)$"),tl=new RegExp("^hsla\\("+[qa,Xa,Xa,qa]+"\\)$"),el={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function nl(){return this.rgb().formatHex()}function ol(){return this.rgb().formatRgb()}function rl(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Za.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?il(e):3===n?new fl(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?al(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?al(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Ya.exec(t))?new fl(e[1],e[2],e[3],1):(e=$a.exec(t))?new fl(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ka.exec(t))?al(e[1],e[2],e[3],e[4]):(e=Qa.exec(t))?al(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ja.exec(t))?dl(e[1],e[2]/100,e[3]/100,1):(e=tl.exec(t))?dl(e[1],e[2]/100,e[3]/100,e[4]):el.hasOwnProperty(t)?il(el[t]):"transparent"===t?new fl(NaN,NaN,NaN,0):null}function il(t){return new fl(t>>16&255,t>>8&255,255&t,1)}function al(t,e,n,o){return o<=0&&(t=e=n=NaN),new fl(t,e,n,o)}function ll(t){return t instanceof ja||(t=rl(t)),t?new fl((t=t.rgb()).r,t.g,t.b,t.opacity):new fl}function sl(t,e,n,o){return 1===arguments.length?ll(t):new fl(t,e,n,null==o?1:o)}function fl(t,e,n,o){this.r=+t,this.g=+e,this.b=+n,this.opacity=+o}function ul(){return"#"+hl(this.r)+hl(this.g)+hl(this.b)}function cl(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function hl(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function dl(t,e,n,o){return o<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new gl(t,e,n,o)}function pl(t){if(t instanceof gl)return new gl(t.h,t.s,t.l,t.opacity);if(t instanceof ja||(t=rl(t)),!t)return new gl;if(t instanceof gl)return t;var e=(t=t.rgb()).r/255,n=t.g/255,o=t.b/255,r=Math.min(e,n,o),i=Math.max(e,n,o),a=NaN,l=i-r,s=(i+r)/2;return l?(a=e===i?(n-o)/l+6*(n<o):n===i?(o-e)/l+2:(e-n)/l+4,l/=s<.5?i+r:2-i-r,a*=60):l=s>0&&s<1?0:a,new gl(a,l,s,t.opacity)}function gl(t,e,n,o){this.h=+t,this.s=+e,this.l=+n,this.opacity=+o}function ml(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function bl(t){return function(){return t}}function xl(t){return 1==(t=+t)?vl:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(o){return Math.pow(t+o*e,n)}}(e,n,t):bl(isNaN(e)?n:e)}}function vl(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):bl(isNaN(t)?e:t)}Pa(ja,rl,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:nl,formatHex:nl,formatHsl:function(){return pl(this).formatHsl()},formatRgb:ol,toString:ol}),Pa(fl,sl,Va(ja,{brighter:function(t){return t=null==t?Ga:Math.pow(Ga,t),new fl(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Ua:Math.pow(Ua,t),new fl(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ul,formatHex:ul,formatRgb:cl,toString:cl})),Pa(gl,(function(t,e,n,o){return 1===arguments.length?pl(t):new gl(t,e,n,null==o?1:o)}),Va(ja,{brighter:function(t){return t=null==t?Ga:Math.pow(Ga,t),new gl(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Ua:Math.pow(Ua,t),new gl(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*e,r=2*n-o;return new fl(ml(t>=240?t-240:t+120,r,o),ml(t,r,o),ml(t<120?t+240:t-120,r,o),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var yl=function t(e){var n=xl(e);function o(t,e){var o=n((t=sl(t)).r,(e=sl(e)).r),r=n(t.g,e.g),i=n(t.b,e.b),a=vl(t.opacity,e.opacity);return function(e){return t.r=o(e),t.g=r(e),t.b=i(e),t.opacity=a(e),t+""}}return o.gamma=t,o}(1);function wl(t,e){e||(e=[]);var n,o=t?Math.min(e.length,t.length):0,r=e.slice();return function(i){for(n=0;n<o;++n)r[n]=t[n]*(1-i)+e[n]*i;return r}}function _l(t,e){var n,o=e?e.length:0,r=t?Math.min(o,t.length):0,i=new Array(r),a=new Array(o);for(n=0;n<r;++n)i[n]=Dl(t[n],e[n]);for(;n<o;++n)a[n]=e[n];return function(t){for(n=0;n<r;++n)a[n]=i[n](t);return a}}function Cl(t,e){var n=new Date;return t=+t,e=+e,function(o){return n.setTime(t*(1-o)+e*o),n}}function Al(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Tl(t,e){var n,o={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?o[n]=Dl(t[n],e[n]):r[n]=e[n];return function(t){for(n in o)r[n]=o[n](t);return r}}var Ll=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,El=new RegExp(Ll.source,"g");function Bl(t,e){var n,o,r,i=Ll.lastIndex=El.lastIndex=0,a=-1,l=[],s=[];for(t+="",e+="";(n=Ll.exec(t))&&(o=El.exec(e));)(r=o.index)>i&&(r=e.slice(i,r),l[a]?l[a]+=r:l[++a]=r),(n=n[0])===(o=o[0])?l[a]?l[a]+=o:l[++a]=o:(l[++a]=null,s.push({i:a,x:Al(n,o)})),i=El.lastIndex;return i<e.length&&(r=e.slice(i),l[a]?l[a]+=r:l[++a]=r),l.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,o=0;o<e;++o)l[(n=s[o]).i]=n.x(t);return l.join("")})}function Dl(t,e){var n,o,r=typeof e;return null==e||"boolean"===r?bl(e):("number"===r?Al:"string"===r?(n=rl(e))?(e=n,yl):Bl:e instanceof rl?yl:e instanceof Date?Cl:(o=e,!ArrayBuffer.isView(o)||o instanceof DataView?Array.isArray(e)?_l:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Tl:Al:wl))(t,e)}function Fl(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Il(t){return+t}var Sl=[0,1];function Rl(t){return t}function Ol(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function kl(t,e,n){var o=t[0],r=t[1],i=e[0],a=e[1];return r<o?(o=Ol(r,o),i=n(a,i)):(o=Ol(o,r),i=n(i,a)),function(t){return i(o(t))}}function Nl(t,e,n){var o=Math.min(t.length,e.length)-1,r=new Array(o),i=new Array(o),a=-1;for(t[o]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<o;)r[a]=Ol(t[a],t[a+1]),i[a]=n(e[a],e[a+1]);return function(e){var n=Fa(t,e,1,o)-1;return i[n](r[n](e))}}function Ml(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Hl(){var t,e,n,o,r,i,a=Sl,l=Sl,s=Dl,f=Rl;function u(){var t,e,n,s=Math.min(a.length,l.length);return f!==Rl&&(t=a[0],e=a[s-1],t>e&&(n=t,t=e,e=n),f=function(n){return Math.max(t,Math.min(e,n))}),o=s>2?Nl:kl,r=i=null,c}function c(e){return isNaN(e=+e)?n:(r||(r=o(a.map(t),l,s)))(t(f(e)))}return c.invert=function(n){return f(e((i||(i=o(l,a.map(t),Al)))(n)))},c.domain=function(t){return arguments.length?(a=Array.from(t,Il),u()):a.slice()},c.range=function(t){return arguments.length?(l=Array.from(t),u()):l.slice()},c.rangeRound=function(t){return l=Array.from(t),s=Fl,u()},c.clamp=function(t){return arguments.length?(f=!!t||Rl,u()):f!==Rl},c.interpolate=function(t){return arguments.length?(s=t,u()):s},c.unknown=function(t){return arguments.length?(n=t,c):n},function(n,o){return t=n,e=o,u()}}function zl(){return Hl()(Rl,Rl)}function Pl(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,o=t.slice(0,n);return[o.length>1?o[0]+o.slice(2):o,+t.slice(n+1)]}function Vl(t){return(t=Pl(Math.abs(t)))?t[1]:NaN}var jl,Ul=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Gl(t){if(!(e=Ul.exec(t)))throw new Error("invalid format: "+t);var e;return new Wl({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Wl(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function ql(t,e){var n=Pl(t,e);if(!n)return t+"";var o=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+o:o.length>r+1?o.slice(0,r+1)+"."+o.slice(r+1):o+new Array(r-o.length+2).join("0")}Gl.prototype=Wl.prototype,Wl.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Xl={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>ql(100*t,e),r:ql,s:function(t,e){var n=Pl(t,e);if(!n)return t+"";var o=n[0],r=n[1],i=r-(jl=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=o.length;return i===a?o:i>a?o+new Array(i-a+1).join("0"):i>0?o.slice(0,i)+"."+o.slice(i):"0."+new Array(1-i).join("0")+Pl(t,Math.max(0,e+i-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Zl(t){return t}var Yl,$l,Kl,Ql=Array.prototype.map,Jl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ts(t){var e,n,o=void 0===t.grouping||void 0===t.thousands?Zl:(e=Ql.call(t.grouping,Number),n=t.thousands+"",function(t,o){for(var r=t.length,i=[],a=0,l=e[0],s=0;r>0&&l>0&&(s+l+1>o&&(l=Math.max(1,o-s)),i.push(t.substring(r-=l,r+l)),!((s+=l+1)>o));)l=e[a=(a+1)%e.length];return i.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?Zl:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Ql.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",f=void 0===t.minus?"−":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function c(t){var e=(t=Gl(t)).fill,n=t.align,c=t.sign,h=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,b=t.trim,x=t.type;"n"===x?(g=!0,x="g"):Xl[x]||(void 0===m&&(m=12),b=!0,x="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var v="$"===h?r:"#"===h&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",y="$"===h?i:/[%p]/.test(x)?s:"",w=Xl[x],_=/[defgprs%]/.test(x);function C(t){var r,i,s,h=v,C=y;if("c"===x)C=w(t)+C,t="";else{var A=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:w(Math.abs(t),m),b&&(t=function(t){t:for(var e,n=t.length,o=1,r=-1;o<n;++o)switch(t[o]){case".":r=e=o;break;case"0":0===r&&(r=o),e=o;break;default:if(!+t[o])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),A&&0==+t&&"+"!==c&&(A=!1),h=(A?"("===c?c:f:"-"===c||"("===c?"":c)+h,C=("s"===x?Jl[8+jl/3]:"")+C+(A&&"("===c?")":""),_)for(r=-1,i=t.length;++r<i;)if(48>(s=t.charCodeAt(r))||s>57){C=(46===s?a+t.slice(r+1):t.slice(r))+C,t=t.slice(0,r);break}}g&&!d&&(t=o(t,1/0));var T=h.length+t.length+C.length,L=T<p?new Array(p-T+1).join(e):"";switch(g&&d&&(t=o(L+t,L.length?p-C.length:1/0),L=""),n){case"<":t=h+t+C+L;break;case"=":t=h+L+t+C;break;case"^":t=L.slice(0,T=L.length>>1)+h+t+C+L.slice(T);break;default:t=L+h+t+C}return l(t)}return m=void 0===m?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),C.toString=function(){return t+""},C}return{format:c,formatPrefix:function(t,e){var n=c(((t=Gl(t)).type="f",t)),o=3*Math.max(-8,Math.min(8,Math.floor(Vl(e)/3))),r=Math.pow(10,-o),i=Jl[8+o/3];return function(t){return n(r*t)+i}}}}function es(t,e,n,o){var r,i=Ma(t,e,n);switch((o=Gl(null==o?",f":o)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=o.precision||isNaN(r=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Vl(e)/3)))-Vl(Math.abs(t)))}(i,a))||(o.precision=r),Kl(o,a);case"":case"e":case"g":case"p":case"r":null!=o.precision||isNaN(r=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Vl(e)-Vl(t))+1}(i,Math.max(Math.abs(t),Math.abs(e))))||(o.precision=r-("e"===o.type));break;case"f":case"%":null!=o.precision||isNaN(r=function(t){return Math.max(0,-Vl(Math.abs(t)))}(i))||(o.precision=r-2*("%"===o.type))}return $l(o)}function ns(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var o,r,i,a,l=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((o=e<t)&&(r=t,t=e,e=r),0===(a=Na(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),i=new Array(r=Math.ceil(e-t+1));++l<r;)i[l]=(t+l)*a;else for(a=-a,t=Math.ceil(t*a),e=Math.floor(e*a),i=new Array(r=Math.ceil(e-t+1));++l<r;)i[l]=(t+l)/a;return o&&i.reverse(),i}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var o=e();return es(o[0],o[o.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var o,r,i=e(),a=0,l=i.length-1,s=i[a],f=i[l],u=10;for(f<s&&(r=s,s=f,f=r,r=a,a=l,l=r);u-- >0;){if((r=Na(s,f,n))===o)return i[a]=s,i[l]=f,e(i);if(r>0)s=Math.floor(s/r)*r,f=Math.ceil(f/r)*r;else{if(!(r<0))break;s=Math.ceil(s*r)/r,f=Math.floor(f*r)/r}o=r}return t},t}Yl=ts({thousands:",",grouping:[3],currency:["$",""]}),$l=Yl.format,Kl=Yl.formatPrefix;var os=2*Math.PI,rs=Math.abs,is=Math.sqrt;function as(){}function ls(t,e){t&&fs.hasOwnProperty(t.type)&&fs[t.type](t,e)}var ss={Feature:function(t,e){ls(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,o=-1,r=n.length;++o<r;)ls(n[o].geometry,e)}},fs={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,o=-1,r=n.length;++o<r;)t=n[o],e.point(t[0],t[1],t[2])},LineString:function(t,e){us(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,o=-1,r=n.length;++o<r;)us(n[o],e,0)},Polygon:function(t,e){cs(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,o=-1,r=n.length;++o<r;)cs(n[o],e)},GeometryCollection:function(t,e){for(var n=t.geometries,o=-1,r=n.length;++o<r;)ls(n[o],e)}};function us(t,e,n){var o,r=-1,i=t.length-n;for(e.lineStart();++r<i;)o=t[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function cs(t,e){var n=-1,o=t.length;for(e.polygonStart();++n<o;)us(t[n],e,1);e.polygonEnd()}function hs(t,e){t&&ss.hasOwnProperty(t.type)?ss[t.type](t,e):ls(t,e)}var ds,ps,gs,ms,bs=t=>t,xs=new Ia,vs=new Ia,ys={point:as,lineStart:as,lineEnd:as,polygonStart:function(){ys.lineStart=ws,ys.lineEnd=As},polygonEnd:function(){ys.lineStart=ys.lineEnd=ys.point=as,xs.add(rs(vs)),vs=new Ia},result:function(){var t=xs/2;return xs=new Ia,t}};function ws(){ys.point=_s}function _s(t,e){ys.point=Cs,ds=gs=t,ps=ms=e}function Cs(t,e){vs.add(ms*t-gs*e),gs=t,ms=e}function As(){Cs(ds,ps)}var Ts=1/0,Ls=Ts,Es=-Ts,Bs=Es,Ds={point:function(t,e){t<Ts&&(Ts=t);t>Es&&(Es=t);e<Ls&&(Ls=e);e>Bs&&(Bs=e)},lineStart:as,lineEnd:as,polygonStart:as,polygonEnd:as,result:function(){var t=[[Ts,Ls],[Es,Bs]];return Es=Bs=-(Ls=Ts=1/0),t}};var Fs,Is,Ss,Rs,Os=0,ks=0,Ns=0,Ms=0,Hs=0,zs=0,Ps=0,Vs=0,js=0,Us={point:Gs,lineStart:Ws,lineEnd:Zs,polygonStart:function(){Us.lineStart=Ys,Us.lineEnd=$s},polygonEnd:function(){Us.point=Gs,Us.lineStart=Ws,Us.lineEnd=Zs},result:function(){var t=js?[Ps/js,Vs/js]:zs?[Ms/zs,Hs/zs]:Ns?[Os/Ns,ks/Ns]:[NaN,NaN];return Os=ks=Ns=Ms=Hs=zs=Ps=Vs=js=0,t}};function Gs(t,e){Os+=t,ks+=e,++Ns}function Ws(){Us.point=qs}function qs(t,e){Us.point=Xs,Gs(Ss=t,Rs=e)}function Xs(t,e){var n=t-Ss,o=e-Rs,r=is(n*n+o*o);Ms+=r*(Ss+t)/2,Hs+=r*(Rs+e)/2,zs+=r,Gs(Ss=t,Rs=e)}function Zs(){Us.point=Gs}function Ys(){Us.point=Ks}function $s(){Qs(Fs,Is)}function Ks(t,e){Us.point=Qs,Gs(Fs=Ss=t,Is=Rs=e)}function Qs(t,e){var n=t-Ss,o=e-Rs,r=is(n*n+o*o);Ms+=r*(Ss+t)/2,Hs+=r*(Rs+e)/2,zs+=r,Ps+=(r=Rs*t-Ss*e)*(Ss+t),Vs+=r*(Rs+e),js+=3*r,Gs(Ss=t,Rs=e)}function Js(t){this._context=t}Js.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,os)}},result:as};var tf,ef,nf,of,rf,af=new Ia,lf={point:as,lineStart:function(){lf.point=sf},lineEnd:function(){tf&&ff(ef,nf),lf.point=as},polygonStart:function(){tf=!0},polygonEnd:function(){tf=null},result:function(){var t=+af;return af=new Ia,t}};function sf(t,e){lf.point=ff,ef=of=t,nf=rf=e}function ff(t,e){of-=t,rf-=e,af.add(is(of*of+rf*rf)),of=t,rf=e}function uf(){this._string=[]}function cf(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}uf.prototype={_radius:4.5,_circle:cf(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=cf(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var hf=Array.prototype.slice;function df(t,e){return t-e}var pf=t=>()=>t;function gf(t,e){for(var n,o=-1,r=e.length;++o<r;)if(n=mf(t,e[o]))return n;return 0}function mf(t,e){for(var n=e[0],o=e[1],r=-1,i=0,a=t.length,l=a-1;i<a;l=i++){var s=t[i],f=s[0],u=s[1],c=t[l],h=c[0],d=c[1];if(bf(s,c,e))return 0;u>o!=d>o&&n<(h-f)*(o-u)/(d-u)+f&&(r=-r)}return r}function bf(t,e,n){var o;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&function(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}(t[o=+(t[0]===e[0])],n[o],e[o])}function xf(){}var vf=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];var yf="$";function wf(){}function _f(t,e){var n=new wf;if(t instanceof wf)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var o,r=-1,i=t.length;if(null==e)for(;++r<i;)n.set(r,t[r]);else for(;++r<i;)n.set(e(o=t[r],r,t),o)}else if(t)for(var a in t)n.set(a,t[a]);return n}function Cf(){}wf.prototype=_f.prototype={constructor:wf,has:function(t){return yf+t in this},get:function(t){return this[yf+t]},set:function(t,e){return this[yf+t]=e,this},remove:function(t){var e=yf+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===yf&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===yf&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===yf&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===yf&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===yf&&++t;return t},empty:function(){for(var t in this)if(t[0]===yf)return!1;return!0},each:function(t){for(var e in this)e[0]===yf&&t(this[e],e.slice(1),this)}};var Af=_f.prototype;Cf.prototype=function(t,e){var n=new Cf;if(t instanceof Cf)t.each((function(t){n.add(t)}));else if(t){var o=-1,r=t.length;if(null==e)for(;++o<r;)n.add(t[o]);else for(;++o<r;)n.add(e(t[o],o,t))}return n}.prototype={constructor:Cf,has:Af.has,add:function(t){return this[yf+(t+="")]=t,this},remove:Af.remove,clear:Af.clear,values:Af.keys,size:Af.size,empty:Af.empty,each:Af.each};var Tf={value:function(){}};function Lf(){for(var t,e=0,n=arguments.length,o={};e<n;++e){if(!(t=arguments[e]+"")||t in o||/[\s.]/.test(t))throw new Error("illegal type: "+t);o[t]=[]}return new Ef(o)}function Ef(t){this._=t}function Bf(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",o=t.indexOf(".");if(o>=0&&(n=t.slice(o+1),t=t.slice(0,o)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function Df(t,e){for(var n,o=0,r=t.length;o<r;++o)if((n=t[o]).name===e)return n.value}function Ff(t,e,n){for(var o=0,r=t.length;o<r;++o)if(t[o].name===e){t[o]=Tf,t=t.slice(0,o).concat(t.slice(o+1));break}return null!=n&&t.push({name:e,value:n}),t}Ef.prototype=Lf.prototype={constructor:Ef,on:function(t,e){var n,o=this._,r=Bf(t+"",o),i=-1,a=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<a;)if(n=(t=r[i]).type)o[n]=Ff(o[n],t.name,e);else if(null==e)for(n in o)o[n]=Ff(o[n],t.name,null);return this}for(;++i<a;)if((n=(t=r[i]).type)&&(n=Df(o[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ef(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,o,r=new Array(n),i=0;i<n;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(o=this._[t]).length;i<n;++i)o[i].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)}};var If,Sf,Rf=(If="application/json",Sf=function(t){return JSON.parse(t.responseText)},function(t,e){var n=function(t,e){var n,o,r,i,a=Lf("beforesend","progress","load","error"),l=_f(),s=new XMLHttpRequest,f=null,u=null,c=0;function h(t){var e,o=s.status;if(!o&&function(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}(s)||o>=200&&o<300||304===o){if(r)try{e=r.call(n,s)}catch(t){return void a.call("error",n,t)}else e=s;a.call("load",n,e)}else a.call("error",n,t)}if("undefined"!=typeof XDomainRequest&&!("withCredentials"in s)&&/^(http(s)?:)?\/\//.test(t)&&(s=new XDomainRequest),"onload"in s?s.onload=s.onerror=s.ontimeout=h:s.onreadystatechange=function(t){s.readyState>3&&h(t)},s.onprogress=function(t){a.call("progress",n,t)},n={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?l.get(t):(null==e?l.remove(t):l.set(t,e+""),n)},mimeType:function(t){return arguments.length?(o=null==t?null:t+"",n):o},responseType:function(t){return arguments.length?(i=t,n):i},timeout:function(t){return arguments.length?(c=+t,n):c},user:function(t){return arguments.length<1?f:(f=null==t?null:t+"",n)},password:function(t){return arguments.length<1?u:(u=null==t?null:t+"",n)},response:function(t){return r=t,n},get:function(t,e){return n.send("GET",t,e)},post:function(t,e){return n.send("POST",t,e)},send:function(e,r,h){return s.open(e,t,!0,f,u),null==o||l.has("accept")||l.set("accept",o+",*/*"),s.setRequestHeader&&l.each((function(t,e){s.setRequestHeader(e,t)})),null!=o&&s.overrideMimeType&&s.overrideMimeType(o),null!=i&&(s.responseType=i),c>0&&(s.timeout=c),null==h&&"function"==typeof r&&(h=r,r=null),null!=h&&1===h.length&&(h=function(t){return function(e,n){t(null==e?n:null)}}(h)),null!=h&&n.on("error",h).on("load",(function(t){h(null,t)})),a.call("beforesend",n,s),s.send(null==r?null:r),n},abort:function(){return s.abort(),n},on:function(){var t=a.on.apply(a,arguments);return t===a?n:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return n.get(e)}return n}(t).mimeType(If).response(Sf);if(null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return n.get(e)}return n});function Of(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function kf(t,e){var n=Object.create(t.prototype);for(var o in e)n[o]=e[o];return n}function Nf(){}var Mf=.7,Hf=1/Mf,zf="\\s*([+-]?\\d+)\\s*",Pf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jf=/^#([0-9a-f]{3,8})$/,Uf=new RegExp("^rgb\\("+[zf,zf,zf]+"\\)$"),Gf=new RegExp("^rgb\\("+[Vf,Vf,Vf]+"\\)$"),Wf=new RegExp("^rgba\\("+[zf,zf,zf,Pf]+"\\)$"),qf=new RegExp("^rgba\\("+[Vf,Vf,Vf,Pf]+"\\)$"),Xf=new RegExp("^hsl\\("+[Pf,Vf,Vf]+"\\)$"),Zf=new RegExp("^hsla\\("+[Pf,Vf,Vf,Pf]+"\\)$"),Yf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function $f(){return this.rgb().formatHex()}function Kf(){return this.rgb().formatRgb()}function Qf(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=jf.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Jf(e):3===n?new nu(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?tu(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?tu(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Uf.exec(t))?new nu(e[1],e[2],e[3],1):(e=Gf.exec(t))?new nu(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Wf.exec(t))?tu(e[1],e[2],e[3],e[4]):(e=qf.exec(t))?tu(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Xf.exec(t))?au(e[1],e[2]/100,e[3]/100,1):(e=Zf.exec(t))?au(e[1],e[2]/100,e[3]/100,e[4]):Yf.hasOwnProperty(t)?Jf(Yf[t]):"transparent"===t?new nu(NaN,NaN,NaN,0):null}function Jf(t){return new nu(t>>16&255,t>>8&255,255&t,1)}function tu(t,e,n,o){return o<=0&&(t=e=n=NaN),new nu(t,e,n,o)}function eu(t){return t instanceof Nf||(t=Qf(t)),t?new nu((t=t.rgb()).r,t.g,t.b,t.opacity):new nu}function nu(t,e,n,o){this.r=+t,this.g=+e,this.b=+n,this.opacity=+o}function ou(){return"#"+iu(this.r)+iu(this.g)+iu(this.b)}function ru(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function iu(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function au(t,e,n,o){return o<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new su(t,e,n,o)}function lu(t){if(t instanceof su)return new su(t.h,t.s,t.l,t.opacity);if(t instanceof Nf||(t=Qf(t)),!t)return new su;if(t instanceof su)return t;var e=(t=t.rgb()).r/255,n=t.g/255,o=t.b/255,r=Math.min(e,n,o),i=Math.max(e,n,o),a=NaN,l=i-r,s=(i+r)/2;return l?(a=e===i?(n-o)/l+6*(n<o):n===i?(o-e)/l+2:(e-n)/l+4,l/=s<.5?i+r:2-i-r,a*=60):l=s>0&&s<1?0:a,new su(a,l,s,t.opacity)}function su(t,e,n,o){this.h=+t,this.s=+e,this.l=+n,this.opacity=+o}function fu(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Of(Nf,Qf,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:$f,formatHex:$f,formatHsl:function(){return lu(this).formatHsl()},formatRgb:Kf,toString:Kf}),Of(nu,(function(t,e,n,o){return 1===arguments.length?eu(t):new nu(t,e,n,null==o?1:o)}),kf(Nf,{brighter:function(t){return t=null==t?Hf:Math.pow(Hf,t),new nu(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Mf:Math.pow(Mf,t),new nu(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ou,formatHex:ou,formatRgb:ru,toString:ru})),Of(su,(function(t,e,n,o){return 1===arguments.length?lu(t):new su(t,e,n,null==o?1:o)}),kf(Nf,{brighter:function(t){return t=null==t?Hf:Math.pow(Hf,t),new su(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Mf:Math.pow(Mf,t),new su(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*e,r=2*n-o;return new nu(fu(t>=240?t-240:t+120,r,o),fu(t,r,o),fu(t<120?t+240:t-120,r,o),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const uu=Math.PI/180,cu=180/Math.PI,hu=.96422,du=.82521,pu=4/29,gu=6/29,mu=3*gu*gu;function bu(t){if(t instanceof xu)return new xu(t.l,t.a,t.b,t.opacity);if(t instanceof Tu)return Lu(t);t instanceof nu||(t=eu(t));var e,n,o=_u(t.r),r=_u(t.g),i=_u(t.b),a=vu((.2225045*o+.7168786*r+.0606169*i)/1);return o===r&&r===i?e=n=a:(e=vu((.4360747*o+.3850649*r+.1430804*i)/hu),n=vu((.0139322*o+.0971045*r+.7141733*i)/du)),new xu(116*a-16,500*(e-a),200*(a-n),t.opacity)}function xu(t,e,n,o){this.l=+t,this.a=+e,this.b=+n,this.opacity=+o}function vu(t){return t>.008856451679035631?Math.pow(t,1/3):t/mu+pu}function yu(t){return t>gu?t*t*t:mu*(t-pu)}function wu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function _u(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Cu(t){if(t instanceof Tu)return new Tu(t.h,t.c,t.l,t.opacity);if(t instanceof xu||(t=bu(t)),0===t.a&&0===t.b)return new Tu(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*cu;return new Tu(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Au(t,e,n,o){return 1===arguments.length?Cu(t):new Tu(t,e,n,null==o?1:o)}function Tu(t,e,n,o){this.h=+t,this.c=+e,this.l=+n,this.opacity=+o}function Lu(t){if(isNaN(t.h))return new xu(t.l,0,0,t.opacity);var e=t.h*uu;return new xu(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Of(xu,(function(t,e,n,o){return 1===arguments.length?bu(t):new xu(t,e,n,null==o?1:o)}),kf(Nf,{brighter:function(t){return new xu(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new xu(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new nu(wu(3.1338561*(e=hu*yu(e))-1.6168667*(t=1*yu(t))-.4906146*(n=du*yu(n))),wu(-.9787684*e+1.9161415*t+.033454*n),wu(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),Of(Tu,Au,kf(Nf,{brighter:function(t){return new Tu(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Tu(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Lu(this).rgb()}}));var Eu=t=>()=>t;function Bu(t,e){return function(n){return t+n*e}}function Du(t,e){var n=e-t;return n?Bu(t,n):Eu(isNaN(t)?e:t)}var Fu={select:function(t){return"string"==typeof t?new Ba([[document.querySelector(t)]],[document.documentElement]):new Ba([[t]],Ea)},selectAll:function(t){return"string"==typeof t?new Ba([document.querySelectorAll(t)],[document.documentElement]):new Ba([null==t?[]:Ei(t)],Ea)},scaleLinear:function t(){var e=zl();return e.copy=function(){return Ml(e,t())},za.apply(e,arguments),ns(e)},geoPath:function(t,e){var n,o,r=4.5;function i(t){return t&&("function"==typeof r&&o.pointRadius(+r.apply(this,arguments)),hs(t,n(o))),o.result()}return i.area=function(t){return hs(t,n(ys)),ys.result()},i.measure=function(t){return hs(t,n(lf)),lf.result()},i.bounds=function(t){return hs(t,n(Ds)),Ds.result()},i.centroid=function(t){return hs(t,n(Us)),Us.result()},i.projection=function(e){return arguments.length?(n=null==e?(t=null,bs):(t=e).stream,i):t},i.context=function(t){return arguments.length?(o=null==t?(e=null,new uf):new Js(e=t),"function"!=typeof r&&o.pointRadius(r),i):e},i.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(o.pointRadius(+t),+t),i):r},i.projection(t).context(e)},contours:function(){var t=1,e=1,n=Ha,o=l;function r(t){var e=n(t);if(Array.isArray(e))e=e.slice().sort(df);else{var o=function(t,e){let n,o;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=o=e):(n>e&&(n=e),o<e&&(o=e)));else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(void 0===n?i>=i&&(n=o=i):(n>i&&(n=i),o<i&&(o=i)))}return[n,o]}(t),r=o[0],a=o[1];e=Ma(r,a,e),e=Sa(Math.floor(r/e)*e,Math.floor(a/e)*e,e)}return e.map((function(e){return i(t,e)}))}function i(n,r){var i=[],l=[];return function(n,o,r){var i,l,s,f,u,c,h=new Array,d=new Array;i=l=-1,f=n[0]>=o,vf[f<<1].forEach(p);for(;++i<t-1;)s=f,f=n[i+1]>=o,vf[s|f<<1].forEach(p);vf[f<<0].forEach(p);for(;++l<e-1;){for(i=-1,f=n[l*t+t]>=o,u=n[l*t]>=o,vf[f<<1|u<<2].forEach(p);++i<t-1;)s=f,f=n[l*t+t+i+1]>=o,c=u,u=n[l*t+i+1]>=o,vf[s|f<<1|u<<2|c<<3].forEach(p);vf[f|u<<3].forEach(p)}i=-1,u=n[l*t]>=o,vf[u<<2].forEach(p);for(;++i<t-1;)c=u,u=n[l*t+i+1]>=o,vf[u<<2|c<<3].forEach(p);function p(t){var e,n,o=[t[0][0]+i,t[0][1]+l],s=[t[1][0]+i,t[1][1]+l],f=a(o),u=a(s);(e=d[f])?(n=h[u])?(delete d[e.end],delete h[n.start],e===n?(e.ring.push(s),r(e.ring)):h[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(s),d[e.end=u]=e):(e=h[u])?(n=d[f])?(delete h[e.start],delete d[n.end],e===n?(e.ring.push(s),r(e.ring)):h[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete h[e.start],e.ring.unshift(o),h[e.start=f]=e):h[f]=d[u]={start:f,end:u,ring:[o,s]}}vf[u<<3].forEach(p)}(n,r,(function(t){o(t,n,r),function(t){for(var e=0,n=t.length,o=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)o+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return o}(t)>0?i.push([t]):l.push(t)})),l.forEach((function(t){for(var e,n=0,o=i.length;n<o;++n)if(-1!==gf((e=i[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:r,coordinates:i}}function a(e){return 2*e[0]+e[1]*(t+1)*4}function l(n,o,r){n.forEach((function(n){var i,a=n[0],l=n[1],s=0|a,f=0|l,u=o[f*t+s];a>0&&a<t&&s===a&&(i=o[f*t+s-1],n[0]=a+(r-i)/(u-i)-.5),l>0&&l<e&&f===l&&(i=o[(f-1)*t+s],n[1]=l+(r-i)/(u-i)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[t,e];var o=Math.floor(n[0]),i=Math.floor(n[1]);if(!(o>=0&&i>=0))throw new Error("invalid size");return t=o,e=i,r},r.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?pf(hf.call(t)):pf(t),r):n},r.smooth=function(t){return arguments.length?(o=t?l:xf,r):o===l},r},interpolateHcl:function(t){return function(e,n){var o=t((e=Au(e)).h,(n=Au(n)).h),r=Du(e.c,n.c),i=Du(e.l,n.l),a=Du(e.opacity,n.opacity);return function(t){return e.h=o(t),e.c=r(t),e.l=i(t),e.opacity=a(t),e+""}}}((function(t,e){var n=e-t;return n?Bu(t,n>180||n<-180?n-360*Math.round(n/360):n):Eu(isNaN(t)?e:t)})),json:Rf,min:function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let o=-1;for(let r of t)null!=(r=e(r,++o,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n},max:function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let o=-1;for(let r of t)null!=(r=e(r,++o,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n},scan:function(t,e){const n=function(t,e=Da){if(1===e.length)return function(t,e){let n,o=-1,r=-1;if(void 0===e)for(const e of t)++r,null!=e&&(n>e||void 0===n&&e>=e)&&(n=e,o=r);else for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i,o=r);return o}(t,e);let n,o=-1,r=-1;for(const i of t)++r,(o<0?0===e(i,i):e(i,n)<0)&&(n=i,o=r);return o}(t,e);return n<0?void 0:n},range:Sa},Iu=Nr(),Su={colorScale:[],sentinelValues:[],transitions:!1,transitionTimeMs:800,debug:!1,extraPixelLayers:0,colorscaleMaxLength:16,sentinelMaxLength:16,minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,glOperation:"none",multiLayers:0,operationUrlA:"",operationUrlB:"",operationUrlC:"",operationUrlD:"",operationUrlE:"",operationUrlF:"",filterLowA:0,filterHighA:1e5,filterLowB:0,filterHighB:1e5,filterLowC:0,filterHighC:1e5,filterLowD:0,filterHighD:1e5,filterLowE:0,filterHighE:1e5,filterLowF:0,filterHighF:1e5,multiplierA:1,multiplierB:1,multiplierC:1,multiplierD:1,multiplierE:1,multiplierF:1,hillshadeType:"none",hsElevationScale:1,hsSimpleZoomdelta:0,hsSimpleSlopescale:3,hsSimpleAzimuth:315,hsSimpleAltitude:70,hsAdvSoftIterations:128,hsAdvAmbientIterations:40,hsAdvSunRadiusMultiplier:100,hsAdvFinalSoftMultiplier:4,hsAdvFinalAmbientMultiplier:.25,hsPregenUrl:"",_hillshadeOptions:{hillshadeType:"none"},contourType:"none",contourSmoothLines:!1,contourSmoothInput:!1,contourSmoothInputKernel:7,contourScaleFactor:1,contourInterval:25,contourIndexInterval:100,contourLineColor:"#000000",contourIlluminatedHighlightColor:"rgba(177,174,164,.5)",contourIlluminatedShadowColor:"#5b5143",contourIlluminatedShadowSize:2,contourLineWeight:.5,contourLineIndexWeight:2,contourIndexLabels:!1,contourLabelFont:"12px Arial",contourLabelDistance:250,contourHypso:!1,contourHypsoDomain:[0,1e3,2e3],contourHypsoColors:["#486341","#e5d9c9","#dddddd"],contourBathy:!1,contourBathyDomain:[-2e3,0],contourBathyColors:["#315d9b","#d5f2ff"],contourBathyShadowColor:"#4e5c66",contourBathyHighlightColor:"rgba(224, 242, 255, .5)"};return function(i){function a(t){var e=i.call(this,Object.assign({},Su,t))||this;e._contourData={},e._checkColorScaleAndSentinels();var n=e.options,a=n.nodataValue,l=n.preloadUrl,s=e._tileSizeAsNumber(),f=new xi(s,a,e.options.colorScale,e.options.sentinelValues,e.options.colorscaleMaxLength,e.options.sentinelMaxLength);return Object.assign(e,{_renderer:f,_preloadTileCache:void 0}),e._maybePreload(l),e.on("tileunload",e._onTileRemove.bind(e)),e.on("load",(function(t){return setTimeout((function(){e.options.debug&&console.log("all tiles loaded. Updating contours if enabled."),e._maybeUpdateMergedArrayAndDrawContours()}),300)})),setTimeout((function(){e._map.on("zoomend",(function(t){return setTimeout((function(){return o(e,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return"none"===this.options.contourType?[3,2]:(this.options.debug&&console.log("zoom changed. Moving contour canvas."),[4,this._getActivetilesBounds()]);case 1:t=e.sent(),this._moveContourCanvas(t),e.label=2;case 2:return[2]}}))}))}),50)}))}),300),e}return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}(a,i),a.prototype.updateOptions=function(e){var n=this,i=this.options,a=i.url,l=i.glOperation,s=i.operationUrlA,f=i.operationUrlB,u=i.operationUrlC,c=i.operationUrlD,h=i.operationUrlE,d=i.operationUrlF,p=i.colorScale,g=i.sentinelValues,m=i.filterLowA,b=i.filterHighA,x=i.filterLowB,v=i.filterHighB,y=i.filterLowC,w=i.filterHighC,_=i.filterLowD,C=i.filterHighD,A=i.filterLowE,T=i.filterHighE,L=i.filterLowF,E=i.filterHighF,B=i.multiplierA,D=i.multiplierB,F=i.multiplierC,I=i.multiplierD,S=i.multiplierE,R=i.multiplierF,O=i.multiLayers,k=i.hsPregenUrl,N=i.hillshadeType,M=i.hsSimpleSlopescale,H=i.contourInterval,z=i.contourIndexInterval,P=i.contourLineColor,V=i.contourLineWeight,j=i.contourLineIndexWeight,U=i.contourType,G=i.contourSmoothLines,W=i.contourSmoothInput,q=i.contourSmoothInputKernel,X=i.contourIlluminatedHighlightColor,Z=i.contourIlluminatedShadowColor,Y=i.contourIlluminatedShadowSize,$=i.contourHypso,K=i.contourHypsoDomain,Q=i.contourHypsoColors,J=i.contourBathy,tt=i.contourBathyDomain,et=i.contourBathyColors,nt=i.contourBathyShadowColor,ot=i.contourBathyHighlightColor,rt=i.contourIndexLabels,it=i.contourLabelFont,at=i.contourLabelDistance,lt=i.colorscaleMaxLength,st=i.sentinelMaxLength;if(t.Util.setOptions(this,e),this.options.colorscaleMaxLength!==lt||this.options.sentinelMaxLength!==st){this.options.debug&&console.log("Creating new renderer");var ft=this._tileSizeAsNumber(),ut=new xi(ft,this.options.nodataValue,this.options.colorScale,this.options.sentinelValues,this.options.colorscaleMaxLength,this.options.sentinelMaxLength);this._renderer.regl.destroy(),delete this._renderer,Object.assign(this,{_renderer:ut})}if(this._checkColorScaleAndSentinels(),this.options.colorScale!==p&&this._renderer.updateColorscale(this.options.colorScale),this.options.sentinelValues!==g&&this._renderer.updateSentinels(this.options.sentinelValues),this._maybePreload(this.options.preloadUrl),this.options._hillshadeOptions={hillshadeType:this.options.hillshadeType,hsElevationScale:this.options.hsElevationScale,hsSimpleSlopescale:this.options.hsSimpleSlopescale,hsSimpleAzimuth:this.options.hsSimpleAzimuth,hsSimpleAltitude:this.options.hsSimpleAltitude,hsSimpleZoomdelta:this.options.hsSimpleZoomdelta,hsAdvSoftIterations:this.options.hsAdvSoftIterations,hsAdvAmbientIterations:this.options.hsAdvAmbientIterations,hsAdvSunRadiusMultiplier:this.options.hsAdvSunRadiusMultiplier,hsAdvFinalSoftMultiplier:this.options.hsAdvFinalSoftMultiplier,hsAdvFinalAmbientMultiplier:this.options.hsAdvFinalAmbientMultiplier,hsPregenUrl:this.options.hsPregenUrl},this.options.extraPixelLayers>0&&"none"===this.options.glOperation&&this._maybeLoadExtraLayers(s,f,u,c),this.options.hillshadeType!==N)if("simple"===this.options.hillshadeType)this._renderer.setMaxTextureDimension(this._tileSizeAsNumber());else if("simple"===N){var ct=this._renderer.findMaxTextureDimension();this._renderer.setMaxTextureDimension(ct)}"none"===this.options.glOperation?this.options.transitions?this.options.url!==a?(this._updateTilesWithTransitions(p,g),this.options.debug&&console.log("Running GLOperations with transition on tiles")):this.options.url===a&&(this._updateColorscaleWithTransitions(p,g),this.options.debug&&console.log("Running GLOperations with transition on colorscale only")):this.options.url!==a||this.options.hillshadeType!==N||this.options.hsPregenUrl!==k||this.options.hsSimpleSlopescale!==M?(this._updateTiles(),this.options.debug&&console.log("Running GLOperations with new url, no transition and no operation")):JSON.stringify(this.options.colorScale)!==JSON.stringify(p)&&(this._updateTilesColorscaleOnly(),this.options.debug&&console.log("Running GLOperations with same url, no transition and no operation")):"multi"===this.options.glOperation?(1===this.options.multiLayers?this._updateTilesWithMultiAnalyze1(l,O,s,m,b,B):2===this.options.multiLayers?this._updateTilesWithMultiAnalyze2(l,O,s,f,m,b,x,v,B,D):3===this.options.multiLayers?this._updateTilesWithMultiAnalyze3(l,O,s,f,u,m,b,x,v,y,w,B,D,F):4===this.options.multiLayers?this._updateTilesWithMultiAnalyze4(l,O,s,f,u,c,m,b,x,v,y,w,_,C,B,D,F,I):5===this.options.multiLayers?this._updateTilesWithMultiAnalyze5(l,O,s,f,u,c,h,m,b,x,v,y,w,_,C,A,T,B,D,F,I,S):6===this.options.multiLayers&&this._updateTilesWithMultiAnalyze6(l,O,s,f,u,c,h,d,m,b,x,v,y,w,_,C,A,T,L,E,B,D,F,I,S,R),this.options.debug&&console.log("Running GLOperations with multiAnalyze")):"diff"===this.options.glOperation&&(this._updateTilesWithDiff(l,s,f),this.options.debug&&console.log("Running GLOperations with diff")),"none"!==this.options.contourType?this.options.contourType!==U&&"none"===U?this._contourData.mergedTileArray?setTimeout((function(){n._calculateAndDrawContours()}),50):setTimeout((function(){n._maybeUpdateMergedArrayAndDrawContours()}),50):!this.options.contourSmoothInput||this.options.contourSmoothInput===W&&this.options.contourSmoothInputKernel===q?this.options.contourInterval!==H||this.options.contourIndexInterval!==z||this.options.contourSmoothLines!==G||this.options.contourSmoothInput!==W?setTimeout((function(){n._calculateAndDrawContours()}),50):this.options.contourType===U&&this.options.contourLineColor===P&&this.options.contourLineWeight===V&&this.options.contourLineIndexWeight===j&&this.options.contourIlluminatedHighlightColor===X&&this.options.contourIlluminatedShadowColor===Z&&this.options.contourIlluminatedShadowSize===Y&&this.options.contourHypso===$&&this.options.contourHypsoDomain===K&&this.options.contourHypsoColors===Q&&this.options.contourBathy===J&&this.options.contourBathyDomain===tt&&this.options.contourBathyColors===et&&this.options.contourBathyShadowColor===nt&&this.options.contourBathyHighlightColor===ot&&this.options.contourIndexLabels===rt&&this.options.contourLabelFont===it&&this.options.contourLabelDistance===at||this._drawContours():setTimeout((function(){return o(n,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this._smoothContourInput()];case 1:return t.sent(),this._calculateAndDrawContours(),[2]}}))}))}),50):this.options.contourType!==U&&"none"===this.options.contourType&&(this._clearContours(),this._contourData.mergedTileArray=void 0)},a.prototype.getEvents=function(){var e=this,o=this.options,r=gn({click:o.onclick,dblclick:o.ondblclick,mousedown:o.onmousedown,mouseup:o.onmouseup,mouseover:o.onmouseover,mouseout:o.onmouseout,mousemove:o.onmousemove,contextmenu:o.oncontextmenu},(function(t){return!(void 0===t)}));return n(n({},t.GridLayer.prototype.getEvents.call(this)),function(t,e){var n={};return e=rn(e),sn(t,(function(t,o,r){tt(n,o,e(t,o,r))})),n}(r,(function(t){return t&&e._wrapMouseEventHandler(t)})))},a.prototype.getTileUrl=function(e,n){var o={r:t.Browser.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-e.y;this.options.tms&&(o.y=r),o["-y"]=r}return t.Util.template(n,t.Util.extend(o,this.options))},a.prototype.redraw=function(){return this._map&&(this.options.debug&&console.log("redraw() called"),this._removeAllTiles(),this._update()),this},a.prototype.createTile=function(e,n){var o=this,r=this.options,i=r.extraPixelLayers,a=r.tileSize,l=r.url,s=r.hsPregenUrl,f=r.operationUrlA,u=r.operationUrlB,c=r.operationUrlC,h=r.operationUrlD,d=r.operationUrlE,p=r.operationUrlF,g=r.filterLowA,m=r.filterHighA,b=r.filterLowB,x=r.filterHighB,v=r.filterLowC,y=r.filterHighC,w=r.filterLowD,_=r.filterHighD,C=r.filterLowE,A=r.filterHighE,T=r.filterLowF,L=r.filterHighF,E=r.multiplierA,B=r.multiplierB,D=r.multiplierC,F=r.multiplierD,I=r.multiplierE,S=r.multiplierF;this.options.debug&&console.log("createTile");var R=t.DomUtil.create("canvas");return Object.assign(R,{className:"gl-tilelayer-tile",width:a,height:a}),"none"===this.options.glOperation?(1===i&&this._fetchTileData(e,f).then((function(t){o.options.debug&&console.log("createTile - extraPixelLayers === 1"),R.pixelDataA=t})),"pregen"===this.options._hillshadeOptions.hillshadeType?Promise.all([this._fetchTileData(e,l),this._fetchTileData(e,s)]).then((function(t){o.options.debug&&console.log("_fetchTileData with pregen hs");var r=t[0],i=t[1],a=o._renderer.renderTileHsPregen({coords:e,pixelData:r},{coords:e,pixelData:i},o.options._hillshadeOptions),l=a[0],s=a[1];R.pixelData=r,R.pixelDataHsPregen=i,o._copyToTileCanvas(R,l,s),n(void 0,R)})):this._fetchTileData(e,l).then((function(t){o.options.debug&&console.log("_fetchTileData with no operation");var r=o._renderer.renderTile({coords:e,pixelData:t},o.options._hillshadeOptions,o._getZoomForUrl()),i=r[0],a=r[1];R.pixelData=t,o._copyToTileCanvas(R,i,a),n(void 0,R)}))):"diff"===this.options.glOperation?Promise.all([this._fetchTileData(e,f),this._fetchTileData(e,u)]).then((function(t){o.options.debug&&console.log("_fetchTileData with diff");var r=t[0],i=t[1],a=o._renderer.renderTileDiff({coords:e,pixelData:r},{coords:e,pixelData:i}),l=a[0],s=a[1],f=a[2];R.pixelData=f,R.pixelDataA=r,R.pixelDataB=i,o._copyToTileCanvas(R,l,s),n(void 0,R)})):"multi"===this.options.glOperation&&1===this.options.multiLayers?Promise.all([this._fetchTileData(e,f)]).then((function(t){o.options.debug&&console.log("_fetchTileData with multi");var r=t[0],i=o._renderer.renderTileMulti1({coords:e,pixelData:r},g,m,E),a=i[0],l=i[1],s=i[2];R.pixelData=s,R.pixelDataA=r,o._copyToTileCanvas(R,a,l),n(void 0,R)})):"multi"===this.options.glOperation&&2===this.options.multiLayers?Promise.all([this._fetchTileData(e,f),this._fetchTileData(e,u)]).then((function(t){o.options.debug&&console.log("_fetchTileData with multi");var r=t[0],i=t[1],a=o._renderer.renderTileMulti2({coords:e,pixelData:r},{coords:e,pixelData:i},g,m,b,x,E,B),l=a[0],s=a[1],f=a[2];R.pixelData=f,R.pixelDataA=r,R.pixelDataB=i,o._copyToTileCanvas(R,l,s),n(void 0,R)})):"multi"===this.options.glOperation&&3===this.options.multiLayers?Promise.all([this._fetchTileData(e,f),this._fetchTileData(e,u),this._fetchTileData(e,c)]).then((function(t){o.options.debug&&console.log("_fetchTileData with multi");var r=t[0],i=t[1],a=t[2],l=o._renderer.renderTileMulti3({coords:e,pixelData:r},{coords:e,pixelData:i},{coords:e,pixelData:a},g,m,b,x,v,y,E,B,D),s=l[0],f=l[1],u=l[2];R.pixelData=u,R.pixelDataA=r,R.pixelDataB=i,R.pixelDataC=a,o._copyToTileCanvas(R,s,f),n(void 0,R)})):"multi"===this.options.glOperation&&4===this.options.multiLayers?Promise.all([this._fetchTileData(e,f),this._fetchTileData(e,u),this._fetchTileData(e,c),this._fetchTileData(e,h)]).then((function(t){o.options.debug&&console.log("_fetchTileData with multi");var r=t[0],i=t[1],a=t[2],l=t[3],s=o._renderer.renderTileMulti4({coords:e,pixelData:r},{coords:e,pixelData:i},{coords:e,pixelData:a},{coords:e,pixelData:l},g,m,b,x,v,y,w,_,E,B,D,F),f=s[0],u=s[1],c=s[2];R.pixelData=c,R.pixelDataA=r,R.pixelDataB=i,R.pixelDataC=a,R.pixelDataD=l,o._copyToTileCanvas(R,f,u),n(void 0,R)})):"multi"===this.options.glOperation&&5===this.options.multiLayers?Promise.all([this._fetchTileData(e,f),this._fetchTileData(e,u),this._fetchTileData(e,c),this._fetchTileData(e,h),this._fetchTileData(e,d)]).then((function(t){o.options.debug&&console.log("_fetchTileData with multi");var r=t[0],i=t[1],a=t[2],l=t[3],s=t[4],f=o._renderer.renderTileMulti5({coords:e,pixelData:r},{coords:e,pixelData:i},{coords:e,pixelData:a},{coords:e,pixelData:l},{coords:e,pixelData:s},g,m,b,x,v,y,w,_,C,A,E,B,D,F,I),u=f[0],c=f[1],h=f[2];R.pixelData=h,R.pixelDataA=r,R.pixelDataB=i,R.pixelDataC=a,R.pixelDataD=l,R.pixelDataE=s,o._copyToTileCanvas(R,u,c),n(void 0,R)})):"multi"===this.options.glOperation&&6===this.options.multiLayers&&Promise.all([this._fetchTileData(e,f),this._fetchTileData(e,u),this._fetchTileData(e,c),this._fetchTileData(e,h),this._fetchTileData(e,d),this._fetchTileData(e,p)]).then((function(t){o.options.debug&&console.log("_fetchTileData with multi");var r=t[0],i=t[1],a=t[2],l=t[3],s=t[4],f=t[5],u=o._renderer.renderTileMulti6({coords:e,pixelData:r},{coords:e,pixelData:i},{coords:e,pixelData:a},{coords:e,pixelData:l},{coords:e,pixelData:s},{coords:e,pixelData:f},g,m,b,x,v,y,w,_,C,A,T,L,E,B,D,F,I,S),c=u[0],h=u[1],d=u[2];R.pixelData=d,R.pixelDataA=r,R.pixelDataB=i,R.pixelDataC=a,R.pixelDataD=l,R.pixelDataE=s,R.pixelDataF=f,o._copyToTileCanvas(R,c,h),n(void 0,R)})),R},a.prototype._checkColorScaleAndSentinels=function(){var t=this.options,e=t.colorScale,n=t.sentinelValues,o=t.colorscaleMaxLength,r=t.sentinelMaxLength;if(0===e.length&&0===n.length)throw new Error("Either `colorScale` or `sentinelValues` must be of non-zero length.");if(e.length>o)throw new Error("Color scale length "+e.length+" exceeds the maximum, "+o+".");if(n.length>r)throw new Error("Sentinel values length "+n.length+" exceeds the maximum, "+r+".")},a.prototype._getSubdomain=function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},a.prototype._getZoomForUrl=function(){var t=this.options,e=t.maxZoom,n=t.zoomReverse,o=t.zoomOffset,r=this._tileZoom;return(n?e-r:r)+o},a.prototype._onTileRemove=function(e){var n=e.coords,o=e.tile;this.options.debug&&console.log("_onTileRemove()"),t.Browser.android||(o.onload=Z),this._renderer.removeTile(n)},a.prototype._updateTiles=function(){return o(this,void 0,void 0,(function(){var t,e,n,o,i=this;return r(this,(function(r){switch(r.label){case 0:return t=this._getActiveTiles(),[4,this._getTilesData(t)];case 1:return e=r.sent(),this.options.debug&&console.log("_updateTiles() with url "+this.options.url),"pregen"!==this.options._hillshadeOptions.hillshadeType?[3,3]:[4,this._getTilesData(t,this.options.hsPregenUrl)];case 2:return o=r.sent(),n=this._renderer.renderTilesHsPregen(e,o,this.options._hillshadeOptions),[3,4];case 3:n=this._renderer.renderTiles(e,this.options._hillshadeOptions,this._getZoomForUrl()),r.label=4;case 4:return n.forEach((function(n,r){var a=n[0],l=n[1],s=t[r];i._copyToTileCanvas(s.el,a,l),s.el.pixelData=e[r].pixelData,"pregen"===i.options._hillshadeOptions.hillshadeType&&(s.el.pixelDataHsPregen=o[r].pixelData)})),[2]}}))}))},a.prototype._updateTilesColorscaleOnly=function(){return o(this,void 0,void 0,(function(){var t,e,n,o=this;return r(this,(function(r){return this.options.debug&&console.log("_updateTilesColorscaleOnly()"),t=this._getActiveTiles(),"pregen"===this.options._hillshadeOptions.hillshadeType?(n=t.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),e=t.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataHsPregen}})),this._renderer.renderTilesHsPregen(n,e,this.options._hillshadeOptions).forEach((function(e,n){var r=e[0],i=e[1],a=t[n];o._copyToTileCanvas(a.el,r,i)}))):(n=t.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(n,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,n){var r=e[0],i=e[1],a=t[n];o._copyToTileCanvas(a.el,r,i)}))),[2]}))}))},a.prototype._updateTilesWithTransitions=function(t,e){return o(this,void 0,void 0,(function(){var n,o,i,a,l,s,f,u,c,h=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithTransitions()"),n=this._getActiveTiles(),o=n.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),[4,this._getTilesData(n)];case 1:return i=r.sent(),n.forEach((function(t,e){t.el.pixelData=i[e].pixelData})),a=this.options,l=a.colorScale,s=a.sentinelValues,f=void 0===s?[]:s,u=a.transitionTimeMs,c=function(t){t.forEach((function(t,e){var o=t[0],r=t[1],i=n[e];h._copyToTileCanvas(i.el,o,r)}))},JSON.stringify(l)===JSON.stringify(t)&&JSON.stringify(f)===JSON.stringify(e)?this._renderer.renderTilesWithTransition(o,i,u,c):this._renderer.renderTilesWithTransitionAndNewColorScale(o,i,u,c),[2]}}))}))},a.prototype._updateColorscaleWithTransitions=function(t,e){return o(this,void 0,void 0,(function(){var n,o,i,a,l,s,f,u,c=this;return r(this,(function(r){return this.options.debug&&console.log("_updateColorscaleWithTransitions()"),n=this._getActiveTiles(),o=n.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),i=this.options,a=i.colorScale,l=i.sentinelValues,s=void 0===l?[]:l,f=i.transitionTimeMs,u=function(t){t.forEach((function(t,e){var o=t[0],r=t[1],i=n[e];c._copyToTileCanvas(i.el,o,r)}))},JSON.stringify(a)===JSON.stringify(t)&&JSON.stringify(s)===JSON.stringify(e)||this._renderer.renderTilesWithTransitionAndNewColorScaleOnly(o,f,u),[2]}))}))},a.prototype._updateTilesWithDiff=function(t,e,n){return o(this,void 0,void 0,(function(){var o,i,a,l,s,f=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithDiff()"),o=this._getActiveTiles(),i=[],a=[],this.options.glOperation!==t||this.options.operationUrlA!==e||this.options.operationUrlB!==n?[3,1]:(this.options.debug&&console.log("_updateTilesWithDiff: both same url. Getting data from existing result"),i=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),[3,7]);case 1:return this.options.operationUrlA===e?[3,3]:(this.options.debug&&console.log("_updateTilesWithDiff: new A url. Downloading new tiles"),[4,this._getTilesData(o,this.options.operationUrlA)]);case 2:return i=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=i[e].pixelData})),[3,4];case 3:this.options.debug&&console.log("_updateTilesWithDiff: same A url. Getting data from existing tiles"),i=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),r.label=4;case 4:return this.options.operationUrlB===n?[3,6]:(this.options.debug&&console.log("_updateTilesWithDiff: new B url. Downloading new tiles"),[4,this._getTilesData(o,this.options.operationUrlB)]);case 5:return a=r.sent(),o.forEach((function(t,e){t.el.pixelDataB=a[e].pixelData})),[3,7];case 6:this.options.debug&&console.log("_updateTilesWithDiff: same B url. Getting data from existing tiles"),a=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),r.label=7;case 7:return this.options.glOperation===t&&this.options.operationUrlA===e&&this.options.operationUrlB===n?(this.options.debug&&console.log("_updateTilesWithDiff: both same urls. Running renderTiles()"),this._renderer.renderTiles(i,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],r=t[1],i=o[e];f._copyToTileCanvas(i.el,n,r)}))):(this.options.debug&&console.log("_updateTilesWithDiff: not same urls. Running renderTilesWithDiff()"),l=function(t){t.forEach((function(t,e){var n=t[0],r=t[1],i=o[e];f._copyToTileCanvas(i.el,n,r)}))},s=this._renderer.renderTilesWithDiff(i,a,l),o.forEach((function(t,e){t.el.pixelData=s[e]}))),[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze1=function(t,e,n,i,a,l){return o(this,void 0,void 0,(function(){var o,s,f,u,c,h=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze1()"),o=this._getActiveTiles(),this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.filterLowA!==i||this.options.filterHighA!==a||this.options.multiplierA!==l||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze1: all same urls. Fetching from existing tiles. Running renderTiles()"),s=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(s,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],r=t[1],i=o[e];h._copyToTileCanvas(i.el,n,r)})),[3,5]);case 1:return f=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(o,this.options.operationUrlA)];case 2:return f=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=f[e].pixelData})),[3,4];case 3:f=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),r.label=4;case 4:u=function(t){t.forEach((function(t,e){var n=t[0],r=t[1],i=o[e];h._copyToTileCanvas(i.el,n,r)}))},c=this._renderer.renderTilesWithMultiAnalyze1(f,this.options.filterLowA,this.options.filterHighA,this.options.multiplierA,u),o.forEach((function(t,e){t.el.pixelData=c[e]})),r.label=5;case 5:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze2=function(t,e,n,i,a,l,s,f,u,c){return o(this,void 0,void 0,(function(){var o,h,d,p,g,m,b=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze2()"),o=this._getActiveTiles(),this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.filterLowA!==a||this.options.filterHighA!==l||this.options.filterLowB!==s||this.options.filterHighB!==f||this.options.multiplierA!==u||this.options.multiplierB!==c||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze2: all same urls. Fetching from existing tiles. Running renderTiles()"),h=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(h,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],r=t[1],i=o[e];b._copyToTileCanvas(i.el,n,r)})),[3,8]);case 1:return d=[],p=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(o,this.options.operationUrlA)];case 2:return d=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=d[e].pixelData})),[3,4];case 3:d=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),r.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(o,this.options.operationUrlB)];case 5:return p=r.sent(),o.forEach((function(t,e){t.el.pixelDataB=p[e].pixelData})),[3,7];case 6:p=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),r.label=7;case 7:g=function(t){t.forEach((function(t,e){var n=t[0],r=t[1],i=o[e];b._copyToTileCanvas(i.el,n,r)}))},m=this._renderer.renderTilesWithMultiAnalyze2(d,p,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.multiplierA,this.options.multiplierB,g),o.forEach((function(t,e){t.el.pixelData=m[e]})),r.label=8;case 8:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze3=function(t,e,n,i,a,l,s,f,u,c,h,d,p,g){return o(this,void 0,void 0,(function(){var o,m,b,x,v,y,w,_=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze3()"),o=this._getActiveTiles(),this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.filterLowA!==l||this.options.filterHighA!==s||this.options.filterLowB!==f||this.options.filterHighB!==u||this.options.filterLowC!==c||this.options.filterHighC!==h||this.options.multiplierA!==d||this.options.multiplierB!==p||this.options.multiplierC!==g||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze3: all same urls. Fetching from existing tiles. Running renderTiles()"),m=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(m,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],r=t[1],i=o[e];_._copyToTileCanvas(i.el,n,r)})),[3,11]);case 1:return b=[],x=[],v=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(o,this.options.operationUrlA)];case 2:return b=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=b[e].pixelData})),[3,4];case 3:b=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),r.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(o,this.options.operationUrlB)];case 5:return x=r.sent(),o.forEach((function(t,e){t.el.pixelDataB=x[e].pixelData})),[3,7];case 6:x=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),r.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(o,this.options.operationUrlC)];case 8:return v=r.sent(),o.forEach((function(t,e){t.el.pixelDataC=v[e].pixelData})),[3,10];case 9:v=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),r.label=10;case 10:y=function(t){t.forEach((function(t,e){var n=t[0],r=t[1],i=o[e];_._copyToTileCanvas(i.el,n,r)}))},w=this._renderer.renderTilesWithMultiAnalyze3(b,x,v,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,y),o.forEach((function(t,e){t.el.pixelData=w[e]})),r.label=11;case 11:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze4=function(t,e,n,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v){return o(this,void 0,void 0,(function(){var o,y,w,_,C,A,T,L,E=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze4()"),o=this._getActiveTiles(),this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.filterLowA!==s||this.options.filterHighA!==f||this.options.filterLowB!==u||this.options.filterHighB!==c||this.options.filterLowC!==h||this.options.filterHighC!==d||this.options.filterLowD!==p||this.options.filterHighD!==g||this.options.multiplierA!==m||this.options.multiplierB!==b||this.options.multiplierC!==x||this.options.multiplierD!==v||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze4: all same urls. Fetching from existing tiles. Running renderTiles()"),y=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(y,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],r=t[1],i=o[e];E._copyToTileCanvas(i.el,n,r)})),[3,14]);case 1:return w=[],_=[],C=[],A=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(o,this.options.operationUrlA)];case 2:return w=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=w[e].pixelData})),[3,4];case 3:w=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),r.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(o,this.options.operationUrlB)];case 5:return _=r.sent(),o.forEach((function(t,e){t.el.pixelDataB=_[e].pixelData})),[3,7];case 6:_=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),r.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(o,this.options.operationUrlC)];case 8:return C=r.sent(),o.forEach((function(t,e){t.el.pixelDataC=C[e].pixelData})),[3,10];case 9:C=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),r.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(o,this.options.operationUrlD)];case 11:return A=r.sent(),o.forEach((function(t,e){t.el.pixelDataD=A[e].pixelData})),[3,13];case 12:A=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataD}})),r.label=13;case 13:T=function(t){t.forEach((function(t,e){var n=t[0],r=t[1],i=o[e];E._copyToTileCanvas(i.el,n,r)}))},L=this._renderer.renderTilesWithMultiAnalyze4(w,_,C,A,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,T),o.forEach((function(t,e){t.el.pixelData=L[e]})),r.label=14;case 14:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze5=function(t,e,n,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y,w,_,C){return o(this,void 0,void 0,(function(){var o,A,T,L,E,B,D,F,I,S=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze5()"),o=this._getActiveTiles(),this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.operationUrlE!==s||this.options.filterLowA!==f||this.options.filterHighA!==u||this.options.filterLowB!==c||this.options.filterHighB!==h||this.options.filterLowC!==d||this.options.filterHighC!==p||this.options.filterLowD!==g||this.options.filterHighD!==m||this.options.filterLowE!==b||this.options.filterHighE!==x||this.options.multiplierA!==v||this.options.multiplierB!==y||this.options.multiplierC!==w||this.options.multiplierD!==_||this.options.multiplierE!==C||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze5: all same urls. Fetching from existing tiles. Running renderTiles()"),A=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(A,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],r=t[1],i=o[e];S._copyToTileCanvas(i.el,n,r)})),[3,17]);case 1:return T=[],L=[],E=[],B=[],D=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(o,this.options.operationUrlA)];case 2:return T=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=T[e].pixelData})),[3,4];case 3:T=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),r.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(o,this.options.operationUrlB)];case 5:return L=r.sent(),o.forEach((function(t,e){t.el.pixelDataB=L[e].pixelData})),[3,7];case 6:L=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),r.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(o,this.options.operationUrlC)];case 8:return E=r.sent(),o.forEach((function(t,e){t.el.pixelDataC=E[e].pixelData})),[3,10];case 9:E=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),r.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(o,this.options.operationUrlD)];case 11:return B=r.sent(),o.forEach((function(t,e){t.el.pixelDataD=B[e].pixelData})),[3,13];case 12:B=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataD}})),r.label=13;case 13:return this.options.operationUrlE===s?[3,15]:[4,this._getTilesData(o,this.options.operationUrlE)];case 14:return D=r.sent(),o.forEach((function(t,e){t.el.pixelDataE=D[e].pixelData})),[3,16];case 15:D=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataE}})),r.label=16;case 16:F=function(t){t.forEach((function(t,e){var n=t[0],r=t[1],i=o[e];S._copyToTileCanvas(i.el,n,r)}))},I=this._renderer.renderTilesWithMultiAnalyze5(T,L,E,B,D,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.filterLowE,this.options.filterHighE,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,this.options.multiplierE,F),o.forEach((function(t,e){t.el.pixelData=I[e]})),r.label=17;case 17:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze6=function(t,e,n,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y,w,_,C,A,T,L,E){return o(this,void 0,void 0,(function(){var o,B,D,F,I,S,R,O,k,N,M=this;return r(this,(function(r){switch(r.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze6()"),o=this._getActiveTiles(),this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.operationUrlE!==s||this.options.operationUrlF!==f||this.options.filterLowA!==u||this.options.filterHighA!==c||this.options.filterLowB!==h||this.options.filterHighB!==d||this.options.filterLowC!==p||this.options.filterHighC!==g||this.options.filterLowD!==m||this.options.filterHighD!==b||this.options.filterLowE!==x||this.options.filterHighE!==v||this.options.filterLowF!==y||this.options.filterHighF!==w||this.options.multiplierA!==_||this.options.multiplierB!==C||this.options.multiplierC!==A||this.options.multiplierD!==T||this.options.multiplierE!==L||this.options.multiplierF!==E||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze6: all same urls. Fetching from existing tiles. Running renderTiles()"),B=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(B,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],r=t[1],i=o[e];M._copyToTileCanvas(i.el,n,r)})),[3,20]);case 1:return D=[],F=[],I=[],S=[],R=[],O=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(o,this.options.operationUrlA)];case 2:return D=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=D[e].pixelData})),[3,4];case 3:D=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),r.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(o,this.options.operationUrlB)];case 5:return F=r.sent(),o.forEach((function(t,e){t.el.pixelDataB=F[e].pixelData})),[3,7];case 6:F=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),r.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(o,this.options.operationUrlC)];case 8:return I=r.sent(),o.forEach((function(t,e){t.el.pixelDataC=I[e].pixelData})),[3,10];case 9:I=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),r.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(o,this.options.operationUrlD)];case 11:return S=r.sent(),o.forEach((function(t,e){t.el.pixelDataD=S[e].pixelData})),[3,13];case 12:S=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataD}})),r.label=13;case 13:return this.options.operationUrlE===s?[3,15]:[4,this._getTilesData(o,this.options.operationUrlE)];case 14:return R=r.sent(),o.forEach((function(t,e){t.el.pixelDataE=R[e].pixelData})),[3,16];case 15:R=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataE}})),r.label=16;case 16:return this.options.operationUrlF===f?[3,18]:[4,this._getTilesData(o,this.options.operationUrlF)];case 17:return O=r.sent(),o.forEach((function(t,e){t.el.pixelDataF=O[e].pixelData})),[3,19];case 18:O=o.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataF}})),r.label=19;case 19:k=function(t){t.forEach((function(t,e){var n=t[0],r=t[1],i=o[e];M._copyToTileCanvas(i.el,n,r)}))},N=this._renderer.renderTilesWithMultiAnalyze6(D,F,I,S,R,O,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.filterLowE,this.options.filterHighE,this.options.filterLowF,this.options.filterHighF,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,this.options.multiplierE,this.options.multiplierF,k),o.forEach((function(t,e){t.el.pixelData=N[e]})),r.label=20;case 20:return[2]}}))}))},a.prototype._maybePreload=function(t){!t||this._preloadTileCache&&this._preloadTileCache.url===t||this._preloadTiles(t)},a.prototype._maybeLoadExtraLayers=function(t,e,n,i){return o(this,void 0,void 0,(function(){var o,a,l,s,f;return r(this,(function(r){switch(r.label){case 0:return o=[],this.options.extraPixelLayers>=1?(o=this._getActiveTiles(),t===this.options.operationUrlA?[3,2]:[4,this._getTilesData(o,this.options.operationUrlA)]):[3,2];case 1:a=r.sent(),o.forEach((function(t,e){t.el.pixelDataA=a[e].pixelData})),r.label=2;case 2:return this.options.extraPixelLayers>=2?e===this.options.operationUrlB?[3,4]:[4,this._getTilesData(o,this.options.operationUrlB)]:[3,4];case 3:l=r.sent(),o.forEach((function(t,e){t.el.pixelDataB=l[e].pixelData})),r.label=4;case 4:return this.options.extraPixelLayers>=3?n===this.options.operationUrlC?[3,6]:[4,this._getTilesData(o,this.options.operationUrlC)]:[3,6];case 5:s=r.sent(),o.forEach((function(t,e){t.el.pixelDataC=s[e].pixelData})),r.label=6;case 6:return this.options.extraPixelLayers>=4?i===this.options.operationUrlD?[3,8]:[4,this._getTilesData(o,this.options.operationUrlD)]:[3,8];case 7:f=r.sent(),o.forEach((function(t,e){t.el.pixelDataD=f[e].pixelData})),r.label=8;case 8:return[2]}}))}))},a.prototype._preloadTiles=function(t){return o(this,void 0,void 0,(function(){var e,n;return r(this,(function(o){switch(o.label){case 0:return e=this._getActiveTiles(),[4,this._fetchTilesData(e,t)];case 1:return n=o.sent(),this._preloadTileCache={url:t,tiles:n},[2]}}))}))},a.prototype._getActiveTiles=function(){return this.options.debug&&console.log("_getActiveTiles()"),this._pruneTiles(),hn(this._tiles).sort((function(t,e){return Pr(t.coords,e.coords)}))},a.prototype._getTilesData=function(t,e){return void 0===e&&(e=this.options.url),o(this,void 0,void 0,(function(){var n;return r(this,(function(o){return this.options.debug&&console.log("_getTilesData() with url: "+e),(n=this._preloadTileCache)&&e===n.url&&(r=n.tiles.map((function(t){return t.coords})),i=t.map((function(t){return t.coords})),r.length===i.length&&r.every((function(t,e){return 0===Pr(t,i[e])})))?(this._preloadTileCache=void 0,[2,Promise.resolve(n.tiles)]):[2,this._fetchTilesData(t,e)];var r,i}))}))},a.prototype._fetchTilesData=function(t,e){return o(this,void 0,void 0,(function(){var n,o=this;return r(this,(function(r){switch(r.label){case 0:return[4,Promise.all(t.map((function(t){var n=t.coords;return o._fetchTileData(n,e)})))];case 1:return n=r.sent(),this.options.debug&&console.log("_fetchTilesData() with url:"+e),this.fire("load",{url:e}),[2,xn(t,n,(function(t,e){return{coords:t.coords,pixelData:e}}))]}}))}))},a.prototype._fetchTileData=function(t,e){return function(t,e,n){return o(this,void 0,void 0,(function(){return r(this,(function(o){return[2,new Promise((function(e,n){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.addEventListener("load",(function(){e(o.response)})),o.addEventListener("error",n),o.send(null)})).then((function(t){return new Uint8Array(kr.decode(t).data)})).catch((function(){return Vr(e,n)}))]}))}))}(this.getTileUrl(t,e),this.options.nodataValue,this._tileSizeAsNumber())},a.prototype._tileSizeAsNumber=function(){var t=this.options.tileSize;return"number"==typeof t?t:t.x},a.prototype._copyToTileCanvas=function(t,e,n){this.options.debug&&console.log("_copyToTileCanvas()");var o=this._tileSizeAsNumber(),r=t.getContext("2d");if(null===r)throw new Error("Tile canvas 2D context is null.");r.clearRect(0,0,o,o),r.drawImage(this._renderer.canvas,e,n,o,o,0,0,o,o)},a.prototype._getActivetilesBounds=function(){return o(this,void 0,void 0,(function(){var t,e,n,o,i;return r(this,(function(r){return t=this._getActiveTiles(),e=t[0].coords.x,n=t[0].coords.x,o=t[0].coords.y,i=t[0].coords.y,t.forEach((function(t){t.coords.x>n&&(n=t.coords.x),t.coords.x<e&&(e=t.coords.x),t.coords.y>i&&(i=t.coords.y),t.coords.y<o&&(o=t.coords.y)})),[2,{xMin:e,xMax:n,yMin:o,yMax:i,xTiles:n-e+1,yTiles:i-o+1}]}))}))},a.prototype._mergePixelData=function(t,e){return o(this,void 0,void 0,(function(){var n,o,i,a,l,s,f,u,c,h,d,p,g,m,b,x,v,y;return r(this,(function(r){for(this.options.debug&&console.log("_mergePixelData()"),n=this._tileZoom,o=document.createElement("canvas"),this._contourData.width=t.xTiles*e,this._contourData.height=t.yTiles*e,o.width=this._contourData.width,o.height=this._contourData.height,i=o.getContext("2d"),a=Vr(this.options.nodataValue,e),l=0;l<=t.xTiles;l++)for(s=t.xMin+l,f=0;f<=t.yTiles;f++){u=t.yMin+f,c=void 0;try{h=this._tiles[s+":"+u+":"+n].el,c=h.pixelData}catch(t){c=a}d=new Uint8ClampedArray(c),p=new Uint8ClampedArray(d.buffer,0,4*e*e),g=new ImageData(p,e,e),i.putImageData(g,l*e,f*e)}return m=i.getImageData(0,0,t.xTiles*e,t.yTiles*e),b=(b=new Float32Array(m.data.buffer)).map((function(t){return t<-9e5&&(t=NaN),t}),this),x=Array.from(b),v=function(t){return t.reduce((function(t,e){return(isNaN(t)?0:t)+(isNaN(e)?0:e)}),0)},this.options.debug&&(console.log("sum mergedPixelArray"),console.log(v(x))),this.options.contourCanvas?((y=this.options.contourCanvas).width=this._contourData.width,y.height=this._contourData.height,this._contourData.mergedTileArray=x,this._contourData.smoothedTileArray=void 0,[2]):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._maybeUpdateMergedArrayAndDrawContours=function(){return o(this,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return"none"===this.options.contourType?[2]:(this._map.fire("contourDrawing",{status:!0}),this.options.debug&&console.log("_maybeUpdateMergedArrayAndDrawContours()"),[4,this._clearContours()]);case 1:return e.sent(),setTimeout((function(){return o(t,void 0,void 0,(function(){var t,e;return r(this,(function(n){switch(n.label){case 0:return[4,this._getActivetilesBounds()];case 1:return t=n.sent(),e=this._tileSizeAsNumber(),[4,this._mergePixelData(t,e)];case 2:return n.sent(),this.options.contourSmoothInput?[4,this._smoothContourInput()]:[3,4];case 3:n.sent(),n.label=4;case 4:return[4,this._calculateAndDrawContours()];case 5:return n.sent(),[4,this._moveContourCanvas(t)];case 6:return n.sent(),[2]}}))}))}),50),[2]}}))}))},a.prototype._smoothContourInput=function(){return o(this,void 0,void 0,(function(){var t,e,n,o,i,a,l;return r(this,(function(r){for(this.options.debug&&console.log("_smoothContourInput()"),t=this._contourData.mergedTileArray,e=t.map((function(t){return isNaN(t)&&(t=this.options.nodataValue),t}),this),n=new Uint8Array(Float32Array.from(e).buffer),o=this._renderer.renderConvolutionSmooth(n,this._contourData.width,this._contourData.height,this.options.contourSmoothInputKernel),i=[],a=0;a<o.length;a+=1)(l=o[a])===this.options.nodataValue&&(l=NaN),i.push(l);return this._contourData.smoothedTileArray=i,[2]}))}))},a.prototype._calculateAndDrawContours=function(){return o(this,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return"none"===this.options.contourType?[2]:(this._map.fire("contourDrawing",{status:!0}),this.options.debug&&console.log("_calculateAndDrawContours()"),[4,this._clearContours()]);case 1:return e.sent(),[4,this._calculateContours()];case 2:return e.sent(),setTimeout((function(){t._drawContours()}),50),[2]}}))}))},a.prototype._addlabel=function(t,e,n,o){t.save(),t.translate(e.xy[0],e.xy[1]),t.rotate(e.angle+(Math.cos(e.angle)<0?Math.PI:0)),t.textAlign="center",t.fillStyle=n,t.font=o,t.fillText(e.text,-1,4),t.restore()},a.prototype._calculateContours=function(){return o(this,void 0,void 0,(function(){var t,e,n,o,i,a,l,s=this;return r(this,(function(r){for(this.options.debug&&console.log("_calculateContours()"),t=this.options.contourSmoothInput?this._contourData.smoothedTileArray:this._contourData.mergedTileArray,1!==this.options.contourScaleFactor&&(t=t.map((function(t){return t*s.options.contourScaleFactor}))),this.options.debug&&(console.log("valuesArray"),console.log(t)),e=Fu.max(t,(function(t){return t!==s.options.nodataValue?t:NaN})),n=Fu.min(t,(function(t){return t!==s.options.nodataValue?t:NaN})),e=Math.ceil(e/this.options.contourInterval)*this.options.contourInterval,n=Math.floor(n/this.options.contourInterval)*this.options.contourInterval,this.options.debug&&(console.log("Contours: max"),console.log(e)),this.options.debug&&(console.log("Contours: min"),console.log(n)),o=[],i=n;i<=e;i+=this.options.contourInterval)o.push(i);return this.options.debug&&(console.log("Contour thresholds"),console.log(o)),(a=Fu.contours().size([this._contourData.width,this._contourData.height])).thresholds(o),a.smooth(this.options.contourSmoothLines),l=a(t),this._contourData.contoursGeoData=l,this.options.debug&&(console.log("contoursGeoData"),console.log(l)),[2]}))}))},a.prototype._clearContours=function(){return o(this,void 0,void 0,(function(){var t,e;return r(this,(function(n){return this.options.debug&&console.log("_clearContours()"),this.options.contourCanvas?(t=this.options.contourCanvas,(e=t.getContext("2d")).setTransform(1,0,0,1,0,0),e.clearRect(0,0,this._contourData.width,this._contourData.height),e.beginPath(),[2]):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._moveContourCanvas=function(e){return o(this,void 0,void 0,(function(){var n,o,i,a,l,s;return r(this,(function(r){return this.options.debug&&console.log("_moveContourCanvas()"),this.options.contourCanvas?(n=this.options.contourCanvas,this.options.contourPane?(o=this.options.contourPane,i=this._map.getZoomScale(this._map.getZoom(),this._level.zoom),a=this._map.getPixelOrigin(),l=this._level.origin.multiplyBy(i).subtract(a),s=this._getTilePos(this._keyToTileCoords(e.xMin+":"+e.yMin+":"+this._level.zoom)),t.DomUtil.setTransform(o,l,i),t.DomUtil.setTransform(n,s),[2]):(console.log("Error: contourPane not specified."),[2])):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._drawContours=function(){return o(this,void 0,void 0,(function(){var t,e,n,o,i,a,l,s,f,u,c,h,d,p,g,m,b=this;return r(this,(function(r){if(this.options.debug&&console.log("_drawContours()"),t=this._contourData.width,e=this._contourData.height,!this.options.contourCanvas)return console.log("Error: contourCanvas not specified."),[2];if(n=this.options.contourCanvas,o=n.getContext("2d"),i=Fu.geoPath().context(o),a=Fu.scaleLinear().domain(this.options.contourBathyDomain).range(this.options.contourBathyColors),l=Fu.scaleLinear().domain(this.options.contourHypsoDomain).range(this.options.contourHypsoColors).interpolate(Fu.interpolateHcl),s=this._contourData.contoursGeoData,f=this.options.contourIndexInterval,u=this.options.contourBathyDomain[this.options.contourBathyDomain.length-1],o.clearRect(0,0,t,e),o.save(),"lines"==this.options.contourType){if(o.lineWidth=this.options.contourLineWeight,o.strokeStyle=this.options.contourLineColor,this.options.contourHypso||this.options.contourBathy?s.forEach((function(t){var e;o.beginPath(),t.value>=u||!this.options.contourBathy?this.options.contourHypso&&(e=l(t.value)):this.options.contourBathy&&(e=a(t.value)),i(t),e&&(o.fillStyle=e,o.fill()),o.stroke()}),this):(o.beginPath(),s.forEach((function(t){0!=f&&t.value%f==0||i(t)})),o.stroke()),0!=this.options.contourIndexInterval)if(this.options.contourIndexLabels)for(c=[],h=function(n){var r=n.value;n.value%d.options.contourIndexInterval==0&&n.coordinates.forEach((function(o){return o.forEach((function(o,i){var a=o.slice(1,1/0),l=Fu.range(b.options.contourLabelDistance,1.4*b.options.contourLabelDistance),s=l.map((function(t){return-(a.length-1)%t})),f=l[Fu.scan(s)],u=1+Fu.scan(a.map((function(t){return(0===i?-1:1)*t[1]})))%f;a.forEach((function(o,i){if(i%f===u&&o[0]>10&&o[0]<t-10&&o[1]>10&&o[1]<e-10){var l=(i-2+a.length)%a.length,s=(i+2)%a.length,h=a[s][0]-a[l][0],d=a[s][1]-a[l][1];if(0===h&&0===d)return;c.push({threshold:r,xy:o.map((function(t){return 1*t})),angle:Math.atan2(d,h),text:""+n.value})}}))}),b)}),d),o.save(),o.beginPath(),o.moveTo(0,0),o.lineTo(t,0),o.lineTo(t,e),o.lineTo(0,e),o.lineTo(0,0);for(var a=0,l=c;a<l.length;a++)for(var s=l[a],f=0;f<2*Math.PI;f+=.2){var u=[20*Math.cos(f),10*-Math.sin(f)],h=Math.cos(s.angle),p=Math.sin(s.angle);o[0===f?"moveTo":"lineTo"](s.xy[0]+u[0]*h-u[1]*p,s.xy[1]+u[1]*h+u[0]*p)}o.clip(),n.value%d.options.contourIndexInterval==0&&(o.beginPath(),o.strokeStyle=d.options.contourLineColor,o.lineWidth=d.options.contourLineIndexWeight,i(n),o.stroke()),o.restore();for(var g=0,m=c;g<m.length;g++){s=m[g];d._addlabel(o,s,d.options.contourLineColor,d.options.contourLabelFont)}},d=this,p=0,g=s;p<g.length;p++)m=g[p],h(m);else o.lineWidth=this.options.contourLineIndexWeight,o.beginPath(),s.forEach((function(t){t.value%f==0&&i(t)})),o.stroke()}else"illuminated"==this.options.contourType&&(o.lineWidth=this.options.contourIlluminatedShadowSize+1,o.shadowBlur=this.options.contourIlluminatedShadowSize,o.shadowOffsetX=this.options.contourIlluminatedShadowSize,o.shadowOffsetY=this.options.contourIlluminatedShadowSize,s.forEach((function(t){o.beginPath(),t.value>=u||!this.options.contourBathy?(o.shadowColor=this.options.contourIlluminatedShadowColor,o.strokeStyle=this.options.contourIlluminatedHighlightColor,this.options.contourHypso&&(o.fillStyle=l(t.value))):(o.shadowColor=this.options.contourBathyShadowColor,o.strokeStyle=this.options.contourBathyHighlightColor,this.options.contourBathy&&(o.fillStyle=a(t.value))),i(t),o.stroke(),(this.options.contourHypso||this.options.contourBathy)&&o.fill()}),this));return o.restore(),this._map.fire("contourDrawing",{status:!1}),[2]}))}))},a.prototype._wrapMouseEventHandler=function(t){var e=this;return function(o){var r=o.latlng,i=e._map.project(r,e._tileZoom).floor(),a=e._getTileContainingPoint(i),l=a&&e._getCoordsInTile(a,i),s=void 0;void 0!==l&&(s=4*(l.y*e._tileSizeAsNumber()+l.x));var f={};if(void 0===s)f.pixelValue=void 0;else{var u=a.el.pixelData;f.pixelValue=l&&e._getPixelValue(u,s)}if(void 0!==s&&e.options.extraPixelLayers>=1){var c=a.el.pixelDataA;f.pixelValueA=l&&e._getPixelValue(c,s)}if(void 0!==s&&e.options.extraPixelLayers>=2){var h=a.el.pixelDataB;f.pixelValueB=l&&e._getPixelValue(h,s)}if(void 0!==s&&e.options.extraPixelLayers>=3){var d=a.el.pixelDataC;f.pixelValueC=l&&e._getPixelValue(d,s)}if(void 0!==s&&e.options.extraPixelLayers>=4){var p=a.el.pixelDataD;f.pixelValueD=l&&e._getPixelValue(p,s)}if(void 0!==s&&e.options.extraPixelLayers>=5){var g=a.el.pixelDataE;f.pixelValueE=l&&e._getPixelValue(g,s)}if(void 0!==s&&e.options.extraPixelLayers>=6){var m=a.el.pixelDataF;f.pixelValueF=l&&e._getPixelValue(m,s)}t(n(n({},o),{pixelValues:f}))}},a.prototype._getTileContainingPoint=function(t){var e=this;return hn(this._tiles).find((function(n){return n.coords.z===e._tileZoom&&e._tileBounds(n).contains(t)}))},a.prototype._tileBounds=function(e){var n=e.coords,o=n.x,r=n.y,i=this._tileSizeAsNumber(),a=t.point(o*i,r*i),l=t.point(a.x+(i-1),a.y+(i-1));return t.bounds(a,l)},a.prototype._getCoordsInTile=function(e,n){var o=e.coords,r=o.x,i=o.y,a=this._tileSizeAsNumber();return t.point(n.x-r*a,n.y-i*a)},a.prototype._getPixelValue=function(t,e){if(t){var n=this.options,o=n.nodataValue,r=n.sentinelValues,i=new DataView(t.buffer).getFloat32(e,Iu);if(i!==o)return r&&r.find((function(t){return t.offset===i}))||i}},a.defaultOptions=Su,a}(t.GridLayer)}(L);
//# sourceMappingURL=bundle.min.js.map
