this.L=this.L||{},this.L.TileLayer=this.L.TileLayer||{},this.L.TileLayer.GLOperations=function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)};var n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function l(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}var i="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,l=i||a||Function("return this")(),s=l.Symbol,u=Object.prototype,f=u.hasOwnProperty,c=u.toString,h=s?s.toStringTag:void 0;var p=Object.prototype.toString;var d=s?s.toStringTag:void 0;function m(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":d&&d in Object(e)?function(e){var t=f.call(e,h),n=e[h];try{e[h]=void 0;var r=!0}catch(e){}var o=c.call(e);return r&&(t?e[h]=n:delete e[h]),o}(e):function(e){return p.call(e)}(e)}function g(e){return null!=e&&"object"==typeof e}function v(e){return"symbol"==typeof e||g(e)&&"[object Symbol]"==m(e)}function b(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}var x=Array.isArray,y=s?s.prototype:void 0,_=y?y.toString:void 0;function w(e){if("string"==typeof e)return e;if(x(e))return b(e,w)+"";if(v(e))return _?_.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function C(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var A=/^\s+|\s+$/g,T=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,D=/^0o[0-7]+$/i,L=parseInt;var S=1/0;function F(e){return e?(e=function(e){if("number"==typeof e)return e;if(v(e))return NaN;if(C(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=C(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(A,"");var n=E.test(e);return n||D.test(e)?L(e.slice(2),n?2:8):T.test(e)?NaN:+e}(e))===S||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function B(e){return e}function k(e){if(!C(e))return!1;var t=m(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var M,O=l["__core-js_shared__"],I=(M=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+M:"";var R=Function.prototype.toString;function N(e){if(null!=e){try{return R.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var z=/^\[object .+?Constructor\]$/,H=Function.prototype,V=Object.prototype,P=H.toString,U=V.hasOwnProperty,j=RegExp("^"+P.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function G(e){return!(!C(e)||(t=e,I&&I in t))&&(k(e)?j:z).test(N(e));var t}function q(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return G(n)?n:void 0}var W=q(l,"WeakMap");function Z(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function X(){}var Y=Date.now;var $=function(){try{var e=q(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),K=function(e){var t=0,n=0;return function(){var r=Y(),o=16-(r-n);if(n=r,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}($?function(e,t){return $(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:B),Q=/^(?:0|[1-9]\d*)$/;function J(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Q.test(e))&&e>-1&&e%1==0&&e<t}function ee(e,t,n){"__proto__"==t&&$?$(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function te(e,t){return e===t||e!=e&&t!=t}var ne=Object.prototype.hasOwnProperty;function re(e,t,n){var r=e[t];ne.call(e,t)&&te(r,n)&&(void 0!==n||t in e)||ee(e,t,n)}var oe=Math.max;function ie(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function ae(e){return null!=e&&ie(e.length)&&!k(e)}var le=Object.prototype;function se(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||le)}function ue(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function fe(e){return g(e)&&"[object Arguments]"==m(e)}var ce=Object.prototype,he=ce.hasOwnProperty,pe=ce.propertyIsEnumerable,de=fe(function(){return arguments}())?fe:function(e){return g(e)&&he.call(e,"callee")&&!pe.call(e,"callee")};var me="object"==typeof exports&&exports&&!exports.nodeType&&exports,ge=me&&"object"==typeof module&&module&&!module.nodeType&&module,ve=ge&&ge.exports===me?l.Buffer:void 0,be=(ve?ve.isBuffer:void 0)||function(){return!1},xe={};xe["[object Float32Array]"]=xe["[object Float64Array]"]=xe["[object Int8Array]"]=xe["[object Int16Array]"]=xe["[object Int32Array]"]=xe["[object Uint8Array]"]=xe["[object Uint8ClampedArray]"]=xe["[object Uint16Array]"]=xe["[object Uint32Array]"]=!0,xe["[object Arguments]"]=xe["[object Array]"]=xe["[object ArrayBuffer]"]=xe["[object Boolean]"]=xe["[object DataView]"]=xe["[object Date]"]=xe["[object Error]"]=xe["[object Function]"]=xe["[object Map]"]=xe["[object Number]"]=xe["[object Object]"]=xe["[object RegExp]"]=xe["[object Set]"]=xe["[object String]"]=xe["[object WeakMap]"]=!1;var ye,_e="object"==typeof exports&&exports&&!exports.nodeType&&exports,we=_e&&"object"==typeof module&&module&&!module.nodeType&&module,Ce=we&&we.exports===_e&&i.process,Ae=function(){try{var e=we&&we.require&&we.require("util").types;return e||Ce&&Ce.binding&&Ce.binding("util")}catch(e){}}(),Te=Ae&&Ae.isTypedArray,Ee=Te?(ye=Te,function(e){return ye(e)}):function(e){return g(e)&&ie(e.length)&&!!xe[m(e)]},De=Object.prototype.hasOwnProperty;function Le(e,t){var n=x(e),r=!n&&de(e),o=!n&&!r&&be(e),i=!n&&!r&&!o&&Ee(e),a=n||r||o||i,l=a?ue(e.length,String):[],s=l.length;for(var u in e)!t&&!De.call(e,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||J(u,s))||l.push(u);return l}function Se(e,t){return function(n){return e(t(n))}}var Fe=Se(Object.keys,Object),Be=Object.prototype.hasOwnProperty;function ke(e){if(!se(e))return Fe(e);var t=[];for(var n in Object(e))Be.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Me(e){return ae(e)?Le(e):ke(e)}var Oe=Object.prototype.hasOwnProperty;function Ie(e){if(!C(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=se(e),n=[];for(var r in e)("constructor"!=r||!t&&Oe.call(e,r))&&n.push(r);return n}function Re(e){return ae(e)?Le(e,!0):Ie(e)}var Ne=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ze=/^\w*$/;function He(e,t){if(x(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!v(e))||(ze.test(e)||!Ne.test(e)||null!=t&&e in Object(t))}var Ve=q(Object,"create");var Pe=Object.prototype.hasOwnProperty;var Ue=Object.prototype.hasOwnProperty;function je(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ge(e,t){for(var n=e.length;n--;)if(te(e[n][0],t))return n;return-1}je.prototype.clear=function(){this.__data__=Ve?Ve(null):{},this.size=0},je.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},je.prototype.get=function(e){var t=this.__data__;if(Ve){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Pe.call(t,e)?t[e]:void 0},je.prototype.has=function(e){var t=this.__data__;return Ve?void 0!==t[e]:Ue.call(t,e)},je.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ve&&void 0===t?"__lodash_hash_undefined__":t,this};var qe=Array.prototype.splice;function We(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}We.prototype.clear=function(){this.__data__=[],this.size=0},We.prototype.delete=function(e){var t=this.__data__,n=Ge(t,e);return!(n<0)&&(n==t.length-1?t.pop():qe.call(t,n,1),--this.size,!0)},We.prototype.get=function(e){var t=this.__data__,n=Ge(t,e);return n<0?void 0:t[n][1]},We.prototype.has=function(e){return Ge(this.__data__,e)>-1},We.prototype.set=function(e,t){var n=this.__data__,r=Ge(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};var Ze=q(l,"Map");function Xe(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Ye(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ye.prototype.clear=function(){this.size=0,this.__data__={hash:new je,map:new(Ze||We),string:new je}},Ye.prototype.delete=function(e){var t=Xe(this,e).delete(e);return this.size-=t?1:0,t},Ye.prototype.get=function(e){return Xe(this,e).get(e)},Ye.prototype.has=function(e){return Xe(this,e).has(e)},Ye.prototype.set=function(e,t){var n=Xe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function $e(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=e.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new($e.Cache||Ye),n}$e.Cache=Ye;var Ke=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qe=/\\(\\)?/g,Je=function(e){var t=$e(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ke,(function(e,n,r,o){t.push(r?o.replace(Qe,"$1"):n||e)})),t}));function et(e,t){return x(e)?e:He(e,t)?[e]:Je(function(e){return null==e?"":w(e)}(e))}function tt(e){if("string"==typeof e||v(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function nt(e,t){for(var n=0,r=(t=et(t,e)).length;null!=e&&n<r;)e=e[tt(t[n++])];return n&&n==r?e:void 0}function rt(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}var ot=s?s.isConcatSpreadable:void 0;function it(e){return x(e)||de(e)||!!(ot&&e&&e[ot])}var at=Se(Object.getPrototypeOf,Object);function lt(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(o);++r<o;)i[r]=e[r+t];return i}var st=Math.ceil,ut=Math.max;function ft(e,t,n){t=(n?function(e,t,n){if(!C(n))return!1;var r=typeof t;return!!("number"==r?ae(n)&&J(t,n.length):"string"==r&&t in n)&&te(n[t],e)}(e,t,n):void 0===t)?1:ut(function(e){var t=F(e),n=t%1;return t==t?n?t-n:t:0}(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var o=0,i=0,a=Array(st(r/t));o<r;)a[i++]=lt(e,o,o+=t);return a}function ct(e){var t=this.__data__=new We(e);this.size=t.size}function ht(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var a=e[n];t(a,n,e)&&(i[o++]=a)}return i}function pt(){return[]}ct.prototype.clear=function(){this.__data__=new We,this.size=0},ct.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ct.prototype.get=function(e){return this.__data__.get(e)},ct.prototype.has=function(e){return this.__data__.has(e)},ct.prototype.set=function(e,t){var n=this.__data__;if(n instanceof We){var r=n.__data__;if(!Ze||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ye(r)}return n.set(e,t),this.size=n.size,this};var dt=Object.prototype.propertyIsEnumerable,mt=Object.getOwnPropertySymbols,gt=mt?function(e){return null==e?[]:(e=Object(e),ht(mt(e),(function(t){return dt.call(e,t)})))}:pt,vt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)rt(t,gt(e)),e=at(e);return t}:pt;function bt(e,t,n){var r=t(e);return x(e)?r:rt(r,n(e))}function xt(e){return bt(e,Me,gt)}var yt=q(l,"DataView"),_t=q(l,"Promise"),wt=q(l,"Set"),Ct="[object Map]",At="[object Promise]",Tt="[object Set]",Et="[object WeakMap]",Dt="[object DataView]",Lt=N(yt),St=N(Ze),Ft=N(_t),Bt=N(wt),kt=N(W),Mt=m;(yt&&Mt(new yt(new ArrayBuffer(1)))!=Dt||Ze&&Mt(new Ze)!=Ct||_t&&Mt(_t.resolve())!=At||wt&&Mt(new wt)!=Tt||W&&Mt(new W)!=Et)&&(Mt=function(e){var t=m(e),n="[object Object]"==t?e.constructor:void 0,r=n?N(n):"";if(r)switch(r){case Lt:return Dt;case St:return Ct;case Ft:return At;case Bt:return Tt;case kt:return Et}return t});var Ot=Mt,It=l.Uint8Array;function Rt(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Ye;++t<n;)this.add(e[t])}function Nt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}Rt.prototype.add=Rt.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Rt.prototype.has=function(e){return this.__data__.has(e)};function zt(e,t,n,r,o,i){var a=1&n,l=e.length,s=t.length;if(l!=s&&!(a&&s>l))return!1;var u=i.get(e);if(u&&i.get(t))return u==t;var f=-1,c=!0,h=2&n?new Rt:void 0;for(i.set(e,t),i.set(t,e);++f<l;){var p=e[f],d=t[f];if(r)var m=a?r(d,p,f,t,e,i):r(p,d,f,e,t,i);if(void 0!==m){if(m)continue;c=!1;break}if(h){if(!Nt(t,(function(e,t){if(a=t,!h.has(a)&&(p===e||o(p,e,n,r,i)))return h.push(t);var a}))){c=!1;break}}else if(p!==d&&!o(p,d,n,r,i)){c=!1;break}}return i.delete(e),i.delete(t),c}function Ht(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Vt(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var Pt=s?s.prototype:void 0,Ut=Pt?Pt.valueOf:void 0;var jt=Object.prototype.hasOwnProperty;var Gt="[object Arguments]",qt="[object Array]",Wt="[object Object]",Zt=Object.prototype.hasOwnProperty;function Xt(e,t,n,r,o,i){var a=x(e),l=x(t),s=a?qt:Ot(e),u=l?qt:Ot(t),f=(s=s==Gt?Wt:s)==Wt,c=(u=u==Gt?Wt:u)==Wt,h=s==u;if(h&&be(e)){if(!be(t))return!1;a=!0,f=!1}if(h&&!f)return i||(i=new ct),a||Ee(e)?zt(e,t,n,r,o,i):function(e,t,n,r,o,i,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new It(e),new It(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return te(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var l=Ht;case"[object Set]":var s=1&r;if(l||(l=Vt),e.size!=t.size&&!s)return!1;var u=a.get(e);if(u)return u==t;r|=2,a.set(e,t);var f=zt(l(e),l(t),r,o,i,a);return a.delete(e),f;case"[object Symbol]":if(Ut)return Ut.call(e)==Ut.call(t)}return!1}(e,t,s,n,r,o,i);if(!(1&n)){var p=f&&Zt.call(e,"__wrapped__"),d=c&&Zt.call(t,"__wrapped__");if(p||d){var m=p?e.value():e,g=d?t.value():t;return i||(i=new ct),o(m,g,n,r,i)}}return!!h&&(i||(i=new ct),function(e,t,n,r,o,i){var a=1&n,l=xt(e),s=l.length;if(s!=xt(t).length&&!a)return!1;for(var u=s;u--;){var f=l[u];if(!(a?f in t:jt.call(t,f)))return!1}var c=i.get(e);if(c&&i.get(t))return c==t;var h=!0;i.set(e,t),i.set(t,e);for(var p=a;++u<s;){var d=e[f=l[u]],m=t[f];if(r)var g=a?r(m,d,f,t,e,i):r(d,m,f,e,t,i);if(!(void 0===g?d===m||o(d,m,n,r,i):g)){h=!1;break}p||(p="constructor"==f)}if(h&&!p){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(h=!1)}return i.delete(e),i.delete(t),h}(e,t,n,r,o,i))}function Yt(e,t,n,r,o){return e===t||(null==e||null==t||!g(e)&&!g(t)?e!=e&&t!=t:Xt(e,t,n,r,Yt,o))}function $t(e){return e==e&&!C(e)}function Kt(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}function Qt(e){var t=function(e){for(var t=Me(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,$t(o)]}return t}(e);return 1==t.length&&t[0][2]?Kt(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var o=n.length,i=o,a=!r;if(null==e)return!i;for(e=Object(e);o--;){var l=n[o];if(a&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<i;){var s=(l=n[o])[0],u=e[s],f=l[1];if(a&&l[2]){if(void 0===u&&!(s in e))return!1}else{var c=new ct;if(r)var h=r(u,f,s,e,t,c);if(!(void 0===h?Yt(f,u,3,r,c):h))return!1}}return!0}(n,e,t)}}function Jt(e,t){return null!=e&&t in Object(e)}function en(e,t){return null!=e&&function(e,t,n){for(var r=-1,o=(t=et(t,e)).length,i=!1;++r<o;){var a=tt(t[r]);if(!(i=null!=e&&n(e,a)))break;e=e[a]}return i||++r!=o?i:!!(o=null==e?0:e.length)&&ie(o)&&J(a,o)&&(x(e)||de(e))}(e,t,Jt)}function tn(e,t){return He(e)&&$t(t)?Kt(tt(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:nt(e,t);return void 0===r?n:r}(n,e);return void 0===r&&r===t?en(n,e):Yt(t,r,3)}}function nn(e){return function(t){return null==t?void 0:t[e]}}function rn(e){return He(e)?nn(tt(e)):function(e){return function(t){return nt(t,e)}}(e)}function on(e){return"function"==typeof e?e:null==e?B:"object"==typeof e?x(e)?tn(e[0],e[1]):Qt(e):rn(e)}var an,ln=function(e,t,n){for(var r=-1,o=Object(e),i=n(e),a=i.length;a--;){var l=i[an?a:++r];if(!1===t(o[l],l,o))break}return e};function sn(e,t){return e&&ln(e,t,Me)}var un=function(e,t){return function(n,r){if(null==n)return n;if(!ae(n))return e(n,r);for(var o=n.length,i=t?o:-1,a=Object(n);(t?i--:++i<o)&&!1!==r(a[i],i,a););return n}}(sn);function fn(e,t){var n=-1,r=ae(e)?Array(e.length):[];return un(e,(function(e,o,i){r[++n]=t(e,o,i)})),r}function cn(e,t){return function e(t,n,r,o,i){var a=-1,l=t.length;for(r||(r=it),i||(i=[]);++a<l;){var s=t[a];n>0&&r(s)?n>1?e(s,n-1,r,o,i):rt(i,s):o||(i[i.length]=s)}return i}(function(e,t){return(x(e)?b:fn)(e,on(t))}(e,t),1)}function hn(e){return null==e?[]:function(e,t){return b(t,(function(t){return e[t]}))}(e,Me(e))}var pn=Object.prototype.hasOwnProperty;function dn(e,t,n,r){if(!C(e))return e;for(var o=-1,i=(t=et(t,e)).length,a=i-1,l=e;null!=l&&++o<i;){var s=tt(t[o]),u=n;if(o!=a){var f=l[s];void 0===(u=r?r(f,s,l):void 0)&&(u=C(f)?f:J(t[o+1])?[]:{})}re(l,s,u),l=l[s]}return e}function mn(e,t){if(null==e)return{};var n=b(function(e){return bt(e,Re,vt)}(e),(function(e){return[e]}));return t=on(t),function(e,t,n){for(var r=-1,o=t.length,i={};++r<o;){var a=t[r],l=nt(e,a);n(l,a)&&dn(i,et(a,e),l)}return i}(e,n,(function(e,n){return t(e,n[0])}))}var gn=Math.max;function vn(e){if(!e||!e.length)return[];var t=0;return e=ht(e,(function(e){if(g(n=e)&&ae(n))return t=gn(e.length,t),!0;var n})),ue(t,(function(t){return b(e,nn(t))}))}var bn=function(e,t){return K(function(e,t,n){return t=oe(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,i=oe(r.length-t,0),a=Array(i);++o<i;)a[o]=r[t+o];o=-1;for(var l=Array(t+1);++o<t;)l[o]=r[o];return l[t]=n(a),Z(e,this,l)}}(e,t,B),e+"")}((function(e){var t=e.length,n=t>1?e[t-1]:void 0;return n="function"==typeof n?(e.pop(),n):void 0,function(e,t){if(!e||!e.length)return[];var n=vn(e);return null==t?n:b(n,(function(e){return Z(t,void 0,e)}))}(e,n)}));function xn(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var yn=function(e){let t=e,n=e;function r(e,t,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const i=r+o>>>1;n(e[i],t)<0?r=i+1:o=i}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>xn(e(t),n)}(e)),{left:r,center:function(e,n,o,i){null==o&&(o=0),null==i&&(i=e.length);const a=r(e,n,o,i);return a>o&&t(e[a-1],n)>-t(e[a],n)?a-1:a},right:function(e,t,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const i=r+o>>>1;n(e[i],t)>0?o=i:r=i+1}return r}}}(xn).right;class _n{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const o=t[r],i=e+o,a=Math.abs(e)<Math.abs(o)?e-(i-o):o-(i-e);a&&(t[n++]=a),e=i}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,o=this._n,i=0;if(o>0){for(i=e[--o];o>0&&(t=i,n=e[--o],i=t+n,r=n-(i-t),!r););o>0&&(r<0&&e[o-1]<0||r>0&&e[o-1]>0)&&(n=2*r,t=i+n,n==t-i&&(i=t))}return i}}function wn(e,t,n){e=+e,t=+t,n=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+n;for(var r=-1,o=0|Math.max(0,Math.ceil((t-e)/n)),i=new Array(o);++r<o;)i[r]=e+r*n;return i}var Cn=Math.sqrt(50),An=Math.sqrt(10),Tn=Math.sqrt(2);function En(e,t,n){var r=(t-e)/Math.max(0,n),o=Math.floor(Math.log(r)/Math.LN10),i=r/Math.pow(10,o);return o>=0?(i>=Cn?10:i>=An?5:i>=Tn?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(i>=Cn?10:i>=An?5:i>=Tn?2:1)}function Dn(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),o=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=r/o;return i>=Cn?o*=10:i>=An?o*=5:i>=Tn&&(o*=2),t<e?-o:o}function Ln(e){return Math.ceil(Math.log(function(e,t){let n=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&++n;else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(o=+o)>=o&&++n}return n}(e))/Math.LN2)+1}var Sn=Array.prototype.slice;function Fn(e,t){return e-t}var Bn=e=>()=>e;function kn(e,t){for(var n,r=-1,o=t.length;++r<o;)if(n=Mn(e,t[r]))return n;return 0}function Mn(e,t){for(var n=t[0],r=t[1],o=-1,i=0,a=e.length,l=a-1;i<a;l=i++){var s=e[i],u=s[0],f=s[1],c=e[l],h=c[0],p=c[1];if(On(s,c,t))return 0;f>r!=p>r&&n<(h-u)*(r-f)/(p-f)+u&&(o=-o)}return o}function On(e,t,n){var r;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&function(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}(e[r=+(e[0]===t[0])],n[r],t[r])}function In(){}var Rn=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Nn(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return zn(null==t&&n.path)}},n.exports),n.exports}function zn(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Hn=Nn((function(e,t){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var o in n)r(n,o)&&(e[o]=n[o])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,o){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),o);else for(var i=0;i<r;i++)e[o+i]=t[n+i]},flattenChunks:function(e){var t,n,r,o,i,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),o=0,t=0,n=e.length;t<n;t++)i=e[t],a.set(i,o),o+=i.length;return a}},i={arraySet:function(e,t,n,r,o){for(var i=0;i<r;i++)e[o+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(n)}));function Vn(e){for(var t=e.length;--t>=0;)e[t]=0}var Pn=256,Un=286,jn=30,Gn=15,qn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Wn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Zn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Xn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Yn=new Array(576);Vn(Yn);var $n=new Array(60);Vn($n);var Kn=new Array(512);Vn(Kn);var Qn=new Array(256);Vn(Qn);var Jn=new Array(29);Vn(Jn);var er,tr,nr,rr=new Array(jn);function or(e,t,n,r,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=e&&e.length}function ir(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function ar(e){return e<256?Kn[e]:Kn[256+(e>>>7)]}function lr(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function sr(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,lr(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function ur(e,t,n){sr(e,n[2*t],n[2*t+1])}function fr(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function cr(e,t,n){var r,o,i=new Array(16),a=0;for(r=1;r<=Gn;r++)i[r]=a=a+n[r-1]<<1;for(o=0;o<=t;o++){var l=e[2*o+1];0!==l&&(e[2*o]=fr(i[l]++,l))}}function hr(e){var t;for(t=0;t<Un;t++)e.dyn_ltree[2*t]=0;for(t=0;t<jn;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function pr(e){e.bi_valid>8?lr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function dr(e,t,n,r){var o=2*t,i=2*n;return e[o]<e[i]||e[o]===e[i]&&r[t]<=r[n]}function mr(e,t,n){for(var r=e.heap[n],o=n<<1;o<=e.heap_len&&(o<e.heap_len&&dr(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!dr(t,r,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=r}function gr(e,t,n){var r,o,i,a,l=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],o=e.pending_buf[e.l_buf+l],l++,0===r?ur(e,o,t):(ur(e,(i=Qn[o])+Pn+1,t),0!==(a=qn[i])&&sr(e,o-=Jn[i],a),ur(e,i=ar(--r),n),0!==(a=Wn[i])&&sr(e,r-=rr[i],a))}while(l<e.last_lit);ur(e,256,t)}function vr(e,t){var n,r,o,i=t.dyn_tree,a=t.stat_desc.static_tree,l=t.stat_desc.has_stree,s=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<s;n++)0!==i[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(o=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[o]=0,e.opt_len--,l&&(e.static_len-=a[2*o+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)mr(e,i,n);o=s;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],mr(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,i[2*o]=i[2*n]+i[2*r],e.depth[o]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,i[2*n+1]=i[2*r+1]=o,e.heap[1]=o++,mr(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,o,i,a,l,s=t.dyn_tree,u=t.max_code,f=t.stat_desc.static_tree,c=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,d=t.stat_desc.max_length,m=0;for(i=0;i<=Gn;i++)e.bl_count[i]=0;for(s[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(i=s[2*s[2*(r=e.heap[n])+1]+1]+1)>d&&(i=d,m++),s[2*r+1]=i,r>u||(e.bl_count[i]++,a=0,r>=p&&(a=h[r-p]),l=s[2*r],e.opt_len+=l*(i+a),c&&(e.static_len+=l*(f[2*r+1]+a)));if(0!==m){do{for(i=d-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[d]--,m-=2}while(m>0);for(i=d;0!==i;i--)for(r=e.bl_count[i];0!==r;)(o=e.heap[--n])>u||(s[2*o+1]!==i&&(e.opt_len+=(i-s[2*o+1])*s[2*o],s[2*o+1]=i),r--)}}(e,t),cr(i,u,e.bl_count)}function br(e,t,n){var r,o,i=-1,a=t[1],l=0,s=7,u=4;for(0===a&&(s=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)o=a,a=t[2*(r+1)+1],++l<s&&o===a||(l<u?e.bl_tree[2*o]+=l:0!==o?(o!==i&&e.bl_tree[2*o]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,i=o,0===a?(s=138,u=3):o===a?(s=6,u=3):(s=7,u=4))}function xr(e,t,n){var r,o,i=-1,a=t[1],l=0,s=7,u=4;for(0===a&&(s=138,u=3),r=0;r<=n;r++)if(o=a,a=t[2*(r+1)+1],!(++l<s&&o===a)){if(l<u)do{ur(e,o,e.bl_tree)}while(0!=--l);else 0!==o?(o!==i&&(ur(e,o,e.bl_tree),l--),ur(e,16,e.bl_tree),sr(e,l-3,2)):l<=10?(ur(e,17,e.bl_tree),sr(e,l-3,3)):(ur(e,18,e.bl_tree),sr(e,l-11,7));l=0,i=o,0===a?(s=138,u=3):o===a?(s=6,u=3):(s=7,u=4)}}Vn(rr);var yr=!1;function _r(e,t,n,r){sr(e,0+(r?1:0),3),function(e,t,n,r){pr(e),r&&(lr(e,n),lr(e,~n)),Hn.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}var wr={_tr_init:function(e){yr||(!function(){var e,t,n,r,o,i=new Array(16);for(n=0,r=0;r<28;r++)for(Jn[r]=n,e=0;e<1<<qn[r];e++)Qn[n++]=r;for(Qn[n-1]=r,o=0,r=0;r<16;r++)for(rr[r]=o,e=0;e<1<<Wn[r];e++)Kn[o++]=r;for(o>>=7;r<jn;r++)for(rr[r]=o<<7,e=0;e<1<<Wn[r]-7;e++)Kn[256+o++]=r;for(t=0;t<=Gn;t++)i[t]=0;for(e=0;e<=143;)Yn[2*e+1]=8,e++,i[8]++;for(;e<=255;)Yn[2*e+1]=9,e++,i[9]++;for(;e<=279;)Yn[2*e+1]=7,e++,i[7]++;for(;e<=287;)Yn[2*e+1]=8,e++,i[8]++;for(cr(Yn,287,i),e=0;e<jn;e++)$n[2*e+1]=5,$n[2*e]=fr(e,5);er=new or(Yn,qn,257,Un,Gn),tr=new or($n,Wn,0,jn,Gn),nr=new or(new Array(0),Zn,0,19,7)}(),yr=!0),e.l_desc=new ir(e.dyn_ltree,er),e.d_desc=new ir(e.dyn_dtree,tr),e.bl_desc=new ir(e.bl_tree,nr),e.bi_buf=0,e.bi_valid=0,hr(e)},_tr_stored_block:_r,_tr_flush_block:function(e,t,n,r){var o,i,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Pn;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),vr(e,e.l_desc),vr(e,e.d_desc),a=function(e){var t;for(br(e,e.dyn_ltree,e.l_desc.max_code),br(e,e.dyn_dtree,e.d_desc.max_code),vr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Xn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),o=e.opt_len+3+7>>>3,(i=e.static_len+3+7>>>3)<=o&&(o=i)):o=i=n+5,n+4<=o&&-1!==t?_r(e,t,n,r):4===e.strategy||i===o?(sr(e,2+(r?1:0),3),gr(e,Yn,$n)):(sr(e,4+(r?1:0),3),function(e,t,n,r){var o;for(sr(e,t-257,5),sr(e,n-1,5),sr(e,r-4,4),o=0;o<r;o++)sr(e,e.bl_tree[2*Xn[o]+1],3);xr(e,e.dyn_ltree,t-1),xr(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),gr(e,e.dyn_ltree,e.dyn_dtree)),hr(e),r&&pr(e)},_tr_tally:function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Qn[n]+Pn+1)]++,e.dyn_dtree[2*ar(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){sr(e,2,3),ur(e,256,Yn),function(e){16===e.bi_valid?(lr(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}};var Cr=function(e,t,n,r){for(var o=65535&e|0,i=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{i=i+(o=o+t[r++]|0)|0}while(--a);o%=65521,i%=65521}return o|i<<16|0};var Ar=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();var Tr,Er=function(e,t,n,r){var o=Ar,i=r+n;e^=-1;for(var a=r;a<i;a++)e=e>>>8^o[255&(e^t[a])];return-1^e},Dr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Lr=-2,Sr=258,Fr=262,Br=103,kr=113,Mr=666;function Or(e,t){return e.msg=Dr[t],t}function Ir(e){return(e<<1)-(e>4?9:0)}function Rr(e){for(var t=e.length;--t>=0;)e[t]=0}function Nr(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(Hn.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function zr(e,t){wr._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Nr(e.strm)}function Hr(e,t){e.pending_buf[e.pending++]=t}function Vr(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Pr(e,t){var n,r,o=e.max_chain_length,i=e.strstart,a=e.prev_length,l=e.nice_match,s=e.strstart>e.w_size-Fr?e.strstart-(e.w_size-Fr):0,u=e.window,f=e.w_mask,c=e.prev,h=e.strstart+Sr,p=u[i+a-1],d=u[i+a];e.prev_length>=e.good_match&&(o>>=2),l>e.lookahead&&(l=e.lookahead);do{if(u[(n=t)+a]===d&&u[n+a-1]===p&&u[n]===u[i]&&u[++n]===u[i+1]){i+=2,n++;do{}while(u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&i<h);if(r=Sr-(h-i),i=h-Sr,r>a){if(e.match_start=t,a=r,r>=l)break;p=u[i+a-1],d=u[i+a]}}}while((t=c[t&f])>s&&0!=--o);return a<=e.lookahead?a:e.lookahead}function Ur(e){var t,n,r,o,i,a,l,s,u,f,c=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-Fr)){Hn.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=c?r-c:0}while(--n);t=n=c;do{r=e.prev[--t],e.prev[t]=r>=c?r-c:0}while(--n);o+=c}if(0===e.strm.avail_in)break;if(a=e.strm,l=e.window,s=e.strstart+e.lookahead,u=o,f=void 0,(f=a.avail_in)>u&&(f=u),n=0===f?0:(a.avail_in-=f,Hn.arraySet(l,a.input,a.next_in,f,s),1===a.state.wrap?a.adler=Cr(a.adler,l,f,s):2===a.state.wrap&&(a.adler=Er(a.adler,l,f,s)),a.next_in+=f,a.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+3-1])&e.hash_mask,e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Fr&&0!==e.strm.avail_in)}function jr(e,t){for(var n,r;;){if(e.lookahead<Fr){if(Ur(e),e.lookahead<Fr&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Fr&&(e.match_length=Pr(e,n)),e.match_length>=3)if(r=wr._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=wr._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(zr(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(zr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(zr(e,!1),0===e.strm.avail_out)?1:2}function Gr(e,t){for(var n,r,o;;){if(e.lookahead<Fr){if(Ur(e),e.lookahead<Fr&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Fr&&(e.match_length=Pr(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,r=wr._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(zr(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=wr._tr_tally(e,0,e.window[e.strstart-1]))&&zr(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=wr._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(zr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(zr(e,!1),0===e.strm.avail_out)?1:2}function qr(e,t,n,r,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=o}function Wr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Hn.Buf16(1146),this.dyn_dtree=new Hn.Buf16(122),this.bl_tree=new Hn.Buf16(78),Rr(this.dyn_ltree),Rr(this.dyn_dtree),Rr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Hn.Buf16(16),this.heap=new Hn.Buf16(573),Rr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Hn.Buf16(573),Rr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zr(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:kr,e.adler=2===t.wrap?0:1,t.last_flush=0,wr._tr_init(t),0):Or(e,Lr)}function Xr(e){var t,n=Zr(e);return 0===n&&((t=e.state).window_size=2*t.w_size,Rr(t.head),t.max_lazy_match=Tr[t.level].max_lazy,t.good_match=Tr[t.level].good_length,t.nice_match=Tr[t.level].nice_length,t.max_chain_length=Tr[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function Yr(e,t,n,r,o,i){if(!e)return Lr;var a=1;if(-1===t&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),o<1||o>9||8!==n||r<8||r>15||t<0||t>9||i<0||i>4)return Or(e,Lr);8===r&&(r=9);var l=new Wr;return e.state=l,l.strm=e,l.wrap=a,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Hn.Buf8(2*l.w_size),l.head=new Hn.Buf16(l.hash_size),l.prev=new Hn.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Hn.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=i,l.method=n,Xr(e)}Tr=[new qr(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ur(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,zr(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Fr&&(zr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(zr(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(zr(e,!1),e.strm.avail_out),1)})),new qr(4,4,8,4,jr),new qr(4,5,16,8,jr),new qr(4,6,32,32,jr),new qr(4,4,16,16,Gr),new qr(8,16,32,32,Gr),new qr(8,16,128,128,Gr),new qr(8,32,128,256,Gr),new qr(32,128,258,1024,Gr),new qr(32,258,258,4096,Gr)];var $r={deflateInit:function(e,t){return Yr(e,t,8,15,8,0)},deflateInit2:Yr,deflateReset:Xr,deflateResetKeep:Zr,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?Lr:(e.state.gzhead=t,0):Lr},deflate:function(e,t){var n,r,o,i;if(!e||!e.state||t>5||t<0)return e?Or(e,Lr):Lr;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===Mr&&4!==t)return Or(e,0===e.avail_out?-5:Lr);if(r.strm=e,n=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,Hr(r,31),Hr(r,139),Hr(r,8),r.gzhead?(Hr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Hr(r,255&r.gzhead.time),Hr(r,r.gzhead.time>>8&255),Hr(r,r.gzhead.time>>16&255),Hr(r,r.gzhead.time>>24&255),Hr(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Hr(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Hr(r,255&r.gzhead.extra.length),Hr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Er(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Hr(r,0),Hr(r,0),Hr(r,0),Hr(r,0),Hr(r,0),Hr(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Hr(r,3),r.status=kr);else{var a=8+(r.w_bits-8<<4)<<8;a|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(a|=32),a+=31-a%31,r.status=kr,Vr(r,a),0!==r.strstart&&(Vr(r,e.adler>>>16),Vr(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(e.adler=Er(e.adler,r.pending_buf,r.pending-o,o)),Nr(e),o=r.pending,r.pending!==r.pending_buf_size));)Hr(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(e.adler=Er(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=Er(e.adler,r.pending_buf,r.pending-o,o)),Nr(e),o=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Hr(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>o&&(e.adler=Er(e.adler,r.pending_buf,r.pending-o,o)),0===i&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=Er(e.adler,r.pending_buf,r.pending-o,o)),Nr(e),o=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Hr(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>o&&(e.adler=Er(e.adler,r.pending_buf,r.pending-o,o)),0===i&&(r.status=Br)}else r.status=Br;if(r.status===Br&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Nr(e),r.pending+2<=r.pending_buf_size&&(Hr(r,255&e.adler),Hr(r,e.adler>>8&255),e.adler=0,r.status=kr)):r.status=kr),0!==r.pending){if(Nr(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&Ir(t)<=Ir(n)&&4!==t)return Or(e,-5);if(r.status===Mr&&0!==e.avail_in)return Or(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&r.status!==Mr){var l=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(Ur(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=wr._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(zr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(zr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(zr(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,r,o,i,a=e.window;;){if(e.lookahead<=Sr){if(Ur(e),e.lookahead<=Sr&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=a[o=e.strstart-1])===a[++o]&&r===a[++o]&&r===a[++o]){i=e.strstart+Sr;do{}while(r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&o<i);e.match_length=Sr-(i-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=wr._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=wr._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(zr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(zr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(zr(e,!1),0===e.strm.avail_out)?1:2}(r,t):Tr[r.level].func(r,t);if(3!==l&&4!==l||(r.status=Mr),1===l||3===l)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===l&&(1===t?wr._tr_align(r):5!==t&&(wr._tr_stored_block(r,0,0,!1),3===t&&(Rr(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Nr(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(Hr(r,255&e.adler),Hr(r,e.adler>>8&255),Hr(r,e.adler>>16&255),Hr(r,e.adler>>24&255),Hr(r,255&e.total_in),Hr(r,e.total_in>>8&255),Hr(r,e.total_in>>16&255),Hr(r,e.total_in>>24&255)):(Vr(r,e.adler>>>16),Vr(r,65535&e.adler)),Nr(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},deflateEnd:function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==Br&&t!==kr&&t!==Mr?Or(e,Lr):(e.state=null,t===kr?Or(e,-3):0):Lr},deflateSetDictionary:function(e,t){var n,r,o,i,a,l,s,u,f=t.length;if(!e||!e.state)return Lr;if(2===(i=(n=e.state).wrap)||1===i&&42!==n.status||n.lookahead)return Lr;for(1===i&&(e.adler=Cr(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===i&&(Rr(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new Hn.Buf8(n.w_size),Hn.arraySet(u,t,f-n.w_size,n.w_size,0),t=u,f=n.w_size),a=e.avail_in,l=e.next_in,s=e.input,e.avail_in=f,e.next_in=0,e.input=t,Ur(n);n.lookahead>=3;){r=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=2,Ur(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=s,e.avail_in=a,n.wrap=i,0},deflateInfo:"pako deflate (from Nodeca project)"},Kr=!0,Qr=!0;try{String.fromCharCode.apply(null,[0])}catch(e){Kr=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Qr=!1}for(var Jr=new Hn.Buf8(256),eo=0;eo<256;eo++)Jr[eo]=eo>=252?6:eo>=248?5:eo>=240?4:eo>=224?3:eo>=192?2:1;Jr[254]=Jr[254]=1;function to(e,t){if(t<65534&&(e.subarray&&Qr||!e.subarray&&Kr))return String.fromCharCode.apply(null,Hn.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}var no=function(e){var t,n,r,o,i,a=e.length,l=0;for(o=0;o<a;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Hn.Buf8(l),i=0,o=0;i<l;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},ro=function(e){return to(e,e.length)},oo=function(e){for(var t=new Hn.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},io=function(e,t){var n,r,o,i,a=t||e.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((o=e[n++])<128)l[r++]=o;else if((i=Jr[o])>4)l[r++]=65533,n+=i-1;else{for(o&=2===i?31:3===i?15:7;i>1&&n<a;)o=o<<6|63&e[n++],i--;i>1?l[r++]=65533:o<65536?l[r++]=o:(o-=65536,l[r++]=55296|o>>10&1023,l[r++]=56320|1023&o)}return to(l,r)},ao=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Jr[e[n]]>t?n:t};var lo=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},so=Object.prototype.toString;function uo(e){if(!(this instanceof uo))return new uo(e);this.options=Hn.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lo,this.strm.avail_out=0;var n=$r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(Dr[n]);if(t.header&&$r.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?no(t.dictionary):"[object ArrayBuffer]"===so.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=$r.deflateSetDictionary(this.strm,r)))throw new Error(Dr[n]);this._dict_set=!0}}function fo(e,t){var n=new uo(t);if(n.push(e,!0),n.err)throw n.msg||Dr[n.err];return n.result}uo.prototype.push=function(e,t){var n,r,o=this.strm,i=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?o.input=no(e):"[object ArrayBuffer]"===so.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new Hn.Buf8(i),o.next_out=0,o.avail_out=i),1!==(n=$r.deflate(o,r))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(ro(Hn.shrinkBuf(o.output,o.next_out))):this.onData(Hn.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==n);return 4===r?(n=$r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==r||(this.onEnd(0),o.avail_out=0,!0)},uo.prototype.onData=function(e){this.chunks.push(e)},uo.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Hn.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var co={Deflate:uo,deflate:fo,deflateRaw:function(e,t){return(t=t||{}).raw=!0,fo(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,fo(e,t)}},ho=function(e,t){var n,r,o,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y,_,w,C,A,T,E;n=e.state,r=e.next_in,T=e.input,o=r+(e.avail_in-5),i=e.next_out,E=e.output,a=i-(t-e.avail_out),l=i+(e.avail_out-257),s=n.dmax,u=n.wsize,f=n.whave,c=n.wnext,h=n.window,p=n.hold,d=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,b=(1<<n.distbits)-1;e:do{d<15&&(p+=T[r++]<<d,d+=8,p+=T[r++]<<d,d+=8),x=m[p&v];t:for(;;){if(p>>>=y=x>>>24,d-=y,0===(y=x>>>16&255))E[i++]=65535&x;else{if(!(16&y)){if(0==(64&y)){x=m[(65535&x)+(p&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}_=65535&x,(y&=15)&&(d<y&&(p+=T[r++]<<d,d+=8),_+=p&(1<<y)-1,p>>>=y,d-=y),d<15&&(p+=T[r++]<<d,d+=8,p+=T[r++]<<d,d+=8),x=g[p&b];n:for(;;){if(p>>>=y=x>>>24,d-=y,!(16&(y=x>>>16&255))){if(0==(64&y)){x=g[(65535&x)+(p&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&x,d<(y&=15)&&(p+=T[r++]<<d,(d+=8)<y&&(p+=T[r++]<<d,d+=8)),(w+=p&(1<<y)-1)>s){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=y,d-=y,w>(y=i-a)){if((y=w-y)>f&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,A=h,0===c){if(C+=u-y,y<_){_-=y;do{E[i++]=h[C++]}while(--y);C=i-w,A=E}}else if(c<y){if(C+=u+c-y,(y-=c)<_){_-=y;do{E[i++]=h[C++]}while(--y);if(C=0,c<_){_-=y=c;do{E[i++]=h[C++]}while(--y);C=i-w,A=E}}}else if(C+=c-y,y<_){_-=y;do{E[i++]=h[C++]}while(--y);C=i-w,A=E}for(;_>2;)E[i++]=A[C++],E[i++]=A[C++],E[i++]=A[C++],_-=3;_&&(E[i++]=A[C++],_>1&&(E[i++]=A[C++]))}else{C=i-w;do{E[i++]=E[C++],E[i++]=E[C++],E[i++]=E[C++],_-=3}while(_>2);_&&(E[i++]=E[C++],_>1&&(E[i++]=E[C++]))}break}}break}}while(r<o&&i<l);r-=_=d>>3,p&=(1<<(d-=_<<3))-1,e.next_in=r,e.next_out=i,e.avail_in=r<o?o-r+5:5-(r-o),e.avail_out=i<l?l-i+257:257-(i-l),n.hold=p,n.bits=d},po=15,mo=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],go=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],vo=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],bo=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],xo=function(e,t,n,r,o,i,a,l){var s,u,f,c,h,p,d,m,g,v=l.bits,b=0,x=0,y=0,_=0,w=0,C=0,A=0,T=0,E=0,D=0,L=null,S=0,F=new Hn.Buf16(16),B=new Hn.Buf16(16),k=null,M=0;for(b=0;b<=po;b++)F[b]=0;for(x=0;x<r;x++)F[t[n+x]]++;for(w=v,_=po;_>=1&&0===F[_];_--);if(w>_&&(w=_),0===_)return o[i++]=20971520,o[i++]=20971520,l.bits=1,0;for(y=1;y<_&&0===F[y];y++);for(w<y&&(w=y),T=1,b=1;b<=po;b++)if(T<<=1,(T-=F[b])<0)return-1;if(T>0&&(0===e||1!==_))return-1;for(B[1]=0,b=1;b<po;b++)B[b+1]=B[b]+F[b];for(x=0;x<r;x++)0!==t[n+x]&&(a[B[t[n+x]]++]=x);if(0===e?(L=k=a,p=19):1===e?(L=mo,S-=257,k=go,M-=257,p=256):(L=vo,k=bo,p=-1),D=0,x=0,b=y,h=i,C=w,A=0,f=-1,c=(E=1<<w)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){d=b-A,a[x]<p?(m=0,g=a[x]):a[x]>p?(m=k[M+a[x]],g=L[S+a[x]]):(m=96,g=0),s=1<<b-A,y=u=1<<C;do{o[h+(D>>A)+(u-=s)]=d<<24|m<<16|g|0}while(0!==u);for(s=1<<b-1;D&s;)s>>=1;if(0!==s?(D&=s-1,D+=s):D=0,x++,0==--F[b]){if(b===_)break;b=t[n+a[x]]}if(b>w&&(D&c)!==f){for(0===A&&(A=w),h+=y,T=1<<(C=b-A);C+A<_&&!((T-=F[C+A])<=0);)C++,T<<=1;if(E+=1<<C,1===e&&E>852||2===e&&E>592)return 1;o[f=D&c]=w<<24|C<<16|h-i|0}}return 0!==D&&(o[h+D]=b-A<<24|64<<16|0),l.bits=w,0},yo=-2,_o=12,wo=30;function Co(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Ao(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Hn.Buf16(320),this.work=new Hn.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function To(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Hn.Buf32(852),t.distcode=t.distdyn=new Hn.Buf32(592),t.sane=1,t.back=-1,0):yo}function Eo(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,To(e)):yo}function Do(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?yo:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Eo(e))):yo}function Lo(e,t){var n,r;return e?(r=new Ao,e.state=r,r.window=null,0!==(n=Do(e,t))&&(e.state=null),n):yo}var So,Fo,Bo=!0;function ko(e){if(Bo){var t;for(So=new Hn.Buf32(512),Fo=new Hn.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(xo(1,e.lens,0,288,So,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;xo(2,e.lens,0,32,Fo,0,e.work,{bits:5}),Bo=!1}e.lencode=So,e.lenbits=9,e.distcode=Fo,e.distbits=5}function Mo(e,t,n,r){var o,i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Hn.Buf8(i.wsize)),r>=i.wsize?(Hn.arraySet(i.window,t,n-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):((o=i.wsize-i.wnext)>r&&(o=r),Hn.arraySet(i.window,t,n-r,o,i.wnext),(r-=o)?(Hn.arraySet(i.window,t,n-r,r,0),i.wnext=r,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0}var Oo={inflateReset:Eo,inflateReset2:Do,inflateResetKeep:To,inflateInit:function(e){return Lo(e,15)},inflateInit2:Lo,inflate:function(e,t){var n,r,o,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y,_,w,C,A,T,E=0,D=new Hn.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return yo;(n=e.state).mode===_o&&(n.mode=13),a=e.next_out,o=e.output,s=e.avail_out,i=e.next_in,r=e.input,l=e.avail_in,u=n.hold,f=n.bits,c=l,h=s,C=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;f<16;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(2&n.wrap&&35615===u){n.check=0,D[0]=255&u,D[1]=u>>>8&255,n.check=Er(n.check,D,2,0),u=0,f=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=wo;break}if(8!=(15&u)){e.msg="unknown compression method",n.mode=wo;break}if(f-=4,w=8+(15&(u>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){e.msg="invalid window size",n.mode=wo;break}n.dmax=1<<w,e.adler=n.check=1,n.mode=512&u?10:_o,u=0,f=0;break;case 2:for(;f<16;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(n.flags=u,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=wo;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=wo;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,n.check=Er(n.check,D,2,0)),u=0,f=0,n.mode=3;case 3:for(;f<32;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}n.head&&(n.head.time=u),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,D[2]=u>>>16&255,D[3]=u>>>24&255,n.check=Er(n.check,D,4,0)),u=0,f=0,n.mode=4;case 4:for(;f<16;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,n.check=Er(n.check,D,2,0)),u=0,f=0,n.mode=5;case 5:if(1024&n.flags){for(;f<16;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(D[0]=255&u,D[1]=u>>>8&255,n.check=Er(n.check,D,2,0)),u=0,f=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>l&&(p=l),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Hn.arraySet(n.head.extra,r,i,p,w)),512&n.flags&&(n.check=Er(n.check,r,p,i)),l-=p,i+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===l)break e;p=0;do{w=r[i+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<l);if(512&n.flags&&(n.check=Er(n.check,r,p,i)),l-=p,i+=p,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===l)break e;p=0;do{w=r[i+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<l);if(512&n.flags&&(n.check=Er(n.check,r,p,i)),l-=p,i+=p,w)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;f<16;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=wo;break}u=0,f=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=_o;break;case 10:for(;f<32;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}e.adler=n.check=Co(u),u=0,f=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=s,e.next_in=i,e.avail_in=l,n.hold=u,n.bits=f,2;e.adler=n.check=1,n.mode=_o;case _o:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&f,f-=7&f,n.mode=27;break}for(;f<3;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}switch(n.last=1&u,f-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(ko(n),n.mode=20,6===t){u>>>=2,f-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=wo}u>>>=2,f-=2;break;case 14:for(u>>>=7&f,f-=7&f;f<32;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=wo;break}if(n.length=65535&u,u=0,f=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>l&&(p=l),p>s&&(p=s),0===p)break e;Hn.arraySet(o,r,i,p,a),l-=p,i+=p,s-=p,a+=p,n.length-=p;break}n.mode=_o;break;case 17:for(;f<14;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(n.nlen=257+(31&u),u>>>=5,f-=5,n.ndist=1+(31&u),u>>>=5,f-=5,n.ncode=4+(15&u),u>>>=4,f-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=wo;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;f<3;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}n.lens[L[n.have++]]=7&u,u>>>=3,f-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},C=xo(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,C){e.msg="invalid code lengths set",n.mode=wo;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(E=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,b=65535&E,!((g=E>>>24)<=f);){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(b<16)u>>>=g,f-=g,n.lens[n.have++]=b;else{if(16===b){for(T=g+2;f<T;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(u>>>=g,f-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=wo;break}w=n.lens[n.have-1],p=3+(3&u),u>>>=2,f-=2}else if(17===b){for(T=g+3;f<T;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}f-=g,w=0,p=3+(7&(u>>>=g)),u>>>=3,f-=3}else{for(T=g+7;f<T;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}f-=g,w=0,p=11+(127&(u>>>=g)),u>>>=7,f-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=wo;break}for(;p--;)n.lens[n.have++]=w}}if(n.mode===wo)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=wo;break}if(n.lenbits=9,A={bits:n.lenbits},C=xo(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,C){e.msg="invalid literal/lengths set",n.mode=wo;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},C=xo(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,C){e.msg="invalid distances set",n.mode=wo;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(l>=6&&s>=258){e.next_out=a,e.avail_out=s,e.next_in=i,e.avail_in=l,n.hold=u,n.bits=f,ho(e,h),a=e.next_out,o=e.output,s=e.avail_out,i=e.next_in,r=e.input,l=e.avail_in,u=n.hold,f=n.bits,n.mode===_o&&(n.back=-1);break}for(n.back=0;v=(E=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,b=65535&E,!((g=E>>>24)<=f);){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(v&&0==(240&v)){for(x=g,y=v,_=b;v=(E=n.lencode[_+((u&(1<<x+y)-1)>>x)])>>>16&255,b=65535&E,!(x+(g=E>>>24)<=f);){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}u>>>=x,f-=x,n.back+=x}if(u>>>=g,f-=g,n.back+=g,n.length=b,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=_o;break}if(64&v){e.msg="invalid literal/length code",n.mode=wo;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(T=n.extra;f<T;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(E=n.distcode[u&(1<<n.distbits)-1])>>>16&255,b=65535&E,!((g=E>>>24)<=f);){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(0==(240&v)){for(x=g,y=v,_=b;v=(E=n.distcode[_+((u&(1<<x+y)-1)>>x)])>>>16&255,b=65535&E,!(x+(g=E>>>24)<=f);){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}u>>>=x,f-=x,n.back+=x}if(u>>>=g,f-=g,n.back+=g,64&v){e.msg="invalid distance code",n.mode=wo;break}n.offset=b,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(T=n.extra;f<T;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=wo;break}n.mode=25;case 25:if(0===s)break e;if(p=h-s,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=wo;break}p>n.wnext?(p-=n.wnext,d=n.wsize-p):d=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=o,d=a-n.offset,p=n.length;p>s&&(p=s),s-=p,n.length-=p;do{o[a++]=m[d++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===s)break e;o[a++]=n.length,s--,n.mode=21;break;case 27:if(n.wrap){for(;f<32;){if(0===l)break e;l--,u|=r[i++]<<f,f+=8}if(h-=s,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=n.flags?Er(n.check,o,h,a-h):Cr(n.check,o,h,a-h)),h=s,(n.flags?u:Co(u))!==n.check){e.msg="incorrect data check",n.mode=wo;break}u=0,f=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;f<32;){if(0===l)break e;l--,u+=r[i++]<<f,f+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=wo;break}u=0,f=0}n.mode=29;case 29:C=1;break e;case wo:C=-3;break e;case 31:return-4;case 32:default:return yo}return e.next_out=a,e.avail_out=s,e.next_in=i,e.avail_in=l,n.hold=u,n.bits=f,(n.wsize||h!==e.avail_out&&n.mode<wo&&(n.mode<27||4!==t))&&Mo(e,e.output,e.next_out,h-e.avail_out),c-=e.avail_in,h-=e.avail_out,e.total_in+=c,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=n.flags?Er(n.check,o,h,e.next_out-h):Cr(n.check,o,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===_o?128:0)+(20===n.mode||15===n.mode?256:0),(0===c&&0===h||4===t)&&0===C&&(C=-5),C},inflateEnd:function(e){if(!e||!e.state)return yo;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflateGetHeader:function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?yo:(n.head=t,t.done=!1,0):yo},inflateSetDictionary:function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?yo:11===n.mode&&Cr(1,t,r,0)!==n.check?-3:Mo(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):yo},inflateInfo:"pako inflate (from Nodeca project)"},Io={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Ro=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},No=Object.prototype.toString;function zo(e){if(!(this instanceof zo))return new zo(e);this.options=Hn.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lo,this.strm.avail_out=0;var n=Oo.inflateInit2(this.strm,t.windowBits);if(n!==Io.Z_OK)throw new Error(Dr[n]);if(this.header=new Ro,Oo.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=no(t.dictionary):"[object ArrayBuffer]"===No.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Oo.inflateSetDictionary(this.strm,t.dictionary))!==Io.Z_OK))throw new Error(Dr[n])}function Ho(e,t){var n=new zo(t);if(n.push(e,!0),n.err)throw n.msg||Dr[n.err];return n.result}zo.prototype.push=function(e,t){var n,r,o,i,a,l=this.strm,s=this.options.chunkSize,u=this.options.dictionary,f=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?Io.Z_FINISH:Io.Z_NO_FLUSH,"string"==typeof e?l.input=oo(e):"[object ArrayBuffer]"===No.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Hn.Buf8(s),l.next_out=0,l.avail_out=s),(n=Oo.inflate(l,Io.Z_NO_FLUSH))===Io.Z_NEED_DICT&&u&&(n=Oo.inflateSetDictionary(this.strm,u)),n===Io.Z_BUF_ERROR&&!0===f&&(n=Io.Z_OK,f=!1),n!==Io.Z_STREAM_END&&n!==Io.Z_OK)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&n!==Io.Z_STREAM_END&&(0!==l.avail_in||r!==Io.Z_FINISH&&r!==Io.Z_SYNC_FLUSH)||("string"===this.options.to?(o=ao(l.output,l.next_out),i=l.next_out-o,a=io(l.output,o),l.next_out=i,l.avail_out=s-i,i&&Hn.arraySet(l.output,l.output,o,i,0),this.onData(a)):this.onData(Hn.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(f=!0)}while((l.avail_in>0||0===l.avail_out)&&n!==Io.Z_STREAM_END);return n===Io.Z_STREAM_END&&(r=Io.Z_FINISH),r===Io.Z_FINISH?(n=Oo.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Io.Z_OK):r!==Io.Z_SYNC_FLUSH||(this.onEnd(Io.Z_OK),l.avail_out=0,!0)},zo.prototype.onData=function(e){this.chunks.push(e)},zo.prototype.onEnd=function(e){e===Io.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Hn.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Vo={Inflate:zo,inflate:Ho,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Ho(e,t)},ungzip:Ho},Po={};(0,Hn.assign)(Po,co,Vo,Io);var Uo=Po,jo=Nn((function(e){!function(){var t={};e.exports=t,function(e,t){e.toRGBA8=function(t){var n=t.width,r=t.height;if(null==t.tabs.acTL)return[e.toRGBA8.decodeImage(t.data,n,r,t).buffer];var o=[];null==t.frames[0].data&&(t.frames[0].data=t.data);for(var i,a=new Uint8Array(n*r*4),l=0;l<t.frames.length;l++){var s=t.frames[l],u=s.rect.x,f=s.rect.y,c=s.rect.width,h=s.rect.height,p=e.toRGBA8.decodeImage(s.data,c,h,t);if(0==l?i=p:0==s.blend?e._copyTile(p,c,h,i,n,r,u,f,0):1==s.blend&&e._copyTile(p,c,h,i,n,r,u,f,1),o.push(i.buffer),i=i.slice(0),0==s.dispose);else if(1==s.dispose)e._copyTile(a,c,h,i,n,r,u,f,0);else if(2==s.dispose){for(var d=l-1;2==t.frames[d].dispose;)d--;i=new Uint8Array(o[d]).slice(0)}}return o},e.toRGBA8.decodeImage=function(t,n,r,o){var i=n*r,a=e.decode._getBPP(o),l=Math.ceil(n*a/8),s=new Uint8Array(4*i),u=new Uint32Array(s.buffer),f=o.ctype,c=o.depth,h=e._bin.readUshort;if(6==f){var p=i<<2;if(8==c)for(var d=0;d<p;d++)s[d]=t[d];if(16==c)for(d=0;d<p;d++)s[d]=t[d<<1]}else if(2==f){var m=o.tabs.tRNS,g=-1,v=-1,b=-1;if(m&&(g=m[0],v=m[1],b=m[2]),8==c)for(d=0;d<i;d++){var x=3*d;s[E=d<<2]=t[x],s[E+1]=t[x+1],s[E+2]=t[x+2],s[E+3]=255,-1!=g&&t[x]==g&&t[x+1]==v&&t[x+2]==b&&(s[E+3]=0)}if(16==c)for(d=0;d<i;d++){x=6*d;s[E=d<<2]=t[x],s[E+1]=t[x+2],s[E+2]=t[x+4],s[E+3]=255,-1!=g&&h(t,x)==g&&h(t,x+2)==v&&h(t,x+4)==b&&(s[E+3]=0)}}else if(3==f){var y=o.tabs.PLTE,_=o.tabs.tRNS,w=_?_.length:0;if(1==c)for(var C=0;C<r;C++){var A=C*l,T=C*n;for(d=0;d<n;d++){var E=T+d<<2,D=3*(L=t[A+(d>>3)]>>7-((7&d)<<0)&1);s[E]=y[D],s[E+1]=y[D+1],s[E+2]=y[D+2],s[E+3]=L<w?_[L]:255}}if(2==c)for(C=0;C<r;C++)for(A=C*l,T=C*n,d=0;d<n;d++){E=T+d<<2,D=3*(L=t[A+(d>>2)]>>6-((3&d)<<1)&3);s[E]=y[D],s[E+1]=y[D+1],s[E+2]=y[D+2],s[E+3]=L<w?_[L]:255}if(4==c)for(C=0;C<r;C++)for(A=C*l,T=C*n,d=0;d<n;d++){E=T+d<<2,D=3*(L=t[A+(d>>1)]>>4-((1&d)<<2)&15);s[E]=y[D],s[E+1]=y[D+1],s[E+2]=y[D+2],s[E+3]=L<w?_[L]:255}if(8==c)for(d=0;d<i;d++){var L;E=d<<2,D=3*(L=t[d]);s[E]=y[D],s[E+1]=y[D+1],s[E+2]=y[D+2],s[E+3]=L<w?_[L]:255}}else if(4==f){if(8==c)for(d=0;d<i;d++){E=d<<2;var S=t[F=d<<1];s[E]=S,s[E+1]=S,s[E+2]=S,s[E+3]=t[F+1]}if(16==c)for(d=0;d<i;d++){var F;E=d<<2,S=t[F=d<<2];s[E]=S,s[E+1]=S,s[E+2]=S,s[E+3]=t[F+2]}}else if(0==f){g=o.tabs.tRNS?o.tabs.tRNS:-1;if(1==c)for(d=0;d<i;d++){var B=(S=255*(t[d>>3]>>7-(7&d)&1))==255*g?0:255;u[d]=B<<24|S<<16|S<<8|S}if(2==c)for(d=0;d<i;d++){B=(S=85*(t[d>>2]>>6-((3&d)<<1)&3))==85*g?0:255;u[d]=B<<24|S<<16|S<<8|S}if(4==c)for(d=0;d<i;d++){B=(S=17*(t[d>>1]>>4-((1&d)<<2)&15))==17*g?0:255;u[d]=B<<24|S<<16|S<<8|S}if(8==c)for(d=0;d<i;d++){B=(S=t[d])==g?0:255;u[d]=B<<24|S<<16|S<<8|S}if(16==c)for(d=0;d<i;d++){S=t[d<<1],B=h(t,d<<1)==g?0:255;u[d]=B<<24|S<<16|S<<8|S}}return s},e.decode=function(t){for(var n,r=new Uint8Array(t),o=8,i=e._bin,a=i.readUshort,l=i.readUint,s={tabs:{},frames:[]},u=new Uint8Array(r.length),f=0,c=0,h=[137,80,78,71,13,10,26,10],p=0;p<8;p++)if(r[p]!=h[p])throw"The input is not a PNG file!";for(;o<r.length;){var d=i.readUint(r,o);o+=4;var m=i.readASCII(r,o,4);if(o+=4,"IHDR"==m)e.decode._IHDR(r,o,s);else if("IDAT"==m){for(p=0;p<d;p++)u[f+p]=r[o+p];f+=d}else if("acTL"==m)s.tabs[m]={num_frames:l(r,o),num_plays:l(r,o+4)},n=new Uint8Array(r.length);else if("fcTL"==m){if(0!=c)(A=s.frames[s.frames.length-1]).data=e.decode._decompress(s,n.slice(0,c),A.rect.width,A.rect.height),c=0;var g={x:l(r,o+12),y:l(r,o+16),width:l(r,o+4),height:l(r,o+8)},v=a(r,o+22);v=a(r,o+20)/(0==v?100:v);var b={rect:g,delay:Math.round(1e3*v),dispose:r[o+24],blend:r[o+25]};s.frames.push(b)}else if("fdAT"==m){for(p=0;p<d-4;p++)n[c+p]=r[o+p+4];c+=d-4}else if("pHYs"==m)s.tabs[m]=[i.readUint(r,o),i.readUint(r,o+4),r[o+8]];else if("cHRM"==m){s.tabs[m]=[];for(p=0;p<8;p++)s.tabs[m].push(i.readUint(r,o+4*p))}else if("tEXt"==m){null==s.tabs[m]&&(s.tabs[m]={});var x=i.nextZero(r,o),y=i.readASCII(r,o,x-o),_=i.readASCII(r,x+1,o+d-x-1);s.tabs[m][y]=_}else if("iTXt"==m){null==s.tabs[m]&&(s.tabs[m]={});x=0;var w=o;x=i.nextZero(r,w);y=i.readASCII(r,w,x-w);w=x+1,w+=2,x=i.nextZero(r,w);i.readASCII(r,w,x-w);w=x+1,x=i.nextZero(r,w);i.readUTF8(r,w,x-w);w=x+1;_=i.readUTF8(r,w,d-(w-o));s.tabs[m][y]=_}else if("PLTE"==m)s.tabs[m]=i.readBytes(r,o,d);else if("hIST"==m){var C=s.tabs.PLTE.length/3;s.tabs[m]=[];for(p=0;p<C;p++)s.tabs[m].push(a(r,o+2*p))}else if("tRNS"==m)3==s.ctype?s.tabs[m]=i.readBytes(r,o,d):0==s.ctype?s.tabs[m]=a(r,o):2==s.ctype&&(s.tabs[m]=[a(r,o),a(r,o+2),a(r,o+4)]);else if("gAMA"==m)s.tabs[m]=i.readUint(r,o)/1e5;else if("sRGB"==m)s.tabs[m]=r[o];else if("bKGD"==m)0==s.ctype||4==s.ctype?s.tabs[m]=[a(r,o)]:2==s.ctype||6==s.ctype?s.tabs[m]=[a(r,o),a(r,o+2),a(r,o+4)]:3==s.ctype&&(s.tabs[m]=r[o]);else if("IEND"==m){var A;if(0!=c)(A=s.frames[s.frames.length-1]).data=e.decode._decompress(s,n.slice(0,c),A.rect.width,A.rect.height),c=0;s.data=e.decode._decompress(s,u,s.width,s.height);break}o+=d;i.readUint(r,o);o+=4}return delete s.compress,delete s.interlace,delete s.filter,s},e.decode._decompress=function(t,n,r,o){return 0==t.compress&&(n=e.decode._inflate(n)),0==t.interlace?n=e.decode._filterZero(n,t,0,r,o):1==t.interlace&&(n=e.decode._readInterlace(n,t)),n},e.decode._inflate=function(e){return t.inflate(e)},e.decode._readInterlace=function(t,n){for(var r=n.width,o=n.height,i=e.decode._getBPP(n),a=i>>3,l=Math.ceil(r*i/8),s=new Uint8Array(o*l),u=0,f=[0,0,4,0,2,0,1],c=[0,4,0,2,0,1,0],h=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1],d=0;d<7;){for(var m=h[d],g=p[d],v=0,b=0,x=f[d];x<o;)x+=m,b++;for(var y=c[d];y<r;)y+=g,v++;var _=Math.ceil(v*i/8);e.decode._filterZero(t,n,u,v,b);for(var w=0,C=f[d];C<o;){for(var A=c[d],T=u+w*_<<3;A<r;){var E;if(1==i)E=(E=t[T>>3])>>7-(7&T)&1,s[C*l+(A>>3)]|=E<<7-((3&A)<<0);if(2==i)E=(E=t[T>>3])>>6-(7&T)&3,s[C*l+(A>>2)]|=E<<6-((3&A)<<1);if(4==i)E=(E=t[T>>3])>>4-(7&T)&15,s[C*l+(A>>1)]|=E<<4-((1&A)<<2);if(i>=8)for(var D=C*l+A*a,L=0;L<a;L++)s[D+L]=t[(T>>3)+L];T+=i,A+=g}w++,C+=m}v*b!=0&&(u+=b*(1+_)),d+=1}return s},e.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},e.decode._filterZero=function(t,n,r,o,i){var a=e.decode._getBPP(n),l=Math.ceil(o*a/8),s=e.decode._paeth;a=Math.ceil(a/8);for(var u=0;u<i;u++){var f=r+u*l,c=f+u+1,h=t[c-1];if(0==h)for(var p=0;p<l;p++)t[f+p]=t[c+p];else if(1==h){for(p=0;p<a;p++)t[f+p]=t[c+p];for(p=a;p<l;p++)t[f+p]=t[c+p]+t[f+p-a]&255}else if(0==u){for(p=0;p<a;p++)t[f+p]=t[c+p];if(2==h)for(p=a;p<l;p++)t[f+p]=255&t[c+p];if(3==h)for(p=a;p<l;p++)t[f+p]=t[c+p]+(t[f+p-a]>>1)&255;if(4==h)for(p=a;p<l;p++)t[f+p]=t[c+p]+s(t[f+p-a],0,0)&255}else{if(2==h)for(p=0;p<l;p++)t[f+p]=t[c+p]+t[f+p-l]&255;if(3==h){for(p=0;p<a;p++)t[f+p]=t[c+p]+(t[f+p-l]>>1)&255;for(p=a;p<l;p++)t[f+p]=t[c+p]+(t[f+p-l]+t[f+p-a]>>1)&255}if(4==h){for(p=0;p<a;p++)t[f+p]=t[c+p]+s(0,t[f+p-l],0)&255;for(p=a;p<l;p++)t[f+p]=t[c+p]+s(t[f+p-a],t[f+p-l],t[f+p-a-l])&255}}}return t},e.decode._paeth=function(e,t,n){var r=e+t-n,o=Math.abs(r-e),i=Math.abs(r-t),a=Math.abs(r-n);return o<=i&&o<=a?e:i<=a?t:n},e.decode._IHDR=function(t,n,r){var o=e._bin;r.width=o.readUint(t,n),n+=4,r.height=o.readUint(t,n),n+=4,r.depth=t[n],n++,r.ctype=t[n],n++,r.compress=t[n],n++,r.filter=t[n],n++,r.interlace=t[n],n++},e._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII:function(e,t,n){for(var r="",o=0;o<n;o++)r+=String.fromCharCode(e[t+o]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},readBytes:function(e,t,n){for(var r=[],o=0;o<n;o++)r.push(e[t+o]);return r},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(t,n,r){for(var o,i="",a=0;a<r;a++)i+="%"+e._bin.pad(t[n+a].toString(16));try{o=decodeURIComponent(i)}catch(o){return e._bin.readASCII(t,n,r)}return o}},e._copyTile=function(e,t,n,r,o,i,a,l,s){for(var u=Math.min(t,o),f=Math.min(n,i),c=0,h=0,p=0;p<f;p++)for(var d=0;d<u;d++)if(a>=0&&l>=0?(c=p*t+d<<2,h=(l+p)*o+a+d<<2):(c=(-l+p)*t-a+d<<2,h=p*o+d<<2),0==s)r[h]=e[c],r[h+1]=e[c+1],r[h+2]=e[c+2],r[h+3]=e[c+3];else if(1==s){var m=e[c+3]*(1/255),g=e[c]*m,v=e[c+1]*m,b=e[c+2]*m,x=r[h+3]*(1/255),y=r[h]*x,_=r[h+1]*x,w=r[h+2]*x,C=1-m,A=m+x*C,T=0==A?0:1/A;r[h+3]=255*A,r[h+0]=(g+y*C)*T,r[h+1]=(v+_*C)*T,r[h+2]=(b+w*C)*T}else if(2==s){m=e[c+3],g=e[c],v=e[c+1],b=e[c+2],x=r[h+3],y=r[h],_=r[h+1],w=r[h+2];m==x&&g==y&&v==_&&b==w?(r[h]=0,r[h+1]=0,r[h+2]=0,r[h+3]=0):(r[h]=g,r[h+1]=v,r[h+2]=b,r[h+3]=m)}else if(3==s){m=e[c+3],g=e[c],v=e[c+1],b=e[c+2],x=r[h+3],y=r[h],_=r[h+1],w=r[h+2];if(m==x&&g==y&&v==_&&b==w)continue;if(m<220&&x>20)return!1}return!0},e.encode=function(t,n,r,o,i,a){null==o&&(o=0),null==a&&(a=!1);for(var l=new Uint8Array(t[0].byteLength*t.length+100),s=[137,80,78,71,13,10,26,10],u=0;u<8;u++)l[u]=s[u];var f=8,c=e._bin,h=e.crc.crc,p=c.writeUint,d=c.writeUshort,m=c.writeASCII,g=e.encode.compressPNG(t,n,r,o,a);p(l,f,13),m(l,f+=4,"IHDR"),p(l,f+=4,n),p(l,f+=4,r),l[f+=4]=g.depth,l[++f]=g.ctype,l[++f]=0,l[++f]=0,l[++f]=0,p(l,++f,h(l,f-17,17)),p(l,f+=4,1),m(l,f+=4,"sRGB"),l[f+=4]=1,p(l,++f,h(l,f-5,5)),f+=4;var v=t.length>1;if(v&&(p(l,f,8),m(l,f+=4,"acTL"),p(l,f+=4,t.length),p(l,f+=4,0),p(l,f+=4,h(l,f-12,12)),f+=4),3==g.ctype){p(l,f,3*(E=g.plte.length)),m(l,f+=4,"PLTE"),f+=4;for(u=0;u<E;u++){var b=3*u,x=g.plte[u],y=255&x,_=x>>8&255,w=x>>16&255;l[f+b+0]=y,l[f+b+1]=_,l[f+b+2]=w}if(p(l,f+=3*E,h(l,f-3*E-4,3*E+4)),f+=4,g.gotAlpha){p(l,f,E),m(l,f+=4,"tRNS"),f+=4;for(u=0;u<E;u++)l[f+u]=g.plte[u]>>24&255;p(l,f+=E,h(l,f-E-4,E+4)),f+=4}}for(var C=0,A=0;A<g.frames.length;A++){var T=g.frames[A];v&&(p(l,f,26),m(l,f+=4,"fcTL"),p(l,f+=4,C++),p(l,f+=4,T.rect.width),p(l,f+=4,T.rect.height),p(l,f+=4,T.rect.x),p(l,f+=4,T.rect.y),d(l,f+=4,i[A]),d(l,f+=2,1e3),l[f+=2]=T.dispose,l[++f]=T.blend,p(l,++f,h(l,f-30,30)),f+=4);var E,D=T.cimg;p(l,f,(E=D.length)+(0==A?0:4));var L=f+=4;m(l,f,0==A?"IDAT":"fdAT"),f+=4,0!=A&&(p(l,f,C++),f+=4);for(u=0;u<E;u++)l[f+u]=D[u];p(l,f+=E,h(l,L,f-L)),f+=4}return p(l,f,0),m(l,f+=4,"IEND"),p(l,f+=4,h(l,f-4,4)),f+=4,l.buffer.slice(0,f)},e.encode.compressPNG=function(t,n,r,o,i){for(var a=e.encode.compress(t,n,r,o,!1,i),l=0;l<t.length;l++){var s=a.frames[l],u=(s.rect.width,s.rect.height),f=s.bpl,c=s.bpp,h=new Uint8Array(u*f+u);s.cimg=e.encode._filterZero(s.img,u,c,f,h)}return a},e.encode.compress=function(t,n,r,o,i,a){null==a&&(a=!1);for(var l=6,s=8,u=4,f=255,c=0;c<t.length;c++)for(var h=new Uint8Array(t[c]),p=h.length,d=0;d<p;d+=4)f&=h[d+3];var m=255!=f,g={},v=[];if(0!=t.length&&(g[0]=0,v.push(0),0!=o&&o--),0!=o){var b=e.quantize(t,o,i);t=b.bufs;for(d=0;d<b.plte.length;d++){null==g[y=b.plte[d].est.rgba]&&(g[y]=v.length,v.push(y))}}else for(c=0;c<t.length;c++){var x=new Uint32Array(t[c]);for(p=x.length,d=0;d<p;d++){var y=x[d];if((d<n||y!=x[d-1]&&y!=x[d-n])&&null==g[y]&&(g[y]=v.length,v.push(y),v.length>=300))break}}var _=!!m&&i,w=v.length;w<=256&&0==a&&(s=w<=2?1:w<=4?2:w<=16?4:8,i&&(s=8),m=!0);var C=[];for(c=0;c<t.length;c++){var A=new Uint8Array(t[c]),T=new Uint32Array(A.buffer),E=0,D=0,L=n,S=r,F=0;if(0!=c&&!_){for(var B=i||1==c||2==C[C.length-2].dispose?1:2,k=0,M=1e9,O=0;O<B;O++){for(var I=new Uint8Array(t[c-1-O]),R=new Uint32Array(t[c-1-O]),N=n,z=r,H=-1,V=-1,P=0;P<r;P++)for(var U=0;U<n;U++){T[d=P*n+U]!=R[d]&&(U<N&&(N=U),U>H&&(H=U),P<z&&(z=P),P>V&&(V=P))}var j=-1==H?1:(H-N+1)*(V-z+1);j<M&&(M=j,k=O,-1==H?(E=D=0,L=S=1):(E=N,D=z,L=H-N+1,S=V-z+1))}I=new Uint8Array(t[c-1-k]);1==k&&(C[C.length-1].dispose=2);var G=new Uint8Array(L*S*4);new Uint32Array(G.buffer);e._copyTile(I,n,r,G,L,S,-E,-D,0),e._copyTile(A,n,r,G,L,S,-E,-D,3)?(e._copyTile(A,n,r,G,L,S,-E,-D,2),F=1):(e._copyTile(A,n,r,G,L,S,-E,-D,0),F=0),A=G,T=new Uint32Array(A.buffer)}var q=4*L;if(w<=256&&0==a){q=Math.ceil(s*L/8);for(G=new Uint8Array(q*S),P=0;P<S;P++){d=P*q;var W=P*L;if(8==s)for(U=0;U<L;U++)G[d+U]=g[T[W+U]];else if(4==s)for(U=0;U<L;U++)G[d+(U>>1)]|=g[T[W+U]]<<4-4*(1&U);else if(2==s)for(U=0;U<L;U++)G[d+(U>>2)]|=g[T[W+U]]<<6-2*(3&U);else if(1==s)for(U=0;U<L;U++)G[d+(U>>3)]|=g[T[W+U]]<<7-1*(7&U)}A=G,l=3,u=1}else if(0==m&&1==t.length){G=new Uint8Array(L*S*3);var Z=L*S;for(d=0;d<Z;d++){var X=3*d,Y=4*d;G[X]=A[Y],G[X+1]=A[Y+1],G[X+2]=A[Y+2]}A=G,l=2,u=3,q=3*L}C.push({rect:{x:E,y:D,width:L,height:S},img:A,bpl:q,bpp:u,blend:F,dispose:_?1:0})}return{ctype:l,depth:s,plte:v,gotAlpha:m,frames:C}},e.encode._filterZero=function(n,r,o,i,a){for(var l=[],s=0;s<5;s++)if(!(r*i>5e5)||2!=s&&3!=s&&4!=s){for(var u=0;u<r;u++)e.encode._filterLine(a,n,u,i,o,s);if(l.push(t.deflate(a)),1==o)break}for(var f,c=1e9,h=0;h<l.length;h++)l[h].length<c&&(f=h,c=l[h].length);return l[f]},e.encode._filterLine=function(t,n,r,o,i,a){var l=r*o,s=l+r,u=e.decode._paeth;if(t[s]=a,s++,0==a)for(var f=0;f<o;f++)t[s+f]=n[l+f];else if(1==a){for(f=0;f<i;f++)t[s+f]=n[l+f];for(f=i;f<o;f++)t[s+f]=n[l+f]-n[l+f-i]+256&255}else if(0==r){for(f=0;f<i;f++)t[s+f]=n[l+f];if(2==a)for(f=i;f<o;f++)t[s+f]=n[l+f];if(3==a)for(f=i;f<o;f++)t[s+f]=n[l+f]-(n[l+f-i]>>1)+256&255;if(4==a)for(f=i;f<o;f++)t[s+f]=n[l+f]-u(n[l+f-i],0,0)+256&255}else{if(2==a)for(f=0;f<o;f++)t[s+f]=n[l+f]+256-n[l+f-o]&255;if(3==a){for(f=0;f<i;f++)t[s+f]=n[l+f]+256-(n[l+f-o]>>1)&255;for(f=i;f<o;f++)t[s+f]=n[l+f]+256-(n[l+f-o]+n[l+f-i]>>1)&255}if(4==a){for(f=0;f<i;f++)t[s+f]=n[l+f]+256-u(0,n[l+f-o],0)&255;for(f=i;f<o;f++)t[s+f]=n[l+f]+256-u(n[l+f-i],n[l+f-o],n[l+f-i-o])&255}}},e.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(t,n,r,o){for(var i=0;i<o;i++)t=e.crc.table[255&(t^n[r+i])]^t>>>8;return t},crc:function(t,n,r){return 4294967295^e.crc.update(4294967295,t,n,r)}},e.quantize=function(t,n,r){for(var o=[],i=0,a=0;a<t.length;a++)o.push(e.encode.alphaMul(new Uint8Array(t[a]),r)),i+=t[a].byteLength;var l=new Uint8Array(i),s=new Uint32Array(l.buffer),u=0;for(a=0;a<o.length;a++){for(var f=o[a],c=f.length,h=0;h<c;h++)l[u+h]=f[h];u+=c}var p={i0:0,i1:l.length,bst:null,est:null,tdst:0,left:null,right:null};p.bst=e.quantize.stats(l,p.i0,p.i1),p.est=e.quantize.estats(p.bst);for(var d=[p];d.length<n;){var m=0,g=0;for(a=0;a<d.length;a++)d[a].est.L>m&&(m=d[a].est.L,g=a);if(m<.001)break;var v=d[g],b=e.quantize.splitPixels(l,s,v.i0,v.i1,v.est.e,v.est.eMq255),x={i0:v.i0,i1:b,bst:null,est:null,tdst:0,left:null,right:null};x.bst=e.quantize.stats(l,x.i0,x.i1),x.est=e.quantize.estats(x.bst);var y={i0:b,i1:v.i1,bst:null,est:null,tdst:0,left:null,right:null};y.bst={R:[],m:[],N:v.bst.N-x.bst.N};for(a=0;a<16;a++)y.bst.R[a]=v.bst.R[a]-x.bst.R[a];for(a=0;a<4;a++)y.bst.m[a]=v.bst.m[a]-x.bst.m[a];y.est=e.quantize.estats(y.bst),v.left=x,v.right=y,d[g]=x,d.push(y)}d.sort((function(e,t){return t.bst.N-e.bst.N}));for(var _=0;_<o.length;_++){var w=e.quantize.planeDst,C=new Uint8Array(o[_].buffer),A=new Uint32Array(o[_].buffer),T=C.length;for(a=0;a<T;a+=4){for(var E=C[a]*(1/255),D=C[a+1]*(1/255),L=C[a+2]*(1/255),S=C[a+3]*(1/255),F=p;F.left;)F=w(F.est,E,D,L,S)<=0?F.left:F.right;A[a>>2]=F.est.rgba}o[_]=A.buffer}return{bufs:o,plte:d}},e.quantize.getNearest=function(t,n,r,o,i){if(null==t.left)return t.tdst=e.quantize.dist(t.est.q,n,r,o,i),t;var a=e.quantize.planeDst(t.est,n,r,o,i),l=t.left,s=t.right;a>0&&(l=t.right,s=t.left);var u=e.quantize.getNearest(l,n,r,o,i);if(u.tdst<=a*a)return u;var f=e.quantize.getNearest(s,n,r,o,i);return f.tdst<u.tdst?f:u},e.quantize.planeDst=function(e,t,n,r,o){var i=e.e;return i[0]*t+i[1]*n+i[2]*r+i[3]*o-e.eMq},e.quantize.dist=function(e,t,n,r,o){var i=t-e[0],a=n-e[1],l=r-e[2],s=o-e[3];return i*i+a*a+l*l+s*s},e.quantize.splitPixels=function(t,n,r,o,i,a){var l=e.quantize.vecDot;for(o-=4;r<o;){for(;l(t,r,i)<=a;)r+=4;for(;l(t,o,i)>a;)o-=4;if(r>=o)break;var s=n[r>>2];n[r>>2]=n[o>>2],n[o>>2]=s,r+=4,o-=4}for(;l(t,r,i)>a;)r-=4;return r+4},e.quantize.vecDot=function(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]},e.quantize.stats=function(e,t,n){for(var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=[0,0,0,0],i=n-t>>2,a=t;a<n;a+=4){var l=e[a]*(1/255),s=e[a+1]*(1/255),u=e[a+2]*(1/255),f=e[a+3]*(1/255);o[0]+=l,o[1]+=s,o[2]+=u,o[3]+=f,r[0]+=l*l,r[1]+=l*s,r[2]+=l*u,r[3]+=l*f,r[5]+=s*s,r[6]+=s*u,r[7]+=s*f,r[10]+=u*u,r[11]+=u*f,r[15]+=f*f}return r[4]=r[1],r[8]=r[2],r[12]=r[3],r[9]=r[6],r[13]=r[7],r[14]=r[11],{R:r,m:o,N:i}},e.quantize.estats=function(t){var n=t.R,r=t.m,o=t.N,i=r[0],a=r[1],l=r[2],s=r[3],u=0==o?0:1/o,f=[n[0]-i*i*u,n[1]-i*a*u,n[2]-i*l*u,n[3]-i*s*u,n[4]-a*i*u,n[5]-a*a*u,n[6]-a*l*u,n[7]-a*s*u,n[8]-l*i*u,n[9]-l*a*u,n[10]-l*l*u,n[11]-l*s*u,n[12]-s*i*u,n[13]-s*a*u,n[14]-s*l*u,n[15]-s*s*u],c=f,h=e.M4,p=[.5,.5,.5,.5],d=0,m=0;if(0!=o)for(var g=0;g<10&&(p=h.multVec(c,p),m=Math.sqrt(h.dot(p,p)),p=h.sml(1/m,p),!(Math.abs(m-d)<1e-9));g++)d=m;var v=[i*u,a*u,l*u,s*u],b=h.dot(h.sml(255,v),p),x=v[3]<.001?0:1/v[3];return{Cov:f,q:v,e:p,L:d,eMq255:b,eMq:h.dot(p,v),rgba:(Math.round(255*v[3])<<24|Math.round(255*v[2]*x)<<16|Math.round(255*v[1]*x)<<8|Math.round(255*v[0]*x)<<0)>>>0}},e.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},e.encode.alphaMul=function(e,t){for(var n=new Uint8Array(e.length),r=e.length>>2,o=0;o<r;o++){var i=o<<2,a=e[i+3];t&&(a=a<128?0:255);var l=a*(1/255);n[i+0]=e[i+0]*l,n[i+1]=e[i+1]*l,n[i+2]=e[i+2]*l,n[i+3]=a}return n}}(t,Uo)}()})),Go=[0,0,0,0],qo=1024,Wo=.017453292519943295,Zo=.0333334,Xo=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/,Yo=/(?:#)[0-9a-f]{8}|(?:#)[0-9a-f]{6}|(?:#)[0-9a-f]{4}|(?:#)[0-9a-f]{3}/gi;function $o(){var e=new Uint8Array([170,187]);return 48042===new Uint16Array(e.buffer)[0]}function Ko(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];return new Array(n).fill(void 0).map((function(e,t){return t}))}var r=e[0],o=(n=e[1],e[2]),i=void 0===o?1:o;if(0===i)throw new Error("Argument step must be nonzero.");for(var a=[],l=r;i>0?l<n:l>n;l+=i)a.push(l);return a}function Qo(e,t,n){return r(this,void 0,void 0,(function(){return o(this,(function(r){return[2,new Promise((function(t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.addEventListener("load",(function(){t(r.response)})),r.addEventListener("error",n),r.send(null)})).then((function(e){var t=jo.decode(e),n=jo.toRGBA8(t)[0];return new Uint8Array(n)})).catch((function(){return oi(t,n)}))]}))}))}function Jo(e,t){return e.byteLength===t.byteLength&&e.every((function(e,n){return e===t[n]}))}function ei(e){var t=e[0],n=t.x,r=t.y,o=e[1],i=o.x,a=o.y;return[[n,r],[i,r],[n,a],[i,a]]}function ti(e){var t=e[0],n=t.x,r=t.y,o=e[1],i=o.x,a=o.y;return[[n,r],[i,r],[n,a],[i,a],[i,r],[n,a]]}function ni(e){return new Promise((function(t){return setTimeout(t,e)}))}function ri(e,t){var n=e.z-t.z,r=e.x-t.x,o=e.y-t.y;return 0!==n?n:0!==r?r:o}var oi=$e((function(e,t){void 0===t&&(t=256);var n=new Float32Array(t*t);return n.fill(e),new Uint8Array(n.buffer)}));function ii(e,t){return Object.keys(t).map((function(e){return"#define "+e+" "+t[e]+"\n"})).join("")+"\n"+e}function ai(e,t){var n=[e.framebuffer(t),e.framebuffer(t)],r=0;return{ping:function(){return n[r]},pong:function(){return n[1-r]},swap:function(){r=1-r},destroy:function(){n[0].destroy(),n[1].destroy()}}}function li(e){if("transparent"===e)return[0,0,0,0];var t=e.match(Xo),n=e.match(Yo);if(null!==t)return[+t[1],+t[2],+t[3],255];if(null!==n)return function(e){var t=9===e.length,n=t?24:16,r=parseInt(e.slice(1),16);return[r>>n&255,r>>n-8&255,r>>n-16&255,t?r>>n-24&255:255]}(e);throw new Error("'"+e+"' is not a valid RGB or hex color expression.")}function si(e,t){var n=function(e){for(var t=[],n=[],r=0;r<e.length;r++){t.push(e[r].offset);var o=li(e[r].color);n=n.concat(o)}var i=new Float32Array(t),a=new Uint8Array(i.buffer),l=Array.from(a);return n.concat(l)}(e);return 0===e.length?t.texture({shape:[2,2]}):t.texture({width:e.length,height:2,data:n})}function ui(e,t,n,i){return r(this,void 0,void 0,(function(){var r,a,l,s,u,f,c,h,p,d,m;return o(this,(function(o){switch(o.label){case 0:r=t.contents,a=3,l=[],s=0,o.label=1;case 1:if(!(s<a))return[3,7];u=n.x+(s-1),f=0,o.label=2;case 2:return f<a?(c=n.y+(f-1),h={x:u,y:c,z:n.z},p=t.hashTileCoordinates(h),r.has(p)?[3,4]:[4,e._fetchTileData(h,i)]):[3,6];case 3:return d=o.sent(),m=e._renderer.textureManager.addTile(h,d),l=l.concat(ti(m)),[3,5];case 4:m=e._renderer.textureManager.getTextureCoordinates(h),l=l.concat(ti(m)),o.label=5;case 5:return f++,[3,2];case 6:return s++,[3,1];case 7:return[2,l]}}))}))}function fi(e){return new Promise((function(t){setTimeout(t,e)}))}var ci="http://www.w3.org/1999/xhtml",hi={svg:"http://www.w3.org/2000/svg",xhtml:ci,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function pi(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),hi.hasOwnProperty(t)?{space:hi[t],local:e}:e}function di(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ci&&t.documentElement.namespaceURI===ci?t.createElement(e):t.createElementNS(n,e)}}function mi(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function gi(e){var t=pi(e);return(t.local?mi:di)(t)}function vi(){}function bi(e){return null==e?vi:function(){return this.querySelector(e)}}function xi(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function yi(){return[]}function _i(e){return function(t){return t.matches(e)}}var wi=Array.prototype.find;function Ci(){return this.firstElementChild}var Ai=Array.prototype.filter;function Ti(){return this.children}function Ei(e){return new Array(e.length)}function Di(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Li(e){return function(){return e}}function Si(e,t,n,r,o,i){for(var a,l=0,s=t.length,u=i.length;l<u;++l)(a=t[l])?(a.__data__=i[l],r[l]=a):n[l]=new Di(e,i[l]);for(;l<s;++l)(a=t[l])&&(o[l]=a)}function Fi(e,t,n,r,o,i,a){var l,s,u,f=new Map,c=t.length,h=i.length,p=new Array(c);for(l=0;l<c;++l)(s=t[l])&&(p[l]=u=a.call(s,s.__data__,l,t)+"",f.has(u)?o[l]=s:f.set(u,s));for(l=0;l<h;++l)u=a.call(e,i[l],l,i)+"",(s=f.get(u))?(r[l]=s,s.__data__=i[l],f.delete(u)):n[l]=new Di(e,i[l]);for(l=0;l<c;++l)(s=t[l])&&f.get(p[l])===s&&(o[l]=s)}function Bi(e){return e.__data__}function ki(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Mi(e){return function(){this.removeAttribute(e)}}function Oi(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ii(e,t){return function(){this.setAttribute(e,t)}}function Ri(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ni(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function zi(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Hi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Vi(e){return function(){this.style.removeProperty(e)}}function Pi(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ui(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function ji(e,t){return e.style.getPropertyValue(t)||Hi(e).getComputedStyle(e,null).getPropertyValue(t)}function Gi(e){return function(){delete this[e]}}function qi(e,t){return function(){this[e]=t}}function Wi(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Zi(e){return e.trim().split(/^|\s+/)}function Xi(e){return e.classList||new Yi(e)}function Yi(e){this._node=e,this._names=Zi(e.getAttribute("class")||"")}function $i(e,t){for(var n=Xi(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Ki(e,t){for(var n=Xi(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function Qi(e){return function(){$i(this,e)}}function Ji(e){return function(){Ki(this,e)}}function ea(e,t){return function(){(t.apply(this,arguments)?$i:Ki)(this,e)}}function ta(){this.textContent=""}function na(e){return function(){this.textContent=e}}function ra(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function oa(){this.innerHTML=""}function ia(e){return function(){this.innerHTML=e}}function aa(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function la(){this.nextSibling&&this.parentNode.appendChild(this)}function sa(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ua(){return null}function fa(){var e=this.parentNode;e&&e.removeChild(this)}function ca(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ha(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function pa(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function da(e){return function(){var t=this.__on;if(t){for(var n,r=0,o=-1,i=t.length;r<i;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++o]=n:this.removeEventListener(n.type,n.listener,n.options);++o?t.length=o:delete this.__on}}}function ma(e,t,n){return function(){var r,o=this.__on,i=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(o)for(var a=0,l=o.length;a<l;++a)if((r=o[a]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=t);this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},o?o.push(r):this.__on=[r]}}function ga(e,t,n){var r=Hi(e),o=r.CustomEvent;"function"==typeof o?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function va(e,t){return function(){return ga(this,e,t)}}function ba(e,t){return function(){return ga(this,e,t.apply(this,arguments))}}Di.prototype={constructor:Di,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},Yi.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var xa=[null];function ya(e,t){this._groups=e,this._parents=t}function _a(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function wa(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ca(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Aa(){}ya.prototype=function(){return new ya([[document.documentElement]],xa)}.prototype={constructor:ya,select:function(e){"function"!=typeof e&&(e=bi(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a,l=t[o],s=l.length,u=r[o]=new Array(s),f=0;f<s;++f)(i=l[f])&&(a=e.call(i,i.__data__,f,l))&&("__data__"in i&&(a.__data__=i.__data__),u[f]=a);return new ya(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);return null==t?[]:xi(t)}}(e):function(e){return null==e?yi:function(){return this.querySelectorAll(e)}}(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var a,l=t[i],s=l.length,u=0;u<s;++u)(a=l[u])&&(r.push(e.call(a,a.__data__,u,l)),o.push(a));return new ya(r,o)},selectChild:function(e){return this.select(null==e?Ci:function(e){return function(){return wi.call(this.children,e)}}("function"==typeof e?e:_i(e)))},selectChildren:function(e){return this.selectAll(null==e?Ti:function(e){return function(){return Ai.call(this.children,e)}}("function"==typeof e?e:_i(e)))},filter:function(e){"function"!=typeof e&&(e=function(e){return function(){return this.matches(e)}}(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a=t[o],l=a.length,s=r[o]=[],u=0;u<l;++u)(i=a[u])&&e.call(i,i.__data__,u,a)&&s.push(i);return new ya(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,Bi);var n=t?Fi:Si,r=this._parents,o=this._groups;"function"!=typeof e&&(e=Li(e));for(var i=o.length,a=new Array(i),l=new Array(i),s=new Array(i),u=0;u<i;++u){var f=r[u],c=o[u],h=c.length,p=xi(e.call(f,f&&f.__data__,u,r)),d=p.length,m=l[u]=new Array(d),g=a[u]=new Array(d),v=s[u]=new Array(h);n(f,c,m,g,v,p,t);for(var b,x,y=0,_=0;y<d;++y)if(b=m[y]){for(y>=_&&(_=y+1);!(x=g[_])&&++_<d;);b._next=x||null}}return(a=new ya(a,r))._enter=l,a._exit=s,a},enter:function(){return new ya(this._enter||this._groups.map(Ei),this._parents)},exit:function(){return new ya(this._exit||this._groups.map(Ei),this._parents)},join:function(e,t,n){var r=this.enter(),o=this,i=this.exit();return r="function"==typeof e?e(r):r.append(e+""),null!=t&&(o=t(o)),null==n?i.remove():n(i),r&&o?r.merge(o).order():o},merge:function(e){if(!(e instanceof ya))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),a=new Array(r),l=0;l<i;++l)for(var s,u=t[l],f=n[l],c=u.length,h=a[l]=new Array(c),p=0;p<c;++p)(s=u[p]||f[p])&&(h[p]=s);for(;l<r;++l)a[l]=t[l];return new ya(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,o=e[t],i=o.length-1,a=o[i];--i>=0;)(r=o[i])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=ki);for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var a,l=n[i],s=l.length,u=o[i]=new Array(s),f=0;f<s;++f)(a=l[f])&&(u[f]=a);u.sort(t)}return new ya(o,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var a=r[o];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o,i=t[n],a=0,l=i.length;a<l;++a)(o=i[a])&&e.call(o,o.__data__,a,i);return this},attr:function(e,t){var n=pi(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?Oi:Mi:"function"==typeof t?n.local?zi:Ni:n.local?Ri:Ii)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Vi:"function"==typeof t?Ui:Pi)(e,t,null==n?"":n)):ji(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Gi:"function"==typeof t?Wi:qi)(e,t)):this.node()[e]},classed:function(e,t){var n=Zi(e+"");if(arguments.length<2){for(var r=Xi(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each(("function"==typeof t?ea:t?Qi:Ji)(n,t))},text:function(e){return arguments.length?this.each(null==e?ta:("function"==typeof e?ra:na)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?oa:("function"==typeof e?aa:ia)(e)):this.node().innerHTML},raise:function(){return this.each(la)},lower:function(){return this.each(sa)},append:function(e){var t="function"==typeof e?e:gi(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:gi(e),r=null==t?ua:"function"==typeof t?t:bi(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(fa)},clone:function(e){return this.select(e?ha:ca)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,o,i=pa(e+""),a=i.length;if(!(arguments.length<2)){for(l=t?ma:da,r=0;r<a;++r)this.each(l(i[r],t,n));return this}var l=this.node().__on;if(l)for(var s,u=0,f=l.length;u<f;++u)for(r=0,s=l[u];r<a;++r)if((o=i[r]).type===s.type&&o.name===s.name)return s.value},dispatch:function(e,t){return this.each(("function"==typeof t?ba:va)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,o=e[t],i=0,a=o.length;i<a;++i)(r=o[i])&&(yield r)}};var Ta=.7,Ea=1/Ta,Da="\\s*([+-]?\\d+)\\s*",La="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Sa="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fa=/^#([0-9a-f]{3,8})$/,Ba=new RegExp("^rgb\\("+[Da,Da,Da]+"\\)$"),ka=new RegExp("^rgb\\("+[Sa,Sa,Sa]+"\\)$"),Ma=new RegExp("^rgba\\("+[Da,Da,Da,La]+"\\)$"),Oa=new RegExp("^rgba\\("+[Sa,Sa,Sa,La]+"\\)$"),Ia=new RegExp("^hsl\\("+[La,Sa,Sa]+"\\)$"),Ra=new RegExp("^hsla\\("+[La,Sa,Sa,La]+"\\)$"),Na={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function za(){return this.rgb().formatHex()}function Ha(){return this.rgb().formatRgb()}function Va(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Fa.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Pa(t):3===n?new qa(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ua(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ua(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Ba.exec(e))?new qa(t[1],t[2],t[3],1):(t=ka.exec(e))?new qa(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ma.exec(e))?Ua(t[1],t[2],t[3],t[4]):(t=Oa.exec(e))?Ua(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Ia.exec(e))?Ya(t[1],t[2]/100,t[3]/100,1):(t=Ra.exec(e))?Ya(t[1],t[2]/100,t[3]/100,t[4]):Na.hasOwnProperty(e)?Pa(Na[e]):"transparent"===e?new qa(NaN,NaN,NaN,0):null}function Pa(e){return new qa(e>>16&255,e>>8&255,255&e,1)}function Ua(e,t,n,r){return r<=0&&(e=t=n=NaN),new qa(e,t,n,r)}function ja(e){return e instanceof Aa||(e=Va(e)),e?new qa((e=e.rgb()).r,e.g,e.b,e.opacity):new qa}function Ga(e,t,n,r){return 1===arguments.length?ja(e):new qa(e,t,n,null==r?1:r)}function qa(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Wa(){return"#"+Xa(this.r)+Xa(this.g)+Xa(this.b)}function Za(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Xa(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Ya(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ka(e,t,n,r)}function $a(e){if(e instanceof Ka)return new Ka(e.h,e.s,e.l,e.opacity);if(e instanceof Aa||(e=Va(e)),!e)return new Ka;if(e instanceof Ka)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),i=Math.max(t,n,r),a=NaN,l=i-o,s=(i+o)/2;return l?(a=t===i?(n-r)/l+6*(n<r):n===i?(r-t)/l+2:(t-n)/l+4,l/=s<.5?i+o:2-i-o,a*=60):l=s>0&&s<1?0:a,new Ka(a,l,s,e.opacity)}function Ka(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Qa(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Ja(e){return function(){return e}}function el(e){return 1==(e=+e)?tl:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Ja(isNaN(t)?n:t)}}function tl(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Ja(isNaN(e)?t:e)}wa(Aa,Va,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:za,formatHex:za,formatHsl:function(){return $a(this).formatHsl()},formatRgb:Ha,toString:Ha}),wa(qa,Ga,Ca(Aa,{brighter:function(e){return e=null==e?Ea:Math.pow(Ea,e),new qa(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Ta:Math.pow(Ta,e),new qa(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Wa,formatHex:Wa,formatRgb:Za,toString:Za})),wa(Ka,(function(e,t,n,r){return 1===arguments.length?$a(e):new Ka(e,t,n,null==r?1:r)}),Ca(Aa,{brighter:function(e){return e=null==e?Ea:Math.pow(Ea,e),new Ka(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ta:Math.pow(Ta,e),new Ka(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new qa(Qa(e>=240?e-240:e+120,o,r),Qa(e,o,r),Qa(e<120?e+240:e-120,o,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var nl=function e(t){var n=el(t);function r(e,t){var r=n((e=Ga(e)).r,(t=Ga(t)).r),o=n(e.g,t.g),i=n(e.b,t.b),a=tl(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=o(t),e.b=i(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function rl(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,o=t.slice();return function(i){for(n=0;n<r;++n)o[n]=e[n]*(1-i)+t[n]*i;return o}}function ol(e,t){var n,r=t?t.length:0,o=e?Math.min(r,e.length):0,i=new Array(o),a=new Array(r);for(n=0;n<o;++n)i[n]=cl(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<o;++n)a[n]=i[n](e);return a}}function il(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function al(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ll(e,t){var n,r={},o={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=cl(e[n],t[n]):o[n]=t[n];return function(e){for(n in r)o[n]=r[n](e);return o}}var sl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ul=new RegExp(sl.source,"g");function fl(e,t){var n,r,o,i=sl.lastIndex=ul.lastIndex=0,a=-1,l=[],s=[];for(e+="",t+="";(n=sl.exec(e))&&(r=ul.exec(t));)(o=r.index)>i&&(o=t.slice(i,o),l[a]?l[a]+=o:l[++a]=o),(n=n[0])===(r=r[0])?l[a]?l[a]+=r:l[++a]=r:(l[++a]=null,s.push({i:a,x:al(n,r)})),i=ul.lastIndex;return i<t.length&&(o=t.slice(i),l[a]?l[a]+=o:l[++a]=o),l.length<2?s[0]?function(e){return function(t){return e(t)+""}}(s[0].x):function(e){return function(){return e}}(t):(t=s.length,function(e){for(var n,r=0;r<t;++r)l[(n=s[r]).i]=n.x(e);return l.join("")})}function cl(e,t){var n,r,o=typeof t;return null==t||"boolean"===o?Ja(t):("number"===o?al:"string"===o?(n=Va(t))?(t=n,nl):fl:t instanceof Va?nl:t instanceof Date?il:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?ol:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?ll:al:rl))(e,t)}function hl(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function pl(e){return+e}var dl=[0,1];function ml(e){return e}function gl(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function vl(e,t,n){var r=e[0],o=e[1],i=t[0],a=t[1];return o<r?(r=gl(o,r),i=n(a,i)):(r=gl(r,o),i=n(i,a)),function(e){return i(r(e))}}function bl(e,t,n){var r=Math.min(e.length,t.length)-1,o=new Array(r),i=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)o[a]=gl(e[a],e[a+1]),i[a]=n(t[a],t[a+1]);return function(t){var n=yn(e,t,1,r)-1;return i[n](o[n](t))}}function xl(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yl(){var e,t,n,r,o,i,a=dl,l=dl,s=cl,u=ml;function f(){var e,t,n,s=Math.min(a.length,l.length);return u!==ml&&(e=a[0],t=a[s-1],e>t&&(n=e,e=t,t=n),u=function(n){return Math.max(e,Math.min(t,n))}),r=s>2?bl:vl,o=i=null,c}function c(t){return isNaN(t=+t)?n:(o||(o=r(a.map(e),l,s)))(e(u(t)))}return c.invert=function(n){return u(t((i||(i=r(l,a.map(e),al)))(n)))},c.domain=function(e){return arguments.length?(a=Array.from(e,pl),f()):a.slice()},c.range=function(e){return arguments.length?(l=Array.from(e),f()):l.slice()},c.rangeRound=function(e){return l=Array.from(e),s=hl,f()},c.clamp=function(e){return arguments.length?(u=!!e||ml,f()):u!==ml},c.interpolate=function(e){return arguments.length?(s=e,f()):s},c.unknown=function(e){return arguments.length?(n=e,c):n},function(n,r){return e=n,t=r,f()}}function _l(){return yl()(ml,ml)}function wl(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Cl(e){return(e=wl(Math.abs(e)))?e[1]:NaN}var Al,Tl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function El(e){if(!(t=Tl.exec(e)))throw new Error("invalid format: "+e);var t;return new Dl({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Dl(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Ll(e,t){var n=wl(e,t);if(!n)return e+"";var r=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}El.prototype=Dl.prototype,Dl.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Sl={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Ll(100*e,t),r:Ll,s:function(e,t){var n=wl(e,t);if(!n)return e+"";var r=n[0],o=n[1],i=o-(Al=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,a=r.length;return i===a?r:i>a?r+new Array(i-a+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+wl(e,Math.max(0,t+i-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Fl(e){return e}var Bl,kl,Ml,Ol=Array.prototype.map,Il=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Rl(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Fl:(t=Ol.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var o=e.length,i=[],a=0,l=t[0],s=0;o>0&&l>0&&(s+l+1>r&&(l=Math.max(1,r-s)),i.push(e.substring(o-=l,o+l)),!((s+=l+1)>r));)l=t[a=(a+1)%t.length];return i.reverse().join(n)}),o=void 0===e.currency?"":e.currency[0]+"",i=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",l=void 0===e.numerals?Fl:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Ol.call(e.numerals,String)),s=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"":e.minus+"",f=void 0===e.nan?"NaN":e.nan+"";function c(e){var t=(e=El(e)).fill,n=e.align,c=e.sign,h=e.symbol,p=e.zero,d=e.width,m=e.comma,g=e.precision,v=e.trim,b=e.type;"n"===b?(m=!0,b="g"):Sl[b]||(void 0===g&&(g=12),v=!0,b="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var x="$"===h?o:"#"===h&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",y="$"===h?i:/[%p]/.test(b)?s:"",_=Sl[b],w=/[defgprs%]/.test(b);function C(e){var o,i,s,h=x,C=y;if("c"===b)C=_(e)+C,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?f:_(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,o=-1;r<n;++r)switch(e[r]){case".":o=t=r;break;case"0":0===o&&(o=r),t=r;break;default:if(!+e[r])break e;o>0&&(o=0)}return o>0?e.slice(0,o)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==c&&(A=!1),h=(A?"("===c?c:u:"-"===c||"("===c?"":c)+h,C=("s"===b?Il[8+Al/3]:"")+C+(A&&"("===c?")":""),w)for(o=-1,i=e.length;++o<i;)if(48>(s=e.charCodeAt(o))||s>57){C=(46===s?a+e.slice(o+1):e.slice(o))+C,e=e.slice(0,o);break}}m&&!p&&(e=r(e,1/0));var T=h.length+e.length+C.length,E=T<d?new Array(d-T+1).join(t):"";switch(m&&p&&(e=r(E+e,E.length?d-C.length:1/0),E=""),n){case"<":e=h+e+C+E;break;case"=":e=h+E+e+C;break;case"^":e=E.slice(0,T=E.length>>1)+h+e+C+E.slice(T);break;default:e=E+h+e+C}return l(e)}return g=void 0===g?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),C.toString=function(){return e+""},C}return{format:c,formatPrefix:function(e,t){var n=c(((e=El(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Cl(t)/3))),o=Math.pow(10,-r),i=Il[8+r/3];return function(e){return n(o*e)+i}}}}function Nl(e,t,n,r){var o,i=Dn(e,t,n);switch((r=El(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(o=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Cl(t)/3)))-Cl(Math.abs(e)))}(i,a))||(r.precision=o),Ml(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(o=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Cl(t)-Cl(e))+1}(i,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=o-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(o=function(e){return Math.max(0,-Cl(Math.abs(e)))}(i))||(r.precision=o-2*("%"===r.type))}return kl(r)}function zl(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var r,o,i,a,l=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(o=e,e=t,t=o),0===(a=En(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),i=new Array(o=Math.ceil(t-e+1));++l<o;)i[l]=(e+l)*a;else for(a=-a,e=Math.ceil(e*a),t=Math.floor(t*a),i=new Array(o=Math.ceil(t-e+1));++l<o;)i[l]=(e+l)/a;return r&&i.reverse(),i}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return Nl(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,o,i=t(),a=0,l=i.length-1,s=i[a],u=i[l],f=10;for(u<s&&(o=s,s=u,u=o,o=a,a=l,l=o);f-- >0;){if((o=En(s,u,n))===r)return i[a]=s,i[l]=u,t(i);if(o>0)s=Math.floor(s/o)*o,u=Math.ceil(u/o)*o;else{if(!(o<0))break;s=Math.ceil(s*o)/o,u=Math.floor(u*o)/o}r=o}return e},e}Bl=Rl({thousands:",",grouping:[3],currency:["$",""]}),kl=Bl.format,Ml=Bl.formatPrefix;var Hl=2*Math.PI,Vl=Math.abs,Pl=Math.sqrt;function Ul(){}function jl(e,t){e&&ql.hasOwnProperty(e.type)&&ql[e.type](e,t)}var Gl={Feature:function(e,t){jl(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,o=n.length;++r<o;)jl(n[r].geometry,t)}},ql={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,o=n.length;++r<o;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Wl(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,o=n.length;++r<o;)Wl(n[r],t,0)},Polygon:function(e,t){Zl(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,o=n.length;++r<o;)Zl(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,o=n.length;++r<o;)jl(n[r],t)}};function Wl(e,t,n){var r,o=-1,i=e.length-n;for(t.lineStart();++o<i;)r=e[o],t.point(r[0],r[1],r[2]);t.lineEnd()}function Zl(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Wl(e[n],t,1);t.polygonEnd()}function Xl(e,t){e&&Gl.hasOwnProperty(e.type)?Gl[e.type](e,t):jl(e,t)}var Yl,$l,Kl,Ql,Jl=e=>e,es=new _n,ts=new _n,ns={point:Ul,lineStart:Ul,lineEnd:Ul,polygonStart:function(){ns.lineStart=rs,ns.lineEnd=as},polygonEnd:function(){ns.lineStart=ns.lineEnd=ns.point=Ul,es.add(Vl(ts)),ts=new _n},result:function(){var e=es/2;return es=new _n,e}};function rs(){ns.point=os}function os(e,t){ns.point=is,Yl=Kl=e,$l=Ql=t}function is(e,t){ts.add(Ql*e-Kl*t),Kl=e,Ql=t}function as(){is(Yl,$l)}var ls=1/0,ss=ls,us=-ls,fs=us,cs={point:function(e,t){e<ls&&(ls=e);e>us&&(us=e);t<ss&&(ss=t);t>fs&&(fs=t)},lineStart:Ul,lineEnd:Ul,polygonStart:Ul,polygonEnd:Ul,result:function(){var e=[[ls,ss],[us,fs]];return us=fs=-(ss=ls=1/0),e}};var hs,ps,ds,ms,gs=0,vs=0,bs=0,xs=0,ys=0,_s=0,ws=0,Cs=0,As=0,Ts={point:Es,lineStart:Ds,lineEnd:Fs,polygonStart:function(){Ts.lineStart=Bs,Ts.lineEnd=ks},polygonEnd:function(){Ts.point=Es,Ts.lineStart=Ds,Ts.lineEnd=Fs},result:function(){var e=As?[ws/As,Cs/As]:_s?[xs/_s,ys/_s]:bs?[gs/bs,vs/bs]:[NaN,NaN];return gs=vs=bs=xs=ys=_s=ws=Cs=As=0,e}};function Es(e,t){gs+=e,vs+=t,++bs}function Ds(){Ts.point=Ls}function Ls(e,t){Ts.point=Ss,Es(ds=e,ms=t)}function Ss(e,t){var n=e-ds,r=t-ms,o=Pl(n*n+r*r);xs+=o*(ds+e)/2,ys+=o*(ms+t)/2,_s+=o,Es(ds=e,ms=t)}function Fs(){Ts.point=Es}function Bs(){Ts.point=Ms}function ks(){Os(hs,ps)}function Ms(e,t){Ts.point=Os,Es(hs=ds=e,ps=ms=t)}function Os(e,t){var n=e-ds,r=t-ms,o=Pl(n*n+r*r);xs+=o*(ds+e)/2,ys+=o*(ms+t)/2,_s+=o,ws+=(o=ms*e-ds*t)*(ds+e),Cs+=o*(ms+t),As+=3*o,Es(ds=e,ms=t)}function Is(e){this._context=e}Is.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Hl)}},result:Ul};var Rs,Ns,zs,Hs,Vs,Ps=new _n,Us={point:Ul,lineStart:function(){Us.point=js},lineEnd:function(){Rs&&Gs(Ns,zs),Us.point=Ul},polygonStart:function(){Rs=!0},polygonEnd:function(){Rs=null},result:function(){var e=+Ps;return Ps=new _n,e}};function js(e,t){Us.point=Gs,Ns=Hs=e,zs=Vs=t}function Gs(e,t){Hs-=e,Vs-=t,Ps.add(Pl(Hs*Hs+Vs*Vs)),Hs=e,Vs=t}function qs(){this._string=[]}function Ws(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}qs.prototype={_radius:4.5,_circle:Ws(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=Ws(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var Zs="$";function Xs(){}function Ys(e,t){var n=new Xs;if(e instanceof Xs)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,o=-1,i=e.length;if(null==t)for(;++o<i;)n.set(o,e[o]);else for(;++o<i;)n.set(t(r=e[o],o,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}function $s(){}Xs.prototype=Ys.prototype={constructor:Xs,has:function(e){return Zs+e in this},get:function(e){return this[Zs+e]},set:function(e,t){return this[Zs+e]=t,this},remove:function(e){var t=Zs+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Zs&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Zs&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Zs&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Zs&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Zs&&++e;return e},empty:function(){for(var e in this)if(e[0]===Zs)return!1;return!0},each:function(e){for(var t in this)t[0]===Zs&&e(this[t],t.slice(1),this)}};var Ks=Ys.prototype;$s.prototype=function(e,t){var n=new $s;if(e instanceof $s)e.each((function(e){n.add(e)}));else if(e){var r=-1,o=e.length;if(null==t)for(;++r<o;)n.add(e[r]);else for(;++r<o;)n.add(t(e[r],r,e))}return n}.prototype={constructor:$s,has:Ks.has,add:function(e){return this[Zs+(e+="")]=e,this},remove:Ks.remove,clear:Ks.clear,values:Ks.keys,size:Ks.size,empty:Ks.empty,each:Ks.each};var Qs={value:function(){}};function Js(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new eu(r)}function eu(e){this._=e}function tu(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function nu(e,t){for(var n,r=0,o=e.length;r<o;++r)if((n=e[r]).name===t)return n.value}function ru(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Qs,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}eu.prototype=Js.prototype={constructor:eu,on:function(e,t){var n,r=this._,o=tu(e+"",r),i=-1,a=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++i<a;)if(n=(e=o[i]).type)r[n]=ru(r[n],e.name,t);else if(null==t)for(n in r)r[n]=ru(r[n],e.name,null);return this}for(;++i<a;)if((n=(e=o[i]).type)&&(n=nu(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new eu(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,o=new Array(n),i=0;i<n;++i)o[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=0,n=(r=this._[e]).length;i<n;++i)r[i].value.apply(t,o)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,i=r.length;o<i;++o)r[o].value.apply(t,n)}};var ou,iu,au=(ou="application/json",iu=function(e){return JSON.parse(e.responseText)},function(e,t){var n=function(e,t){var n,r,o,i,a=Js("beforesend","progress","load","error"),l=Ys(),s=new XMLHttpRequest,u=null,f=null,c=0;function h(e){var t,r=s.status;if(!r&&function(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}(s)||r>=200&&r<300||304===r){if(o)try{t=o.call(n,s)}catch(e){return void a.call("error",n,e)}else t=s;a.call("load",n,t)}else a.call("error",n,e)}if("undefined"!=typeof XDomainRequest&&!("withCredentials"in s)&&/^(http(s)?:)?\/\//.test(e)&&(s=new XDomainRequest),"onload"in s?s.onload=s.onerror=s.ontimeout=h:s.onreadystatechange=function(e){s.readyState>3&&h(e)},s.onprogress=function(e){a.call("progress",n,e)},n={header:function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?l.get(e):(null==t?l.remove(e):l.set(e,t+""),n)},mimeType:function(e){return arguments.length?(r=null==e?null:e+"",n):r},responseType:function(e){return arguments.length?(i=e,n):i},timeout:function(e){return arguments.length?(c=+e,n):c},user:function(e){return arguments.length<1?u:(u=null==e?null:e+"",n)},password:function(e){return arguments.length<1?f:(f=null==e?null:e+"",n)},response:function(e){return o=e,n},get:function(e,t){return n.send("GET",e,t)},post:function(e,t){return n.send("POST",e,t)},send:function(t,o,h){return s.open(t,e,!0,u,f),null==r||l.has("accept")||l.set("accept",r+",*/*"),s.setRequestHeader&&l.each((function(e,t){s.setRequestHeader(t,e)})),null!=r&&s.overrideMimeType&&s.overrideMimeType(r),null!=i&&(s.responseType=i),c>0&&(s.timeout=c),null==h&&"function"==typeof o&&(h=o,o=null),null!=h&&1===h.length&&(h=function(e){return function(t,n){e(null==t?n:null)}}(h)),null!=h&&n.on("error",h).on("load",(function(e){h(null,e)})),a.call("beforesend",n,s),s.send(null==o?null:o),n},abort:function(){return s.abort(),n},on:function(){var e=a.on.apply(a,arguments);return e===a?n:e}},null!=t){if("function"!=typeof t)throw new Error("invalid callback: "+t);return n.get(t)}return n}(e).mimeType(ou).response(iu);if(null!=t){if("function"!=typeof t)throw new Error("invalid callback: "+t);return n.get(t)}return n});function lu(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function su(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function uu(){}var fu=.7,cu=1/fu,hu="\\s*([+-]?\\d+)\\s*",pu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",du="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",mu=/^#([0-9a-f]{3,8})$/,gu=new RegExp("^rgb\\("+[hu,hu,hu]+"\\)$"),vu=new RegExp("^rgb\\("+[du,du,du]+"\\)$"),bu=new RegExp("^rgba\\("+[hu,hu,hu,pu]+"\\)$"),xu=new RegExp("^rgba\\("+[du,du,du,pu]+"\\)$"),yu=new RegExp("^hsl\\("+[pu,du,du]+"\\)$"),_u=new RegExp("^hsla\\("+[pu,du,du,pu]+"\\)$"),wu={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Cu(){return this.rgb().formatHex()}function Au(){return this.rgb().formatRgb()}function Tu(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=mu.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Eu(t):3===n?new Su(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Du(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Du(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=gu.exec(e))?new Su(t[1],t[2],t[3],1):(t=vu.exec(e))?new Su(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=bu.exec(e))?Du(t[1],t[2],t[3],t[4]):(t=xu.exec(e))?Du(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=yu.exec(e))?Mu(t[1],t[2]/100,t[3]/100,1):(t=_u.exec(e))?Mu(t[1],t[2]/100,t[3]/100,t[4]):wu.hasOwnProperty(e)?Eu(wu[e]):"transparent"===e?new Su(NaN,NaN,NaN,0):null}function Eu(e){return new Su(e>>16&255,e>>8&255,255&e,1)}function Du(e,t,n,r){return r<=0&&(e=t=n=NaN),new Su(e,t,n,r)}function Lu(e){return e instanceof uu||(e=Tu(e)),e?new Su((e=e.rgb()).r,e.g,e.b,e.opacity):new Su}function Su(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Fu(){return"#"+ku(this.r)+ku(this.g)+ku(this.b)}function Bu(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function ku(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Mu(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Iu(e,t,n,r)}function Ou(e){if(e instanceof Iu)return new Iu(e.h,e.s,e.l,e.opacity);if(e instanceof uu||(e=Tu(e)),!e)return new Iu;if(e instanceof Iu)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),i=Math.max(t,n,r),a=NaN,l=i-o,s=(i+o)/2;return l?(a=t===i?(n-r)/l+6*(n<r):n===i?(r-t)/l+2:(t-n)/l+4,l/=s<.5?i+o:2-i-o,a*=60):l=s>0&&s<1?0:a,new Iu(a,l,s,e.opacity)}function Iu(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Ru(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}lu(uu,Tu,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Cu,formatHex:Cu,formatHsl:function(){return Ou(this).formatHsl()},formatRgb:Au,toString:Au}),lu(Su,(function(e,t,n,r){return 1===arguments.length?Lu(e):new Su(e,t,n,null==r?1:r)}),su(uu,{brighter:function(e){return e=null==e?cu:Math.pow(cu,e),new Su(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?fu:Math.pow(fu,e),new Su(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Fu,formatHex:Fu,formatRgb:Bu,toString:Bu})),lu(Iu,(function(e,t,n,r){return 1===arguments.length?Ou(e):new Iu(e,t,n,null==r?1:r)}),su(uu,{brighter:function(e){return e=null==e?cu:Math.pow(cu,e),new Iu(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?fu:Math.pow(fu,e),new Iu(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new Su(Ru(e>=240?e-240:e+120,o,r),Ru(e,o,r),Ru(e<120?e+240:e-120,o,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Nu=Math.PI/180,zu=180/Math.PI,Hu=.96422,Vu=.82521,Pu=4/29,Uu=6/29,ju=3*Uu*Uu;function Gu(e){if(e instanceof qu)return new qu(e.l,e.a,e.b,e.opacity);if(e instanceof Qu)return Ju(e);e instanceof Su||(e=Lu(e));var t,n,r=Yu(e.r),o=Yu(e.g),i=Yu(e.b),a=Wu((.2225045*r+.7168786*o+.0606169*i)/1);return r===o&&o===i?t=n=a:(t=Wu((.4360747*r+.3850649*o+.1430804*i)/Hu),n=Wu((.0139322*r+.0971045*o+.7141733*i)/Vu)),new qu(116*a-16,500*(t-a),200*(a-n),e.opacity)}function qu(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function Wu(e){return e>.008856451679035631?Math.pow(e,1/3):e/ju+Pu}function Zu(e){return e>Uu?e*e*e:ju*(e-Pu)}function Xu(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Yu(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function $u(e){if(e instanceof Qu)return new Qu(e.h,e.c,e.l,e.opacity);if(e instanceof qu||(e=Gu(e)),0===e.a&&0===e.b)return new Qu(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*zu;return new Qu(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Ku(e,t,n,r){return 1===arguments.length?$u(e):new Qu(e,t,n,null==r?1:r)}function Qu(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Ju(e){if(isNaN(e.h))return new qu(e.l,0,0,e.opacity);var t=e.h*Nu;return new qu(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}lu(qu,(function(e,t,n,r){return 1===arguments.length?Gu(e):new qu(e,t,n,null==r?1:r)}),su(uu,{brighter:function(e){return new qu(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new qu(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Su(Xu(3.1338561*(t=Hu*Zu(t))-1.6168667*(e=1*Zu(e))-.4906146*(n=Vu*Zu(n))),Xu(-.9787684*t+1.9161415*e+.033454*n),Xu(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),lu(Qu,Ku,su(uu,{brighter:function(e){return new Qu(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new Qu(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return Ju(this).rgb()}}));var ef=e=>()=>e;function tf(e,t){return function(n){return e+n*t}}function nf(e,t){var n=t-e;return n?tf(e,n):ef(isNaN(e)?t:e)}var rf=function(e){return function(t,n){var r=e((t=Ku(t)).h,(n=Ku(n)).h),o=nf(t.c,n.c),i=nf(t.l,n.l),a=nf(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=o(e),t.l=i(e),t.opacity=a(e),t+""}}}((function(e,t){var n=t-e;return n?tf(e,n>180||n<-180?n-360*Math.round(n/360):n):ef(isNaN(e)?t:e)}));!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".gl-tilelayer-tile {\n  -ms-interpolation-mode: nearest-neighbor;\n      image-rendering: -moz-crisp-edges;\n      image-rendering: pixelated;\n  image-rendering: crisp-edges;\n}\n");var of=Nn((function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function o(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||o(t)}function a(e){return e?": "+e:""}function l(e,t,n){e in t||o("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join())}function s(t,n){e(t)||o("invalid parameter type"+a(n)+". must be a typed array")}function u(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function f(e,t,n){u(e,t)||o("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e)}function c(e,t){e>=0&&(0|e)===e||o("invalid parameter type, ("+e+")"+a(t)+". must be a nonnegative integer")}function h(e,t,n){t.indexOf(e)<0&&o("invalid value"+a(n)+". must be one of: "+t)}var p=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function d(e){Object.keys(e).forEach((function(e){p.indexOf(e)<0&&o('invalid regl constructor argument "'+e+'". must be one of '+p)}))}function m(e,t){for(e+="";e.length<t;)e=" "+e;return e}function g(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function v(e,t){this.number=e,this.line=t,this.errors=[]}function b(e,t,n){this.file=e,this.line=t,this.message=n}function x(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function y(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function _(e,t){var n=e.split("\n"),o=1,i=0,a={unknown:new g,0:new g};a.unknown.name=a[0].name=t||x(),a.unknown.lines.push(new v(0,""));for(var l=0;l<n.length;++l){var s=n[l],u=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(s);if(u)switch(u[1]){case"line":var f=/(\d+)(\s+\d+)?/.exec(u[2]);f&&(o=0|f[1],f[2]&&((i=0|f[2])in a||(a[i]=new g)));break;case"define":var c=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);c&&(a[i].name=c[1]?r(c[2]):c[2])}a[i].lines.push(new v(o++,s))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function w(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new b(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new b("unknown",0,e))}})),t}function C(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}function A(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var l=e.getShaderInfoLog(t),s=o===e.FRAGMENT_SHADER?"fragment":"vertex";B(r,"string",s+" shader source must be a string",a);var u=_(r,a),f=w(l);C(u,f),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var r=[""],o=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(m(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var o=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(o);if(a){var l=a[1];switch(o=a[2],l){case"assign":l="="}t=Math.max(e.line.indexOf(l,t),0)}else t=0;i(m("| ",6)),i(m("^^^",t+3)+n,"font-weight:bold"),i(m("| ",6)),i(o+n,"font-weight:bold")})),i(m("| ",6)+n)}else i(m(e.number,4)+"|  "),i(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(o[0]=r.join("%c"),console.log.apply(console,o))}function i(e,t){r.push(e),o.push(t||"")}})),i.raise("Error compiling "+s+" shader, "+u[0].name)}}function T(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var l=e.getProgramInfoLog(t),s=_(r,a),u='Error linking program with vertex shader, "'+_(o,a)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+n+"%c"+l,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+n+l),i.raise(u)}}function E(e){e._commandRef=x()}function D(e,t,n,r){function o(e){return e?r.id(e):0}function i(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}E(e),e._fragId=o(e.static.frag),e._vertId=o(e.static.vert);var a=e._uniformSet={};i(a,t.static),i(a,t.dynamic);var l=e._attributeSet={};i(l,n.static),i(l,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function L(e,t){var n=y();o(e+" in command "+(t||x())+("unknown"===n?"":" called from "+n))}function S(e,t,n){e||L(t,n||x())}function F(e,t,n,r){e in t||L("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join(),r||x())}function B(e,t,n,r){u(e,t)||L("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e,r||x())}function k(e){e()}function M(e,t,n){e.texture?h(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):h(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var O=33071,I=9728,R=9984,N=9985,z=9986,H=9987,V=5121,P=5122,U=5123,j=5124,G=5125,q=5126,W=32819,Z=32820,X=33635,Y=34042,$=36193,K={};function Q(e,t){return e===Z||e===W||e===X?2:e===Y?4:K[e]*t}function J(e){return!(e&e-1||!e)}function ee(e,t,n){var r,o=t.width,a=t.height,l=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===O&&e.wrapT===O||i(J(o)&&J(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(e.minFilter!==R&&e.minFilter!==z&&e.minFilter!==N&&e.minFilter!==H,"min filter requires mipmap"):(i(J(o)&&J(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),t.type===q&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(e.minFilter===I&&e.magFilter===I,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var s=t.images;for(r=0;r<16;++r)if(s[r]){var u=o>>r,f=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var c=s[r];if(i(c.width===u&&c.height===f,"invalid shape for mip images"),i(c.format===t.format&&c.internalformat===t.internalformat&&c.type===t.type,"incompatible type for mip image"),c.compressed);else if(c.data){var h=Math.ceil(Q(c.type,l)*u/c.unpackAlignment)*c.unpackAlignment;i(c.data.byteLength===h*f,"invalid data for image, buffer size is inconsistent with image format")}else c.element||c.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")}function te(e,t,n,r){var o=e.width,a=e.height,l=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===O&&t.wrapT===O,"wrap mode not supported by cube map");for(var s=0;s<n.length;++s){var u=n[s];i(u.width===o&&u.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!u.compressed,"can not generate mipmap for compressed textures"),i(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var f=u.images,c=0;c<16;++c){var h=f[c];if(h){var p=o>>c,d=a>>c;i(u.mipmask&1<<c,"missing mipmap data"),i(h.width===p&&h.height===d,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===p*d*Math.max(Q(h.type,l),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}K[5120]=K[V]=1,K[P]=K[U]=K[$]=K[X]=K[W]=K[Z]=2,K[j]=K[G]=K[q]=K[Y]=4;var ne=t(i,{optional:k,raise:o,commandRaise:L,command:S,parameter:l,commandParameter:F,constructor:d,type:f,commandType:B,isTypedArray:s,nni:c,oneOf:h,shaderError:A,linkError:T,callSite:y,saveCommandRef:E,saveDrawInfo:D,framebufferFormat:M,guessCommand:x,texture2D:ee,textureCube:te}),re=0,oe=0;function ie(e,t){this.id=re++,this.type=e,this.data=t}function ae(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function le(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+ae(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return le(e.substr(0,r.index)).concat(le(r[1])).concat(le(e.substr(r.index+r[0].length)));var o=e.split(".");if(1===o.length)return['"'+ae(e)+'"'];for(var i=[],a=0;a<o.length;++a)i=i.concat(le(o[a]));return i}function se(e){return"["+le(e).join("][")+"]"}function ue(e,t){return new ie(e,se(t+""))}function fe(e){return"function"==typeof e&&!e._reglType||e instanceof ie}function ce(e,t){return"function"==typeof e?new ie(oe,e):e}var he={DynamicVariable:ie,define:ue,isDynamic:fe,unbox:ce,accessor:se},pe={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},de="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function me(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}function ge(e,n,r){var o,i=document.createElement("canvas");function a(){var n=window.innerWidth,o=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,o=a.bottom-a.top}i.width=r*n,i.height=r*o,t(i.style,{width:n+"px",height:o+"px"})}function l(){o?o.disconnect():window.removeEventListener("resize",a),e.removeChild(i)}return t(i.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(i),e===document.body&&(i.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(o=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:i,onDestroy:l}}function ve(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function be(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}function xe(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}function ye(e){return"string"==typeof e?e.split():(ne(Array.isArray(e),"invalid extension array"),e)}function _e(e){return"string"==typeof e?(ne("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function we(e){var t,n,r,o,i=e||{},a={},l=[],s=[],u="undefined"==typeof window?1:window.devicePixelRatio,f=!1,c=function(e){e&&ne.raise(e)},h=function(){};if("string"==typeof i?(ne("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(i),ne(t,"invalid query string for element")):"object"==typeof i?be(i)?t=i:xe(i)?r=(o=i).canvas:(ne.constructor(i),"gl"in i?o=i.gl:"canvas"in i?r=_e(i.canvas):"container"in i&&(n=_e(i.container)),"attributes"in i&&(a=i.attributes,ne.type(a,"object","invalid context attributes")),"extensions"in i&&(l=ye(i.extensions)),"optionalExtensions"in i&&(s=ye(i.optionalExtensions)),"onDone"in i&&(ne.type(i.onDone,"function","invalid or missing onDone callback"),c=i.onDone),"profile"in i&&(f=!!i.profile),"pixelRatio"in i&&(u=+i.pixelRatio,ne(u>0,"invalid pixel ratio"))):ne.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?r=t:n=t),!o){if(!r){ne("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var p=ge(n||document.body,c,u);if(!p)return null;r=p.canvas,h=p.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),o=ve(r,a)}return o?{gl:o,canvas:r,container:n,extensions:l,optionalExtensions:s,pixelRatio:u,profile:f,onDone:c,onDestroy:h}:(h(),c("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ce(e,t){var n={};function r(t){ne.type(t,"string","extension name must be string");var r,o=t.toLowerCase();try{r=n[o]=e.getExtension(o)}catch(e){}return!!r}for(var o=0;o<t.extensions.length;++o){var i=t.extensions[o];if(!r(i))return t.onDestroy(),t.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function Ae(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var Te=5120,Ee=5121,De=5122,Le=5123,Se=5124,Fe=5125,Be=5126;function ke(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Me(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function Oe(){var e=Ae(8,(function(){return[]}));function t(t){var n=ke(t),r=e[Me(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[Me(t.byteLength)>>2].push(t)}function r(e,n){var r=null;switch(e){case Te:r=new Int8Array(t(n),0,n);break;case Ee:r=new Uint8Array(t(n),0,n);break;case De:r=new Int16Array(t(2*n),0,n);break;case Le:r=new Uint16Array(t(2*n),0,n);break;case Se:r=new Int32Array(t(4*n),0,n);break;case Fe:r=new Uint32Array(t(4*n),0,n);break;case Be:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function o(e){n(e.buffer)}return{alloc:t,free:n,allocType:r,freeType:o}}var Ie=Oe();Ie.zero=Oe();var Re=3408,Ne=3410,ze=3411,He=3412,Ve=3413,Pe=3414,Ue=3415,je=33901,Ge=33902,qe=3379,We=3386,Ze=34921,Xe=36347,Ye=36348,$e=35661,Ke=35660,Qe=34930,Je=36349,et=34076,tt=34024,nt=7936,rt=7937,ot=7938,it=35724,at=34047,lt=36063,st=34852,ut=3553,ft=34067,ct=34069,ht=33984,pt=6408,dt=5126,mt=5121,gt=36160,vt=36053,bt=36064,xt=16384,yt=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(at));var r=1,o=1;t.webgl_draw_buffers&&(r=e.getParameter(st),o=e.getParameter(lt));var i=!!t.oes_texture_float;if(i){var a=e.createTexture();e.bindTexture(ut,a),e.texImage2D(ut,0,pt,1,1,0,pt,dt,null);var l=e.createFramebuffer();if(e.bindFramebuffer(gt,l),e.framebufferTexture2D(gt,bt,ut,a,0),e.bindTexture(ut,null),e.checkFramebufferStatus(gt)!==vt)i=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(xt);var s=Ie.allocType(dt,4);e.readPixels(0,0,1,1,pt,dt,s),e.getError()?i=!1:(e.deleteFramebuffer(l),e.deleteTexture(a),i=1===s[0]),Ie.freeType(s)}}var u=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var f=e.createTexture(),c=Ie.allocType(mt,36);e.activeTexture(ht),e.bindTexture(ft,f),e.texImage2D(ct,0,pt,3,3,0,pt,mt,c),Ie.freeType(c),e.bindTexture(ft,null),e.deleteTexture(f),u=!e.getError()}return{colorBits:[e.getParameter(Ne),e.getParameter(ze),e.getParameter(He),e.getParameter(Ve)],depthBits:e.getParameter(Pe),stencilBits:e.getParameter(Ue),subpixelBits:e.getParameter(Re),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:o,pointSizeDims:e.getParameter(je),lineWidthDims:e.getParameter(Ge),maxViewportDims:e.getParameter(We),maxCombinedTextureUnits:e.getParameter($e),maxCubeMapSize:e.getParameter(et),maxRenderbufferSize:e.getParameter(tt),maxTextureUnits:e.getParameter(Qe),maxTextureSize:e.getParameter(qe),maxAttributes:e.getParameter(Ze),maxVertexUniforms:e.getParameter(Xe),maxVertexTextureUnits:e.getParameter(Ke),maxVaryingVectors:e.getParameter(Ye),maxFragmentUniforms:e.getParameter(Je),glsl:e.getParameter(it),renderer:e.getParameter(rt),vendor:e.getParameter(nt),version:e.getParameter(ot),readFloat:i,npotTextureCube:u}};function _t(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var wt=function(e){return Object.keys(e).map((function(t){return e[t]}))},Ct={shape:St,flatten:Lt};function At(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}function Tt(e,t,n,r){for(var o=0,i=0;i<t;++i)for(var a=e[i],l=0;l<n;++l)r[o++]=a[l]}function Et(e,t,n,r,o,i){for(var a=i,l=0;l<t;++l)for(var s=e[l],u=0;u<n;++u)for(var f=s[u],c=0;c<r;++c)o[a++]=f[c]}function Dt(e,t,n,r,o){for(var i=1,a=n+1;a<t.length;++a)i*=t[a];var l=t[n];if(t.length-n==4){var s=t[n+1],u=t[n+2],f=t[n+3];for(a=0;a<l;++a)Et(e[a],s,u,f,r,o),o+=i}else for(a=0;a<l;++a)Dt(e[a],t,n+1,r,o),o+=i}function Lt(e,t,n,r){var o=1;if(t.length)for(var i=0;i<t.length;++i)o*=t[i];else o=0;var a=r||Ie.allocType(n,o);switch(t.length){case 0:break;case 1:At(e,t[0],a);break;case 2:Tt(e,t[0],t[1],a);break;case 3:Et(e,t[0],t[1],t[2],a,0);break;default:Dt(e,t,0,a,0)}return a}function St(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t}var Ft={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Bt={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},kt={dynamic:35048,stream:35040,static:35044},Mt=Ct.flatten,Ot=Ct.shape,It=35044,Rt=35040,Nt=5121,zt=5126,Ht=[];function Vt(e){return 0|Ft[Object.prototype.toString.call(e)]}function Pt(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Ut(e,t,n,r,o,i,a){for(var l=0,s=0;s<n;++s)for(var u=0;u<r;++u)e[l++]=t[o*s+i*u+a]}function jt(t,n,r,o){var i=0,a={};function l(e){this.id=i++,this.buffer=t.createBuffer(),this.type=e,this.usage=It,this.byteLength=0,this.dimension=1,this.dtype=Nt,this.persistentData=null,r.profile&&(this.stats={size:0})}l.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},l.prototype.destroy=function(){p(this)};var s=[];function u(e,t){var n=s.pop();return n||(n=new l(e)),n.bind(),h(n,t,Rt,0,1,!1),n}function f(e){s.push(e)}function c(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function h(t,n,r,o,i,a){var l,s;if(t.usage=r,Array.isArray(n)){if(t.dtype=o||zt,n.length>0)if(Array.isArray(n[0])){l=Ot(n);for(var u=1,f=1;f<l.length;++f)u*=l[f];t.dimension=u,c(t,s=Mt(n,l,t.dtype),r),a?t.persistentData=s:Ie.freeType(s)}else if("number"==typeof n[0]){t.dimension=i;var h=Ie.allocType(t.dtype,n.length);Pt(h,n),c(t,h,r),a?t.persistentData=h:Ie.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=o||Vt(n[0])||zt,c(t,s=Mt(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=s:Ie.freeType(s)):ne.raise("invalid buffer data")}else if(e(n))t.dtype=o||Vt(n),t.dimension=i,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(_t(n)){l=n.shape;var p=n.stride,d=n.offset,m=0,g=0,v=0,b=0;1===l.length?(m=l[0],g=1,v=p[0],b=0):2===l.length?(m=l[0],g=l[1],v=p[0],b=p[1]):ne.raise("invalid shape"),t.dtype=o||Vt(n.data)||zt,t.dimension=g;var x=Ie.allocType(t.dtype,m*g);Ut(x,n.data,m,g,v,b,d),c(t,x,r),a?t.persistentData=x:Ie.freeType(x)}else n instanceof ArrayBuffer?(t.dtype=Nt,t.dimension=i,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):ne.raise("invalid buffer data")}function p(e){n.bufferCount--,o(e);var r=e.buffer;ne(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}function d(o,i,s,u){n.bufferCount++;var f=new l(i);function c(n){var o=It,i=null,a=0,l=0,s=1;return Array.isArray(n)||e(n)||_t(n)||n instanceof ArrayBuffer?i=n:"number"==typeof n?a=0|n:n&&(ne.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(ne(null===i||Array.isArray(i)||e(i)||_t(i),"invalid data for buffer"),i=n.data),"usage"in n&&(ne.parameter(n.usage,kt,"invalid buffer usage"),o=kt[n.usage]),"type"in n&&(ne.parameter(n.type,Bt,"invalid buffer type"),l=Bt[n.type]),"dimension"in n&&(ne.type(n.dimension,"number","invalid dimension"),s=0|n.dimension),"length"in n&&(ne.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),i?h(f,i,o,l,s,u):(a&&t.bufferData(f.type,a,o),f.dtype=l||Nt,f.usage=o,f.dimension=s,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*Ht[f.dtype]),c}function d(e,n){ne(n+e.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),t.bufferSubData(f.type,n,e)}function m(t,n){var r,o=0|(n||0);if(f.bind(),e(t)||t instanceof ArrayBuffer)d(t,o);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var i=Ie.allocType(f.dtype,t.length);Pt(i,t),d(i,o),Ie.freeType(i)}else if(Array.isArray(t[0])||e(t[0])){r=Ot(t);var a=Mt(t,r,f.dtype);d(a,o),Ie.freeType(a)}else ne.raise("invalid buffer data")}else if(_t(t)){r=t.shape;var l=t.stride,s=0,u=0,h=0,p=0;1===r.length?(s=r[0],u=1,h=l[0],p=0):2===r.length?(s=r[0],u=r[1],h=l[0],p=l[1]):ne.raise("invalid shape");var m=Array.isArray(t.data)?f.dtype:Vt(t.data),g=Ie.allocType(m,s*u);Ut(g,t.data,s,u,h,p,t.offset),d(g,o),Ie.freeType(g)}else ne.raise("invalid data for buffer subdata");return c}return a[f.id]=f,s||c(o),c._reglType="buffer",c._buffer=f,c.subdata=m,r.profile&&(c.stats=f.stats),c.destroy=function(){p(f)},c}function m(){wt(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:d,createStream:u,destroyStream:f,clear:function(){wt(a).forEach(p),s.forEach(p)},getBuffer:function(e){return e&&e._buffer instanceof l?e._buffer:null},restore:m,_initBuffer:h}}Ht[5120]=1,Ht[5122]=2,Ht[5124]=4,Ht[5121]=1,Ht[5123]=2,Ht[5125]=4,Ht[5126]=4;var Gt={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},qt=0,Wt=1,Zt=4,Xt=5120,Yt=5121,$t=5122,Kt=5123,Qt=5124,Jt=5125,en=34963,tn=35040,nn=35044;function rn(t,n,r,o){var i={},a=0,l={uint8:Yt,uint16:Kt};function s(e){this.id=a++,i[this.id]=this,this.buffer=e,this.primType=Zt,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(l.uint32=Jt),s.prototype.bind=function(){this.buffer.bind()};var u=[];function f(e){var t=u.pop();return t||(t=new s(r.create(null,en,!0,!1)._buffer)),h(t,e,tn,-1,-1,0,0),t}function c(e){u.push(e)}function h(o,i,a,l,s,u,f){var c;if(o.buffer.bind(),i){var h=f;f||e(i)&&(!_t(i)||e(i.data))||(h=n.oes_element_index_uint?Jt:Kt),r._initBuffer(o.buffer,i,a,h,3)}else t.bufferData(en,u,a),o.buffer.dtype=c||Yt,o.buffer.usage=a,o.buffer.dimension=3,o.buffer.byteLength=u;if(c=f,!f){switch(o.buffer.dtype){case Yt:case Xt:c=Yt;break;case Kt:case $t:c=Kt;break;case Jt:case Qt:c=Jt;break;default:ne.raise("unsupported type for element array")}o.buffer.dtype=c}o.type=c,ne(c!==Jt||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=s;p<0&&(p=o.buffer.byteLength,c===Kt?p>>=1:c===Jt&&(p>>=2)),o.vertCount=p;var d=l;if(l<0){d=Zt;var m=o.buffer.dimension;1===m&&(d=qt),2===m&&(d=Wt),3===m&&(d=Zt)}o.primType=d}function p(e){o.elementsCount--,ne(null!==e.buffer,"must not double destroy elements"),delete i[e.id],e.buffer.destroy(),e.buffer=null}function d(t,n){var i=r.create(null,en,!0),a=new s(i._buffer);function u(t){if(t)if("number"==typeof t)i(t),a.primType=Zt,a.vertCount=0|t,a.type=Yt;else{var n=null,r=nn,o=-1,s=-1,f=0,c=0;Array.isArray(t)||e(t)||_t(t)?n=t:(ne.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,ne(Array.isArray(n)||e(n)||_t(n),"invalid data for element buffer")),"usage"in t&&(ne.parameter(t.usage,kt,"invalid element buffer usage"),r=kt[t.usage]),"primitive"in t&&(ne.parameter(t.primitive,Gt,"invalid element buffer primitive"),o=Gt[t.primitive]),"count"in t&&(ne("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),s=0|t.count),"type"in t&&(ne.parameter(t.type,l,"invalid buffer type"),c=l[t.type]),"length"in t?f=0|t.length:(f=s,c===Kt||c===$t?f*=2:c!==Jt&&c!==Qt||(f*=4))),h(a,n,r,o,s,f,c)}else i(),a.primType=Zt,a.vertCount=0,a.type=Yt;return u}return o.elementsCount++,u(t),u._reglType="elements",u._elements=a,u.subdata=function(e,t){return i.subdata(e,t),u},u.destroy=function(){p(a)},u}return{create:d,createStream:f,destroyStream:c,getElements:function(e){return"function"==typeof e&&e._elements instanceof s?e._elements:null},clear:function(){wt(i).forEach(p)}}}var on=new Float32Array(1),an=new Uint32Array(on.buffer),ln=5123;function sn(e){for(var t=Ie.allocType(ln,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{on[0]=e[n];var r=an[0],o=r>>>31<<15,i=(r<<1>>>24)-127,a=r>>13&1023;if(i<-24)t[n]=o;else if(i<-14){var l=-14-i;t[n]=o+(a+1024>>l)}else t[n]=i>15?o+31744:o+(i+15<<10)+a}return t}function un(t){return Array.isArray(t)||e(t)}var fn=function(e){return!(e&e-1||!e)},cn=34467,hn=3553,pn=34067,dn=34069,mn=6408,gn=6406,vn=6407,bn=6409,xn=6410,yn=32854,_n=32855,wn=36194,Cn=32819,An=32820,Tn=33635,En=34042,Dn=6402,Ln=34041,Sn=35904,Fn=35906,Bn=36193,kn=33776,Mn=33777,On=33778,In=33779,Rn=35986,Nn=35987,zn=34798,Hn=35840,Vn=35841,Pn=35842,Un=35843,jn=36196,Gn=5121,qn=5123,Wn=5125,Zn=5126,Xn=10242,Yn=10243,$n=10497,Kn=33071,Qn=33648,Jn=10240,er=10241,tr=9728,nr=9729,rr=9984,or=9985,ir=9986,ar=9987,lr=33170,sr=4352,ur=4353,fr=4354,cr=34046,hr=3317,pr=37440,dr=37441,mr=37443,gr=37444,vr=33984,br=[rr,ir,or,ar],xr=[0,bn,xn,vn,mn],yr={};function _r(e){return"[object "+e+"]"}yr[bn]=yr[gn]=yr[Dn]=1,yr[Ln]=yr[xn]=2,yr[vn]=yr[Sn]=3,yr[mn]=yr[Fn]=4;var wr=_r("HTMLCanvasElement"),Cr=_r("OffscreenCanvas"),Ar=_r("CanvasRenderingContext2D"),Tr=_r("ImageBitmap"),Er=_r("HTMLImageElement"),Dr=_r("HTMLVideoElement"),Lr=Object.keys(Ft).concat([wr,Cr,Ar,Tr,Er,Dr]),Sr=[];Sr[Gn]=1,Sr[Zn]=4,Sr[Bn]=2,Sr[qn]=2,Sr[Wn]=4;var Fr=[];function Br(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function kr(e){return!!Array.isArray(e)&&!(0===e.length||!un(e[0]))}function Mr(e){return Object.prototype.toString.call(e)}function Or(e){return Mr(e)===wr}function Ir(e){return Mr(e)===Cr}function Rr(e){return Mr(e)===Ar}function Nr(e){return Mr(e)===Tr}function zr(e){return Mr(e)===Er}function Hr(e){return Mr(e)===Dr}function Vr(e){if(!e)return!1;var t=Mr(e);return Lr.indexOf(t)>=0||Br(e)||kr(e)||_t(e)}function Pr(e){return 0|Ft[Object.prototype.toString.call(e)]}function Ur(e,t){var n=t.length;switch(e.type){case Gn:case qn:case Wn:case Zn:var r=Ie.allocType(e.type,n);r.set(t),e.data=r;break;case Bn:e.data=sn(t);break;default:ne.raise("unsupported texture type, must specify a typed array")}}function jr(e,t){return Ie.allocType(e.type===Bn?Zn:e.type,t)}function Gr(e,t){e.type===Bn?(e.data=sn(t),Ie.freeType(t)):e.data=t}function qr(e,t,n,r,o,i){for(var a=e.width,l=e.height,s=e.channels,u=jr(e,a*l*s),f=0,c=0;c<l;++c)for(var h=0;h<a;++h)for(var p=0;p<s;++p)u[f++]=t[n*h+r*c+o*p+i];Gr(e,u)}function Wr(e,t,n,r,o,i){var a;if(a=void 0!==Fr[e]?Fr[e]:yr[e]*Sr[t],i&&(a*=6),o){for(var l=0,s=n;s>=1;)l+=a*s*s,s/=2;return l}return a*n*r}function Zr(n,r,o,i,a,l,s){var u={"don't care":sr,"dont care":sr,nice:fr,fast:ur},f={repeat:$n,clamp:Kn,mirror:Qn},c={nearest:tr,linear:nr},h=t({mipmap:ar,"nearest mipmap nearest":rr,"linear mipmap nearest":or,"nearest mipmap linear":ir,"linear mipmap linear":ar},c),p={none:0,browser:gr},d={uint8:Gn,rgba4:Cn,rgb565:Tn,"rgb5 a1":An},m={alpha:gn,luminance:bn,"luminance alpha":xn,rgb:vn,rgba:mn,rgba4:yn,"rgb5 a1":_n,rgb565:wn},g={};r.ext_srgb&&(m.srgb=Sn,m.srgba=Fn),r.oes_texture_float&&(d.float32=d.float=Zn),r.oes_texture_half_float&&(d.float16=d["half float"]=Bn),r.webgl_depth_texture&&(t(m,{depth:Dn,"depth stencil":Ln}),t(d,{uint16:qn,uint32:Wn,"depth stencil":En})),r.webgl_compressed_texture_s3tc&&t(g,{"rgb s3tc dxt1":kn,"rgba s3tc dxt1":Mn,"rgba s3tc dxt3":On,"rgba s3tc dxt5":In}),r.webgl_compressed_texture_atc&&t(g,{"rgb atc":Rn,"rgba atc explicit alpha":Nn,"rgba atc interpolated alpha":zn}),r.webgl_compressed_texture_pvrtc&&t(g,{"rgb pvrtc 4bppv1":Hn,"rgb pvrtc 2bppv1":Vn,"rgba pvrtc 4bppv1":Pn,"rgba pvrtc 2bppv1":Un}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=jn);var v=Array.prototype.slice.call(n.getParameter(cn));Object.keys(g).forEach((function(e){var t=g[e];v.indexOf(t)>=0&&(m[e]=t)}));var b=Object.keys(m);o.textureFormats=b;var x=[];Object.keys(m).forEach((function(e){var t=m[e];x[t]=e}));var y=[];Object.keys(d).forEach((function(e){var t=d[e];y[t]=e}));var _=[];Object.keys(c).forEach((function(e){var t=c[e];_[t]=e}));var w=[];Object.keys(h).forEach((function(e){var t=h[e];w[t]=e}));var C=[];Object.keys(f).forEach((function(e){var t=f[e];C[t]=e}));var A=b.reduce((function(e,t){var n=m[t];return n===bn||n===gn||n===bn||n===xn||n===Dn||n===Ln||r.ext_srgb&&(n===Sn||n===Fn)?e[n]=n:n===_n||t.indexOf("rgba")>=0?e[n]=mn:e[n]=vn,e}),{});function T(){this.internalformat=mn,this.format=mn,this.type=Gn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=gr,this.width=0,this.height=0,this.channels=0}function E(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function D(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(ne.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(ne.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(ne.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(ne.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var n=t.type;ne(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),ne(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ne(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(n,d,"invalid texture type"),e.type=d[n]}var i=e.width,a=e.height,l=e.channels,s=!1;"shape"in t?(ne(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],a=t.shape[1],3===t.shape.length&&(l=t.shape[2],ne(l>0&&l<=4,"invalid number of channels"),s=!0),ne(i>=0&&i<=o.maxTextureSize,"invalid width"),ne(a>=0&&a<=o.maxTextureSize,"invalid height")):("radius"in t&&(i=a=t.radius,ne(i>=0&&i<=o.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,ne(i>=0&&i<=o.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,ne(a>=0&&a<=o.maxTextureSize,"invalid height")),"channels"in t&&(l=t.channels,ne(l>0&&l<=4,"invalid number of channels"),s=!0)),e.width=0|i,e.height=0|a,e.channels=0|l;var u=!1;if("format"in t){var f=t.format;ne(r.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(f,m,"invalid texture format");var c=e.internalformat=m[f];e.format=A[c],f in d&&("type"in t||(e.type=d[f])),f in g&&(e.compressed=!0),u=!0}!s&&u?e.channels=yr[e.format]:s&&!u?e.channels!==xr[e.format]&&(e.format=e.internalformat=xr[e.channels]):u&&s&&ne(e.channels===yr[e.format],"number of channels inconsistent with specified format")}}function L(e){n.pixelStorei(pr,e.flipY),n.pixelStorei(dr,e.premultiplyAlpha),n.pixelStorei(mr,e.colorSpace),n.pixelStorei(hr,e.unpackAlignment)}function S(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function F(t,n){var r=null;if(Vr(n)?r=n:n&&(ne.type(n,"object","invalid pixel data type"),D(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),Vr(n.data)&&(r=n.data)),ne(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){ne(!r,"can not specify copy and data field for the same texture");var i=a.viewportWidth,l=a.viewportHeight;t.width=t.width||i-t.xOffset,t.height=t.height||l-t.yOffset,t.needsCopy=!0,ne(t.xOffset>=0&&t.xOffset<i&&t.yOffset>=0&&t.yOffset<l&&t.width>0&&t.width<=i&&t.height>0&&t.height<=l,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Gn||(t.type=Pr(r));else if(Br(r))t.channels=t.channels||4,Ur(t,r),t.alignment=1,t.needsFree=!0;else if(_t(r)){var s=r.data;Array.isArray(s)||t.type!==Gn||(t.type=Pr(s));var u,f,c,h,p,d,m=r.shape,g=r.stride;3===m.length?(c=m[2],d=g[2]):(ne(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),c=1,d=1),u=m[0],f=m[1],h=g[0],p=g[1],t.alignment=1,t.width=u,t.height=f,t.channels=c,t.format=t.internalformat=xr[c],t.needsFree=!0,qr(t,s,h,p,d,r.offset)}else if(Or(r)||Ir(r)||Rr(r))Or(r)||Ir(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(Nr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(zr(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Hr(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(kr(r)){var v=t.width||r[0].length,b=t.height||r.length,x=t.channels;x=un(r[0][0])?x||r[0][0].length:x||1;for(var y=Ct.shape(r),_=1,w=0;w<y.length;++w)_*=y[w];var C=jr(t,_);Ct.flatten(r,y,"",C),Gr(t,C),t.alignment=1,t.width=v,t.height=b,t.channels=x,t.format=t.internalformat=xr[x],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Zn?ne(o.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Bn&&ne(o.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function B(e,t,r){var o=e.element,a=e.data,l=e.internalformat,s=e.format,u=e.type,f=e.width,c=e.height;L(e),o?n.texImage2D(t,r,s,s,u,o):e.compressed?n.compressedTexImage2D(t,r,l,f,c,0,a):e.needsCopy?(i(),n.copyTexImage2D(t,r,s,e.xOffset,e.yOffset,f,c,0)):n.texImage2D(t,r,s,f,c,0,s,u,a||null)}function k(e,t,r,o,a){var l=e.element,s=e.data,u=e.internalformat,f=e.format,c=e.type,h=e.width,p=e.height;L(e),l?n.texSubImage2D(t,a,r,o,f,c,l):e.compressed?n.compressedTexSubImage2D(t,a,r,o,u,h,p,s):e.needsCopy?(i(),n.copyTexSubImage2D(t,a,r,o,e.xOffset,e.yOffset,h,p)):n.texSubImage2D(t,a,r,o,h,p,f,c,s)}var M=[];function O(){return M.pop()||new S}function I(e){e.needsFree&&Ie.freeType(e.data),S.call(e),M.push(e)}function R(){T.call(this),this.genMipmaps=!1,this.mipmapHint=sr,this.mipmask=0,this.images=Array(16)}function N(e,t,n){var r=e.images[0]=O();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function z(e,t){var n=null;if(Vr(t))E(n=e.images[0]=O(),e),F(n,t),e.mipmask=1;else if(D(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,o=0;o<r.length;++o)E(n=e.images[o]=O(),e),n.width>>=o,n.height>>=o,F(n,r[o]),e.mipmask|=1<<o;else E(n=e.images[0]=O(),e),F(n,t),e.mipmask=1;E(e,e.images[0]),!e.compressed||e.internalformat!==kn&&e.internalformat!==Mn&&e.internalformat!==On&&e.internalformat!==In||ne(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function H(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;B(n[r],t,r)}}var V=[];function P(){var e=V.pop()||new R;T.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function U(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&I(t[n]),t[n]=null;V.push(e)}function j(){this.minFilter=tr,this.magFilter=tr,this.wrapS=Kn,this.wrapT=Kn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=sr}function G(e,t){if("min"in t){var n=t.min;ne.parameter(n,h),e.minFilter=h[n],br.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;ne.parameter(r,c),e.magFilter=c[r]}var i=e.wrapS,a=e.wrapT;if("wrap"in t){var l=t.wrap;"string"==typeof l?(ne.parameter(l,f),i=a=f[l]):Array.isArray(l)&&(ne.parameter(l[0],f),ne.parameter(l[1],f),i=f[l[0]],a=f[l[1]])}else{if("wrapS"in t){var s=t.wrapS;ne.parameter(s,f),i=f[s]}if("wrapT"in t){var p=t.wrapT;ne.parameter(p,f),a=f[p]}}if(e.wrapS=i,e.wrapT=a,"anisotropic"in t){var d=t.anisotropic;ne("number"==typeof d&&d>=1&&d<=o.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(typeof t.mipmap){case"string":ne.parameter(t.mipmap,u,"invalid mipmap hint"),e.mipmapHint=u[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":ne(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:ne.raise("invalid mipmap type")}m&&!("min"in t)&&(e.minFilter=rr)}}function q(e,t){n.texParameteri(t,er,e.minFilter),n.texParameteri(t,Jn,e.magFilter),n.texParameteri(t,Xn,e.wrapS),n.texParameteri(t,Yn,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,cr,e.anisotropic),e.genMipmaps&&(n.hint(lr,e.mipmapHint),n.generateMipmap(t))}var W=0,Z={},X=o.maxTextureUnits,Y=Array(X).map((function(){return null}));function $(e){T.call(this),this.mipmask=0,this.internalformat=mn,this.id=W++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new j,s.profile&&(this.stats={size:0})}function K(e){n.activeTexture(vr),n.bindTexture(e.target,e.texture)}function Q(){var e=Y[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(hn,null)}function J(e){var t=e.texture;ne(t,"must not double destroy texture");var r=e.unit,o=e.target;r>=0&&(n.activeTexture(vr+r),n.bindTexture(o,null),Y[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete Z[e.id],l.textureCount--}function ee(e,t){var r=new $(hn);function i(e,t){var n=r.texInfo;j.call(n);var a=P();return"number"==typeof e?N(a,0|e,"number"==typeof t?0|t:0|e):e?(ne.type(e,"object","invalid arguments to regl.texture"),G(n,e),z(a,e)):N(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,E(r,a),ne.texture2D(n,a,o),r.internalformat=a.internalformat,i.width=a.width,i.height=a.height,K(r),H(a,hn),q(n,hn),Q(),U(a),s.profile&&(r.stats.size=Wr(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),i.format=x[r.internalformat],i.type=y[r.type],i.mag=_[n.magFilter],i.min=w[n.minFilter],i.wrapS=C[n.wrapS],i.wrapT=C[n.wrapT],i}function a(e,t,n,o){ne(!!e,"must specify image data");var a=0|t,l=0|n,s=0|o,u=O();return E(u,r),u.width=0,u.height=0,F(u,e),u.width=u.width||(r.width>>s)-a,u.height=u.height||(r.height>>s)-l,ne(r.type===u.type&&r.format===u.format&&r.internalformat===u.internalformat,"incompatible format for texture.subimage"),ne(a>=0&&l>=0&&a+u.width<=r.width&&l+u.height<=r.height,"texture.subimage write out of bounds"),ne(r.mipmask&1<<s,"missing mipmap data"),ne(u.data||u.element||u.needsCopy,"missing image data"),K(r),k(u,hn,a,l,s),Q(),I(u),i}function u(e,t){var o=0|e,a=0|t||o;if(o===r.width&&a===r.height)return i;i.width=r.width=o,i.height=r.height=a,K(r);for(var l=0;r.mipmask>>l;++l){var u=o>>l,f=a>>l;if(!u||!f)break;n.texImage2D(hn,l,r.format,u,f,0,r.format,r.type,null)}return Q(),s.profile&&(r.stats.size=Wr(r.internalformat,r.type,o,a,!1,!1)),i}return Z[r.id]=r,l.textureCount++,i(e,t),i.subimage=a,i.resize=u,i._reglType="texture2d",i._texture=r,s.profile&&(i.stats=r.stats),i.destroy=function(){r.decRef()},i}function te(e,t,r,i,a,u){var f=new $(pn);Z[f.id]=f,l.cubeCount++;var c=new Array(6);function h(e,t,n,r,i,a){var l,u=f.texInfo;for(j.call(u),l=0;l<6;++l)c[l]=P();if("number"!=typeof e&&e)if("object"==typeof e)if(t)z(c[0],e),z(c[1],t),z(c[2],n),z(c[3],r),z(c[4],i),z(c[5],a);else if(G(u,e),D(f,e),"faces"in e){var p=e.faces;for(ne(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),l=0;l<6;++l)ne("object"==typeof p[l]&&!!p[l],"invalid input for cube map face"),E(c[l],f),z(c[l],p[l])}else for(l=0;l<6;++l)z(c[l],e);else ne.raise("invalid arguments to cube map");else{var d=0|e||1;for(l=0;l<6;++l)N(c[l],d,d)}for(E(f,c[0]),o.npotTextureCube||ne(fn(f.width)&&fn(f.height),"your browser does not support non power or two texture dimensions"),u.genMipmaps?f.mipmask=(c[0].width<<1)-1:f.mipmask=c[0].mipmask,ne.textureCube(f,u,c,o),f.internalformat=c[0].internalformat,h.width=c[0].width,h.height=c[0].height,K(f),l=0;l<6;++l)H(c[l],dn+l);for(q(u,pn),Q(),s.profile&&(f.stats.size=Wr(f.internalformat,f.type,h.width,h.height,u.genMipmaps,!0)),h.format=x[f.internalformat],h.type=y[f.type],h.mag=_[u.magFilter],h.min=w[u.minFilter],h.wrapS=C[u.wrapS],h.wrapT=C[u.wrapT],l=0;l<6;++l)U(c[l]);return h}function p(e,t,n,r,o){ne(!!t,"must specify image data"),ne("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var i=0|n,a=0|r,l=0|o,s=O();return E(s,f),s.width=0,s.height=0,F(s,t),s.width=s.width||(f.width>>l)-i,s.height=s.height||(f.height>>l)-a,ne(f.type===s.type&&f.format===s.format&&f.internalformat===s.internalformat,"incompatible format for texture.subimage"),ne(i>=0&&a>=0&&i+s.width<=f.width&&a+s.height<=f.height,"texture.subimage write out of bounds"),ne(f.mipmask&1<<l,"missing mipmap data"),ne(s.data||s.element||s.needsCopy,"missing image data"),K(f),k(s,dn+e,i,a,l),Q(),I(s),h}function d(e){var t=0|e;if(t!==f.width){h.width=f.width=t,h.height=f.height=t,K(f);for(var r=0;r<6;++r)for(var o=0;f.mipmask>>o;++o)n.texImage2D(dn+r,o,f.format,t>>o,t>>o,0,f.format,f.type,null);return Q(),s.profile&&(f.stats.size=Wr(f.internalformat,f.type,h.width,h.height,!1,!0)),h}}return h(e,t,r,i,a,u),h.subimage=p,h.resize=d,h._reglType="textureCube",h._texture=f,s.profile&&(h.stats=f.stats),h.destroy=function(){f.decRef()},h}function re(){for(var e=0;e<X;++e)n.activeTexture(vr+e),n.bindTexture(hn,null),Y[e]=null;wt(Z).forEach(J),l.cubeCount=0,l.textureCount=0}function oe(){for(var e=0;e<X;++e){var t=Y[e];t&&(t.bindCount=0,t.unit=-1,Y[e]=null)}wt(Z).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===hn)n.texImage2D(hn,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(dn+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);q(e.texInfo,e.target)}))}return t($.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<X;++r){var o=Y[r];if(o){if(o.bindCount>0)continue;o.unit=-1}Y[r]=e,t=r;break}t>=X&&ne.raise("insufficient number of texture units"),s.profile&&l.maxTextureUnits<t+1&&(l.maxTextureUnits=t+1),e.unit=t,n.activeTexture(vr+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&J(this)}}),s.profile&&(l.getTotalTextureSize=function(){var e=0;return Object.keys(Z).forEach((function(t){e+=Z[t].stats.size})),e}),{create2D:ee,createCube:te,clear:re,getTexture:function(e){return null},restore:oe}}Fr[yn]=2,Fr[_n]=2,Fr[wn]=2,Fr[Ln]=4,Fr[kn]=.5,Fr[Mn]=.5,Fr[On]=1,Fr[In]=1,Fr[Rn]=.5,Fr[Nn]=1,Fr[zn]=1,Fr[Hn]=.5,Fr[Vn]=.25,Fr[Pn]=.5,Fr[Un]=.25,Fr[jn]=.5;var Xr=36161,Yr=32854,$r=32855,Kr=36194,Qr=33189,Jr=36168,eo=34041,to=35907,no=34836,ro=34842,oo=34843,io=[];function ao(e,t,n){return io[e]*t*n}io[Yr]=2,io[$r]=2,io[Kr]=2,io[Qr]=2,io[Jr]=1,io[eo]=4,io[to]=4,io[no]=16,io[ro]=8,io[oo]=6;var lo=function(e,t,n,r,o){var i={rgba4:Yr,rgb565:Kr,"rgb5 a1":$r,depth:Qr,stencil:Jr,"depth stencil":eo};t.ext_srgb&&(i.srgba=to),t.ext_color_buffer_half_float&&(i.rgba16f=ro,i.rgb16f=oo),t.webgl_color_buffer_float&&(i.rgba32f=no);var a=[];Object.keys(i).forEach((function(e){var t=i[e];a[t]=e}));var l=0,s={};function u(e){this.id=l++,this.refCount=1,this.renderbuffer=e,this.format=Yr,this.width=0,this.height=0,o.profile&&(this.stats={size:0})}function f(t){var n=t.renderbuffer;ne(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(Xr,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete s[t.id],r.renderbufferCount--}function c(t,l){var f=new u(e.createRenderbuffer());function c(t,r){var l=0,s=0,u=Yr;if("object"==typeof t&&t){var h=t;if("shape"in h){var p=h.shape;ne(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),l=0|p[0],s=0|p[1]}else"radius"in h&&(l=s=0|h.radius),"width"in h&&(l=0|h.width),"height"in h&&(s=0|h.height);"format"in h&&(ne.parameter(h.format,i,"invalid renderbuffer format"),u=i[h.format])}else"number"==typeof t?(l=0|t,s="number"==typeof r?0|r:l):t?ne.raise("invalid arguments to renderbuffer constructor"):l=s=1;if(ne(l>0&&s>0&&l<=n.maxRenderbufferSize&&s<=n.maxRenderbufferSize,"invalid renderbuffer size"),l!==f.width||s!==f.height||u!==f.format)return c.width=f.width=l,c.height=f.height=s,f.format=u,e.bindRenderbuffer(Xr,f.renderbuffer),e.renderbufferStorage(Xr,u,l,s),ne(0===e.getError(),"invalid render buffer format"),o.profile&&(f.stats.size=ao(f.format,f.width,f.height)),c.format=a[f.format],c}function h(t,r){var i=0|t,a=0|r||i;return i===f.width&&a===f.height||(ne(i>0&&a>0&&i<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),c.width=f.width=i,c.height=f.height=a,e.bindRenderbuffer(Xr,f.renderbuffer),e.renderbufferStorage(Xr,f.format,i,a),ne(0===e.getError(),"invalid render buffer format"),o.profile&&(f.stats.size=ao(f.format,f.width,f.height))),c}return s[f.id]=f,r.renderbufferCount++,c(t,l),c.resize=h,c._reglType="renderbuffer",c._renderbuffer=f,o.profile&&(c.stats=f.stats),c.destroy=function(){f.decRef()},c}function h(){wt(s).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(Xr,t.renderbuffer),e.renderbufferStorage(Xr,t.format,t.width,t.height)})),e.bindRenderbuffer(Xr,null)}return u.prototype.decRef=function(){--this.refCount<=0&&f(this)},o.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(s).forEach((function(t){e+=s[t].stats.size})),e}),{create:c,clear:function(){wt(s).forEach(f)},restore:h}},so=36160,uo=36161,fo=3553,co=34069,ho=36064,po=36096,mo=36128,go=33306,vo=36053,bo=36054,xo=36055,yo=36057,_o=36061,wo=36193,Co=5121,Ao=5126,To=6407,Eo=6408,Do=6402,Lo=[To,Eo],So=[];So[Eo]=4,So[To]=3;var Fo=[];Fo[Co]=1,Fo[Ao]=4,Fo[wo]=2;var Bo=33189,ko=36168,Mo=34041,Oo=[32854,32855,36194,35907,34842,34843,34836],Io={};function Ro(e,n,r,o,i,a){var l={cur:null,next:null,dirty:!1,setFBO:null},s=["rgba"],u=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&u.push("srgba"),n.ext_color_buffer_half_float&&u.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&u.push("rgba32f");var f=["uint8"];function c(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,o=0;t?(r=t.width,o=t.height):n&&(r=n.width,o=n.height),this.width=r,this.height=o}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,o=Math.max(1,r.width),i=Math.max(1,r.height);ne(o===t&&i===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;ne(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(so,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(so,t,uo,n.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=fo,n=null,r=null,o=e;"object"==typeof e&&(o=e.data,"target"in e&&(t=0|e.target)),ne.type(o,"function","invalid attachment data");var i=o._reglType;return"texture2d"===i?(n=o,ne(t===fo)):"textureCube"===i?(n=o,ne(t>=co&&t<co+6,"invalid cube map target")):"renderbuffer"===i?(r=o,t=uo):ne.raise("invalid regl object for attachment"),new c(t,n,r)}function g(e,t,n,r,a){if(n){var l=o.create2D({width:e,height:t,format:r,type:a});return l._texture.refCount=0,new c(fo,l,null)}var s=i.create({width:e,height:t,format:r});return s._renderbuffer.refCount=0,new c(uo,null,s)}function v(e){return e&&(e.texture||e.renderbuffer)}function b(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&f.push("half float","float16"),n.oes_texture_float&&f.push("float","float32");var x=0,y={};function _(){this.id=x++,y[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function C(t){var n=t.framebuffer;ne(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete y[t.id]}function A(t){var n;e.bindFramebuffer(so,t.framebuffer);var o=t.colorAttachments;for(n=0;n<o.length;++n)d(ho+n,o[n]);for(n=o.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(so,ho+n,fo,null,0);e.framebufferTexture2D(so,go,fo,null,0),e.framebufferTexture2D(so,po,fo,null,0),e.framebufferTexture2D(so,mo,fo,null,0),d(po,t.depthAttachment),d(mo,t.stencilAttachment),d(go,t.depthStencilAttachment);var i=e.checkFramebufferStatus(so);e.isContextLost()||i===vo||ne.raise("framebuffer configuration not supported, status = "+Io[i]),e.bindFramebuffer(so,l.next?l.next.framebuffer:null),l.cur=l.next,e.getError()}function T(e,o){var i=new _;function c(e,t){var o;ne(l.next!==i,"can not update framebuffer which is currently in use");var a=0,h=0,d=!0,b=!0,x=null,y=!0,_="rgba",C="uint8",T=1,E=null,D=null,L=null,S=!1;if("number"==typeof e)a=0|e,h=0|t||a;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var F=e;if("shape"in F){var B=F.shape;ne(Array.isArray(B)&&B.length>=2,"invalid shape for framebuffer"),a=B[0],h=B[1]}else"radius"in F&&(a=h=F.radius),"width"in F&&(a=F.width),"height"in F&&(h=F.height);("color"in F||"colors"in F)&&(x=F.color||F.colors,Array.isArray(x)&&ne(1===x.length||n.webgl_draw_buffers,"multiple render targets not supported")),x||("colorCount"in F&&(T=0|F.colorCount,ne(T>0,"invalid color buffer count")),"colorTexture"in F&&(y=!!F.colorTexture,_="rgba4"),"colorType"in F&&(C=F.colorType,y?(ne(n.oes_texture_float||!("float"===C||"float32"===C),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ne(n.oes_texture_half_float||!("half float"===C||"float16"===C),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===C||"float16"===C?(ne(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==C&&"float32"!==C||(ne(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),ne.oneOf(C,f,"invalid color type")),"colorFormat"in F&&(_=F.colorFormat,s.indexOf(_)>=0?y=!0:u.indexOf(_)>=0?y=!1:y?ne.oneOf(F.colorFormat,s,"invalid color format for texture"):ne.oneOf(F.colorFormat,u,"invalid color format for renderbuffer"))),("depthTexture"in F||"depthStencilTexture"in F)&&(S=!(!F.depthTexture&&!F.depthStencilTexture),ne(!S||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in F&&("boolean"==typeof F.depth?d=F.depth:(E=F.depth,b=!1)),"stencil"in F&&("boolean"==typeof F.stencil?b=F.stencil:(D=F.stencil,d=!1)),"depthStencil"in F&&("boolean"==typeof F.depthStencil?d=b=F.depthStencil:(L=F.depthStencil,d=!1,b=!1))}else a=h=1;var k=null,M=null,O=null,I=null;if(Array.isArray(x))k=x.map(m);else if(x)k=[m(x)];else for(k=new Array(T),o=0;o<T;++o)k[o]=g(a,h,y,_,C);ne(n.webgl_draw_buffers||k.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ne(k.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||k[0].width,h=h||k[0].height,E?M=m(E):d&&!b&&(M=g(a,h,S,"depth","uint32")),D?O=m(D):b&&!d&&(O=g(a,h,!1,"stencil","uint8")),L?I=m(L):!E&&!D&&b&&d&&(I=g(a,h,S,"depth stencil","depth stencil")),ne(!!E+!!D+!!L<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var R=null;for(o=0;o<k.length;++o)if(p(k[o],a,h),ne(!k[o]||k[o].texture&&Lo.indexOf(k[o].texture._texture.format)>=0||k[o].renderbuffer&&Oo.indexOf(k[o].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+o+" is invalid"),k[o]&&k[o].texture){var N=So[k[o].texture._texture.format]*Fo[k[o].texture._texture.type];null===R?R=N:ne(R===N,"all color attachments much have the same number of bits per pixel.")}return p(M,a,h),ne(!M||M.texture&&M.texture._texture.format===Do||M.renderbuffer&&M.renderbuffer._renderbuffer.format===Bo,"invalid depth attachment for framebuffer object"),p(O,a,h),ne(!O||O.renderbuffer&&O.renderbuffer._renderbuffer.format===ko,"invalid stencil attachment for framebuffer object"),p(I,a,h),ne(!I||I.texture&&I.texture._texture.format===Mo||I.renderbuffer&&I.renderbuffer._renderbuffer.format===Mo,"invalid depth-stencil attachment for framebuffer object"),w(i),i.width=a,i.height=h,i.colorAttachments=k,i.depthAttachment=M,i.stencilAttachment=O,i.depthStencilAttachment=I,c.color=k.map(v),c.depth=v(M),c.stencil=v(O),c.depthStencil=v(I),c.width=i.width,c.height=i.height,A(i),c}function h(e,t){ne(l.next!==i,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===i.width&&r===i.height)return c;for(var o=i.colorAttachments,a=0;a<o.length;++a)b(o[a],n,r);return b(i.depthAttachment,n,r),b(i.stencilAttachment,n,r),b(i.depthStencilAttachment,n,r),i.width=c.width=n,i.height=c.height=r,A(i),c}return a.framebufferCount++,c(e,o),t(c,{resize:h,_reglType:"framebuffer",_framebuffer:i,destroy:function(){C(i),w(i)},use:function(e){l.setFBO({framebuffer:c},e)}})}function E(e){var i=Array(6);function a(e){var r;ne(i.indexOf(l.next)<0,"can not update framebuffer which is currently in use");var u,c={color:null},h=0,p=null,d="rgba",m="uint8",g=1;if("number"==typeof e)h=0|e;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var v=e;if("shape"in v){var b=v.shape;ne(Array.isArray(b)&&b.length>=2,"invalid shape for framebuffer"),ne(b[0]===b[1],"cube framebuffer must be square"),h=b[0]}else"radius"in v&&(h=0|v.radius),"width"in v?(h=0|v.width,"height"in v&&ne(v.height===h,"must be square")):"height"in v&&(h=0|v.height);("color"in v||"colors"in v)&&(p=v.color||v.colors,Array.isArray(p)&&ne(1===p.length||n.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in v&&(g=0|v.colorCount,ne(g>0,"invalid color buffer count")),"colorType"in v&&(ne.oneOf(v.colorType,f,"invalid color type"),m=v.colorType),"colorFormat"in v&&(d=v.colorFormat,ne.oneOf(v.colorFormat,s,"invalid color format for texture"))),"depth"in v&&(c.depth=v.depth),"stencil"in v&&(c.stencil=v.stencil),"depthStencil"in v&&(c.depthStencil=v.depthStencil)}else h=1;if(p)if(Array.isArray(p))for(u=[],r=0;r<p.length;++r)u[r]=p[r];else u=[p];else{u=Array(g);var x={radius:h,format:d,type:m};for(r=0;r<g;++r)u[r]=o.createCube(x)}for(c.color=Array(u.length),r=0;r<u.length;++r){var y=u[r];ne("function"==typeof y&&"textureCube"===y._reglType,"invalid cube map"),h=h||y.width,ne(y.width===h&&y.height===h,"invalid cube map shape"),c.color[r]={target:co,data:u[r]}}for(r=0;r<6;++r){for(var _=0;_<u.length;++_)c.color[_].target=co+r;r>0&&(c.depth=i[0].depth,c.stencil=i[0].stencil,c.depthStencil=i[0].depthStencil),i[r]?i[r](c):i[r]=T(c)}return t(a,{width:h,height:h,color:u})}function u(e){var t,n=0|e;if(ne(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var o=a.color;for(t=0;t<o.length;++t)o[t].resize(n);for(t=0;t<6;++t)i[t].resize(n);return a.width=a.height=n,a}return a(e),t(a,{faces:i,resize:u,_reglType:"framebufferCube",destroy:function(){i.forEach((function(e){e.destroy()}))}})}function D(){l.cur=null,l.next=null,l.dirty=!0,wt(y).forEach((function(t){t.framebuffer=e.createFramebuffer(),A(t)}))}return t(l,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof _)return t}return null},create:T,createCube:E,clear:function(){wt(y).forEach(C)},restore:D})}Io[vo]="complete",Io[bo]="incomplete attachment",Io[yo]="incomplete dimensions",Io[xo]="incomplete, missing attachment",Io[_o]="unsupported";var No=5126,zo=34962;function Ho(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=No,this.offset=0,this.stride=0,this.divisor=0}function Vo(t,n,r,o,i){for(var a=r.maxAttributes,l=new Array(a),s=0;s<a;++s)l[s]=new Ho;var u=0,f={},c={Record:Ho,scope:{},state:l,currentVAO:null,targetVAO:null,restore:p()?y:function(){},createVAO:_,getVAO:m,destroyBuffer:h,setVAO:p()?g:v,clear:p()?b:function(){}};function h(e){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function p(){return n.oes_vertex_array_object}function d(){return n.angle_instanced_arrays}function m(e){return"function"==typeof e&&e._vao?e._vao:null}function g(e){if(e!==c.currentVAO){var t=p();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),c.currentVAO=e}}function v(e){if(e!==c.currentVAO){if(e)e.bindAttrs();else for(var n=d(),r=0;r<l.length;++r){var o=l[r];o.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,o.size,o.type,o.normalized,o.stride,o.offfset),n&&n.vertexAttribDivisorANGLE(r,o.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,o.x,o.y,o.z,o.w))}c.currentVAO=e}}function b(){wt(f).forEach((function(e){e.destroy()}))}function x(){this.id=++u,this.attributes=[];var e=p();this.vao=e?e.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}function y(){p()&&wt(f).forEach((function(e){e.refresh()}))}function _(t){var r=new x;function l(t){ne(Array.isArray(t),"arguments to vertex array constructor must be an array"),ne(t.length<a,"too many attributes"),ne(t.length>0,"must specify at least one attribute");for(var o=0;o<r.buffers.length;++o)r.buffers[o].destroy();r.buffers.length=0;var s=r.attributes;s.length=t.length;for(var u=0;u<t.length;++u){var f=t[u],c=s[u]=new Ho;if(Array.isArray(f)||e(f)||_t(f)){var h=i.create(f,zo,!1,!0);c.buffer=i.getBuffer(h),c.size=0|c.buffer.dimension,c.normalized=!1,c.type=c.buffer.dtype,c.offset=0,c.stride=0,c.divisor=0,c.state=1,r.buffers.push(h)}else i.getBuffer(f)?(c.buffer=i.getBuffer(f),c.size=0|c.buffer.dimension,c.normalized=!1,c.type=c.buffer.dtype,c.offset=0,c.stride=0,c.divisor=0,c.state=1):i.getBuffer(f.buffer)?(c.buffer=i.getBuffer(f.buffer),c.size=0|(+f.size||c.buffer.dimension),c.normalized=!!f.normalized||!1,"type"in f?(ne.parameter(f.type,Bt,"invalid buffer type"),c.type=Bt[f.type]):c.type=c.buffer.dtype,c.offset=0|(f.offset||0),c.stride=0|(f.stride||0),c.divisor=0|(f.divisor||0),c.state=1,ne(c.size>=1&&c.size<=4,"size must be between 1 and 4"),ne(c.offset>=0,"invalid offset"),ne(c.stride>=0&&c.stride<=255,"stride must be between 0 and 255"),ne(c.divisor>=0,"divisor must be positive"),ne(!c.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in f?(ne(u>0,"first attribute must not be a constant"),c.x=+f.x||0,c.y=+f.y||0,c.z=+f.z||0,c.w=+f.w||0,c.state=2):ne(!1,"invalid attribute spec for location "+u)}return r.refresh(),l}return o.vaoCount+=1,l.destroy=function(){r.destroy()},l._vao=r,l._reglType="vao",l(t)}return x.prototype.bindAttrs=function(){for(var e=d(),n=this.attributes,r=0;r<n.length;++r){var o=n[r];o.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(zo,o.buffer.buffer),t.vertexAttribPointer(r,o.size,o.type,o.normalized,o.stride,o.offset),e&&e.vertexAttribDivisorANGLE(r,o.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,o.x,o.y,o.z,o.w))}for(var i=n.length;i<a;++i)t.disableVertexAttribArray(i)},x.prototype.refresh=function(){var e=p();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),c.currentVAO=this)},x.prototype.destroy=function(){if(this.vao){var e=p();this===c.currentVAO&&(c.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}f[this.id]&&(delete f[this.id],o.vaoCount-=1)},c}var Po=35632,Uo=35633,jo=35718,Go=35721;function qo(e,t,n,r){var o={},i={};function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function l(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function s(n,r,a){var l=n===Po?o:i,s=l[r];if(!s){var u=t.str(r);s=e.createShader(n),e.shaderSource(s,u),e.compileShader(s),ne.shaderError(e,s,u,n,a),l[r]=s}return s}var u={},f=[],c=0;function h(e,t){this.id=c++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(n,o,i){var u,f,c=s(Po,n.fragId),h=s(Uo,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,c),e.attachShader(p,h),i)for(u=0;u<i.length;++u){var d=i[u];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),ne.linkError(e,p,t.str(n.fragId),t.str(n.vertId),o);var m=e.getProgramParameter(p,jo);r.profile&&(n.stats.uniformsCount=m);var g=n.uniforms;for(u=0;u<m;++u)if(f=e.getActiveUniform(p,u))if(f.size>1)for(var v=0;v<f.size;++v){var b=f.name.replace("[0]","["+v+"]");l(g,new a(b,t.id(b),e.getUniformLocation(p,b),f))}else l(g,new a(f.name,t.id(f.name),e.getUniformLocation(p,f.name),f));var x=e.getProgramParameter(p,Go);r.profile&&(n.stats.attributesCount=x);var y=n.attributes;for(u=0;u<x;++u)(f=e.getActiveAttrib(p,u))&&l(y,new a(f.name,t.id(f.name),e.getAttribLocation(p,f.name),f))}function d(){o={},i={};for(var e=0;e<f.length;++e)p(f[e],null,f[e].attributes.map((function(e){return[e.location,e.name]})))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return f.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return f.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);wt(o).forEach(t),o={},wt(i).forEach(t),i={},f.forEach((function(t){e.deleteProgram(t.program)})),f.length=0,u={},n.shaderCount=0},program:function(e,t,r,o){ne.command(e>=0,"missing vertex shader",r),ne.command(t>=0,"missing fragment shader",r);var i=u[t];i||(i=u[t]={});var a=i[e];if(a&&!o)return a;var l=new h(t,e);return n.shaderCount++,p(l,r,o),a||(i[e]=l),f.push(l),l},restore:d,shader:s,frag:-1,vert:-1}}var Wo=6408,Zo=5121,Xo=3333,Yo=5126;function $o(t,n,r,o,i,a,l){function s(s){var u;null===n.next?(ne(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Zo):(ne(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(ne(u===Zo||u===Yo,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),u===Yo&&ne(l.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ne(u===Zo,"Reading from a framebuffer is only allowed for the type 'uint8'"));var f=0,c=0,h=o.framebufferWidth,p=o.framebufferHeight,d=null;e(s)?d=s:s&&(ne.type(s,"object","invalid arguments to regl.read()"),f=0|s.x,c=0|s.y,ne(f>=0&&f<o.framebufferWidth,"invalid x offset for regl.read"),ne(c>=0&&c<o.framebufferHeight,"invalid y offset for regl.read"),h=0|(s.width||o.framebufferWidth-f),p=0|(s.height||o.framebufferHeight-c),d=s.data||null),d&&(u===Zo?ne(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Yo&&ne(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ne(h>0&&h+f<=o.framebufferWidth,"invalid width for read pixels"),ne(p>0&&p+c<=o.framebufferHeight,"invalid height for read pixels"),r();var m=h*p*4;return d||(u===Zo?d=new Uint8Array(m):u===Yo&&(d=d||new Float32Array(m))),ne.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),ne(d.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(Xo,4),t.readPixels(f,c,h,p,Wo,u,d),d}function u(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=s(e)})),t}function f(e){return e&&"framebuffer"in e?u(e):s(e)}return f}function Ko(e){return Array.prototype.slice.call(e)}function Qo(e){return Ko(e).join("")}function Jo(){var e=0,n=[],r=[];function o(t){for(var o=0;o<r.length;++o)if(r[o]===t)return n[o];var i="g"+e++;return n.push(i),r.push(t),i}function i(){var n=[];function r(){n.push.apply(n,Ko(arguments))}var o=[];function i(){var t="v"+e++;return o.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,Ko(arguments)),n.push(";")),t}return t(r,{def:i,toString:function(){return Qo([o.length>0?"var "+o.join(",")+";":"",Qo(n)])}})}function a(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,Ko(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}function l(){var e=Qo(arguments),n=a(),r=a(),o=n.toString,i=r.toString;return t(n,{then:function(){return n.apply(n,Ko(arguments)),this},else:function(){return r.apply(r,Ko(arguments)),this},toString:function(){var t=i();return t&&(t="else{"+t+"}"),Qo(["if(",e,"){",o(),"}",t])}})}var s=i(),u={};function f(e,n){var r=[];function o(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var i=0;i<n;++i)o();var l=a(),s=l.toString;return u[e]=t(l,{arg:o,toString:function(){return Qo(["function(",r.join(),"){",s(),"}"])}})}function c(){var e=['"use strict";',s,"return {"];Object.keys(u).forEach((function(t){e.push('"',t,'":',u[t].toString(),",")})),e.push("}");var t=Qo(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}return{global:s,link:o,block:i,proc:f,scope:a,cond:l,compile:c}}var ei="xyzw".split(""),ti=5121,ni=1,ri=2,oi=0,ii=1,ai=2,li=3,si=4,ui="dither",fi="blend.enable",ci="blend.color",hi="blend.equation",pi="blend.func",di="depth.enable",mi="depth.func",gi="depth.range",vi="depth.mask",bi="colorMask",xi="cull.enable",yi="cull.face",_i="frontFace",wi="lineWidth",Ci="polygonOffset.enable",Ai="polygonOffset.offset",Ti="sample.alpha",Ei="sample.enable",Di="sample.coverage",Li="stencil.enable",Si="stencil.mask",Fi="stencil.func",Bi="stencil.opFront",ki="stencil.opBack",Mi="scissor.enable",Oi="scissor.box",Ii="viewport",Ri="profile",Ni="framebuffer",zi="vert",Hi="frag",Vi="elements",Pi="primitive",Ui="count",ji="offset",Gi="instances",qi="vao",Wi="Width",Zi="Height",Xi=Ni+Wi,Yi=Ni+Zi,$i=Ii+Wi,Ki=Ii+Zi,Qi="drawingBuffer",Ji=Qi+Wi,ea=Qi+Zi,ta=[pi,hi,Fi,Bi,ki,Di,Ii,Oi,Ai],na=34962,ra=34963,oa=3553,ia=34067,aa=2884,la=3042,sa=3024,ua=2960,fa=2929,ca=3089,ha=32823,pa=32926,da=32928,ma=5126,ga=35664,va=35665,ba=35666,xa=5124,ya=35667,_a=35668,wa=35669,Ca=35670,Aa=35671,Ta=35672,Ea=35673,Da=35674,La=35675,Sa=35676,Fa=35678,Ba=35680,ka=4,Ma=1028,Oa=1029,Ia=2304,Ra=2305,Na=32775,za=32776,Ha=519,Va=7680,Pa=0,Ua=1,ja=32774,Ga=513,qa=36160,Wa=36064,Za={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xa=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ya={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$a={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ka={frag:35632,vert:35633},Qa={cw:Ia,ccw:Ra};function Ja(t){return Array.isArray(t)||e(t)||_t(t)}function el(e){return e.sort((function(e,t){return e===Ii?-1:t===Ii?1:e<t?-1:1}))}function tl(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function nl(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function rl(e){return new tl(!1,!1,!1,e)}function ol(e,t){var n=e.type;if(n===oi){var r=e.data.length;return new tl(!0,r>=1,r>=2,t)}if(n===si){var o=e.data;return new tl(o.thisDep,o.contextDep,o.propDep,t)}return new tl(n===li,n===ai,n===ii,t)}var il=new tl(!1,!1,!1,(function(){}));function al(e,t,n,r,o,i,a,l,s,u,f,c,h,p,d){var m=u.Record,g={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(g.min=Na,g.max=za);var v=n.angle_instanced_arrays,b=n.webgl_draw_buffers,x={dirty:!0,profile:d.profile},y={},_=[],w={},C={};function A(e){return e.replace(".","_")}function T(e,t,n){var r=A(e);_.push(e),y[r]=x[r]=!!n,w[r]=t}function E(e,t,n){var r=A(e);_.push(e),Array.isArray(n)?(x[r]=n.slice(),y[r]=n.slice()):x[r]=y[r]=n,C[r]=t}T(ui,sa),T(fi,la),E(ci,"blendColor",[0,0,0,0]),E(hi,"blendEquationSeparate",[ja,ja]),E(pi,"blendFuncSeparate",[Ua,Pa,Ua,Pa]),T(di,fa,!0),E(mi,"depthFunc",Ga),E(gi,"depthRange",[0,1]),E(vi,"depthMask",!0),E(bi,bi,[!0,!0,!0,!0]),T(xi,aa),E(yi,"cullFace",Oa),E(_i,_i,Ra),E(wi,wi,1),T(Ci,ha),E(Ai,"polygonOffset",[0,0]),T(Ti,pa),T(Ei,da),E(Di,"sampleCoverage",[1,!1]),T(Li,ua),E(Si,"stencilMask",-1),E(Fi,"stencilFunc",[Ha,0,-1]),E(Bi,"stencilOpSeparate",[Ma,Va,Va,Va]),E(ki,"stencilOpSeparate",[Oa,Va,Va,Va]),T(Mi,ca),E(Oi,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),E(Ii,Ii,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var D={gl:e,context:h,strings:t,next:y,current:x,draw:c,elements:i,buffer:o,shader:f,attributes:u.state,vao:u,uniforms:s,framebuffer:l,extensions:n,timer:p,isBufferArgs:Ja},L={primTypes:Gt,compareFuncs:Ya,blendFuncs:Za,blendEquations:g,stencilOps:$a,glTypes:Bt,orientationType:Qa};ne.optional((function(){D.isArrayLike=un})),b&&(L.backBuffer=[Oa],L.drawBuffer=Ae(r.maxDrawbuffers,(function(e){return 0===e?[0]:Ae(e,(function(e){return Wa+e}))})));var S=0;function F(){var e=Jo(),n=e.link,r=e.global;e.id=S++,e.batchId="0";var o=n(D),i=e.shared={props:"a0"};Object.keys(D).forEach((function(e){i[e]=r.def(o,".",e)})),ne.optional((function(){e.CHECK=n(ne),e.commandStr=ne.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},L.invalidBlendCombinations=Xa}));var a=e.next={},l=e.current={};Object.keys(C).forEach((function(e){Array.isArray(x[e])&&(a[e]=r.def(i.next,".",e),l[e]=r.def(i.current,".",e))}));var s=e.constants={};Object.keys(L).forEach((function(e){s[e]=r.def(JSON.stringify(L[e]))})),e.invoke=function(t,r){switch(r.type){case oi:var o=["this",i.context,i.props,e.batchId];return t.def(n(r.data),".call(",o.slice(0,Math.max(r.data.length+1,4)),")");case ii:return t.def(i.props,r.data);case ai:return t.def(i.context,r.data);case li:return t.def("this",r.data);case si:return r.data.append(e,t),r.data.ref}},e.attribCache={};var f={};return e.scopeAttrib=function(e){var r=t.id(e);if(r in f)return f[r];var o=u.scope[r];return o||(o=u.scope[r]=new m),f[r]=n(o)},e}function B(e){var t,n=e.static,r=e.dynamic;if(Ri in n){var o=!!n[Ri];(t=rl((function(e,t){return o}))).enable=o}else if(Ri in r){var i=r[Ri];t=ol(i,(function(e,t){return e.invoke(t,i)}))}return t}function k(e,t){var n=e.static,r=e.dynamic;if(Ni in n){var o=n[Ni];return o?(o=l.getFramebuffer(o),ne.command(o,"invalid framebuffer object"),rl((function(e,t){var n=e.link(o),r=e.shared;t.set(r.framebuffer,".next",n);var i=r.context;return t.set(i,"."+Xi,n+".width"),t.set(i,"."+Yi,n+".height"),n}))):rl((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Xi,r+"."+Ji),t.set(r,"."+Yi,r+"."+ea),"null"}))}if(Ni in r){var i=r[Ni];return ol(i,(function(e,t){var n=e.invoke(t,i),r=e.shared,o=r.framebuffer,a=t.def(o,".getFramebuffer(",n,")");ne.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(o,".next",a);var l=r.context;return t.set(l,"."+Xi,a+"?"+a+".width:"+l+"."+Ji),t.set(l,"."+Yi,a+"?"+a+".height:"+l+"."+ea),a}))}return null}function M(e,t,n){var r=e.static,o=e.dynamic;function i(e){if(e in r){var i=r[e];ne.commandType(i,"object","invalid "+e,n.commandStr);var a,l,s=!0,u=0|i.x,f=0|i.y;return"width"in i?(a=0|i.width,ne.command(a>=0,"invalid "+e,n.commandStr)):s=!1,"height"in i?(l=0|i.height,ne.command(l>=0,"invalid "+e,n.commandStr)):s=!1,new tl(!s&&t&&t.thisDep,!s&&t&&t.contextDep,!s&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in i||(r=t.def(n,".",Xi,"-",u));var o=l;return"height"in i||(o=t.def(n,".",Yi,"-",f)),[u,f,r,o]}))}if(e in o){var c=o[e],h=ol(c,(function(t,n){var r=t.invoke(n,c);ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var o=t.shared.context,i=n.def(r,".x|0"),a=n.def(r,".y|0"),l=n.def('"width" in ',r,"?",r,".width|0:","(",o,".",Xi,"-",i,")"),s=n.def('"height" in ',r,"?",r,".height|0:","(",o,".",Yi,"-",a,")");return ne.optional((function(){t.assert(n,l+">=0&&"+s+">=0","invalid "+e)})),[i,a,l,s]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new tl(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Xi),t.def(n,".",Yi)]})):null}var a=i(Ii);if(a){var l=a;a=new tl(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=l.append(e,t),r=e.shared.context;return t.set(r,"."+$i,n[2]),t.set(r,"."+Ki,n[3]),n}))}return{viewport:a,scissor_box:i(Oi)}}function O(e,t){var n=e.static;if("string"==typeof n[Hi]&&"string"==typeof n[zi]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,o=Object.keys(r);if(o.length>0&&"number"==typeof r[o[0]]){for(var i=[],a=0;a<o.length;++a)ne("number"==typeof r[o[a]],"must specify all vertex attribute locations when using vaos"),i.push([0|r[o[a]],o[a]]);return i}}return null}function I(e,n,r){var o=e.static,i=e.dynamic;function a(e){if(e in o){var n=t.id(o[e]);ne.optional((function(){f.shader(Ka[e],n,ne.guessCommand())}));var r=rl((function(){return n}));return r.id=n,r}if(e in i){var a=i[e];return ol(a,(function(t,n){var r=t.invoke(n,a),o=n.def(t.shared.strings,".id(",r,")");return ne.optional((function(){n(t.shared.shader,".shader(",Ka[e],",",o,",",t.command,");")})),o}))}return null}var l,s=a(Hi),u=a(zi),c=null;return nl(s)&&nl(u)?(c=f.program(u.id,s.id,null,r),l=rl((function(e,t){return e.link(c)}))):l=new tl(s&&s.thisDep||u&&u.thisDep,s&&s.contextDep||u&&u.contextDep,s&&s.propDep||u&&u.propDep,(function(e,t){var n,r=e.shared.shader;n=s?s.append(e,t):t.def(r,".",Hi);var o=r+".program("+(u?u.append(e,t):t.def(r,".",zi))+","+n;return ne.optional((function(){o+=","+e.command})),t.def(o+")")})),{frag:s,vert:u,progVar:l,program:c}}function R(e,t){var n=e.static,r=e.dynamic;function o(){if(Vi in n){var e=n[Vi];Ja(e)?e=i.getElements(i.create(e,!0)):e&&(e=i.getElements(e),ne.command(e,"invalid elements",t.commandStr));var o=rl((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return o.value=e,o}if(Vi in r){var a=r[Vi];return ol(a,(function(e,t){var n=e.shared,r=n.isBufferArgs,o=n.elements,i=e.invoke(t,a),l=t.def("null"),s=t.def(r,"(",i,")"),u=e.cond(s).then(l,"=",o,".createStream(",i,");").else(l,"=",o,".getElements(",i,");");return ne.optional((function(){e.assert(u.else,"!"+i+"||"+l,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(o,".destroyStream(",l,");")),e.ELEMENTS=l,l}))}return null}var a=o();function l(){if(Pi in n){var e=n[Pi];return ne.commandParameter(e,Gt,"invalid primitve",t.commandStr),rl((function(t,n){return Gt[e]}))}if(Pi in r){var o=r[Pi];return ol(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return ne.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Gt))})),t.def(n,"[",r,"]")}))}return a?nl(a)?a.value?rl((function(e,t){return t.def(e.ELEMENTS,".primType")})):rl((function(){return ka})):new tl(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",ka)})):null}function s(e,o){if(e in n){var i=0|n[e];return ne.command(!o||i>=0,"invalid "+e,t.commandStr),rl((function(e,t){return o&&(e.OFFSET=i),i}))}if(e in r){var l=r[e];return ol(l,(function(t,n){var r=t.invoke(n,l);return o&&(t.OFFSET=r,ne.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&a?rl((function(e,t){return e.OFFSET="0",0})):null}var u=s(ji,!0);function f(){if(Ui in n){var e=0|n[Ui];return ne.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),rl((function(){return e}))}if(Ui in r){var o=r[Ui];return ol(o,(function(e,t){var n=e.invoke(t,o);return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(a){if(nl(a)){if(a)return u?new tl(u.thisDep,u.contextDep,u.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return ne.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):rl((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var i=rl((function(){return-1}));return ne.optional((function(){i.MISSING=!0})),i}var l=new tl(a.thisDep||u.thisDep,a.contextDep||u.contextDep,a.propDep||u.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return ne.optional((function(){l.DYNAMIC=!0})),l}return null}return{elements:a,primitive:l(),count:f(),instances:s(Gi,!1),offset:u}}function N(e,t){var n=e.static,o=e.dynamic,i={};return _.forEach((function(e){var a=A(e);function l(t,r){if(e in n){var l=t(n[e]);i[a]=rl((function(){return l}))}else if(e in o){var s=o[e];i[a]=ol(s,(function(e,t){return r(e,t,e.invoke(t,s))}))}}switch(e){case xi:case fi:case ui:case Li:case di:case Mi:case Ci:case Ti:case Ei:case vi:return l((function(n){return ne.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return ne.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case mi:return l((function(n){return ne.commandParameter(n,Ya,"invalid "+e,t.commandStr),Ya[n]}),(function(t,n,r){var o=t.constants.compareFuncs;return ne.optional((function(){t.assert(n,r+" in "+o,"invalid "+e+", must be one of "+Object.keys(Ya))})),n.def(o,"[",r,"]")}));case gi:return l((function(e){return ne.command(un(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case pi:return l((function(e){ne.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,o="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return ne.commandParameter(n,Za,a+".srcRGB",t.commandStr),ne.commandParameter(r,Za,a+".srcAlpha",t.commandStr),ne.commandParameter(o,Za,a+".dstRGB",t.commandStr),ne.commandParameter(i,Za,a+".dstAlpha",t.commandStr),ne.command(-1===Xa.indexOf(n+", "+o),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+o+")",t.commandStr),[Za[n],Za[o],Za[r],Za[i]]}),(function(t,n,r){var o=t.constants.blendFuncs;function i(i,a){var l=n.def('"',i,a,'" in ',r,"?",r,".",i,a,":",r,".",i);return ne.optional((function(){t.assert(n,l+" in "+o,"invalid "+e+"."+i+a+", must be one of "+Object.keys(Za))})),l}ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=i("src","RGB"),l=i("dst","RGB");ne.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+l+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var s=n.def(o,"[",a,"]"),u=n.def(o,"[",i("src","Alpha"),"]");return[s,n.def(o,"[",l,"]"),u,n.def(o,"[",i("dst","Alpha"),"]")]}));case hi:return l((function(n){return"string"==typeof n?(ne.commandParameter(n,g,"invalid "+e,t.commandStr),[g[n],g[n]]):"object"==typeof n?(ne.commandParameter(n.rgb,g,e+".rgb",t.commandStr),ne.commandParameter(n.alpha,g,e+".alpha",t.commandStr),[g[n.rgb],g[n.alpha]]):void ne.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var o=t.constants.blendEquations,i=n.def(),a=n.def(),l=t.cond("typeof ",r,'==="string"');return ne.optional((function(){function n(e,n,r){t.assert(e,r+" in "+o,"invalid "+n+", must be one of "+Object.keys(g))}n(l.then,e,r),t.assert(l.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(l.else,e+".rgb",r+".rgb"),n(l.else,e+".alpha",r+".alpha")})),l.then(i,"=",a,"=",o,"[",r,"];"),l.else(i,"=",o,"[",r,".rgb];",a,"=",o,"[",r,".alpha];"),n(l),[i,a]}));case ci:return l((function(e){return ne.command(un(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Ae(4,(function(t){return+e[t]}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Ae(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case Si:return l((function(e){return ne.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case Fi:return l((function(n){ne.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",o=n.ref||0,i="mask"in n?n.mask:-1;return ne.commandParameter(r,Ya,e+".cmp",t.commandStr),ne.commandType(o,"number",e+".ref",t.commandStr),ne.commandType(i,"number",e+".mask",t.commandStr),[Ya[r],o,i]}),(function(e,t,n){var r=e.constants.compareFuncs;return ne.optional((function(){function o(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}o(n+"&&typeof ",n,'==="object"'),o('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Va),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Bi:case ki:return l((function(n){ne.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",o=n.zfail||"keep",i=n.zpass||"keep";return ne.commandParameter(r,$a,e+".fail",t.commandStr),ne.commandParameter(o,$a,e+".zfail",t.commandStr),ne.commandParameter(i,$a,e+".zpass",t.commandStr),[e===ki?Oa:Ma,$a[r],$a[o],$a[i]]}),(function(t,n,r){var o=t.constants.stencilOps;function i(i){return ne.optional((function(){t.assert(n,'!("'+i+'" in '+r+")||("+r+"."+i+" in "+o+")","invalid "+e+"."+i+", must be one of "+Object.keys($a))})),n.def('"',i,'" in ',r,"?",o,"[",r,".",i,"]:",Va)}return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===ki?Oa:Ma,i("fail"),i("zfail"),i("zpass")]}));case Ai:return l((function(e){ne.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return ne.commandType(n,"number",a+".factor",t.commandStr),ne.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case yi:return l((function(e){var n=0;return"front"===e?n=Ma:"back"===e&&(n=Oa),ne.command(!!n,a,t.commandStr),n}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',Ma,":",Oa)}));case wi:return l((function(e){return ne.command("number"==typeof e&&e>=r.lineWidthDims[0]&&e<=r.lineWidthDims[1],"invalid line width, must be a positive number between "+r.lineWidthDims[0]+" and "+r.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+r.lineWidthDims[0]+"&&"+n+"<="+r.lineWidthDims[1],"invalid line width")})),n}));case _i:return l((function(e){return ne.commandParameter(e,Qa,a,t.commandStr),Qa[e]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?'+Ia+":"+Ra)}));case bi:return l((function(e){return ne.command(un(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Ae(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Di:return l((function(e){ne.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return ne.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),i}function z(e,t){var n=e.static,r=e.dynamic,o={};return Object.keys(n).forEach((function(e){var r,i=n[e];if("number"==typeof i||"boolean"==typeof i)r=rl((function(){return i}));else if("function"==typeof i){var a=i._reglType;"texture2d"===a||"textureCube"===a?r=rl((function(e){return e.link(i)})):"framebuffer"===a||"framebufferCube"===a?(ne.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=rl((function(e){return e.link(i.color[0])}))):ne.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else un(i)?r=rl((function(t){return t.global.def("[",Ae(i.length,(function(n){return ne.command("number"==typeof i[n]||"boolean"==typeof i[n],"invalid uniform "+e,t.commandStr),i[n]})),"]")})):ne.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=i,o[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];o[e]=ol(t,(function(e,n){return e.invoke(n,t)}))})),o}function H(e,n){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach((function(e){var i=r[e],l=t.id(e),s=new m;if(Ja(i))s.state=ni,s.buffer=o.getBuffer(o.create(i,na,!1,!0)),s.type=0;else{var u=o.getBuffer(i);if(u)s.state=ni,s.buffer=u,s.type=0;else if(ne.command("object"==typeof i&&i,"invalid data for attribute "+e,n.commandStr),"constant"in i){var f=i.constant;s.buffer="null",s.state=ri,"number"==typeof f?s.x=f:(ne.command(un(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+e,n.commandStr),ei.forEach((function(e,t){t<f.length&&(s[e]=f[t])})))}else{u=Ja(i.buffer)?o.getBuffer(o.create(i.buffer,na,!1,!0)):o.getBuffer(i.buffer),ne.command(!!u,'missing buffer for attribute "'+e+'"',n.commandStr);var c=0|i.offset;ne.command(c>=0,'invalid offset for attribute "'+e+'"',n.commandStr);var h=0|i.stride;ne.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',n.commandStr);var p=0|i.size;ne.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',n.commandStr);var d=!!i.normalized,g=0;"type"in i&&(ne.commandParameter(i.type,Bt,"invalid type for attribute "+e,n.commandStr),g=Bt[i.type]);var b=0|i.divisor;"divisor"in i&&(ne.command(0===b||v,'cannot specify divisor for attribute "'+e+'", instancing not supported',n.commandStr),ne.command(b>=0,'invalid divisor for attribute "'+e+'"',n.commandStr)),ne.optional((function(){var t=n.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(n){ne.command(r.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",t)}))})),s.buffer=u,s.state=ni,s.size=p,s.normalized=d,s.type=g||u.dtype,s.offset=c,s.stride=h,s.divisor=b}}a[e]=rl((function(e,t){var n=e.attribCache;if(l in n)return n[l];var r={isStream:!1};return Object.keys(s).forEach((function(e){r[e]=s[e]})),s.buffer&&(r.buffer=e.link(s.buffer),r.type=r.type||r.buffer+".dtype"),n[l]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];function n(n,r){var o=n.invoke(r,t),i=n.shared,a=n.constants,l=i.isBufferArgs,s=i.buffer;ne.optional((function(){n.assert(r,o+"&&(typeof "+o+'==="object"||typeof '+o+'==="function")&&('+l+"("+o+")||"+s+".getBuffer("+o+")||"+s+".getBuffer("+o+".buffer)||"+l+"("+o+'.buffer)||("constant" in '+o+"&&(typeof "+o+'.constant==="number"||'+i.isArrayLike+"("+o+".constant))))",'invalid dynamic attribute "'+e+'"')}));var u={isStream:r.def(!1)},f=new m;f.state=ni,Object.keys(f).forEach((function(e){u[e]=r.def(""+f[e])}));var c=u.buffer,h=u.type;function p(e){r(u[e],"=",o,".",e,"|0;")}return r("if(",l,"(",o,")){",u.isStream,"=true;",c,"=",s,".createStream(",na,",",o,");",h,"=",c,".dtype;","}else{",c,"=",s,".getBuffer(",o,");","if(",c,"){",h,"=",c,".dtype;",'}else if("constant" in ',o,"){",u.state,"=",ri,";","if(typeof "+o+'.constant === "number"){',u[ei[0]],"=",o,".constant;",ei.slice(1).map((function(e){return u[e]})).join("="),"=0;","}else{",ei.map((function(e,t){return u[e]+"="+o+".constant.length>"+t+"?"+o+".constant["+t+"]:0;"})).join(""),"}}else{","if(",l,"(",o,".buffer)){",c,"=",s,".createStream(",na,",",o,".buffer);","}else{",c,"=",s,".getBuffer(",o,".buffer);","}",h,'="type" in ',o,"?",a.glTypes,"[",o,".type]:",c,".dtype;",u.normalized,"=!!",o,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",u.isStream,"){",s,".destroyStream(",c,");","}"),u}a[e]=ol(t,n)})),a}function V(e,t){var n=e.static,r=e.dynamic;if(qi in n){var o=n[qi];return null!==o&&null===u.getVAO(o)&&(o=u.createVAO(o)),rl((function(e){return e.link(u.getVAO(o))}))}if(qi in r){var i=r[qi];return ol(i,(function(e,t){var n=e.invoke(t,i);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}function P(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=rl((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=ol(t,(function(e,n){return e.invoke(n,t)}))})),r}function U(e,t,r,o,i){var a=e.static,l=e.dynamic;ne.optional((function(){var e=[Ni,zi,Hi,Vi,Pi,ji,Ui,Gi,Ri,qi].concat(_);function t(t){Object.keys(t).forEach((function(t){ne.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',i.commandStr)}))}t(a),t(l)}));var s=O(e,t),f=k(e),c=M(e,f,i),h=R(e,i),p=N(e,i),d=I(e,i,s);function m(e){var t=c[e];t&&(p[e]=t)}m(Ii),m(A(Oi));var g=Object.keys(p).length>0,v={framebuffer:f,draw:h,shader:d,state:p,dirty:g,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(v.profile=B(e),v.uniforms=z(r,i),v.drawVAO=v.scopeVAO=V(e),!v.drawVAO&&d.program&&!s&&n.angle_instanced_arrays){var b=!0,x=d.program.attributes.map((function(e){var n=t.static[e];return b=b&&!!n,n}));if(b&&x.length>0){var y=u.getVAO(u.createVAO(x));v.drawVAO=new tl(null,null,null,(function(e,t){return e.link(y)})),v.useVAO=!0}}return s?v.useVAO=!0:v.attributes=H(t,i),v.context=P(o),v}function j(e,t,n){var r=e.shared.context,o=e.scope();Object.keys(n).forEach((function(i){t.save(r,"."+i);var a=n[i];o(r,".",i,"=",a.append(e,t),";")})),t(o)}function G(e,t,n,r){var o,i=e.shared,a=i.gl,l=i.framebuffer;b&&(o=t.def(i.extensions,".webgl_draw_buffers"));var s,u=e.constants,f=u.drawBuffer,c=u.backBuffer;s=n?n.append(e,t):t.def(l,".next"),r||t("if(",s,"!==",l,".cur){"),t("if(",s,"){",a,".bindFramebuffer(",qa,",",s,".framebuffer);"),b&&t(o,".drawBuffersWEBGL(",f,"[",s,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",qa,",null);"),b&&t(o,".drawBuffersWEBGL(",c,");"),t("}",l,".cur=",s,";"),r||t("}")}function q(e,t,n){var r=e.shared,o=r.gl,i=e.current,a=e.next,l=r.current,s=r.next,u=e.cond(l,".dirty");_.forEach((function(t){var r,f,c=A(t);if(!(c in n.state))if(c in a){r=a[c],f=i[c];var h=Ae(x[c].length,(function(e){return u.def(r,"[",e,"]")}));u(e.cond(h.map((function(e,t){return e+"!=="+f+"["+t+"]"})).join("||")).then(o,".",C[c],"(",h,");",h.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";"))}else{r=u.def(s,".",c);var p=e.cond(r,"!==",l,".",c);u(p),c in w?p(e.cond(r).then(o,".enable(",w[c],");").else(o,".disable(",w[c],");"),l,".",c,"=",r,";"):p(o,".",C[c],"(",r,");",l,".",c,"=",r,";")}})),0===Object.keys(n.state).length&&u(l,".dirty=false;"),t(u)}function W(e,t,n,r){var o=e.shared,i=e.current,a=o.current,l=o.gl;el(Object.keys(n)).forEach((function(o){var s=n[o];if(!r||r(s)){var u=s.append(e,t);if(w[o]){var f=w[o];nl(s)?t(l,u?".enable(":".disable(",f,");"):t(e.cond(u).then(l,".enable(",f,");").else(l,".disable(",f,");")),t(a,".",o,"=",u,";")}else if(un(u)){var c=i[o];t(l,".",C[o],"(",u,");",u.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";")}else t(l,".",C[o],"(",u,");",a,".",o,"=",u,";")}}))}function Z(e,t){v&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function X(e,t,n,r,o){var i,a,l,s=e.shared,u=e.stats,f=s.current,c=s.timer,h=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(e){e(i=t.def(),"=",d(),";"),"string"==typeof o?e(u,".count+=",o,";"):e(u,".count++;"),p&&(r?e(a=t.def(),"=",c,".getNumPendingQueries();"):e(c,".beginQuery(",u,");"))}function g(e){e(u,".cpuTime+=",d(),"-",i,";"),p&&(r?e(c,".pushScopeStats(",a,",",c,".getNumPendingQueries(),",u,");"):e(c,".endQuery();"))}function v(e){var n=t.def(f,".profile");t(f,".profile=",e,";"),t.exit(f,".profile=",n,";")}if(h){if(nl(h))return void(h.enable?(m(t),g(t.exit),v("true")):v("false"));v(l=h.append(e,t))}else l=t.def(f,".profile");var b=e.block();m(b),t("if(",l,"){",b,"}");var x=e.block();g(x),t.exit("if(",l,"){",x,"}")}function Y(e,t,n,r,o){var i=e.shared;function a(e){switch(e){case ga:case ya:case Aa:return 2;case va:case _a:case Ta:return 3;case ba:case wa:case Ea:return 4;default:return 1}}function l(n,r,o){var a=i.gl,l=t.def(n,".location"),s=t.def(i.attributes,"[",l,"]"),u=o.state,f=o.buffer,c=[o.x,o.y,o.z,o.w],h=["buffer","normalized","offset","stride"];function p(){t("if(!",s,".buffer){",a,".enableVertexAttribArray(",l,");}");var n,i=o.type;if(n=o.size?t.def(o.size,"||",r):r,t("if(",s,".type!==",i,"||",s,".size!==",n,"||",h.map((function(e){return s+"."+e+"!=="+o[e]})).join("||"),"){",a,".bindBuffer(",na,",",f,".buffer);",a,".vertexAttribPointer(",[l,n,i,o.normalized,o.stride,o.offset],");",s,".type=",i,";",s,".size=",n,";",h.map((function(e){return s+"."+e+"="+o[e]+";"})).join(""),"}"),v){var u=o.divisor;t("if(",s,".divisor!==",u,"){",e.instancing,".vertexAttribDivisorANGLE(",[l,u],");",s,".divisor=",u,";}")}}function d(){t("if(",s,".buffer){",a,".disableVertexAttribArray(",l,");",s,".buffer=null;","}if(",ei.map((function(e,t){return s+"."+e+"!=="+c[t]})).join("||"),"){",a,".vertexAttrib4f(",l,",",c,");",ei.map((function(e,t){return s+"."+e+"="+c[t]+";"})).join(""),"}")}u===ni?p():u===ri?d():(t("if(",u,"===",ni,"){"),p(),t("}else{"),d(),t("}"))}r.forEach((function(r){var i,s=r.name,u=n.attributes[s];if(u){if(!o(u))return;i=u.append(e,t)}else{if(!o(il))return;var f=e.scopeAttrib(s);ne.optional((function(){e.assert(t,f+".state","missing attribute "+s)})),i={},Object.keys(new m).forEach((function(e){i[e]=t.def(f,".",e)}))}l(e.link(r),a(r.info.type),i)}))}function $(e,n,r,o,i){for(var a,l=e.shared,s=l.gl,u=0;u<o.length;++u){var f,c=o[u],h=c.name,p=c.info.type,d=r.uniforms[h],m=e.link(c)+".location";if(d){if(!i(d))continue;if(nl(d)){var g=d.value;if(ne.command(null!=g,'missing uniform "'+h+'"',e.commandStr),p===Fa||p===Ba){ne.command("function"==typeof g&&(p===Fa&&("texture2d"===g._reglType||"framebuffer"===g._reglType)||p===Ba&&("textureCube"===g._reglType||"framebufferCube"===g._reglType)),"invalid texture for uniform "+h,e.commandStr);var v=e.link(g._texture||g.color[0]._texture);n(s,".uniform1i(",m,",",v+".bind());"),n.exit(v,".unbind();")}else if(p===Da||p===La||p===Sa){ne.optional((function(){ne.command(un(g),"invalid matrix for uniform "+h,e.commandStr),ne.command(p===Da&&4===g.length||p===La&&9===g.length||p===Sa&&16===g.length,"invalid length for matrix uniform "+h,e.commandStr)}));var b=e.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),x=2;p===La?x=3:p===Sa&&(x=4),n(s,".uniformMatrix",x,"fv(",m,",false,",b,");")}else{switch(p){case ma:ne.commandType(g,"number","uniform "+h,e.commandStr),a="1f";break;case ga:ne.command(un(g)&&2===g.length,"uniform "+h,e.commandStr),a="2f";break;case va:ne.command(un(g)&&3===g.length,"uniform "+h,e.commandStr),a="3f";break;case ba:ne.command(un(g)&&4===g.length,"uniform "+h,e.commandStr),a="4f";break;case Ca:ne.commandType(g,"boolean","uniform "+h,e.commandStr),a="1i";break;case xa:ne.commandType(g,"number","uniform "+h,e.commandStr),a="1i";break;case Aa:case ya:ne.command(un(g)&&2===g.length,"uniform "+h,e.commandStr),a="2i";break;case Ta:case _a:ne.command(un(g)&&3===g.length,"uniform "+h,e.commandStr),a="3i";break;case Ea:case wa:ne.command(un(g)&&4===g.length,"uniform "+h,e.commandStr),a="4i"}n(s,".uniform",a,"(",m,",",un(g)?Array.prototype.slice.call(g):g,");")}continue}f=d.append(e,n)}else{if(!i(il))continue;f=n.def(l.uniforms,"[",t.id(h),"]")}p===Fa?n("if(",f,"&&",f,'._reglType==="framebuffer"){',f,"=",f,".color[0];","}"):p===Ba&&n("if(",f,"&&",f,'._reglType==="framebufferCube"){',f,"=",f,".color[0];","}"),ne.optional((function(){function t(t,r){e.assert(n,t,'bad data or missing for uniform "'+h+'".  '+r)}function r(e){t("typeof "+f+'==="'+e+'"',"invalid type, expected "+e)}function o(n,r){t(l.isArrayLike+"("+f+")&&"+f+".length==="+n,"invalid vector, should have length "+n,e.commandStr)}function i(n){t("typeof "+f+'==="function"&&'+f+'._reglType==="texture'+(n===oa?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case xa:r("number");break;case ya:o(2);break;case _a:o(3);break;case wa:o(4);break;case ma:r("number");break;case ga:o(2);break;case va:o(3);break;case ba:o(4);break;case Ca:r("boolean");break;case Aa:o(2);break;case Ta:o(3);break;case Ea:case Da:o(4);break;case La:o(9);break;case Sa:o(16);break;case Fa:i(oa);break;case Ba:i(ia)}}));var y=1;switch(p){case Fa:case Ba:var _=n.def(f,"._texture");n(s,".uniform1i(",m,",",_,".bind());"),n.exit(_,".unbind();");continue;case xa:case Ca:a="1i";break;case ya:case Aa:a="2i",y=2;break;case _a:case Ta:a="3i",y=3;break;case wa:case Ea:a="4i",y=4;break;case ma:a="1f";break;case ga:a="2f",y=2;break;case va:a="3f",y=3;break;case ba:a="4f",y=4;break;case Da:a="Matrix2fv";break;case La:a="Matrix3fv";break;case Sa:a="Matrix4fv"}if(n(s,".uniform",a,"(",m,","),"M"===a.charAt(0)){var w=Math.pow(p-Da+2,2),C=e.global.def("new Float32Array(",w,")");n("false,(Array.isArray(",f,")||",f," instanceof Float32Array)?",f,":(",Ae(w,(function(e){return C+"["+e+"]="+f+"["+e+"]"})),",",C,")")}else n(y>1?Ae(y,(function(e){return f+"["+e+"]"})):f);n(");")}}function K(e,t,n,r){var o=e.shared,i=o.gl,a=o.draw,l=r.draw;function s(){var o,s=l.elements,u=t;return s?((s.contextDep&&r.contextDynamic||s.propDep)&&(u=n),o=s.append(e,u)):o=u.def(a,".",Vi),o&&u("if("+o+")"+i+".bindBuffer("+ra+","+o+".buffer.buffer);"),o}function u(){var o,i=l.count,s=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(s=n),o=i.append(e,s),ne.optional((function(){i.MISSING&&e.assert(t,"false","missing vertex count"),i.DYNAMIC&&e.assert(s,o+">=0","missing vertex count")}))):(o=s.def(a,".",Ui),ne.optional((function(){e.assert(s,o+">=0","missing vertex count")}))),o}var f=s();function c(o){var i=l[o];return i?i.contextDep&&r.contextDynamic||i.propDep?i.append(e,n):i.append(e,t):t.def(a,".",o)}var h,p,d=c(Pi),m=c(ji),g=u();if("number"==typeof g){if(0===g)return}else n("if(",g,"){"),n.exit("}");v&&(h=c(Gi),p=e.instancing);var b=f+".type",x=l.elements&&nl(l.elements);function y(){function e(){n(p,".drawElementsInstancedANGLE(",[d,g,b,m+"<<(("+b+"-"+ti+")>>1)",h],");")}function t(){n(p,".drawArraysInstancedANGLE(",[d,m,g,h],");")}f?x?e():(n("if(",f,"){"),e(),n("}else{"),t(),n("}")):t()}function _(){function e(){n(i+".drawElements("+[d,g,b,m+"<<(("+b+"-"+ti+")>>1)"]+");")}function t(){n(i+".drawArrays("+[d,m,g]+");")}f?x?e():(n("if(",f,"){"),e(),n("}else{"),t(),n("}")):t()}v&&("number"!=typeof h||h>=0)?"string"==typeof h?(n("if(",h,">0){"),y(),n("}else if(",h,"<0){"),_(),n("}")):y():_()}function Q(e,t,n,r,o){var i=F(),a=i.proc("body",o);return ne.optional((function(){i.commandStr=t.commandStr,i.command=i.link(t.commandStr)})),v&&(i.instancing=a.def(i.shared.extensions,".angle_instanced_arrays")),e(i,a,n,r),i.compile().body}function J(e,t,n,r){Z(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),Y(e,t,n,r.attributes,(function(){return!0}))),$(e,t,n,r.uniforms,(function(){return!0})),K(e,t,t,n)}function ee(e,t){var n=e.proc("draw",1);Z(e,n),j(e,n,t.context),G(e,n,t.framebuffer),q(e,n,t),W(e,n,t.state),X(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)J(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var o=e.global.def("{}"),i=n.def(r,".id"),a=n.def(o,"[",i,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",o,"[",i,"]=",e.link((function(n){return Q(J,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}function te(e,t,n,r){function o(){return!0}e.batchId="a1",Z(e,t),Y(e,t,n,r.attributes,o),$(e,t,n,r.uniforms,o),K(e,t,t,n)}function re(e,t,n,r){Z(e,t);var o=n.contextDep,i=t.def(),a="a0",l="a1",s=t.def();e.shared.props=s,e.batchId=i;var u=e.scope(),f=e.scope();function c(e){return e.contextDep&&o||e.propDep}function h(e){return!c(e)}if(t(u.entry,"for(",i,"=0;",i,"<",l,";++",i,"){",s,"=",a,"[",i,"];",f,"}",u.exit),n.needsContext&&j(e,f,n.context),n.needsFramebuffer&&G(e,f,n.framebuffer),W(e,f,n.state,c),n.profile&&c(n.profile)&&X(e,f,n,!1,!0),r)n.useVAO?n.drawVAO?c(n.drawVAO)?f(e.shared.vao,".setVAO(",n.drawVAO.append(e,f),");"):u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):u(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(u(e.shared.vao,".setVAO(null);"),Y(e,u,n,r.attributes,h),Y(e,f,n,r.attributes,c)),$(e,u,n,r.uniforms,h),$(e,f,n,r.uniforms,c),K(e,u,f,n);else{var p=e.global.def("{}"),d=n.shader.progVar.append(e,f),m=f.def(d,".id"),g=f.def(p,"[",m,"]");f(e.shared.gl,".useProgram(",d,".program);","if(!",g,"){",g,"=",p,"[",m,"]=",e.link((function(t){return Q(te,e,n,t,2)})),"(",d,");}",g,".call(this,a0[",i,"],",i,");")}}function oe(e,t){var n=e.proc("batch",2);e.batchId="0",Z(e,n);var r=!1,o=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(j(e,n,t.context),o=!1);var i=t.framebuffer,a=!1;function l(e){return e.contextDep&&r||e.propDep}i?(i.propDep?r=a=!0:i.contextDep&&r&&(a=!0),a||G(e,n,i)):G(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),q(e,n,t),W(e,n,t.state,(function(e){return!l(e)})),t.profile&&l(t.profile)||X(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=o,t.needsFramebuffer=a;var s=t.shader.progVar;if(s.contextDep&&r||s.propDep)re(e,n,t,null);else{var u=s.append(e,n);if(n(e.shared.gl,".useProgram(",u,".program);"),t.shader.program)re(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var f=e.global.def("{}"),c=n.def(u,".id"),h=n.def(f,"[",c,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",f,"[",c,"]=",e.link((function(n){return Q(re,e,t,n,2)})),"(",u,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}function ie(e,n){var r=e.proc("scope",3);e.batchId="a2";var o=e.shared,i=o.current;function a(t){var i=n.shader[t];i&&r.set(o.shader,"."+t,i.append(e,r))}j(e,r,n.context),n.framebuffer&&n.framebuffer.append(e,r),el(Object.keys(n.state)).forEach((function(t){var i=n.state[t].append(e,r);un(i)?i.forEach((function(n,o){r.set(e.next[t],"["+o+"]",n)})):r.set(o.next,"."+t,i)})),X(e,r,n,!0,!0),[Vi,ji,Ui,Gi,Pi].forEach((function(t){var i=n.draw[t];i&&r.set(o.draw,"."+t,""+i.append(e,r))})),Object.keys(n.uniforms).forEach((function(i){r.set(o.uniforms,"["+t.id(i)+"]",n.uniforms[i].append(e,r))})),Object.keys(n.attributes).forEach((function(t){var o=n.attributes[t].append(e,r),i=e.scopeAttrib(t);Object.keys(new m).forEach((function(e){r.set(i,"."+e,o[e])}))})),n.scopeVAO&&r.set(o.vao,".targetVAO",n.scopeVAO.append(e,r)),a(zi),a(Hi),Object.keys(n.state).length>0&&(r(i,".dirty=true;"),r.exit(i,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}function ae(e){if("object"==typeof e&&!un(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(he.isDynamic(e[t[n]]))return!0;return!1}}function le(e,t,n){var r=t.static[n];if(r&&ae(r)){var o=e.global,i=Object.keys(r),a=!1,l=!1,s=!1,u=e.global.def("{}");i.forEach((function(t){var n=r[t];if(he.isDynamic(n)){"function"==typeof n&&(n=r[t]=he.unbox(n));var i=ol(n,null);a=a||i.thisDep,s=s||i.propDep,l=l||i.contextDep}else{switch(o(u,".",t,"="),typeof n){case"number":o(n);break;case"string":o('"',n,'"');break;case"object":Array.isArray(n)&&o("[",n.join(),"]");break;default:o(e.link(n))}o(";")}})),t.dynamic[n]=new he.DynamicVariable(si,{thisDep:a,contextDep:l,propDep:s,ref:u,append:f}),delete t.static[n]}function f(e,t){i.forEach((function(n){var o=r[n];if(he.isDynamic(o)){var i=e.invoke(t,o);t(u,".",n,"=",i,";")}}))}}function se(e,t,n,r,o){var i=F();i.stats=i.link(o),Object.keys(t.static).forEach((function(e){le(i,t,e)})),ta.forEach((function(t){le(i,e,t)}));var a=U(e,t,n,r,i);return ee(i,a),ie(i,a),oe(i,a),i.compile()}return{next:y,current:x,procs:function(){var e=F(),t=e.proc("poll"),o=e.proc("refresh"),i=e.block();t(i),o(i);var a,l=e.shared,s=l.gl,u=l.next,f=l.current;i(f,".dirty=false;"),G(e,t),G(e,o,null,!0),v&&(a=e.link(v)),n.oes_vertex_array_object&&o(e.link(n.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var c=0;c<r.maxAttributes;++c){var h=o.def(l.attributes,"[",c,"]"),p=e.cond(h,".buffer");p.then(s,".enableVertexAttribArray(",c,");",s,".bindBuffer(",na,",",h,".buffer.buffer);",s,".vertexAttribPointer(",c,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(s,".disableVertexAttribArray(",c,");",s,".vertexAttrib4f(",c,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),o(p),v&&o(a,".vertexAttribDivisorANGLE(",c,",",h,".divisor);")}return o(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(w).forEach((function(n){var r=w[n],a=i.def(u,".",n),l=e.block();l("if(",a,"){",s,".enable(",r,")}else{",s,".disable(",r,")}",f,".",n,"=",a,";"),o(l),t("if(",a,"!==",f,".",n,"){",l,"}")})),Object.keys(C).forEach((function(n){var r,a,l=C[n],c=x[n],h=e.block();if(h(s,".",l,"("),un(c)){var p=c.length;r=e.global.def(u,".",n),a=e.global.def(f,".",n),h(Ae(p,(function(e){return r+"["+e+"]"})),");",Ae(p,(function(e){return a+"["+e+"]="+r+"["+e+"];"})).join("")),t("if(",Ae(p,(function(e){return r+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",h,"}")}else r=i.def(u,".",n),a=i.def(f,".",n),h(r,");",f,".",n,"=",r,";"),t("if(",r,"!==",a,"){",h,"}");o(h)})),e.compile()}(),compile:se}}function ll(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var sl=34918,ul=34919,fl=35007,cl=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function o(e){n.push(e)}var i=[];function a(e){var n=r();t.ext_disjoint_timer_query.beginQueryEXT(fl,n),i.push(n),p(i.length-1,i.length,e)}function l(){t.ext_disjoint_timer_query.endQueryEXT(fl)}function s(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var u=[];function f(){return u.pop()||new s}function c(e){u.push(e)}var h=[];function p(e,t,n){var r=f();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,h.push(r)}var d=[],m=[];function g(){var e,n,r=i.length;if(0!==r){m.length=Math.max(m.length,r+1),d.length=Math.max(d.length,r+1),d[0]=0,m[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var l=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(l,ul)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,sl),o(l)):i[e++]=l,d[n+1]=a,m[n+1]=e}for(i.length=e,e=0,n=0;n<h.length;++n){var s=h[n],u=s.startQueryIndex,f=s.endQueryIndex;s.sum+=d[f]-d[u];var p=m[u],g=m[f];g===p?(s.stats.gpuTime+=s.sum/1e6,c(s)):(s.startQueryIndex=p,s.endQueryIndex=g,h[e++]=s)}h.length=e}}return{beginQuery:a,endQuery:l,pushScopeStats:p,update:g,getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},hl=16384,pl=256,dl=1024,ml=34962,gl="webglcontextlost",vl="webglcontextrestored",bl=1,xl=2,yl=3;function _l(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function wl(e){var n=we(e);if(!n)return null;var r=n.gl,o=r.getContextAttributes(),i=r.isContextLost(),a=Ce(r,n);if(!a)return null;var l=me(),s=ll(),u=a.extensions,f=cl(r,u),c=de(),h=r.drawingBufferWidth,p=r.drawingBufferHeight,d={tick:0,time:0,viewportWidth:h,viewportHeight:p,framebufferWidth:h,framebufferHeight:p,drawingBufferWidth:h,drawingBufferHeight:p,pixelRatio:n.pixelRatio},m={},g={elements:null,primitive:4,count:-1,offset:0,instances:-1},v=yt(r,u),b=jt(r,s,n,y),x=Vo(r,u,v,s,b);function y(e){return x.destroyBuffer(e)}var _=rn(r,u,b,s),w=qo(r,l,s,n),C=Zr(r,u,v,(function(){E.procs.poll()}),d,s,n),A=lo(r,u,v,s,n),T=Ro(r,u,v,C,A,s),E=al(r,l,u,v,b,_,C,T,m,x,w,g,d,f,n),D=$o(r,T,E.procs.poll,d,o,u,v),L=E.next,S=r.canvas,F=[],B=[],k=[],M=[n.onDestroy],O=null;function I(){if(0===F.length)return f&&f.update(),void(O=null);O=pe.next(I),Z();for(var e=F.length-1;e>=0;--e){var t=F[e];t&&t(d,null,0)}r.flush(),f&&f.update()}function R(){!O&&F.length>0&&(O=pe.next(I))}function N(){O&&(pe.cancel(I),O=null)}function z(e){e.preventDefault(),i=!0,N(),B.forEach((function(e){e()}))}function H(e){r.getError(),i=!1,a.restore(),w.restore(),b.restore(),C.restore(),A.restore(),T.restore(),x.restore(),f&&f.restore(),E.procs.refresh(),R(),k.forEach((function(e){e()}))}function V(){F.length=0,N(),S&&(S.removeEventListener(gl,z),S.removeEventListener(vl,H)),w.clear(),T.clear(),A.clear(),C.clear(),_.clear(),b.clear(),x.clear(),f&&f.clear(),M.forEach((function(e){e()}))}function P(e){function n(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}function r(e){var t={},n={};return Object.keys(e).forEach((function(r){var o=e[r];he.isDynamic(o)?n[r]=he.unbox(o,r):t[r]=o})),{dynamic:n,static:t}}ne(!!e,"invalid args to regl({...})"),ne.type(e,"object","invalid args to regl({...})");var o=r(e.context||{}),a=r(e.uniforms||{}),l=r(e.attributes||{}),s=r(n(e)),u={gpuTime:0,cpuTime:0,count:0},f=E.compile(s,l,a,o,u),c=f.draw,h=f.batch,p=f.scope,d=[];function m(e){for(;d.length<e;)d.push(null);return d}function g(e,t){var n;if(i&&ne.raise("context lost"),"function"==typeof e)return p.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)p.call(this,null,t,n);else{if(!Array.isArray(e))return p.call(this,e,t,0);for(n=0;n<e.length;++n)p.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,m(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return h.call(this,e,e.length)}}return t(g,{stats:u})}S&&(S.addEventListener(gl,z,!1),S.addEventListener(vl,H,!1));var U=T.setFBO=P({framebuffer:he.define.call(null,bl,"framebuffer")});function j(e,t){var n=0;E.procs.poll();var o=t.color;o&&(r.clearColor(+o[0]||0,+o[1]||0,+o[2]||0,+o[3]||0),n|=hl),"depth"in t&&(r.clearDepth(+t.depth),n|=pl),"stencil"in t&&(r.clearStencil(0|t.stencil),n|=dl),ne(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function G(e){if(ne("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)U(t({framebuffer:e.framebuffer.faces[n]},e),j);else U(e,j);else j(null,e)}function q(e){function t(){var t=_l(F,e);function n(){var e=_l(F,n);F[e]=F[F.length-1],F.length-=1,F.length<=0&&N()}ne(t>=0,"cannot cancel a frame twice"),F[t]=n}return ne.type(e,"function","regl.frame() callback must be a function"),F.push(e),R(),{cancel:t}}function W(){var e=L.viewport,t=L.scissor_box;e[0]=e[1]=t[0]=t[1]=0,d.viewportWidth=d.framebufferWidth=d.drawingBufferWidth=e[2]=t[2]=r.drawingBufferWidth,d.viewportHeight=d.framebufferHeight=d.drawingBufferHeight=e[3]=t[3]=r.drawingBufferHeight}function Z(){d.tick+=1,d.time=Y(),W(),E.procs.poll()}function X(){W(),E.procs.refresh(),f&&f.update()}function Y(){return(de()-c)/1e3}function $(e,t){var n;switch(ne.type(t,"function","listener callback must be a function"),e){case"frame":return q(t);case"lost":n=B;break;case"restore":n=k;break;case"destroy":n=M;break;default:ne.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}}X();var K=t(P,{clear:G,prop:he.define.bind(null,bl),context:he.define.bind(null,xl),this:he.define.bind(null,yl),draw:P({}),buffer:function(e){return b.create(e,ml,!1,!1)},elements:function(e){return _.create(e,!1)},texture:C.create2D,cube:C.createCube,renderbuffer:A.create,framebuffer:T.create,framebufferCube:T.createCube,vao:x.createVAO,attributes:o,frame:q,on:$,limits:v,hasExtension:function(e){return v.extensions.indexOf(e.toLowerCase())>=0},read:D,destroy:V,_gl:r,_refresh:X,poll:function(){Z(),f&&f.update()},now:Y,stats:s});return n.onDone(null,K),K}return wl}()})),af="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",lf="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = texCoord;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",sf="#define GLSLIFY 1\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = texCoord;\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n",uf="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D texture;\nuniform bool littleEndian;\nuniform bool enableSimpleHillshade;\n\nuniform float textureSize;\nuniform float tileSize;\nuniform vec4 textureBounds;\nvarying vec2 vTexCoord;\n\nuniform float offset;\nuniform float slopescale;\nuniform float slopeFactor;\nuniform float deg2rad;\nuniform float azimuth;\nuniform float altitude;\n\nfloat getRelativeHeight(vec2 pos, float v, vec4 textureBounds) {\n  float pixelFloatValue = getTexelValue(texture, pos, littleEndian);\n  float test = step(0.0, pixelFloatValue);\n  float testReturn = ((test * pixelFloatValue) + ((1.0 - test) * v)) * (slopescale*slopeFactor);\n  return testReturn;\n}\n\nfloat hillshade(vec2 pos, float v, float offset, vec4 textureBounds) {\n  float cv = v * (slopescale * slopeFactor);\n  vec4 nv = vec4(\n  getRelativeHeight(vec2(pos.x + offset, pos.y), v, textureBounds),\n  getRelativeHeight(vec2(pos.x - offset, pos.y), v, textureBounds),\n  getRelativeHeight(vec2(pos.x, pos.y + offset), v, textureBounds),\n  getRelativeHeight(vec2(pos.x, pos.y - offset), v, textureBounds)\n  );\n\n  vec2 grad = vec2(\n    (nv[0] - cv) / 2.0 + (cv - nv[1]) / 2.0,\n    (nv[2] - cv) / 2.0 + (cv - nv[3]) / 2.0\n  );\n\n  float slope = max(3.141593 / 2.0 - atan(sqrt(dot(grad, grad))), 0.0);\n  float aspect = atan(-grad.y, grad.x);\n\n  float hs = sin(altitude * deg2rad) * sin(slope) +\n    cos(altitude * deg2rad) * cos(slope) *\n    cos((azimuth * deg2rad) - aspect);\n\n  return clamp(hs, 0.0, 1.0);\n}\n\nvoid main() {\n  float texelFloat = getTexelValue(texture, vTexCoord, littleEndian);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  vec4 clr = computeColor(\n    texelFloat,\n    scaleColormap,\n    sentinelColormap,\n    scaleLength,\n    sentinelLength,\n    littleEndian\n  );\n\n  if (enableSimpleHillshade) {\n    float hs = hillshade(vTexCoord, texelFloat, offset, textureBounds);\n    clr.rgb = clr.rgb * hs;\n  }\n\n  gl_FragColor = clr;\n}\n",ff=$o();function cf(e,t,r){return e(n(n({},t),{vert:lf,frag:ii(uf,r),uniforms:n(n({},t.uniforms),{scaleLength:e.prop("scaleLength"),sentinelLength:e.prop("sentinelLength"),scaleColormap:e.prop("scaleColormap"),sentinelColormap:e.prop("sentinelColormap"),texture:function(e,t){return t.texture},enableSimpleHillshade:function(e,t){return t.enableSimpleHillshade},offset:0,azimuth:0,altitude:0,slopescale:0,deg2rad:Wo,slopeFactor:Zo,tileSize:0,textureSize:0,textureBounds:[0,0,0,0]}),attributes:n(n({},t.attributes),{texCoord:function(e,t){return ei(t.textureBounds)}})}))}function hf(e,t,r){return e(n(n({},t),{vert:lf,frag:ii(uf,r),uniforms:n(n({},t.uniforms),{scaleLength:e.prop("scaleLength"),sentinelLength:e.prop("sentinelLength"),scaleColormap:e.prop("scaleColormap"),sentinelColormap:e.prop("sentinelColormap"),texture:function(e,t){return t.texture},enableSimpleHillshade:function(e,t){return t.enableSimpleHillshade},azimuth:function(e,t){return t.azimuth},altitude:function(e,t){return t.altitude},slopescale:function(e,t){return t.slopescale},deg2rad:Wo,slopeFactor:Zo,offset:function(e,t){return t.offset},textureBounds:function(e,t){var n=t.textureBounds;return[[n[0].x],[n[0].y],[n[1].x],[n[1].y]]},textureSize:function(e,t){return t.textureSize},tileSize:function(e,t){return t.tileSize}}),attributes:n(n({},t.attributes),{texCoord:function(e,t){return ei(t.textureBounds)}})}))}function pf(e,t,r){return e(n(n({},t),{vert:af,frag:ii("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D texture;\nuniform bool littleEndian;\nuniform sampler2D hillshadePregenTexture;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  float texelFloat = getTexelValue(texture, vTexCoordA, littleEndian);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  vec4 clr = computeColor(\n    texelFloat,\n    scaleColormap,\n    sentinelColormap,\n    scaleLength,\n    sentinelLength,\n    littleEndian\n  );\n\n  // Hillshade\n  float light = texture2D(hillshadePregenTexture, vTexCoordB).r;\n  // float light = getTexelValue(vTexCoordB, hillshadePregenTexture, littleEndian).r;\n  clr.rgb = light * pow(clr.rgb, vec3(2.0));\n  clr.rgb = pow(clr.rgb, vec3(1.0/2.2));\n\n  gl_FragColor = clr;\n}\n",r),uniforms:n(n({},t.uniforms),{scaleLength:e.prop("scaleLength"),sentinelLength:e.prop("sentinelLength"),scaleColormap:e.prop("scaleColormap"),sentinelColormap:e.prop("sentinelColormap"),texture:function(e,t){return t.texture},hillshadePregenTexture:function(e,t){return t.hillshadePregenTexture}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBounds)},texCoordB:function(e,t){return ei(t.textureBoundsHs)}})}))}function df(e,t){return e(n(n({},t),{vert:lf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float multiplierA;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float texelFloatA = getTexelValue(textureA, vTexCoord, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n\n  if (aIsNodata || texelFloatA < filterLowA || texelFloatA > filterHighA) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{filterLowA:function(e,t){return t.filterLowA},filterHighA:function(e,t){return t.filterHighA},multiplierA:function(e,t){return t.multiplierA},textureA:function(e,t){return t.textureA}}),attributes:n(n({},t.attributes),{texCoord:function(e,t){return ei(t.textureBoundsA)}}),framebuffer:e.prop("fbo")}))}function mf(e,t){return e(n(n({},t),{vert:af,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float multiplierA;\nuniform float multiplierB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n  float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{filterLowA:function(e,t){return t.filterLowA},filterHighA:function(e,t){return t.filterHighA},filterLowB:function(e,t){return t.filterLowB},filterHighB:function(e,t){return t.filterHighB},multiplierA:function(e,t){return t.multiplierA},multiplierB:function(e,t){return t.multiplierB},textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)}}),framebuffer:e.prop("fbo")}))}function gf(e,t){return e(n(n({},t),{vert:"#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n  float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n  float texelFloatC = getTexelValue(textureC, vTexCoordC, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{filterLowA:function(e,t){return t.filterLowA},filterHighA:function(e,t){return t.filterHighA},filterLowB:function(e,t){return t.filterLowB},filterHighB:function(e,t){return t.filterHighB},filterLowC:function(e,t){return t.filterLowC},filterHighC:function(e,t){return t.filterHighC},multiplierA:function(e,t){return t.multiplierA},multiplierB:function(e,t){return t.multiplierB},multiplierC:function(e,t){return t.multiplierC},textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB},textureC:function(e,t){return t.textureC}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)},texCoordC:function(e,t){return ei(t.textureBoundsC)}}),framebuffer:e.prop("fbo")}))}function vf(e,t){return e(n(n({},t),{vert:"#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n  float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n  float texelFloatC = getTexelValue(textureC, vTexCoordC, littleEndian);\n  float texelFloatD = getTexelValue(textureD, vTexCoordD, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{filterLowA:function(e,t){return t.filterLowA},filterHighA:function(e,t){return t.filterHighA},filterLowB:function(e,t){return t.filterLowB},filterHighB:function(e,t){return t.filterHighB},filterLowC:function(e,t){return t.filterLowC},filterHighC:function(e,t){return t.filterHighC},filterLowD:function(e,t){return t.filterLowD},filterHighD:function(e,t){return t.filterHighD},multiplierA:function(e,t){return t.multiplierA},multiplierB:function(e,t){return t.multiplierB},multiplierC:function(e,t){return t.multiplierC},multiplierD:function(e,t){return t.multiplierD},textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB},textureC:function(e,t){return t.textureC},textureD:function(e,t){return t.textureD}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)},texCoordC:function(e,t){return ei(t.textureBoundsC)},texCoordD:function(e,t){return ei(t.textureBoundsD)}}),framebuffer:e.prop("fbo")}))}function bf(e,t){return e(n(n({},t),{vert:"#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\nattribute vec2 texCoordE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  vTexCoordE = texCoordE;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n  float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n  float texelFloatC = getTexelValue(textureC, vTexCoordC, littleEndian);\n  float texelFloatD = getTexelValue(textureD, vTexCoordD, littleEndian);\n  float texelFloatE = getTexelValue(textureE, vTexCoordE, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{filterLowA:function(e,t){return t.filterLowA},filterHighA:function(e,t){return t.filterHighA},filterLowB:function(e,t){return t.filterLowB},filterHighB:function(e,t){return t.filterHighB},filterLowC:function(e,t){return t.filterLowC},filterHighC:function(e,t){return t.filterHighC},filterLowD:function(e,t){return t.filterLowD},filterHighD:function(e,t){return t.filterHighD},filterLowE:function(e,t){return t.filterLowE},filterHighE:function(e,t){return t.filterHighE},multiplierA:function(e,t){return t.multiplierA},multiplierB:function(e,t){return t.multiplierB},multiplierC:function(e,t){return t.multiplierC},multiplierD:function(e,t){return t.multiplierD},multiplierE:function(e,t){return t.multiplierE},textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB},textureC:function(e,t){return t.textureC},textureD:function(e,t){return t.textureD},textureE:function(e,t){return t.textureE}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)},texCoordC:function(e,t){return ei(t.textureBoundsC)},texCoordD:function(e,t){return ei(t.textureBoundsD)},texCoordE:function(e,t){return ei(t.textureBoundsE)}}),framebuffer:e.prop("fbo")}))}function xf(e,t){return e(n(n({},t),{vert:"#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\nattribute vec2 texCoordE;\nattribute vec2 texCoordF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  vTexCoordE = texCoordE;\n  vTexCoordE = texCoordF;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\nuniform sampler2D textureF;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float filterLowF;\nuniform float filterHighF;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\nuniform float multiplierF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n  float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n  float texelFloatC = getTexelValue(textureC, vTexCoordC, littleEndian);\n  float texelFloatD = getTexelValue(textureD, vTexCoordD, littleEndian);\n  float texelFloatE = getTexelValue(textureE, vTexCoordE, littleEndian);\n  float texelFloatF = getTexelValue(textureF, vTexCoordF, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n  bool fIsNodata = isCloseEnough(texelFloatF, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata || fIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE ||\n      texelFloatF < filterLowF || texelFloatF > filterHighF\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE + texelFloatF * multiplierF;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{filterLowA:function(e,t){return t.filterLowA},filterHighA:function(e,t){return t.filterHighA},filterLowB:function(e,t){return t.filterLowB},filterHighB:function(e,t){return t.filterHighB},filterLowC:function(e,t){return t.filterLowC},filterHighC:function(e,t){return t.filterHighC},filterLowD:function(e,t){return t.filterLowD},filterHighD:function(e,t){return t.filterHighD},filterLowE:function(e,t){return t.filterLowE},filterHighE:function(e,t){return t.filterHighE},filterLowF:function(e,t){return t.filterLowF},filterHighF:function(e,t){return t.filterHighF},multiplierA:function(e,t){return t.multiplierA},multiplierB:function(e,t){return t.multiplierB},multiplierC:function(e,t){return t.multiplierC},multiplierD:function(e,t){return t.multiplierD},multiplierE:function(e,t){return t.multiplierE},multiplierF:function(e,t){return t.multiplierF},textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB},textureC:function(e,t){return t.textureC},textureD:function(e,t){return t.textureD},textureE:function(e,t){return t.textureE},textureF:function(e,t){return t.textureF}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)},texCoordC:function(e,t){return ei(t.textureBoundsC)},texCoordD:function(e,t){return ei(t.textureBoundsD)},texCoordE:function(e,t){return ei(t.textureBoundsE)},texCoordF:function(e,t){return ei(t.textureBoundsF)}}),framebuffer:e.prop("fbo")}))}function yf(e,t){return e(n(n({},t),{vert:af,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n  float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float diff = texelFloatB - texelFloatA;\n    gl_FragColor = floatToRgba(diff, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)}}),framebuffer:e.prop("fbo")}))}function _f(e,t,r){return e(n(n({},t),{vert:lf,frag:ii("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D texture;\nuniform bool littleEndian;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float f = getTexelValue(texture, vTexCoord, littleEndian);\n\n  if (isCloseEnough(f, nodataValue)) {\n    gl_FragColor = TRANSPARENT;\n  } else {\n    gl_FragColor = computeColor(\n      f,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  }\n}\n",r),depth:{enable:!1},uniforms:n(n({},t.uniforms),{scaleLength:e.prop("scaleLength"),sentinelLength:e.prop("sentinelLength"),scaleColormap:e.prop("scaleColormap"),sentinelColormap:e.prop("sentinelColormap"),texture:e.prop("texture")}),attributes:n(n({},t.attributes),{texCoord:[[0,1],[1,1],[0,0],[1,0]]})}))}function wf(e,t){return e(n(n({},t),{vert:lf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits) {\n    return mod(v, shiftLeft(1.0, bits));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform sampler2D texture;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  //sample the texture\n  vec3 rgb = texture2D(texture, vTexCoord).rgb;\n\n  // Convert the red, green, and blue channels into a float\n  float f = -10000.0 + ((rgb.r * 255.0 * 256.0 * 256.0 + rgb.g * 255.0 * 256.0 + rgb.b * 255.0) * 0.1);\n\n  // convert to rgba and write to framebuffer\n  gl_FragColor = floatToRgba(f, littleEndian);\n}\n",depth:{enable:!1},uniforms:n(n({},t.uniforms),{texture:function(e,t){return t.texture}}),attributes:n(n({},t.attributes),{texCoord:[[0,1],[1,1],[0,0],[1,0]]}),framebuffer:e.prop("fbo")}))}function Cf(e,t,r){return e(n(n({},t),{vert:af,frag:ii("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nuniform float nodataValue;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nbool isSentinelValue(sampler2D sentinelColormap, int len, float value) {\n  for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n    if (i == len) {\n      break;\n    }\n    float i_f = float(i);\n    float lenFloat = float(len);\n    float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / lenFloat, 0.75), littleEndian);\n    if (isCloseEnough(sentinelOffset, value)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nvoid main() {\n  if (interpolationFraction <= 0.0) {\n    float texelFloat = getTexelValue(textureA, vTexCoordA, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(\n      texelFloat,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  } else if (interpolationFraction >= 1.0) {\n    float texelFloat = getTexelValue(textureB, vTexCoordB, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(\n      texelFloat,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n  } else {\n    // retrieve and decode pixel value from both tiles\n    float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n    float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n    bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n    bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n    if (aIsNodata && bIsNodata) {\n      discard;\n    } else if (\n      aIsNodata\n      || bIsNodata\n      || scaleLength == 0\n      || isSentinelValue(sentinelColormap, sentinelLength, texelFloatA)\n      || isSentinelValue(sentinelColormap, sentinelLength, texelFloatB)\n    ) {\n      vec4 colorA = (\n        aIsNodata\n        ? TRANSPARENT\n        : computeColor(\n            texelFloatA,\n            scaleColormap,\n            sentinelColormap,\n            scaleLength,\n            sentinelLength,\n            littleEndian\n          )\n      );\n      vec4 colorB = (\n        bIsNodata\n        ? TRANSPARENT\n        : computeColor(\n            texelFloatB,\n            scaleColormap,\n            sentinelColormap,\n            scaleLength,\n            sentinelLength,\n            littleEndian\n          )\n      );\n      gl_FragColor = mix(colorA, colorB, interpolationFraction);\n    } else {\n      float interpolated = mix(texelFloatA, texelFloatB, interpolationFraction);\n      gl_FragColor = computeColor(\n        interpolated,\n        scaleColormap,\n        sentinelColormap,\n        scaleLength,\n        sentinelLength,\n        littleEndian\n      );\n    }\n  }\n}\n",r),uniforms:n(n({},t.uniforms),{scaleLength:e.prop("scaleLength"),sentinelLength:e.prop("sentinelLength"),scaleColormap:e.prop("scaleColormap"),sentinelColormap:e.prop("sentinelColormap"),textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB},interpolationFraction:function(e,t){return t.interpolationFraction}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)}})}))}function Af(e,t,r){return e(n(n({},t),{vert:af,frag:ii("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nuniform int scaleLengthA;\nuniform int sentinelLengthA;\nuniform sampler2D scaleColormapA;\nuniform sampler2D sentinelColormapA;\n\nuniform int scaleLengthB;\nuniform int sentinelLengthB;\nuniform sampler2D scaleColormapB;\nuniform sampler2D sentinelColormapB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  if (interpolationFraction <= 0.0) {\n    float texelFloat = getTexelValue(textureA, vTexCoordA, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian);\n  } else if (interpolationFraction >= 1.0) {\n    float texelFloat = getTexelValue(textureB, vTexCoordB, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian);\n  } else {\n    float texelFloatA = getTexelValue(textureA, vTexCoordA, littleEndian);\n    float texelFloatB = getTexelValue(textureB, vTexCoordB, littleEndian);\n    vec4 colorA = (\n      isCloseEnough(texelFloatA, nodataValue)\n      ? TRANSPARENT\n      : computeColor(texelFloatA, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian)\n    );\n    vec4 colorB = (\n      isCloseEnough(texelFloatB, nodataValue)\n      ? TRANSPARENT\n      : computeColor(texelFloatB, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian)\n    );\n    gl_FragColor = mix(colorA, colorB, interpolationFraction);\n  }\n}",r),uniforms:n(n({},t.uniforms),{scaleLengthA:e.prop("scaleLengthA"),sentinelLengthA:e.prop("sentinelLengthA"),scaleColormapA:e.prop("scaleColormapA"),sentinelColormapA:e.prop("sentinelColormapA"),scaleLengthB:e.prop("scaleLengthB"),sentinelLengthB:e.prop("sentinelLengthB"),scaleColormapB:e.prop("scaleColormapB"),sentinelColormapB:e.prop("sentinelColormapB"),textureA:function(e,t){return t.textureA},textureB:function(e,t){return t.textureB},interpolationFraction:function(e,t){return t.interpolationFraction}}),attributes:n(n({},t.attributes),{texCoordA:function(e,t){return ei(t.textureBoundsA)},texCoordB:function(e,t){return ei(t.textureBoundsB)}})}))}function Tf(e,t,r){return e(n(n({},t),{vert:lf,frag:ii("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D texture;\n\nuniform int scaleLengthA;\nuniform int sentinelLengthA;\nuniform sampler2D scaleColormapA;\nuniform sampler2D sentinelColormapA;\n\nuniform int scaleLengthB;\nuniform int sentinelLengthB;\nuniform sampler2D scaleColormapB;\nuniform sampler2D sentinelColormapB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float texelFloat = getTexelValue(texture, vTexCoord, littleEndian);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  if (interpolationFraction <= 0.0) {\n    gl_FragColor = computeColor(texelFloat, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian);\n  } else if (interpolationFraction >= 1.0) {\n    gl_FragColor = computeColor(texelFloat, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian);\n  } else {\n    vec4 colorA = computeColor(texelFloat, scaleColormapA, sentinelColormapA, scaleLengthA, sentinelLengthA, littleEndian);\n    vec4 colorB = computeColor(texelFloat, scaleColormapB, sentinelColormapB, scaleLengthB, sentinelLengthB, littleEndian);\n    gl_FragColor = mix(colorA, colorB, interpolationFraction);\n  }\n}",r),uniforms:n(n({},t.uniforms),{scaleLengthA:e.prop("scaleLengthA"),sentinelLengthA:e.prop("sentinelLengthA"),scaleColormapA:e.prop("scaleColormapA"),sentinelColormapA:e.prop("sentinelColormapA"),scaleLengthB:e.prop("scaleLengthB"),sentinelLengthB:e.prop("sentinelLengthB"),scaleColormapB:e.prop("scaleColormapB"),sentinelColormapB:e.prop("sentinelColormapB"),texture:function(e,t){return t.texture},interpolationFraction:function(e,t){return t.interpolationFraction}}),attributes:n(n({},t.attributes),{texCoord:function(e,t){return ei(t.textureBounds)}})}))}function Ef(e,t){return e({vert:sf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat_0(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v_0, float amt) {\n  v_0 = floor(v_0) + 0.5;\n  return floor(v_0 / exp2(amt));\n}\nfloat shiftLeft (float v_0, float amt) {\n    return floor(v_0 * exp2(amt) + 0.5);\n}\nfloat maskLast (float v_0, float bits_0) {\n    return mod(v_0, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat_1(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat_1(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nuniform sampler2D texture;\nuniform float textureSize;\nuniform bool littleEndian;\nuniform float nodataValue;\nvarying vec2 vTexCoord;\nuniform int kernelSize;\n\nint kernelEnd = int(kernelSize/2);\nint kernelStart = kernelEnd * -1;\n\nfloat runConvKernel(vec2 pos, vec2 onePixel) {\n  float convKernelWeight = 0.0;\n  float sum = 0.0;\n\n  for (int i = -20; i < 20; i ++) {\n    if (i < kernelStart) continue;\n    if (i > kernelEnd) break;\n    for (int j = -20; j < 20; j ++) {\n      if (j < kernelStart) continue;\n      if (j > kernelEnd) break;\n      float texelValue = getTexelValue(texture, pos + onePixel * vec2(i, j), littleEndian);\n      if (!isCloseEnough(texelValue, nodataValue)) {\n        sum = sum + texelValue;\n        convKernelWeight = convKernelWeight + 1.0;\n      }\n    }\n  }\n  return (sum / convKernelWeight);\n}\n\nvoid main() {\n  float texelFloat = getTexelValue(texture, vTexCoord, littleEndian);\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    vec2 onePixel = vec2(1.0, 1.0) / textureSize;\n    float texelFloatSmoothed = runConvKernel(vTexCoord, onePixel);\n    gl_FragColor = floatToRgba(texelFloatSmoothed, littleEndian);\n  }\n}\n",uniforms:n(n({},t.uniforms),{texture:e.prop("texture"),textureSize:e.prop("textureSize"),kernelSize:e.prop("kernelSize")}),attributes:{texCoord:[0,1,1,1,0,0,1,0],position:[-1,1,1,1,-1,-1,1,-1]},depth:{enable:!1},primitive:"triangle strip",count:4})}function Df(e){return e({vert:sf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform sampler2D texture;\nuniform float floatScale;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float f = getTexelValue(texture, vTexCoord, littleEndian);\n\n  if (isCloseEnough(f, nodataValue)) {\n    gl_FragColor = vec4(nodataValue);\n  } else {\n    // Scale the input value and write to framebuffer\n    gl_FragColor = vec4(f * floatScale);\n  }\n}",uniforms:{littleEndian:ff,nodataValue:e.prop("nodataValue"),texture:e.prop("texture"),floatScale:e.prop("floatScale")},attributes:{position:[[-1,1],[-1/3,1],[-1,1/3],[-1/3,1/3],[-1/3,1],[-1,1/3],[-1,1/3],[-1/3,1/3],[-1,-1/3],[-1/3,-1/3],[-1/3,1/3],[-1,-1/3],[-1,-1/3],[-1/3,-1/3],[-1,-1],[-1/3,-1],[-1/3,-1/3],[-1,-1],[-1/3,1],[1/3,1],[-1/3,1/3],[1/3,1/3],[1/3,1],[-1/3,1/3],[-1/3,1/3],[1/3,1/3],[-1/3,-1/3],[1/3,-1/3],[1/3,1/3],[-1/3,-1/3],[-1/3,-1/3],[1/3,-1/3],[-1/3,-1],[1/3,-1],[1/3,-1/3],[-1/3,-1],[1/3,1],[1,1],[1/3,1/3],[1,1/3],[1,1],[1/3,1/3],[1/3,1/3],[1,1/3],[1/3,-1/3],[1,-1/3],[1,1/3],[1/3,-1/3],[1/3,-1/3],[1,-1/3],[1/3,-1],[1,-1],[1,-1/3],[1/3,-1]],texCoord:e.prop("texCoord")},depth:{enable:!1},primitive:"triangles",count:54,viewport:function(e,t){var n=t.canvasSize;return{width:n[0],height:n[1]}},framebuffer:e.prop("fbo")})}function Lf(e,t){return e(n(n({},t),{vert:sf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform sampler2D tInput;\nuniform float pixelScale;\nuniform float onePixel;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float p0 = texture2D(tInput, vTexCoord).r;\n  float px = texture2D(tInput, vec2(vTexCoord.x + onePixel, vTexCoord.y)).r;\n  float py = texture2D(tInput, vec2(vTexCoord.x, vTexCoord.y  + onePixel)).r;\n  vec3 dx = vec3(pixelScale, 0.0, px - p0);\n  vec3 dy = vec3(0.0, pixelScale, py - p0);\n  vec3 n = normalize(cross(dx, dy));\n\n  gl_FragColor = vec4(n, 1.0);\n  // gl_FragColor = vec4(0.5 * n + 0.5, 1.0); // to show\n}",uniforms:n(n({},t.uniforms),{tInput:e.prop("tInput"),pixelScale:e.prop("pixelScale"),onePixel:e.prop("onePixel")}),attributes:{position:[[-1,1],[1,1],[-1,-1],[1,-1]],texCoord:[[0,1],[1,1],[0,0],[1,0]]},framebuffer:e.prop("fbo")}))}function Sf(e,t){return e(n(n({},t),{vert:sf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D tInput;\nuniform sampler2D tNormal;\nuniform float floatScale;\nuniform vec3 sunDirection;\nuniform float nodataValue;\nuniform bool littleEndian;\nvarying vec2 vTexCoord;\n\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\n\nvoid main() {\n  float f = texture2D(tInput, vTexCoord).r;\n\n  if (isCloseEnough(f, nodataValue)) {\n    // discard;\n    gl_FragColor = vec4(0.0);\n  } else {\n    vec4 clr = computeColor(\n      f / floatScale,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n\n    vec3 n = texture2D(tNormal, vTexCoord).rgb;\n\n    // light intensity that varies on the range  [1..1]\n    float light = dot(n, sunDirection);\n    // transform the light intensity to the range [0..1]\n    light = 0.5 * light + 0.5;\n\n    // gl_FragColor = vec4(l, l, l, 1.0); // to show light\n\n    vec3 color = light * pow(clr.rgb, vec3(2.0));\n    color = pow(color, vec3(1.0/2.2));\n    gl_FragColor = vec4(color, 1.0);\n  }\n}\n",uniforms:n(n({},t.uniforms),{scaleLength:e.prop("scaleLength"),sentinelLength:e.prop("sentinelLength"),scaleColormap:e.prop("scaleColormap"),sentinelColormap:e.prop("sentinelColormap"),tInput:e.prop("tInput"),tNormal:e.prop("tNormal"),floatScale:e.prop("floatScale"),sunDirection:e.prop("sunDirection")}),attributes:{position:[[-1,1],[1,1],[-1,-1],[1,-1]],texCoord:[[0,1],[1,1],[0,0],[1,0]]}}))}function Ff(e,t){return e(n(n({},t),{vert:sf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform sampler2D tInput;\nuniform sampler2D tNormal;\nuniform sampler2D tSrc;\nuniform vec3 sunDirection;\nuniform vec2 resolution;\nuniform float pixelScale;\nuniform float softIterations;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec2 ires = 1.0 / resolution;\n  vec3 src = texture2D(tSrc, gl_FragCoord.xy * ires).rgb;\n  vec4 e0 = texture2D(tInput, vTexCoord);\n  vec3 n0 = texture2D(tNormal, vTexCoord).rgb;\n\n  // get 2D ray direction\n  vec2 sr = normalize(sunDirection.xy);\n\n  // initialize pixel traversal algorithm\n  vec2 p0 = vTexCoord * resolution;\n  vec2 p = floor(p0); // pixel we are starting in\n  vec2 stp = sign(sr);\n\n  // how far we need to travel in our ray direction to intersect the next pixel\n  // in the x- and y- directions\n  vec2 tMax = step(0.0, sr) * (1.0 - fract(p0)) + (1.0 - step(0.0, sr)) * fract(p0);\n  tMax /= abs(sr);\n  // how far must we travel along our ray to cover the width and height of a pixel\n  vec2 tDelta = 1.0 / abs(sr);\n\n  // pixel traversal routine\n  for (int i = 0; i < 65536; i++) {\n    if (tMax.x < tMax.y) {\n      tMax.x += tDelta.x;\n      p.x += stp.x;\n    } else {\n      tMax.y += tDelta.y;\n      p.y += stp.y;\n    }\n\n    // normalized texture coordinate for the center of the current pixel\n    vec2 ptex = ires * (p + 0.5);\n\n    // If we left the tile: add some illumination to the pixel for this iteration and stop traversing\n    if (ptex.x < 0.0 || ptex.x > 1.0 || ptex.y < 0.0 || ptex.y > 1.0) {\n      // illumination of this single ray\n      vec3 illumination = vec3(1.0/softIterations) * clamp(dot(n0, sunDirection), 0.0, 1.0);\n      // add illumination of this ray to result of previous iteration\n      gl_FragColor = vec4(src + illumination, 1.0);\n      return;\n    }\n\n    // elevation/value at current pixel\n    vec4 e = texture2D(tInput, ptex);\n    // time we have traveled along the 2D ray\n    float time = distance(p + 0.5, p0);\n    // elevation along our original 3D ray at the current point\n    float z = e0.r + time * pixelScale * sunDirection.z;\n\n    // If we did not exit tile, have we hit the terrain?\n    if (e.r > z) {\n      // We hit terrain. Do not add illumination for this iteration\n      gl_FragColor = vec4(src, 1.0);\n      return;\n    }\n  }\n\n  // Should have hit terrain or left the tile by this point, so should never need this\n  // If we finish the loop somehow, lets pretend its been illuminated\n  vec3 illumination = vec3(1.0/softIterations) * clamp(dot(n0, sunDirection), 0.0, 1.0);\n  gl_FragColor = vec4(src + illumination, 1.0);\n}\n",uniforms:n(n({},t.uniforms),{tInput:e.prop("tInput"),tNormal:e.prop("tNormal"),tSrc:e.prop("tSrc"),softIterations:e.prop("softIterations"),pixelScale:e.prop("pixelScale"),resolution:e.prop("resolution"),sunDirection:e.prop("sunDirection")}),attributes:{position:[[-1,1],[1,1],[-1,-1],[1,-1]],texCoord:[[1/3,2/3],[2/3,2/3],[1/3,1/3],[2/3,1/3]]},framebuffer:e.prop("fbo")}))}function Bf(e,t){return e(n(n({},t),{vert:sf,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform sampler2D tInput;\nuniform sampler2D tNormal;\nuniform sampler2D tSrc;\nuniform vec3 direction;\nuniform vec2 resolution;\nuniform float pixelScale;\nuniform float ambientIterations;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec2 ires = 1.0 / resolution;\n  vec3 src = texture2D(tSrc, gl_FragCoord.xy * ires).rgb;\n  vec4 e0 = texture2D(tInput, vTexCoord);\n  vec3 n0 = texture2D(tNormal, vTexCoord).rgb;\n\n  vec3 sr3d = normalize(n0 + direction); // ray direction\n  vec2 sr = normalize(sr3d.xy); // get 2D ray direction\n\n  // initialize pixel traversal algorithm\n  vec2 p0 = vTexCoord * resolution;\n  vec2 p = floor(p0); // pixel we are starting in\n  vec2 stp = sign(sr);\n\n  // how far we need to travel in our ray direction to intersect the next pixel\n  // in the x- and y- directions\n  vec2 tMax = step(0.0, sr) * (1.0 - fract(p0)) + (1.0 - step(0.0, sr)) * fract(p0);\n  tMax /= abs(sr);\n  // how far must we travel along our ray to cover the width and height of a pixel\n  vec2 tDelta = 1.0 / abs(sr);\n\n  // pixel traversal routine\n  for (int i = 0; i < 65536; i++) {\n    if (tMax.x < tMax.y) {\n      tMax.x += tDelta.x;\n      p.x += stp.x;\n    } else {\n      tMax.y += tDelta.y;\n      p.y += stp.y;\n    }\n\n    // normalized texture coordinate for the center of the current pixel\n    vec2 ptex = ires * (p + 0.5);\n\n    // If we left the tile: add some illumination to the pixel for this iteration and stop traversing\n    if (ptex.x < 0.0 || ptex.x > 1.0 || ptex.y < 0.0 || ptex.y > 1.0) {\n      // illumination of this single ray\n      vec3 illumination = vec3(1.0/ambientIterations);\n      // add illumination of this ray to result of previous iteration\n      gl_FragColor = vec4(src + illumination, 1.0);\n      return;\n    }\n\n    // elevation/value at current pixel\n    vec4 e = texture2D(tInput, ptex);\n    // time we have traveled along the 2D ray\n    float time = distance(p + 0.5, p0);\n    // elevation along our original 3D ray at the current point\n    float z = e0.r + time * pixelScale * sr3d.z;\n    // If we did not exit tile, have we hit the terrain?\n    if (e.r > z) {\n      // We hit terrain. Do not add illumination for this iteration\n      gl_FragColor = vec4(src, 1.0);\n      return;\n    }\n  }\n\n  // Should have hit terrain or left the tile by this point, so should never need this\n  // If we finish the loop somehow, lets pretend its been illuminated\n  vec3 illumination = vec3(1.0/ambientIterations);\n  gl_FragColor = vec4(src + illumination, 1.0);\n}",uniforms:n(n({},t.uniforms),{tInput:e.prop("tInput"),tNormal:e.prop("tNormal"),tSrc:e.prop("tSrc"),ambientIterations:e.prop("ambientIterations"),pixelScale:e.prop("pixelScale"),resolution:e.prop("resolution"),direction:e.prop("direction")}),attributes:{position:[[-1,1],[1,1],[-1,-1],[1,-1]],texCoord:[[1/3,2/3],[2/3,2/3],[1/3,1/3],[2/3,1/3]]},framebuffer:e.prop("fbo")}))}function kf(e,t){return e(n(n({},t),{vert:af,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\n// #pragma glslify: rgbaToFloat = require(glsl-rgba-to-float)\n// From https://stackoverflow.com/questions/63827836/is-it-possible-to-do-a-rgba-to-float-and-back-round-trip-and-read-the-pixels-in\n\n// note: the 0.1s here and there are voodoo related to precision\nfloat rgbaToFloat(vec4 v, bool littleEndian) {\n\tif (!littleEndian) {\n\t\tv = v.abgr;\n\t}\n\tvec4 bits = v * 255.0;\n\tfloat sign = mix(-1.0, 1.0, step(bits[3], 128.0));\n\tfloat expo = floor(mod(bits[3] + 0.1, 128.0)) * 2.0 +\n\t\t\t\tfloor((bits[2] + 0.1) / 128.0) - 127.0;\n\tfloat sig = bits[0] +\n\t\t\t\tbits[1] * 256.0 +\n\t\t\t\tfloor(mod(bits[2] + 0.1, 128.0)) * 256.0 * 256.0;\n\treturn sign * (1.0 + sig / 8388607.0) * pow(2.0, expo);\n}\n\nfloat getTexelValue(sampler2D texture, vec2 pos, bool littleEndian) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  sampler2D scaleColormap,\n  sampler2D sentinelColormap,\n  int scaleLength,\n  int sentinelLength,\n  bool littleEndian\n) {\n\n  // vertical texture coordinate to find color and offset\n  float colorRow = 0.25;\n  float offsetRow = 0.75;\n\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelLength > 0) {\n    for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n      if (i == sentinelLength) {\n        break;\n      }\n\n      float i_f = float(i);\n      float sentinelLengthFloat = float(sentinelLength);\n      // retrieve the offset from the colormap\n      float sentinelOffset = getTexelValue(sentinelColormap, vec2((i_f + 0.5) / sentinelLengthFloat, offsetRow), littleEndian);\n      if (isCloseEnough(inputVal, sentinelOffset)) {\n        // retrieve the color from the colormap\n        vec2 colormapCoord = vec2((i_f + 0.5) / sentinelLengthFloat, colorRow);\n        return texture2D(sentinelColormap, colormapCoord);\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (scaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    float scaleOffsetLowest = getTexelValue(scaleColormap, vec2(0.0, offsetRow), littleEndian);\n    float scaleOffsetHighest = getTexelValue(scaleColormap, vec2(1.0, offsetRow), littleEndian);\n    if (inputVal < scaleOffsetLowest) {\n      return texture2D(scaleColormap, vec2(0.0, colorRow));\n    } else if (inputVal > scaleOffsetHighest) {\n      return texture2D(scaleColormap, vec2(1.0, colorRow));\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        float i_f = float(i);\n        float scaleLengthFloat = float(scaleLength);\n\n        // If value above color scale range, clamp to highest color stop.\n        if (i == scaleLength) {\n          return texture2D(sentinelColormap, vec2((scaleLengthFloat - 0.5) / scaleLengthFloat, colorRow));\n        }\n\n        float scaleOffsetNext = getTexelValue(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n\n        if (inputVal <= scaleOffsetNext) {\n          float scaleOffset = getTexelValue(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, offsetRow), littleEndian);\n          float percent = (inputVal - scaleOffset)\n            / (scaleOffsetNext - scaleOffset);\n          vec4 colorLow = texture2D(scaleColormap, vec2((i_f + 0.5) / scaleLengthFloat, colorRow));\n          vec4 colorHigh = texture2D(scaleColormap, vec2((i_f + 1.0 + 0.5) / scaleLengthFloat, colorRow));\n          return mix(colorLow, colorHigh, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D tInput;\nuniform sampler2D tSoftShadow;\nuniform sampler2D tAmbient;\nuniform float floatScale;\nuniform float finalSoftMultiplier;\nuniform float finalAmbientMultiplier;\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform int scaleLength;\nuniform int sentinelLength;\nuniform sampler2D scaleColormap;\nuniform sampler2D sentinelColormap;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  float f = texture2D(tInput, vTexCoordA).r;\n\n  if (isCloseEnough(f, nodataValue)) {\n    gl_FragColor = vec4(0.0);\n    return;\n  } else {\n    vec4 clr = computeColor(\n      f / floatScale,\n      scaleColormap,\n      sentinelColormap,\n      scaleLength,\n      sentinelLength,\n      littleEndian\n    );\n\n    float softShadow = texture2D(tSoftShadow, vTexCoordB).r;\n    float ambient = texture2D(tAmbient, vTexCoordB).r;\n    // Add up the lighting\n    float light = finalSoftMultiplier * softShadow + finalAmbientMultiplier * ambient;\n    // Deepen the original color a bit by applying a curve, and multiply it by the light\n    vec3 color = light * pow(clr.rgb, vec3(2.0));\n    // apply gamma correction\n    color = pow(color, vec3(1.0/2.2));\n    gl_FragColor = vec4(color, 1.0);\n    // gl_FragColor = vec4(clr.rgb, 1.0);\n  }\n  // vec3 n = texture2D(tInput, vTexCoordA).rgb;\n  // gl_FragColor = vec4((0.5 * n + 0.5)*0.1, 1.0);\n}",uniforms:n(n({},t.uniforms),{scaleLength:e.prop("scaleLength"),sentinelLength:e.prop("sentinelLength"),scaleColormap:e.prop("scaleColormap"),sentinelColormap:e.prop("sentinelColormap"),tInput:e.prop("tInput"),tSoftShadow:e.prop("tSoftShadow"),tAmbient:e.prop("tAmbient"),floatScale:e.prop("floatScale"),finalSoftMultiplier:e.prop("finalSoftMultiplier"),finalAmbientMultiplier:e.prop("finalAmbientMultiplier")}),attributes:n(n({},t.attributes),{texCoordA:[[1/3,2/3],[2/3,2/3],[1/3,1/3],[2/3,1/3]],texCoordB:[[0,1],[1,1],[0,0],[1,0]]})}))}function Mf(e,t){return e(n(n({},t),{vert:af,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform sampler2D tBase;\nuniform sampler2D tSoftShadow;\nuniform sampler2D tAmbient;\nuniform float finalSoftMultiplier;\nuniform float finalAmbientMultiplier;\nuniform float nodataValue;\nuniform bool littleEndian;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec3 baselayer = texture2D(tBase, vTexCoordA).rgb;\n\n  float softShadow = texture2D(tSoftShadow, vTexCoordB).r;\n  float ambient = texture2D(tAmbient, vTexCoordB).r;\n  // Add up the lighting\n  float light = finalSoftMultiplier * softShadow + finalAmbientMultiplier * ambient;\n  //Deepen the original color a bit by applying a curve, and multiply it by the light\n  vec3 color = light * pow(baselayer.rgb, vec3(2.0));\n  // apply gamma correction\n  color = pow(color, vec3(1.0/2.2));\n  gl_FragColor = vec4(color, 1.0);\n}",uniforms:n(n({},t.uniforms),{tBase:e.prop("tBase"),tSoftShadow:e.prop("tSoftShadow"),tAmbient:e.prop("tAmbient"),finalSoftMultiplier:e.prop("finalSoftMultiplier"),finalAmbientMultiplier:e.prop("finalAmbientMultiplier")}),attributes:n(n({},t.attributes),{texCoordA:e.prop("baseTexCoords"),texCoordB:[[0,1],[1,1],[0,0],[1,0]]})}))}var Of=function(){function e(e,t,n,r,o,i){void 0===t&&(t=256),void 0===r&&(r=!1),void 0===o&&(o="rgba"),void 0===i&&(i="uint8");var a=Math.floor(n/t),l=a*t,s=a*a,u=e.texture({width:l,height:l,flipY:r,format:o,type:i}),f=new Map,c=this.allTextureCoordinates(a,t);Object.assign(this,{tileSize:t,tilesAcross:a,pixelsAcross:l,tileCapacity:s,texture:u,contents:f,available:c})}return e.prototype.addTile=function(e,t){var n=this,r=n.available,o=n.contents,i=n.texture,a=n.tileSize,l=this.hashTileCoordinates(e);if(o.has(l)){var s=o.get(l);return o.delete(l),o.set(l,s),this.formatOutputTextureCoordinates(s)}if(function(e){if(null==e)return!0;if(ae(e)&&(x(e)||"string"==typeof e||"function"==typeof e.splice||be(e)||Ee(e)||de(e)))return!e.length;var t=Ot(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(se(e))return!ke(e).length;for(var n in e)if(pn.call(e,n))return!1;return!0}(r)){var u=o.keys().next().value;this.removeByHashKey(u)}var f=r.pop();o.set(l,f);var c=f.x,h=f.y;return i.subimage({data:t,width:a,height:a},c,h),this.formatOutputTextureCoordinates(f)},e.prototype.removeTile=function(e){this.removeByHashKey(this.hashTileCoordinates(e))},e.prototype.clearTiles=function(){for(var e=0,t=Array.from(this.contents.keys());e<t.length;e++){var n=t[e];this.removeByHashKey(n)}},e.prototype.destroy=function(){this.texture.destroy()},e.prototype.removeByHashKey=function(e){if(this.contents.has(e)){var t=this.contents.get(e);this.contents.delete(e),this.available.push(t)}},e.prototype.formatOutputTextureCoordinates=function(e){var t=e.x,n=e.y,r=this.pixelsAcross,o=this.tileSize;return[{x:t/r,y:n/r},{x:(t+o)/r,y:(n+o)/r}]},e.prototype.hashTileCoordinates=function(e){return e.x+":"+e.y+":"+e.z},e.prototype.getTextureCoordinates=function(e){var t=this.hashTileCoordinates(e),n=this.contents.get(t);return this.formatOutputTextureCoordinates(n)},e.prototype.allTextureCoordinates=function(e,t){return cn(Ko(e),(function(n){return Ko(e).map((function(e){return{x:n*t,y:e*t}}))}))},e}(),If="undefined"!=typeof Float32Array?Float32Array:Array,Rf=Math.random;function Nf(){var e=new If(3);return If!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function zf(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Hf(e,t){var n=t[0],r=t[1],o=t[2],i=n*n+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Vf(e,t){t=t||1;var n=2*Rf()*Math.PI,r=2*Rf()-1,o=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=r*t,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});Pf=Nf();var Pf,Uf=function(){function t(t,n,r,o,i,a,l){var s=e.DomUtil.create("canvas"),u=qo,f=1024,c=of({canvas:s,optionalExtensions:["OES_texture_float","WEBGL_color_buffer_float"],onDone:function(e,t){e?console.log(e):(t.limits.maxTextureSize>2048&&(u=2048),t.limits.maxTextureSize>4096&&(u=4096),t.limits.maxTextureSize>8192&&(u=8192),f=u,261===t.limits.maxFragmentUniforms&&console.warn("Software rendering detected. Many features of this plugin will fail.          If you have a GPU, check if drivers are installed ok?"))}}),h=function(e,t){return{uniforms:{nodataValue:t,littleEndian:ff,transformMatrix:function(e){return[2/e.viewportWidth,0,0,0,0,-2/e.viewportHeight,0,0,0,0,1,0,-1,1,0,1]}},attributes:{position:function(t,n){var r=n.canvasCoordinates,o=r[0],i=r[1],a=[o+e,i+e],l=a[0],s=a[1];return[[o,i],[l,i],[o,s],[l,s]]}},depth:{enable:!1},primitive:"triangle strip",count:4,viewport:function(e,t){var n=t.canvasSize;return{width:n[0],height:n[1]}}}}(n,r),p={SCALE_MAX_LENGTH:a,SENTINEL_MAX_LENGTH:l};Object.assign(this,{gloperations:t,canvas:s,regl:c,tileSize:n,nodataValue:r,maxTextureDimension:u,normalTextureDimension:f,scaleInput:o,sentinelInput:i,scaleColormap:si(o,c),sentinelColormap:si(i,c),textureManager:new Of(c,n,f,!1),textureManagerA:new Of(c,n,f,!1),textureManagerB:new Of(c,n,f,!1),textureManagerC:new Of(c,n,f,!1),textureManagerD:new Of(c,n,f,!1),textureManagerE:new Of(c,n,f,!1),textureManagerF:new Of(c,n,f,!1),textureManagerHillshade:new Of(c,n,u,!1),drawTile:cf(c,h,p),drawTileHsSimple:hf(c,h,p),drawTileHsPregen:pf(c,h,p),drawTileInterpolateColor:Af(c,h,p),drawTileInterpolateColorOnly:Tf(c,h,p),drawTileInterpolateValue:Cf(c,h,p),calcTileMultiAnalyze1:df(c,h),calcTileMultiAnalyze2:mf(c,h),calcTileMultiAnalyze3:gf(c,h),calcTileMultiAnalyze4:vf(c,h),calcTileMultiAnalyze5:bf(c,h),calcTileMultiAnalyze6:xf(c,h),drawTileResult:_f(c,h,p),calcTileDiff:yf(c,h),convertDem:wf(c,h),convolutionSmooth:Ef(c,h),HsAdvMergeAndScaleTiles:Df(c),HsAdvCalcNormals:Lf(c,h),HsAdvDirectLightning:Sf(c,h),HsAdvSoftShadows:Ff(c,h),HsAdvAmbientShadows:Bf(c,h),HsAdvFinalColorscale:kf(c,h),HsAdvFinalBaselayer:Mf(c,h)})}return t.prototype.findMaxTextureDimension=function(){var e=1024;return this.regl.limits.maxTextureSize>2048&&(e=2048),this.regl.limits.maxTextureSize>4096&&(e=4096),this.regl.limits.maxTextureSize>8192&&(e=8192),e},t.prototype.setMaxTextureDimension=function(e){var t=this,n=t.textureManager,r=t.tileSize,o=t.regl;n.destroy(),Object.assign(this,{maxTextureDimension:e,textureManager:new Of(o,r,e,!1)})},t.prototype.updateColorscale=function(e){this.scaleInputPrevious=this.scaleInput,this.scaleInput=e,this.scaleColormapPrevious=this.scaleColormap,this.scaleColormap=si(e,this.regl)},t.prototype.updateSentinels=function(e){this.sentinelInputPrevious=this.sentinelInput,this.sentinelInput=e,this.sentinelColormapPrevious=this.sentinelColormap,this.sentinelColormap=si(e,this.regl)},t.prototype.renderTile=function(e,t,n){var r=e.coords,o=e.pixelData,i=this,a=i.regl,l=i.textureManager,s=i.tileSize;this.setCanvasSize(s,s);var u=l.addTile(r,o);a.clear({color:Go});var f=t.hsSimpleZoomdelta||0,c=Math.max(.5,Math.pow(2,n+f)/2048)/l.texture.width;return"none"===t.hillshadeType?this.drawTile({canvasSize:[s,s],canvasCoordinates:[0,0],textureBounds:u,texture:l.texture,scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,enableSimpleHillshade:!1}):"simple"===t.hillshadeType&&this.drawTileHsSimple({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[s,s],canvasCoordinates:[0,0],textureBounds:u,texture:l.texture,textureSize:l.texture.width,tileSize:s,offset:c,enableSimpleHillshade:!0,azimuth:t.hsSimpleAzimuth,altitude:t.hsSimpleAltitude,slopescale:t.hsSimpleSlopescale}),[0,0]},t.prototype.renderTileHsPregen=function(e,t){var n=this,r=n.regl,o=n.textureManager,i=n.textureManagerHillshade,a=n.tileSize;this.setCanvasSize(a,a);var l=o.addTile(e.coords,e.pixelData),s=i.addTile(t.coords,t.pixelData);return r.clear({color:Go}),this.drawTileHsPregen({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[a,a],canvasCoordinates:[0,0],textureBounds:l,textureBoundsHs:s,texture:o.texture,hillshadePregenTexture:i.texture}),[0,0]},t.prototype.flipReadPixelsUint=function(e,t,n){for(var r=t/2|0,o=4*e,i=new Uint8Array(4*e),a=0;a<r;++a){var l=a*o,s=(t-a-1)*o;i.set(n.subarray(l,l+o)),n.copyWithin(l,s,s+o),n.set(i,s)}return n},t.prototype.renderTileDiff=function(e,t){var n=this,r=n.regl,o=n.textureManagerA,i=n.textureManagerB,a=n.tileSize;this.setCanvasSize(a,a);var l=o.addTile(e.coords,e.pixelData),s=i.addTile(t.coords,t.pixelData),u=r.framebuffer({width:a,height:a,depth:!1,colorFormat:"rgba",colorType:"uint8"}),f=new Uint8Array(a*a*4);return this.calcTileDiff({canvasSize:[a,a],canvasCoordinates:[0,0],textureA:o.texture,textureB:i.texture,textureBoundsA:l,textureBoundsB:s,fbo:u}),this.drawTileResult({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[a,a],canvasCoordinates:[0,0],texture:u}),u.use((function(){r.read({data:f})})),f=this.flipReadPixelsUint(a,a,f),u.destroy(),[0,0,f]},t.prototype.renderConvertDem=function(e){var t=this.regl,n=this.tileSize,r=t.texture({width:n,height:n,data:e,format:"rgba",type:"uint8",flipY:!1}),o=t.framebuffer({width:n,height:n,depth:!1,colorFormat:"rgba",colorType:"uint8"}),i=new Uint8Array(n*n*4);return this.convertDem({canvasSize:[n,n],canvasCoordinates:[0,0],texture:r,fbo:o}),o.use((function(){t.read({data:i})})),r.destroy(),o.destroy(),i},t.prototype.renderConvolutionSmooth=function(e,t,n,r){var o=this,i=this.regl;this.setCanvasSize(t,n);var a=i.texture({data:e,width:t,height:n,flipY:!1}),l=i.framebuffer({width:t,height:n,depth:!1,colorFormat:"rgba",colorType:"uint8"}),s=new Uint8Array(t*n*4);return l.use((function(){o.convolutionSmooth({texture:a,textureSize:t,kernelSize:r}),i.read({data:s})})),s=new Float32Array(s.buffer),l.destroy(),s},t.prototype.renderTileHsAdvanced=function(e,t,n,r,o){var i=this,a=i.regl,l=i.textureManager,s=i.tileSize;this.setCanvasSize(s,s);var u=a.framebuffer({width:3*s,height:3*s,depth:!1,colorType:"float"}),f=a.framebuffer({width:3*s,height:3*s,depth:!1,colorType:"float"}),c=ai(a,{width:s,height:s,colorType:"float"}),h=ai(a,{width:s,height:s,colorType:"float"}),p=1;"number"==typeof e.hsAdvValueScale?p=e.hsAdvValueScale:e.hsAdvValueScale.constructor===Object&&(p=e.hsAdvValueScale[t]),this.HsAdvMergeAndScaleTiles({canvasSize:[3*s,3*s],texture:l.texture,fbo:u,floatScale:p,texCoord:n,nodataValue:this.nodataValue}),this.HsAdvCalcNormals({canvasSize:[3*s,3*s],canvasCoordinates:[0,0],tInput:u,pixelScale:r,onePixel:1/(3*s),fbo:f});for(var d=0;d<e.hsAdvSoftIterations;d++)this.HsAdvSoftShadows({canvasSize:[s,s],canvasCoordinates:[0,0],tInput:u,tNormal:f,tSrc:c.ping(),softIterations:e.hsAdvSoftIterations,resolution:[s,s],pixelScale:r,sunDirection:this.sunDirections[d],fbo:c.pong()}),c.swap();for(d=0;d<e.hsAdvAmbientIterations;d++)this.HsAdvAmbientShadows({canvasSize:[s,s],canvasCoordinates:[0,0],tInput:u,tNormal:f,tSrc:h.ping(),ambientIterations:e.hsAdvAmbientIterations,direction:this.ambientDirections[d],resolution:[s,s],pixelScale:r,fbo:h.pong()}),h.swap();return e.hsAdvBaselayerUrl?this.HsAdvFinalBaselayer({canvasSize:[s,s],canvasCoordinates:[0,0],tBase:this.textureManagerHillshade.texture,baseTexCoords:o,tSoftShadow:c.ping(),tAmbient:h.ping(),finalSoftMultiplier:e.hsAdvFinalSoftMultiplier,finalAmbientMultiplier:e.hsAdvFinalAmbientMultiplier}):this.HsAdvFinalColorscale({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[s,s],canvasCoordinates:[0,0],tInput:u,tSoftShadow:c.ping(),tAmbient:h.ping(),floatScale:p,finalSoftMultiplier:e.hsAdvFinalSoftMultiplier,finalAmbientMultiplier:e.hsAdvFinalAmbientMultiplier}),u.destroy(),f.destroy(),c.destroy(),h.destroy(),[0,0]},t.prototype.renderTileMulti1=function(e,t,n,r){var o=this,i=o.regl,a=o.textureManagerA,l=o.tileSize;this.setCanvasSize(l,l);var s=a.addTile(e.coords,e.pixelData),u=i.framebuffer({width:l,height:l,depth:!1,colorFormat:"rgba",colorType:"uint8"}),f=new Uint8Array(l*l*4);return this.calcTileMultiAnalyze1({canvasSize:[l,l],canvasCoordinates:[0,0],textureA:a.texture,textureBoundsA:s,filterLowA:t,filterHighA:n,multiplierA:r,fbo:u}),this.drawTileResult({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[l,l],canvasCoordinates:[0,0],texture:u}),u.use((function(){i.read({data:f})})),f=this.flipReadPixelsUint(l,l,f),u.destroy(),[0,0,f]},t.prototype.renderTileMulti2=function(e,t,n,r,o,i,a,l){var s=this,u=s.regl,f=s.textureManagerA,c=s.textureManagerB,h=s.tileSize;this.setCanvasSize(h,h);var p=f.addTile(e.coords,e.pixelData),d=c.addTile(t.coords,t.pixelData),m=u.framebuffer({width:h,height:h,depth:!1,colorFormat:"rgba",colorType:"uint8"}),g=new Uint8Array(h*h*4);return this.calcTileMultiAnalyze2({canvasSize:[h,h],canvasCoordinates:[0,0],textureA:f.texture,textureB:c.texture,textureBoundsA:p,textureBoundsB:d,filterLowA:n,filterHighA:r,filterLowB:o,filterHighB:i,multiplierA:a,multiplierB:l,fbo:m}),this.drawTileResult({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[h,h],canvasCoordinates:[0,0],texture:m}),m.use((function(){u.read({data:g})})),g=this.flipReadPixelsUint(h,h,g),m.destroy(),[0,0,g]},t.prototype.renderTileMulti3=function(e,t,n,r,o,i,a,l,s,u,f,c){var h=this,p=h.regl,d=h.textureManagerA,m=h.textureManagerB,g=h.textureManagerC,v=h.tileSize;this.setCanvasSize(v,v);var b=d.addTile(e.coords,e.pixelData),x=m.addTile(t.coords,t.pixelData),y=g.addTile(n.coords,n.pixelData),_=p.framebuffer({width:v,height:v,depth:!1,colorFormat:"rgba",colorType:"uint8"}),w=new Uint8Array(v*v*4);return this.calcTileMultiAnalyze3({canvasSize:[v,v],canvasCoordinates:[0,0],textureA:d.texture,textureB:m.texture,textureC:g.texture,textureBoundsA:b,textureBoundsB:x,textureBoundsC:y,filterLowA:r,filterHighA:o,filterLowB:i,filterHighB:a,filterLowC:l,filterHighC:s,multiplierA:u,multiplierB:f,multiplierC:c,fbo:_}),this.drawTileResult({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[v,v],canvasCoordinates:[0,0],texture:_}),_.use((function(){p.read({data:w})})),w=this.flipReadPixelsUint(v,v,w),_.destroy(),[0,0,w]},t.prototype.renderTileMulti4=function(e,t,n,r,o,i,a,l,s,u,f,c,h,p,d,m){var g=this,v=g.regl,b=g.textureManagerA,x=g.textureManagerB,y=g.textureManagerC,_=g.textureManagerD,w=g.tileSize;this.setCanvasSize(w,w);var C=b.addTile(e.coords,e.pixelData),A=x.addTile(t.coords,t.pixelData),T=y.addTile(n.coords,n.pixelData),E=_.addTile(r.coords,r.pixelData),D=v.framebuffer({width:w,height:w,depth:!1,colorFormat:"rgba",colorType:"uint8"}),L=new Uint8Array(w*w*4);return this.calcTileMultiAnalyze4({canvasSize:[w,w],canvasCoordinates:[0,0],textureA:b.texture,textureB:x.texture,textureC:y.texture,textureD:_.texture,textureBoundsA:C,textureBoundsB:A,textureBoundsC:T,textureBoundsD:E,filterLowA:o,filterHighA:i,filterLowB:a,filterHighB:l,filterLowC:s,filterHighC:u,filterLowD:f,filterHighD:c,multiplierA:h,multiplierB:p,multiplierC:d,multiplierD:m,fbo:D}),this.drawTileResult({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[w,w],canvasCoordinates:[0,0],texture:D}),D.use((function(){v.read({data:L})})),L=this.flipReadPixelsUint(w,w,L),D.destroy(),[0,0,L]},t.prototype.renderTileMulti5=function(e,t,n,r,o,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x){var y=this,_=y.regl,w=y.textureManagerA,C=y.textureManagerB,A=y.textureManagerC,T=y.textureManagerD,E=y.textureManagerE,D=y.tileSize;this.setCanvasSize(D,D);var L=w.addTile(e.coords,e.pixelData),S=C.addTile(t.coords,t.pixelData),F=A.addTile(n.coords,n.pixelData),B=T.addTile(r.coords,r.pixelData),k=E.addTile(o.coords,o.pixelData),M=_.framebuffer({width:D,height:D,depth:!1,colorFormat:"rgba",colorType:"uint8"}),O=new Uint8Array(D*D*4);return this.calcTileMultiAnalyze5({canvasSize:[D,D],canvasCoordinates:[0,0],textureA:w.texture,textureB:C.texture,textureC:A.texture,textureD:T.texture,textureE:E.texture,textureBoundsA:L,textureBoundsB:S,textureBoundsC:F,textureBoundsD:B,textureBoundsE:k,filterLowA:i,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:u,filterHighC:f,filterLowD:c,filterHighD:h,filterLowE:p,filterHighE:d,multiplierA:m,multiplierB:g,multiplierC:v,multiplierD:b,multiplierE:x,fbo:M}),this.drawTileResult({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[D,D],canvasCoordinates:[0,0],texture:M}),M.use((function(){_.read({data:O})})),O=this.flipReadPixelsUint(D,D,O),M.destroy(),[0,0,O]},t.prototype.renderTileMulti6=function(e,t,n,r,o,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y,_,w,C){var A=this,T=A.regl,E=A.textureManagerA,D=A.textureManagerB,L=A.textureManagerC,S=A.textureManagerD,F=A.textureManagerE,B=A.textureManagerF,k=A.tileSize;this.setCanvasSize(k,k);var M=E.addTile(e.coords,e.pixelData),O=D.addTile(t.coords,t.pixelData),I=L.addTile(n.coords,n.pixelData),R=S.addTile(r.coords,r.pixelData),N=F.addTile(o.coords,o.pixelData),z=F.addTile(i.coords,i.pixelData),H=T.framebuffer({width:k,height:k,depth:!1,colorFormat:"rgba",colorType:"uint8"}),V=new Uint8Array(k*k*4);return this.calcTileMultiAnalyze6({canvasSize:[k,k],canvasCoordinates:[0,0],textureA:E.texture,textureB:D.texture,textureC:L.texture,textureD:S.texture,textureE:F.texture,textureF:B.texture,textureBoundsA:M,textureBoundsB:O,textureBoundsC:I,textureBoundsD:R,textureBoundsE:N,textureBoundsF:z,filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:u,filterLowC:f,filterHighC:c,filterLowD:h,filterHighD:p,filterLowE:d,filterHighE:m,filterLowF:g,filterHighF:v,multiplierA:b,multiplierB:x,multiplierC:y,multiplierD:_,multiplierE:w,multiplierF:C,fbo:H}),this.drawTileResult({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:[k,k],canvasCoordinates:[0,0],texture:H}),H.use((function(){T.read({data:V})})),V=this.flipReadPixelsUint(k,k,V),H.destroy(),[0,0,V]},t.prototype.renderTiles=function(e,t,r){var o=this,i=this,a=i.regl,l=i.textureManager,s=i.tileSize,u=this.computeRequiredCanvasDimensions(e.length),f=u[0],c=u[1];this.setCanvasSize(f,c);var h=this.getCanvasCoordinates(f,c,e.length),p=bn(e,h,(function(e,t){return n(n({},e),{canvasCoords:t})})),d=[f,c];l.clearTiles(),a.clear({color:Go});for(var m=ft(p,l.tileCapacity),g=t.hsSimpleZoomdelta||0,v=function(e){var n=e.map((function(e){var t=e.coords,n=e.pixelData;return l.addTile(t,n)})),i=Math.max(.5,Math.pow(2,r+g)/2048)/l.texture.width;"none"===t.hillshadeType?b.drawTile(e.map((function(e,t){var r=e.canvasCoords;return{canvasSize:d,canvasCoordinates:r,textureBounds:n[t],texture:l.texture,scaleLength:o.scaleInput.length,sentinelLength:o.sentinelInput.length,scaleColormap:o.scaleColormap,sentinelColormap:o.sentinelColormap,enableSimpleHillshade:!1}}))):"simple"===t.hillshadeType&&b.drawTileHsSimple(e.map((function(e,r){var a=e.canvasCoords;return{scaleLength:o.scaleInput.length,sentinelLength:o.sentinelInput.length,scaleColormap:o.scaleColormap,sentinelColormap:o.sentinelColormap,canvasSize:d,canvasCoordinates:a,textureBounds:n[r],textureSize:l.texture.width,texture:l.texture,tileSize:s,offset:i,enableSimpleHillshade:!0,azimuth:t.hsSimpleAzimuth,altitude:t.hsSimpleAltitude,slopescale:t.hsSimpleSlopescale}})))},b=this,x=0,y=m;x<y.length;x++){v(y[x])}return h},t.prototype.renderTilesHsPregen=function(e,t){var n=this,r=this,o=r.regl,i=r.textureManager,a=r.textureManagerHillshade,l=this.computeRequiredCanvasDimensions(e.length),s=l[0],u=l[1];this.setCanvasSize(s,u);var f=this.getCanvasCoordinates(s,u,e.length),c=bn(e,t,f,(function(e,t,n){return{coords:e.coords,tilesPixelData:e.pixelData,tilesHsPixelData:t.pixelData,canvasCoords:n}})),h=[s,u];i.clearTiles(),a.clearTiles(),o.clear({color:Go});for(var p=ft(c,i.tileCapacity),d=function(e){var t=e.map((function(e){var t=e.coords,n=e.tilesPixelData;return i.addTile(t,n)})),r=e.map((function(e){var t=e.coords,n=e.tilesHsPixelData;return a.addTile(t,n)}));m.drawTileHsPregen(e.map((function(e,o){var l=e.canvasCoords;return{scaleLength:n.scaleInput.length,sentinelLength:n.sentinelInput.length,scaleColormap:n.scaleColormap,sentinelColormap:n.sentinelColormap,canvasSize:h,canvasCoordinates:l,textureBounds:t[o],textureBoundsHs:r[o],texture:i.texture,hillshadePregenTexture:a.texture}})))},m=this,g=0,v=p;g<v.length;g++){d(v[g])}return f},t.prototype.renderTilesHsAdvanced=function(e,t,i,a,l){return r(this,void 0,void 0,(function(){var r,s,u,f,c,h,p,d,m,g,v,b,x,y,_,w,C,A,T,E,D,L,S,F,B,k,M,O,I,R,N,z;return o(this,(function(o){switch(o.label){case 0:s=(r=this).regl,u=r.textureManager,f=r.tileSize,c=r.nodataValue,h=this.computeRequiredCanvasDimensions(e.length),p=h[0],d=h[1],this.setCanvasSize(p,d),m=this.getCanvasCoordinates(p,d,e.length),g=bn(e,m,(function(e,t){return n(n({},e),{canvasCoords:t})})),v=[p,d],u.clearTiles(),s.clear({color:Go}),b=ft(g,u.tileCapacity),x=oi(c,f),y=1,"number"==typeof t.hsAdvValueScale?y=t.hsAdvValueScale:t.hsAdvValueScale.constructor===Object&&(y=t.hsAdvValueScale[a]),_=0,w=b,o.label=1;case 1:if(!(_<w.length))return[3,9];C=w[_],A=0,T=C,o.label=2;case 2:return A<T.length?(E=T[A],D=E.coords,L=E.pixelData,S=E.canvasCoords,u.addTile(D,L),Jo(L,x)?[3,7]:[3,3]):[3,8];case 3:return F=[],[4,ui(this.gloperations,this.textureManager,D,i)];case 4:return F=o.sent(),B=[],t.hsAdvBaselayerUrl?[4,this.gloperations._fetchTileData(D,t.hsAdvBaselayerUrl,"image")]:[3,6];case 5:k=o.sent(),M=this.textureManagerHillshade.addTile(D,k),B=ei(M),o.label=6;case 6:for(O=s.framebuffer({width:3*f,height:3*f,depth:!1,colorType:"float"}),I=s.framebuffer({width:3*f,height:3*f,depth:!1,colorType:"float"}),R=ai(s,{width:f,height:f,colorType:"float"}),N=ai(s,{width:f,height:f,colorType:"float"}),this.HsAdvMergeAndScaleTiles({canvasSize:[3*f,3*f],texture:u.texture,fbo:O,floatScale:y,texCoord:F,nodataValue:c}),this.HsAdvCalcNormals({canvasSize:[3*f,3*f],canvasCoordinates:[0,0],tInput:O,pixelScale:l,onePixel:1/(3*f),fbo:I}),z=0;z<t.hsAdvSoftIterations;z++)this.HsAdvSoftShadows({canvasSize:[f,f],canvasCoordinates:[0,0],tInput:O,tNormal:I,tSrc:R.ping(),softIterations:t.hsAdvSoftIterations,resolution:[f,f],pixelScale:l,sunDirection:this.sunDirections[z],fbo:R.pong()}),R.swap();for(z=0;z<t.hsAdvAmbientIterations;z++)this.HsAdvAmbientShadows({canvasSize:[f,f],canvasCoordinates:[0,0],tInput:O,tNormal:I,tSrc:N.ping(),ambientIterations:t.hsAdvAmbientIterations,direction:this.ambientDirections[z],resolution:[f,f],pixelScale:l,fbo:N.pong()}),N.swap();t.hsAdvBaselayerUrl?this.HsAdvFinalBaselayer({canvasSize:v,canvasCoordinates:S,tBase:this.textureManagerHillshade.texture,baseTexCoords:B,tSoftShadow:R.ping(),tAmbient:N.ping(),finalSoftMultiplier:t.hsAdvFinalSoftMultiplier,finalAmbientMultiplier:t.hsAdvFinalAmbientMultiplier}):this.HsAdvFinalColorscale({scaleLength:this.scaleInput.length,sentinelLength:this.sentinelInput.length,scaleColormap:this.scaleColormap,sentinelColormap:this.sentinelColormap,canvasSize:v,canvasCoordinates:S,tInput:O,tSoftShadow:R.ping(),tAmbient:N.ping(),floatScale:y,finalSoftMultiplier:t.hsAdvFinalSoftMultiplier,finalAmbientMultiplier:t.hsAdvFinalAmbientMultiplier}),O.destroy(),I.destroy(),R.destroy(),N.destroy(),o.label=7;case 7:return A++,[3,2];case 8:return _++,[3,1];case 9:return[2,m]}}))}))},t.prototype.renderTilesWithDiff=function(e,t,n){var r=this,o=this,i=o.regl,a=o.textureManagerA,l=o.textureManagerB,s=o.tileSize,u=this.computeRequiredCanvasDimensions(e.length),f=u[0],c=u[1];this.setCanvasSize(f,c);var h=this.getCanvasCoordinates(f,c,e.length),p=bn(e,t,h,(function(e,t,n){return{coords:e.coords,tilesAPixelData:e.pixelData,tilesBPixelData:t.pixelData,canvasCoords:n}})),d=[];return function(){var e=ft(p,a.tileCapacity);i.clear({color:Go});for(var t=0,o=function(e){var n=e.map((function(e){var t=e.coords,n=e.tilesAPixelData;return a.addTile(t,n)})),o=e.map((function(e){var t=e.coords,n=e.tilesBPixelData;return l.addTile(t,n)}));e.forEach((function(e,f){var c=e.canvasCoords,h=i.framebuffer({width:s,height:s,depth:!1,colorFormat:"rgba",colorType:"uint8"}),p=new Uint8Array(s*s*4);r.calcTileDiff({canvasSize:[s,s],canvasCoordinates:[0,0],textureA:a.texture,textureB:l.texture,textureBoundsA:n[f],textureBoundsB:o[f],fbo:h}),r.drawTileResult({scaleLength:r.scaleInput.length,sentinelLength:r.sentinelInput.length,scaleColormap:r.scaleColormap,sentinelColormap:r.sentinelColormap,canvasSize:u,canvasCoordinates:c,texture:h}),h.use((function(){i.read({data:p})})),p=r.flipReadPixelsUint(s,s,p),d[t]=p,t+=1,h.destroy()}))},f=0,c=e;f<c.length;f++){o(c[f])}n(h)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerA=new Of(i,s,qo,!1),this.textureManagerB=new Of(i,s,qo,!1),d},t.prototype.renderTilesWithMultiAnalyze1=function(e,t,n,r,o){var i=this,a=this,l=a.regl,s=a.textureManagerA,u=a.tileSize,f=this.computeRequiredCanvasDimensions(e.length),c=f[0],h=f[1];this.setCanvasSize(c,h);var p=this.getCanvasCoordinates(c,h,e.length),d=bn(e,p,(function(e,t){return{coords:e.coords,tilesAPixelData:e.pixelData,canvasCoords:t}})),m=[];return function(){var e=ft(d,s.tileCapacity);l.clear({color:Go});for(var a=0,c=function(e){var o=e.map((function(e){var t=e.coords,n=e.tilesAPixelData;return s.addTile(t,n)}));e.forEach((function(e,c){var h=e.canvasCoords,p=l.framebuffer({width:u,height:u,depth:!1,colorFormat:"rgba",colorType:"uint8"}),d=new Uint8Array(u*u*4);i.calcTileMultiAnalyze1({canvasSize:[u,u],canvasCoordinates:[0,0],textureA:s.texture,textureBoundsA:o[c],filterLowA:t,filterHighA:n,multiplierA:r,fbo:p}),i.drawTileResult({scaleLength:i.scaleInput.length,sentinelLength:i.sentinelInput.length,scaleColormap:i.scaleColormap,sentinelColormap:i.sentinelColormap,canvasSize:f,canvasCoordinates:h,texture:p}),p.use((function(){l.read({data:d})})),d=i.flipReadPixelsUint(u,u,d),m[a]=d,a+=1,p.destroy()}))},h=0,g=e;h<g.length;h++){c(g[h])}o(p)}(),this.textureManagerA.destroy(),this.textureManagerA=new Of(l,u,qo,!1),m},t.prototype.renderTilesWithMultiAnalyze2=function(e,t,n,r,o,i,a,l,s){var u=this,f=this,c=f.regl,h=f.textureManagerA,p=f.textureManagerB,d=f.tileSize,m=this.computeRequiredCanvasDimensions(e.length),g=m[0],v=m[1];this.setCanvasSize(g,v);var b=this.getCanvasCoordinates(g,v,e.length),x=bn(e,t,b,(function(e,t,n){return{coords:e.coords,tilesAPixelData:e.pixelData,tilesBPixelData:t.pixelData,canvasCoords:n}})),y=[];return function(){var e=ft(x,h.tileCapacity);c.clear({color:Go});for(var t=0,f=function(e){var s=e.map((function(e){var t=e.coords,n=e.tilesAPixelData;return h.addTile(t,n)})),f=e.map((function(e){var t=e.coords,n=e.tilesBPixelData;return p.addTile(t,n)}));e.forEach((function(e,g){var v=e.canvasCoords,b=c.framebuffer({width:d,height:d,depth:!1,colorFormat:"rgba",colorType:"uint8"}),x=new Uint8Array(d*d*4);u.calcTileMultiAnalyze2({canvasSize:[d,d],canvasCoordinates:[0,0],textureA:h.texture,textureB:p.texture,textureBoundsA:s[g],textureBoundsB:f[g],filterLowA:n,filterHighA:r,filterLowB:o,filterHighB:i,multiplierA:a,multiplierB:l,fbo:b}),u.drawTileResult({scaleLength:u.scaleInput.length,sentinelLength:u.sentinelInput.length,scaleColormap:u.scaleColormap,sentinelColormap:u.sentinelColormap,canvasSize:m,canvasCoordinates:v,texture:b}),b.use((function(){c.read({data:x})})),x=u.flipReadPixelsUint(d,d,x),y[t]=x,t+=1,b.destroy()}))},g=0,v=e;g<v.length;g++){f(v[g])}s(b)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerA=new Of(c,d,qo,!1),this.textureManagerB=new Of(c,d,qo,!1),y},t.prototype.renderTilesWithMultiAnalyze3=function(e,t,n,r,o,i,a,l,s,u,f,c,h){var p=this,d=this,m=d.regl,g=d.textureManagerA,v=d.textureManagerB,b=d.textureManagerC,x=d.tileSize,y=this.computeRequiredCanvasDimensions(e.length),_=y[0],w=y[1];this.setCanvasSize(_,w);var C=this.getCanvasCoordinates(_,w,e.length),A=bn(e,t,n,C,(function(e,t,n,r){return{coords:e.coords,tilesAPixelData:e.pixelData,tilesBPixelData:t.pixelData,tilesCPixelData:n.pixelData,canvasCoords:r}})),T=[];return function(){var e=ft(A,g.tileCapacity);m.clear({color:Go});for(var t=0,n=function(e){var n=e.map((function(e){var t=e.coords,n=e.tilesAPixelData;return g.addTile(t,n)})),h=e.map((function(e){var t=e.coords,n=e.tilesBPixelData;return v.addTile(t,n)})),d=e.map((function(e){var t=e.coords,n=e.tilesCPixelData;return b.addTile(t,n)}));e.forEach((function(e,_){var w=e.canvasCoords,C=m.framebuffer({width:x,height:x,depth:!1,colorFormat:"rgba",colorType:"uint8"}),A=new Uint8Array(x*x*4);p.calcTileMultiAnalyze3({canvasSize:[x,x],canvasCoordinates:[0,0],textureA:g.texture,textureB:v.texture,textureC:b.texture,textureBoundsA:n[_],textureBoundsB:h[_],textureBoundsC:d[_],filterLowA:r,filterHighA:o,filterLowB:i,filterHighB:a,filterLowC:l,filterHighC:s,multiplierA:u,multiplierB:f,multiplierC:c,fbo:C}),p.drawTileResult({scaleLength:p.scaleInput.length,sentinelLength:p.sentinelInput.length,scaleColormap:p.scaleColormap,sentinelColormap:p.sentinelColormap,canvasSize:y,canvasCoordinates:w,texture:C}),C.use((function(){m.read({data:A})})),A=p.flipReadPixelsUint(x,x,A),T[t]=A,t+=1,C.destroy()}))},d=0,_=e;d<_.length;d++){n(_[d])}h(C)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerA=new Of(m,x,qo,!1),this.textureManagerB=new Of(m,x,qo,!1),this.textureManagerC=new Of(m,x,qo,!1),T},t.prototype.renderTilesWithMultiAnalyze4=function(e,t,n,r,o,i,a,l,s,u,f,c,h,p,d,m,g){var v=this,b=this,x=b.regl,y=b.textureManagerA,_=b.textureManagerB,w=b.textureManagerC,C=b.textureManagerD,A=b.tileSize,T=this.computeRequiredCanvasDimensions(e.length),E=T[0],D=T[1];this.setCanvasSize(E,D);var L=this.getCanvasCoordinates(E,D,e.length),S=bn(e,t,n,r,L,(function(e,t,n,r,o){return{coords:e.coords,tilesAPixelData:e.pixelData,tilesBPixelData:t.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:r.pixelData,canvasCoords:o}})),F=[];return function(){var e=ft(S,y.tileCapacity);x.clear({color:Go});for(var t=0,n=function(e){var n=e.map((function(e){var t=e.coords,n=e.tilesAPixelData;return y.addTile(t,n)})),r=e.map((function(e){var t=e.coords,n=e.tilesBPixelData;return _.addTile(t,n)})),g=e.map((function(e){var t=e.coords,n=e.tilesCPixelData;return w.addTile(t,n)})),b=e.map((function(e){var t=e.coords,n=e.tilesDPixelData;return C.addTile(t,n)}));e.forEach((function(e,E){var D=e.canvasCoords,L=x.framebuffer({width:A,height:A,depth:!1,colorFormat:"rgba",colorType:"uint8"}),S=new Uint8Array(A*A*4);v.calcTileMultiAnalyze4({canvasSize:[A,A],canvasCoordinates:[0,0],textureA:y.texture,textureB:_.texture,textureC:w.texture,textureD:C.texture,textureBoundsA:n[E],textureBoundsB:r[E],textureBoundsC:g[E],textureBoundsD:b[E],filterLowA:o,filterHighA:i,filterLowB:a,filterHighB:l,filterLowC:s,filterHighC:u,filterLowD:f,filterHighD:c,multiplierA:h,multiplierB:p,multiplierC:d,multiplierD:m,fbo:L}),v.drawTileResult({scaleLength:v.scaleInput.length,sentinelLength:v.sentinelInput.length,scaleColormap:v.scaleColormap,sentinelColormap:v.sentinelColormap,canvasSize:T,canvasCoordinates:D,texture:L}),L.use((function(){x.read({data:S})})),S=v.flipReadPixelsUint(A,A,S),F[t]=S,t+=1,L.destroy()}))},r=0,b=e;r<b.length;r++){n(b[r])}g(L)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerA=new Of(x,A,qo,!1),this.textureManagerB=new Of(x,A,qo,!1),this.textureManagerC=new Of(x,A,qo,!1),this.textureManagerD=new Of(x,A,qo,!1),F},t.prototype.renderTilesWithMultiAnalyze5=function(e,t,n,r,o,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y){var _=this,w=this,C=w.regl,A=w.textureManagerA,T=w.textureManagerB,E=w.textureManagerC,D=w.textureManagerD,L=w.textureManagerE,S=w.tileSize,F=this.computeRequiredCanvasDimensions(e.length),B=F[0],k=F[1];this.setCanvasSize(B,k);var M=this.getCanvasCoordinates(B,k,e.length),O=bn(e,t,n,r,o,M,(function(e,t,n,r,o,i){return{coords:e.coords,tilesAPixelData:e.pixelData,tilesBPixelData:t.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:r.pixelData,tilesEPixelData:o.pixelData,canvasCoords:i}})),I=[];return function(){var e=ft(O,A.tileCapacity);C.clear({color:Go});for(var t=0,n=function(e){var n=e.map((function(e){var t=e.coords,n=e.tilesAPixelData;return A.addTile(t,n)})),r=e.map((function(e){var t=e.coords,n=e.tilesBPixelData;return T.addTile(t,n)})),o=e.map((function(e){var t=e.coords,n=e.tilesCPixelData;return E.addTile(t,n)})),y=e.map((function(e){var t=e.coords,n=e.tilesDPixelData;return D.addTile(t,n)})),w=e.map((function(e){var t=e.coords,n=e.tilesEPixelData;return L.addTile(t,n)}));e.forEach((function(e,B){var k=e.canvasCoords,M=C.framebuffer({width:S,height:S,depth:!1,colorFormat:"rgba",colorType:"uint8"}),O=new Uint8Array(S*S*4);_.calcTileMultiAnalyze5({canvasSize:[S,S],canvasCoordinates:[0,0],textureA:A.texture,textureB:T.texture,textureC:E.texture,textureD:D.texture,textureE:L.texture,textureBoundsA:n[B],textureBoundsB:r[B],textureBoundsC:o[B],textureBoundsD:y[B],textureBoundsE:w[B],filterLowA:i,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:u,filterHighC:f,filterLowD:c,filterHighD:h,filterLowE:p,filterHighE:d,multiplierA:m,multiplierB:g,multiplierC:v,multiplierD:b,multiplierE:x,fbo:M}),_.drawTileResult({scaleLength:_.scaleInput.length,sentinelLength:_.sentinelInput.length,scaleColormap:_.scaleColormap,sentinelColormap:_.sentinelColormap,canvasSize:F,canvasCoordinates:k,texture:M}),M.use((function(){C.read({data:O})})),O=_.flipReadPixelsUint(S,S,O),I[t]=O,t+=1,M.destroy()}))},r=0,o=e;r<o.length;r++){n(o[r])}y(M)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerE.destroy(),this.textureManagerA=new Of(C,S,qo,!1),this.textureManagerB=new Of(C,S,qo,!1),this.textureManagerC=new Of(C,S,qo,!1),this.textureManagerD=new Of(C,S,qo,!1),this.textureManagerE=new Of(C,S,qo,!1),I},t.prototype.renderTilesWithMultiAnalyze6=function(e,t,n,r,o,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y,_,w,C,A){var T=this,E=this,D=E.regl,L=E.textureManagerA,S=E.textureManagerB,F=E.textureManagerC,B=E.textureManagerD,k=E.textureManagerE,M=E.textureManagerF,O=E.tileSize,I=this.computeRequiredCanvasDimensions(e.length),R=I[0],N=I[1];this.setCanvasSize(R,N);var z=this.getCanvasCoordinates(R,N,e.length),H=bn(e,t,n,r,o,i,z,(function(e,t,n,r,o,i,a){return{coords:e.coords,tilesAPixelData:e.pixelData,tilesBPixelData:t.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:r.pixelData,tilesEPixelData:o.pixelData,tilesFPixelData:i.pixelData,canvasCoords:a}})),V=[];return function(){var e=ft(H,L.tileCapacity);D.clear({color:Go});for(var t=0,n=function(e){var n=e.map((function(e){var t=e.coords,n=e.tilesAPixelData;return L.addTile(t,n)})),r=e.map((function(e){var t=e.coords,n=e.tilesBPixelData;return S.addTile(t,n)})),o=e.map((function(e){var t=e.coords,n=e.tilesCPixelData;return F.addTile(t,n)})),i=e.map((function(e){var t=e.coords,n=e.tilesDPixelData;return B.addTile(t,n)})),A=e.map((function(e){var t=e.coords,n=e.tilesEPixelData;return k.addTile(t,n)})),E=e.map((function(e){var t=e.coords,n=e.tilesFPixelData;return M.addTile(t,n)}));e.forEach((function(e,R){var N=e.canvasCoords,z=D.framebuffer({width:O,height:O,depth:!1,colorFormat:"rgba",colorType:"uint8"}),H=new Uint8Array(O*O*4);T.calcTileMultiAnalyze6({canvasSize:[O,O],canvasCoordinates:[0,0],textureA:L.texture,textureB:S.texture,textureC:F.texture,textureD:B.texture,textureE:k.texture,textureF:M.texture,textureBoundsA:n[R],textureBoundsB:r[R],textureBoundsC:o[R],textureBoundsD:i[R],textureBoundsE:A[R],textureBoundsF:E[R],filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:u,filterLowC:f,filterHighC:c,filterLowD:h,filterHighD:p,filterLowE:d,filterHighE:m,filterLowF:g,filterHighF:v,multiplierA:b,multiplierB:x,multiplierC:y,multiplierD:_,multiplierE:w,multiplierF:C,fbo:z}),T.drawTileResult({scaleLength:T.scaleInput.length,sentinelLength:T.sentinelInput.length,scaleColormap:T.scaleColormap,sentinelColormap:T.sentinelColormap,canvasSize:I,canvasCoordinates:N,texture:z}),z.use((function(){D.read({data:H})})),H=T.flipReadPixelsUint(O,O,H),V[t]=H,t+=1,z.destroy()}))},r=0,o=e;r<o.length;r++){n(o[r])}A(z)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerE.destroy(),this.textureManagerF.destroy(),this.textureManagerA=new Of(D,O,qo,!1),this.textureManagerB=new Of(D,O,qo,!1),this.textureManagerC=new Of(D,O,qo,!1),this.textureManagerD=new Of(D,O,qo,!1),this.textureManagerE=new Of(D,O,qo,!1),this.textureManagerF=new Of(D,O,qo,!1),V},t.prototype.renderTilesWithTransition=function(e,t,n,i){return r(this,void 0,void 0,(function(){var r,a,l,s,u,f,c,h,p,d,m,g,v,b,x=this;return o(this,(function(o){switch(o.label){case 0:return a=(r=this).regl,l=r.textureManager,s=r.tileSize,u=r.normalTextureDimension,f=this.computeRequiredCanvasDimensions(e.length),c=f[0],h=f[1],this.setCanvasSize(c,h),p=this.getCanvasCoordinates(c,h,e.length),d=bn(e,t,p,(function(e,t,n){return{coords:e.coords,oldPixelData:e.pixelData,newPixelData:t.pixelData,canvasCoords:n}})),m=new Of(a,s,u,!1),g=a.now(),v=function(e){var t=ft(d,l.tileCapacity);a.clear({color:Go});for(var n=function(t){var n=t.map((function(e){var t=e.coords,n=e.oldPixelData;return l.addTile(t,n)})),r=t.map((function(e){var t=e.coords,n=e.newPixelData;return m.addTile(t,n)}));x.drawTileInterpolateValue(t.map((function(t,o){var i=t.canvasCoords;return{scaleLength:x.scaleInput.length,sentinelLength:x.sentinelInput.length,scaleColormap:x.scaleColormap,sentinelColormap:x.sentinelColormap,canvasSize:f,canvasCoordinates:i,textureA:l.texture,textureB:m.texture,textureBoundsA:n[o],textureBoundsB:r[o],interpolationFraction:e}})))},r=0,o=t;r<o.length;r++){n(o[r])}i(p)},b=a.frame((function(e){var t=e.time;v(1e3*(t-g)/n)})),[4,ni(n)];case 1:return o.sent(),b.cancel(),v(1),this.textureManager.destroy(),this.textureManager=m,[2]}}))}))},t.prototype.renderTilesWithTransitionAndNewColorScale=function(e,t,n,i){return r(this,void 0,void 0,(function(){var r,a,l,s,u,f,c,h,p,d,m,g,v,b,x=this;return o(this,(function(o){switch(o.label){case 0:return a=(r=this).regl,l=r.textureManager,s=r.tileSize,u=r.normalTextureDimension,f=this.computeRequiredCanvasDimensions(e.length),c=f[0],h=f[1],this.setCanvasSize(c,h),p=this.getCanvasCoordinates(c,h,e.length),d=bn(e,t,p,(function(e,t,n){return{coords:e.coords,oldPixelData:e.pixelData,newPixelData:t.pixelData,canvasCoords:n}})),m=new Of(a,s,u,!1),g=a.now(),v=function(e){var t=ft(d,l.tileCapacity);a.clear({color:Go});for(var n=function(t){var n=t.map((function(e){var t=e.coords,n=e.oldPixelData;return l.addTile(t,n)})),r=t.map((function(e){var t=e.coords,n=e.newPixelData;return m.addTile(t,n)}));x.drawTileInterpolateColor(t.map((function(t,o){var i=t.canvasCoords;return{scaleLengthA:x.scaleInputPrevious.length,sentinelLengthA:x.sentinelInputPrevious.length,scaleColormapA:x.scaleColormapPrevious,sentinelColormapA:x.sentinelColormapPrevious,scaleLengthB:x.scaleInput.length,sentinelLengthB:x.sentinelInput.length,scaleColormapB:x.scaleColormap,sentinelColormapB:x.sentinelColormap,canvasSize:f,canvasCoordinates:i,textureA:l.texture,textureB:m.texture,textureBoundsA:n[o],textureBoundsB:r[o],interpolationFraction:e}})))},r=0,o=t;r<o.length;r++){n(o[r])}i(p)},b=a.frame((function(e){var t=e.time;v(1e3*(t-g)/n)})),[4,ni(n)];case 1:return o.sent(),b.cancel(),v(1),this.textureManager.destroy(),this.textureManager=m,[2]}}))}))},t.prototype.renderTilesWithTransitionAndNewColorScaleOnly=function(e,t,i){return r(this,void 0,void 0,(function(){var r,a,l,s,u,f,c,h,p,d,m,g,v,b,x=this;return o(this,(function(o){switch(o.label){case 0:return a=(r=this).regl,l=r.textureManager,s=r.tileSize,u=r.normalTextureDimension,f=this.computeRequiredCanvasDimensions(e.length),c=f[0],h=f[1],this.setCanvasSize(c,h),p=this.getCanvasCoordinates(c,h,e.length),d=bn(e,p,(function(e,t){return n(n({},e),{canvasCoords:t})})),m=new Of(a,s,u,!1),g=a.now(),v=function(e){var t=ft(d,l.tileCapacity);a.clear({color:Go});for(var n=function(t){var n=t.map((function(e){var t=e.coords,n=e.pixelData;return l.addTile(t,n)}));x.drawTileInterpolateColorOnly(t.map((function(t,r){var o=t.canvasCoords;return{scaleLengthA:x.scaleInputPrevious.length,sentinelLengthA:x.sentinelInputPrevious.length,scaleColormapA:x.scaleColormapPrevious,sentinelColormapA:x.sentinelColormapPrevious,scaleLengthB:x.scaleInput.length,sentinelLengthB:x.sentinelInput.length,scaleColormapB:x.scaleColormap,sentinelColormapB:x.sentinelColormap,canvasSize:f,canvasCoordinates:o,texture:l.texture,textureBounds:n[r],interpolationFraction:e}})))},r=0,o=t;r<o.length;r++){n(o[r])}i(p)},b=a.frame((function(e){var n=e.time;v(1e3*(n-g)/t)})),[4,ni(t)];case 1:return o.sent(),b.cancel(),v(1),this.textureManager.destroy(),this.textureManager=m,[2]}}))}))},t.prototype.generateSunDirections=function(e,t){for(var n,r,o,i=[],a=0;a<e;a++){var l=Hf(Nf(),zf(Nf(),(n=Nf(),r=Hf(Nf(),[1,1,1]),o=1496e8,n[0]=r[0]*o,n[1]=r[1]*o,n[2]=r[2]*o,n),Vf(Nf(),695508e3*t)));i.push(l)}this.sunDirections=i},t.prototype.generateAmbientDirections=function(e){for(var t=[],n=0;n<e;n++){var r=Vf(Nf(),Math.random());t.push(r)}this.ambientDirections=t},t.prototype.removeTile=function(e){this.textureManager.removeTile(e)},t.prototype.setCanvasSize=function(e,t){Object.assign(this.canvas,{width:e,height:t})},t.prototype.computeRequiredCanvasDimensions=function(e){var t=this.tileSize,n=Math.ceil(Math.sqrt(e));return[n*t,Math.ceil(e/n)*t]},t.prototype.getCanvasCoordinates=function(e,t,n){var r=this.tileSize;return cn(Ko(0,t,r),(function(t){return Ko(0,e,r).map((function(e){return[e,t]}))})).slice(0,n)},t}(),jf={select:function(e){return"string"==typeof e?new ya([[document.querySelector(e)]],[document.documentElement]):new ya([[e]],xa)},selectAll:function(e){return"string"==typeof e?new ya([document.querySelectorAll(e)],[document.documentElement]):new ya([null==e?[]:xi(e)],xa)},scaleLinear:function e(){var t=_l();return t.copy=function(){return xl(t,e())},_a.apply(t,arguments),zl(t)},geoPath:function(e,t){var n,r,o=4.5;function i(e){return e&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),Xl(e,n(r))),r.result()}return i.area=function(e){return Xl(e,n(ns)),ns.result()},i.measure=function(e){return Xl(e,n(Us)),Us.result()},i.bounds=function(e){return Xl(e,n(cs)),cs.result()},i.centroid=function(e){return Xl(e,n(Ts)),Ts.result()},i.projection=function(t){return arguments.length?(n=null==t?(e=null,Jl):(e=t).stream,i):e},i.context=function(e){return arguments.length?(r=null==e?(t=null,new qs):new Is(t=e),"function"!=typeof o&&r.pointRadius(o),i):t},i.pointRadius=function(e){return arguments.length?(o="function"==typeof e?e:(r.pointRadius(+e),+e),i):o},i.projection(e).context(t)},contours:function(){var e=1,t=1,n=Ln,r=l;function o(e){var t=n(e);if(Array.isArray(t))t=t.slice().sort(Fn);else{var r=function(e,t){let n,r;if(void 0===t)for(const t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let o=-1;for(let i of e)null!=(i=t(i,++o,e))&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)))}return[n,r]}(e),o=r[0],a=r[1];t=Dn(o,a,t),t=wn(Math.floor(o/t)*t,Math.floor(a/t)*t,t)}return t.map((function(t){return i(e,t)}))}function i(n,o){var i=[],l=[];return function(n,r,o){var i,l,s,u,f,c,h=new Array,p=new Array;i=l=-1,u=n[0]>=r,Rn[u<<1].forEach(d);for(;++i<e-1;)s=u,u=n[i+1]>=r,Rn[s|u<<1].forEach(d);Rn[u<<0].forEach(d);for(;++l<t-1;){for(i=-1,u=n[l*e+e]>=r,f=n[l*e]>=r,Rn[u<<1|f<<2].forEach(d);++i<e-1;)s=u,u=n[l*e+e+i+1]>=r,c=f,f=n[l*e+i+1]>=r,Rn[s|u<<1|f<<2|c<<3].forEach(d);Rn[u|f<<3].forEach(d)}i=-1,f=n[l*e]>=r,Rn[f<<2].forEach(d);for(;++i<e-1;)c=f,f=n[l*e+i+1]>=r,Rn[f<<2|c<<3].forEach(d);function d(e){var t,n,r=[e[0][0]+i,e[0][1]+l],s=[e[1][0]+i,e[1][1]+l],u=a(r),f=a(s);(t=p[u])?(n=h[f])?(delete p[t.end],delete h[n.start],t===n?(t.ring.push(s),o(t.ring)):h[t.start]=p[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete p[t.end],t.ring.push(s),p[t.end=f]=t):(t=h[f])?(n=p[u])?(delete h[t.start],delete p[n.end],t===n?(t.ring.push(s),o(t.ring)):h[n.start]=p[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete h[t.start],t.ring.unshift(r),h[t.start=u]=t):h[u]=p[f]={start:u,end:f,ring:[r,s]}}Rn[f<<3].forEach(d)}(n,o,(function(e){r(e,n,o),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?i.push([e]):l.push(e)})),l.forEach((function(e){for(var t,n=0,r=i.length;n<r;++n)if(-1!==kn((t=i[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:o,coordinates:i}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function l(n,r,o){n.forEach((function(n){var i,a=n[0],l=n[1],s=0|a,u=0|l,f=r[u*e+s];a>0&&a<e&&s===a&&(i=r[u*e+s-1],n[0]=a+(o-i)/(f-i)-.5),l>0&&l<t&&u===l&&(i=r[(u-1)*e+s],n[1]=l+(o-i)/(f-i)-.5)}))}return o.contour=i,o.size=function(n){if(!arguments.length)return[e,t];var r=Math.floor(n[0]),i=Math.floor(n[1]);if(!(r>=0&&i>=0))throw new Error("invalid size");return e=r,t=i,o},o.thresholds=function(e){return arguments.length?(n="function"==typeof e?e:Array.isArray(e)?Bn(Sn.call(e)):Bn(e),o):n},o.smooth=function(e){return arguments.length?(r=e?l:In,o):r===l},o},interpolateHcl:rf,json:au,min:function(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(n>o||void 0===n&&o>=o)&&(n=o)}return n},max:function(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(n<o||void 0===n&&o>=o)&&(n=o)}return n},scan:function(e,t){const n=function(e,t=xn){if(1===t.length)return function(e,t){let n,r=-1,o=-1;if(void 0===t)for(const t of e)++o,null!=t&&(n>t||void 0===n&&t>=t)&&(n=t,r=o);else for(let i of e)null!=(i=t(i,++o,e))&&(n>i||void 0===n&&i>=i)&&(n=i,r=o);return r}(e,t);let n,r=-1,o=-1;for(const i of e)++o,(r<0?0===t(i,i):t(i,n)<0)&&(n=i,r=o);return r}(e,t);return n<0?void 0:n},range:wn},Gf=$o(),qf={tileFormat:"float32",colorScale:[],sentinelValues:[],transitions:!1,transitionTimeMs:800,debug:!1,extraPixelLayers:0,colorscaleMaxLength:16,sentinelMaxLength:16,minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,glOperation:"none",multiLayers:0,operationUrlA:"",operationUrlB:"",operationUrlC:"",operationUrlD:"",operationUrlE:"",operationUrlF:"",filterLowA:0,filterHighA:1e5,filterLowB:0,filterHighB:1e5,filterLowC:0,filterHighC:1e5,filterLowD:0,filterHighD:1e5,filterLowE:0,filterHighE:1e5,filterLowF:0,filterHighF:1e5,multiplierA:1,multiplierB:1,multiplierC:1,multiplierD:1,multiplierE:1,multiplierF:1,hillshadeType:"none",hsSimpleZoomdelta:0,hsSimpleSlopescale:3,hsSimpleAzimuth:315,hsSimpleAltitude:70,hsAdvValueScale:1,hsAdvPixelScale:"auto",hsAdvSoftIterations:10,hsAdvAmbientIterations:10,hsAdvSunRadiusMultiplier:100,hsAdvFinalSoftMultiplier:1,hsAdvFinalAmbientMultiplier:.25,hsAdvBaselayerUrl:"",hsPregenUrl:"",_hillshadeOptions:{hillshadeType:"none"},contourType:"none",contourSmoothLines:!1,contourSmoothInput:!1,contourSmoothInputKernel:7,contourScaleFactor:1,contourInterval:25,contourIndexInterval:100,contourLineColor:"#000000",contourIlluminatedHighlightColor:"rgba(177,174,164,.5)",contourIlluminatedShadowColor:"#5b5143",contourIlluminatedShadowSize:2,contourLineWeight:.5,contourLineIndexWeight:2,contourIndexLabels:!1,contourLabelFont:"12px Arial",contourLabelDistance:250,contourHypso:!1,contourHypsoDomain:[0,1e3,2e3],contourHypsoColors:["#486341","#e5d9c9","#dddddd"],contourBathy:!1,contourBathyDomain:[-2e3,0],contourBathyColors:["#315d9b","#d5f2ff"],contourBathyShadowColor:"#4e5c66",contourBathyHighlightColor:"rgba(224, 242, 255, .5)"};return function(i){function a(e){var t=i.call(this,Object.assign({},qf,e))||this;t._contourData={},t._checkColorScaleAndSentinels();var n=t.options,a=n.nodataValue,l=n.preloadUrl,s=t._tileSizeAsNumber(),u=new Uf(t,s,a,t.options.colorScale,t.options.sentinelValues,t.options.colorscaleMaxLength,t.options.sentinelMaxLength);return Object.assign(t,{_renderer:u,_preloadTileCache:void 0}),t._maybePreload(l),t._renderer.generateAmbientDirections(t.options.hsAdvAmbientIterations),t._renderer.generateSunDirections(t.options.hsAdvSoftIterations,t.options.hsAdvSunRadiusMultiplier),t.on("tileunload",t._onTileRemove.bind(t)),t.on("load",(function(e){return setTimeout((function(){t._maybeUpdateMergedArrayAndDrawContours(),"advanced"===t.options.hillshadeType&&t._renderer.textureManager.available.length<t._renderer.textureManager.contents.size&&t._renderer.textureManager.clearTiles()}),300)})),setTimeout((function(){t._map.on("zoomend",(function(e){fi(50).then((function(){return r(t,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return"none"===this.options.contourType?[3,2]:(this.options.debug&&console.log("zoom changed. Moving contour canvas."),[4,this._getActivetilesBounds()]);case 1:e=t.sent(),this._moveContourCanvas(e),t.label=2;case 2:return[2]}}))}))}))}))}),300),t}return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(a,i),a.prototype.updateOptions=function(t){var n=this,i=this.options,a=i.url,l=i.glOperation,s=i.operationUrlA,u=i.operationUrlB,f=i.operationUrlC,c=i.operationUrlD,h=i.operationUrlE,p=i.operationUrlF,d=i.colorScale,m=i.sentinelValues,g=i.filterLowA,v=i.filterHighA,b=i.filterLowB,x=i.filterHighB,y=i.filterLowC,_=i.filterHighC,w=i.filterLowD,C=i.filterHighD,A=i.filterLowE,T=i.filterHighE,E=i.filterLowF,D=i.filterHighF,L=i.multiplierA,S=i.multiplierB,F=i.multiplierC,B=i.multiplierD,k=i.multiplierE,M=i.multiplierF,O=i.multiLayers,I=i.hsPregenUrl,R=i.hillshadeType,N=i.hsAdvValueScale,z=i.hsAdvPixelScale,H=i.hsSimpleSlopescale,V=i.hsSimpleAzimuth,P=i.hsSimpleAltitude,U=i.hsAdvSoftIterations,j=i.hsAdvAmbientIterations,G=i.hsAdvSunRadiusMultiplier,q=i.hsAdvFinalSoftMultiplier,W=i.hsAdvFinalAmbientMultiplier,Z=i.hsAdvBaselayerUrl,X=i.contourInterval,Y=i.contourIndexInterval,$=i.contourLineColor,K=i.contourLineWeight,Q=i.contourLineIndexWeight,J=i.contourType,ee=i.contourSmoothLines,te=i.contourSmoothInput,ne=i.contourSmoothInputKernel,re=i.contourIlluminatedHighlightColor,oe=i.contourIlluminatedShadowColor,ie=i.contourIlluminatedShadowSize,ae=i.contourHypso,le=i.contourHypsoDomain,se=i.contourHypsoColors,ue=i.contourBathy,fe=i.contourBathyDomain,ce=i.contourBathyColors,he=i.contourBathyShadowColor,pe=i.contourBathyHighlightColor,de=i.contourIndexLabels,me=i.contourLabelFont,ge=i.contourLabelDistance,ve=i.colorscaleMaxLength,be=i.sentinelMaxLength;if(e.Util.setOptions(this,t),this.options.colorscaleMaxLength!==ve||this.options.sentinelMaxLength!==be){this.options.debug&&console.log("Creating new renderer");var xe=this._tileSizeAsNumber(),ye=new Uf(this,xe,this.options.nodataValue,this.options.colorScale,this.options.sentinelValues,this.options.colorscaleMaxLength,this.options.sentinelMaxLength);this._renderer.regl.destroy(),delete this._renderer,Object.assign(this,{_renderer:ye})}if(this._checkColorScaleAndSentinels(),this.options.colorScale!==d&&this._renderer.updateColorscale(this.options.colorScale),this.options.sentinelValues!==m&&this._renderer.updateSentinels(this.options.sentinelValues),this.options.hsAdvAmbientIterations!==j&&this._renderer.generateAmbientDirections(this.options.hsAdvAmbientIterations),this.options.hsAdvSoftIterations===U&&this.options.hsAdvSunRadiusMultiplier===G||this._renderer.generateSunDirections(this.options.hsAdvSoftIterations,this.options.hsAdvSunRadiusMultiplier),this._maybePreload(this.options.preloadUrl),this.options._hillshadeOptions={hillshadeType:this.options.hillshadeType,hsAdvValueScale:this.options.hsAdvValueScale,hsAdvPixelScale:this.options.hsAdvPixelScale,hsSimpleSlopescale:this.options.hsSimpleSlopescale,hsSimpleAzimuth:this.options.hsSimpleAzimuth,hsSimpleAltitude:this.options.hsSimpleAltitude,hsSimpleZoomdelta:this.options.hsSimpleZoomdelta,hsAdvSoftIterations:this.options.hsAdvSoftIterations,hsAdvAmbientIterations:this.options.hsAdvAmbientIterations,hsAdvSunRadiusMultiplier:this.options.hsAdvSunRadiusMultiplier,hsAdvFinalSoftMultiplier:this.options.hsAdvFinalSoftMultiplier,hsAdvFinalAmbientMultiplier:this.options.hsAdvFinalAmbientMultiplier,hsAdvBaselayerUrl:this.options.hsAdvBaselayerUrl,hsPregenUrl:this.options.hsPregenUrl},this.options.extraPixelLayers>0&&"none"===this.options.glOperation&&this._maybeLoadExtraLayers(s,u,f,c),this.options.hillshadeType!==R&&("simple"===this.options.hillshadeType?this._renderer.setMaxTextureDimension(this._tileSizeAsNumber()):"simple"===R&&this._renderer.setMaxTextureDimension(this._renderer.findMaxTextureDimension())),this.options.url!==a&&this._renderer.textureManager.clearTiles(),this.options.hsAdvBaselayerUrl!==Z&&this._renderer.textureManagerHillshade.clearTiles(),"none"===this.options.glOperation?this.options.transitions?this.options.url!==a?(this._updateTilesWithTransitions(d,m),this.options.debug&&console.log("Running GLOperations with transition on tiles")):this.options.url===a&&(this._updateColorscaleWithTransitions(d,m),this.options.debug&&console.log("Running GLOperations with transition on colorscale only")):this.options.url!==a||this.options.hillshadeType!==R||this.options.hsPregenUrl!==I||this.options.hsSimpleSlopescale!==H||this.options.hsSimpleAzimuth!==V||this.options.hsSimpleAltitude!==P||this.options.hsAdvSunRadiusMultiplier!==G||this.options.hsAdvFinalSoftMultiplier!==q||this.options.hsAdvFinalAmbientMultiplier!==W||this.options.hsAdvSoftIterations!==U||this.options.hsAdvAmbientIterations!==j||this.options.hsAdvValueScale!==N||this.options.hsAdvPixelScale!==z||this.options.hsAdvBaselayerUrl!==Z?(this._updateTiles(),this.options.debug&&console.log("Running GLOperations with new url, no transition and no operation")):JSON.stringify(this.options.colorScale)!==JSON.stringify(d)&&(this._updateTilesColorscaleOnly(),this.options.debug&&console.log("Running GLOperations with same url, no transition and no operation")):"multi"===this.options.glOperation?(1===this.options.multiLayers?this._updateTilesWithMultiAnalyze1(l,O,s,g,v,L):2===this.options.multiLayers?this._updateTilesWithMultiAnalyze2(l,O,s,u,g,v,b,x,L,S):3===this.options.multiLayers?this._updateTilesWithMultiAnalyze3(l,O,s,u,f,g,v,b,x,y,_,L,S,F):4===this.options.multiLayers?this._updateTilesWithMultiAnalyze4(l,O,s,u,f,c,g,v,b,x,y,_,w,C,L,S,F,B):5===this.options.multiLayers?this._updateTilesWithMultiAnalyze5(l,O,s,u,f,c,h,g,v,b,x,y,_,w,C,A,T,L,S,F,B,k):6===this.options.multiLayers&&this._updateTilesWithMultiAnalyze6(l,O,s,u,f,c,h,p,g,v,b,x,y,_,w,C,A,T,E,D,L,S,F,B,k,M),this.options.debug&&console.log("Running GLOperations with multiAnalyze")):"diff"===this.options.glOperation&&(this._updateTilesWithDiff(l,s,u),this.options.debug&&console.log("Running GLOperations with diff")),"none"!==this.options.contourType)if(this.options.contourType!==J&&"none"===J)this._contourData.mergedTileArray?setTimeout((function(){n._calculateAndDrawContours()}),50):setTimeout((function(){n._maybeUpdateMergedArrayAndDrawContours()}),50);else if(!this.options.contourSmoothInput||this.options.contourSmoothInput===te&&this.options.contourSmoothInputKernel===ne)this.options.contourInterval!==X||this.options.contourIndexInterval!==Y||this.options.contourSmoothLines!==ee||this.options.contourSmoothInput!==te?setTimeout((function(){n._calculateAndDrawContours()}),50):this.options.contourType===J&&this.options.contourLineColor===$&&this.options.contourLineWeight===K&&this.options.contourLineIndexWeight===Q&&this.options.contourIlluminatedHighlightColor===re&&this.options.contourIlluminatedShadowColor===oe&&this.options.contourIlluminatedShadowSize===ie&&this.options.contourHypso===ae&&this.options.contourHypsoDomain===le&&this.options.contourHypsoColors===se&&this.options.contourBathy===ue&&this.options.contourBathyDomain===fe&&this.options.contourBathyColors===ce&&this.options.contourBathyShadowColor===he&&this.options.contourBathyHighlightColor===pe&&this.options.contourIndexLabels===de&&this.options.contourLabelFont===me&&this.options.contourLabelDistance===ge||this._drawContours();else{fi(50).then((function(){return r(n,void 0,void 0,(function(){return o(this,(function(e){return this._smoothContourInput(),this._calculateAndDrawContours(),[2]}))}))}))}else this.options.contourType!==J&&"none"===this.options.contourType&&(this._clearContours(),this._contourData.mergedTileArray=void 0)},a.prototype.getEvents=function(){var t=this,r=this.options,o=mn({click:r.onclick,dblclick:r.ondblclick,mousedown:r.onmousedown,mouseup:r.onmouseup,mouseover:r.onmouseover,mouseout:r.onmouseout,mousemove:r.onmousemove,contextmenu:r.oncontextmenu},(function(e){return!(void 0===e)}));return n(n({},e.GridLayer.prototype.getEvents.call(this)),function(e,t){var n={};return t=on(t),sn(e,(function(e,r,o){ee(n,r,t(e,r,o))})),n}(o,(function(e){return e&&t._wrapMouseEventHandler(e)})))},a.prototype.getTileUrl=function(t,n){var r={r:e.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-t.y;this.options.tms&&(r.y=o),r["-y"]=o}return e.Util.template(n,e.Util.extend(r,this.options))},a.prototype.redraw=function(){return this._map&&(this._removeAllTiles(),this._update()),this},a.prototype.createTile=function(t,n){var i=this,a=this.options,l=a.extraPixelLayers,s=a.tileSize,u=a.url,f=a.hsPregenUrl,c=a.operationUrlA,h=a.operationUrlB,p=a.operationUrlC,d=a.operationUrlD,m=a.operationUrlE,g=a.operationUrlF,v=a.filterLowA,b=a.filterHighA,x=a.filterLowB,y=a.filterHighB,_=a.filterLowC,w=a.filterHighC,C=a.filterLowD,A=a.filterHighD,T=a.filterLowE,E=a.filterHighE,D=a.filterLowF,L=a.filterHighF,S=a.multiplierA,F=a.multiplierB,B=a.multiplierC,k=a.multiplierD,M=a.multiplierE,O=a.multiplierF,I=e.DomUtil.create("canvas");return Object.assign(I,{className:"gl-tilelayer-tile",width:s,height:s}),"none"===this.options.glOperation?(1===l&&this._fetchTileData(t,c).then((function(e){i.options.debug&&console.log("createTile - extraPixelLayers === 1"),I.pixelDataA=e})),"pregen"===this.options._hillshadeOptions.hillshadeType?Promise.all([this._fetchTileData(t,u),this._fetchTileData(t,f)]).then((function(e){i.options.debug&&console.log("_fetchTileData with pregen hs");var r=e[0],o=e[1],a=i._renderer.renderTileHsPregen({coords:t,pixelData:r},{coords:t,pixelData:o}),l=a[0],s=a[1];I.pixelData=r,I.pixelDataHsPregen=o,i._copyToTileCanvas(I,l,s),n(void 0,I)})):"advanced"===this.options._hillshadeOptions.hillshadeType?r(i,void 0,void 0,(function(){var e,r,i,a,l,s,f,c,h,p,d;return o(this,(function(o){switch(o.label){case 0:if(o.trys.push([0,12,,13]),e=void 0,r=this._renderer.textureManager.hashTileCoordinates(t),!this._renderer.textureManager.contents.has(r))return[3,5];o.label=1;case 1:return o.trys.push([1,2,,4]),e=this._tiles[r].el.pixelData,[3,4];case 2:return o.sent(),[4,this._fetchTileData(t,u)];case 3:return e=o.sent(),this._renderer.textureManager.addTile(t,e),[3,4];case 4:return[3,7];case 5:return[4,this._fetchTileData(t,u)];case 6:e=o.sent(),this._renderer.textureManager.addTile(t,e),o.label=7;case 7:return i=oi(this.options.nodataValue,this._tileSizeAsNumber()),Jo(e,i)?[3,11]:[4,ui(this,this._renderer.textureManager,t,u)];case 8:return a=o.sent(),l=[],this.options.hsAdvBaselayerUrl?[4,this._fetchTileData(t,this.options.hsAdvBaselayerUrl,"image")]:[3,10];case 9:s=o.sent(),f=this._renderer.textureManagerHillshade.addTile(t,s),l=ei(f),o.label=10;case 10:c=this._renderer.renderTileHsAdvanced(this.options._hillshadeOptions,this._getZoomForUrl(),a,this._getPixelScale(),l),h=c[0],p=c[1],I.pixelData=e,this._copyToTileCanvas(I,h,p),o.label=11;case 11:return n(void 0,I),[3,13];case 12:return d=o.sent(),console.log(d),[3,13];case 13:return[2]}}))})):this._fetchTileData(t,u).then((function(e){i.options.debug&&console.log("_fetchTileData with no operation");var r=i._renderer.renderTile({coords:t,pixelData:e},i.options._hillshadeOptions,i._getZoomForUrl()),o=r[0],a=r[1];I.pixelData=e,i._copyToTileCanvas(I,o,a),n(void 0,I)}))):"diff"===this.options.glOperation?Promise.all([this._fetchTileData(t,c),this._fetchTileData(t,h)]).then((function(e){i.options.debug&&console.log("_fetchTileData with diff");var r=e[0],o=e[1],a=i._renderer.renderTileDiff({coords:t,pixelData:r},{coords:t,pixelData:o}),l=a[0],s=a[1],u=a[2];I.pixelData=u,I.pixelDataA=r,I.pixelDataB=o,i._copyToTileCanvas(I,l,s),n(void 0,I)})):"multi"===this.options.glOperation&&1===this.options.multiLayers?Promise.all([this._fetchTileData(t,c)]).then((function(e){i.options.debug&&console.log("_fetchTileData with multi");var r=e[0],o=i._renderer.renderTileMulti1({coords:t,pixelData:r},v,b,S),a=o[0],l=o[1],s=o[2];I.pixelData=s,I.pixelDataA=r,i._copyToTileCanvas(I,a,l),n(void 0,I)})):"multi"===this.options.glOperation&&2===this.options.multiLayers?Promise.all([this._fetchTileData(t,c),this._fetchTileData(t,h)]).then((function(e){i.options.debug&&console.log("_fetchTileData with multi");var r=e[0],o=e[1],a=i._renderer.renderTileMulti2({coords:t,pixelData:r},{coords:t,pixelData:o},v,b,x,y,S,F),l=a[0],s=a[1],u=a[2];I.pixelData=u,I.pixelDataA=r,I.pixelDataB=o,i._copyToTileCanvas(I,l,s),n(void 0,I)})):"multi"===this.options.glOperation&&3===this.options.multiLayers?Promise.all([this._fetchTileData(t,c),this._fetchTileData(t,h),this._fetchTileData(t,p)]).then((function(e){i.options.debug&&console.log("_fetchTileData with multi");var r=e[0],o=e[1],a=e[2],l=i._renderer.renderTileMulti3({coords:t,pixelData:r},{coords:t,pixelData:o},{coords:t,pixelData:a},v,b,x,y,_,w,S,F,B),s=l[0],u=l[1],f=l[2];I.pixelData=f,I.pixelDataA=r,I.pixelDataB=o,I.pixelDataC=a,i._copyToTileCanvas(I,s,u),n(void 0,I)})):"multi"===this.options.glOperation&&4===this.options.multiLayers?Promise.all([this._fetchTileData(t,c),this._fetchTileData(t,h),this._fetchTileData(t,p),this._fetchTileData(t,d)]).then((function(e){i.options.debug&&console.log("_fetchTileData with multi");var r=e[0],o=e[1],a=e[2],l=e[3],s=i._renderer.renderTileMulti4({coords:t,pixelData:r},{coords:t,pixelData:o},{coords:t,pixelData:a},{coords:t,pixelData:l},v,b,x,y,_,w,C,A,S,F,B,k),u=s[0],f=s[1],c=s[2];I.pixelData=c,I.pixelDataA=r,I.pixelDataB=o,I.pixelDataC=a,I.pixelDataD=l,i._copyToTileCanvas(I,u,f),n(void 0,I)})):"multi"===this.options.glOperation&&5===this.options.multiLayers?Promise.all([this._fetchTileData(t,c),this._fetchTileData(t,h),this._fetchTileData(t,p),this._fetchTileData(t,d),this._fetchTileData(t,m)]).then((function(e){i.options.debug&&console.log("_fetchTileData with multi");var r=e[0],o=e[1],a=e[2],l=e[3],s=e[4],u=i._renderer.renderTileMulti5({coords:t,pixelData:r},{coords:t,pixelData:o},{coords:t,pixelData:a},{coords:t,pixelData:l},{coords:t,pixelData:s},v,b,x,y,_,w,C,A,T,E,S,F,B,k,M),f=u[0],c=u[1],h=u[2];I.pixelData=h,I.pixelDataA=r,I.pixelDataB=o,I.pixelDataC=a,I.pixelDataD=l,I.pixelDataE=s,i._copyToTileCanvas(I,f,c),n(void 0,I)})):"multi"===this.options.glOperation&&6===this.options.multiLayers&&Promise.all([this._fetchTileData(t,c),this._fetchTileData(t,h),this._fetchTileData(t,p),this._fetchTileData(t,d),this._fetchTileData(t,m),this._fetchTileData(t,g)]).then((function(e){i.options.debug&&console.log("_fetchTileData with multi");var r=e[0],o=e[1],a=e[2],l=e[3],s=e[4],u=e[5],f=i._renderer.renderTileMulti6({coords:t,pixelData:r},{coords:t,pixelData:o},{coords:t,pixelData:a},{coords:t,pixelData:l},{coords:t,pixelData:s},{coords:t,pixelData:u},v,b,x,y,_,w,C,A,T,E,D,L,S,F,B,k,M,O),c=f[0],h=f[1],p=f[2];I.pixelData=p,I.pixelDataA=r,I.pixelDataB=o,I.pixelDataC=a,I.pixelDataD=l,I.pixelDataE=s,I.pixelDataF=u,i._copyToTileCanvas(I,c,h),n(void 0,I)})),I},a.prototype._checkColorScaleAndSentinels=function(){var e=this.options,t=e.colorScale,n=e.sentinelValues,r=e.colorscaleMaxLength,o=e.sentinelMaxLength;if(0===t.length&&0===n.length)throw new Error("Either `colorScale` or `sentinelValues` must be of non-zero length.");if(t.length>r)throw new Error("Color scale length "+t.length+" exceeds the maximum, "+r+".");if(n.length>o)throw new Error("Sentinel values length "+n.length+" exceeds the maximum, "+o+".")},a.prototype._getSubdomain=function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},a.prototype._getZoomForUrl=function(){var e=this.options,t=e.maxZoom,n=e.zoomReverse,r=e.zoomOffset,o=this._tileZoom;return(n?t-o:o)+r},a.prototype._onTileRemove=function(t){var n=t.coords,r=t.tile;this.options.debug&&console.log("_onTileRemove()"),e.Browser.android||(r.onload=X),this._renderer.removeTile(n)},a.prototype._updateTiles=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i=this;return o(this,(function(o){switch(o.label){case 0:return e=this._getActiveTiles(),[4,this._getTilesData(e)];case 1:return t=o.sent(),this.options.debug&&console.log("_updateTiles() with url "+this.options.url),"pregen"!==this.options._hillshadeOptions.hillshadeType?[3,3]:[4,this._getTilesData(e,this.options.hsPregenUrl)];case 2:return r=o.sent(),n=this._renderer.renderTilesHsPregen(t,r),[3,6];case 3:return"advanced"!==this.options._hillshadeOptions.hillshadeType?[3,5]:(this._map.fire("calcHsAdvanced",{status:!0}),[4,this._renderer.renderTilesHsAdvanced(t,this.options._hillshadeOptions,this.options.url,this._getZoomForUrl(),this._getPixelScale())]);case 4:return n=o.sent(),this._map.fire("calcHsAdvanced",{status:!1}),[3,6];case 5:n=this._renderer.renderTiles(t,this.options._hillshadeOptions,this._getZoomForUrl()),o.label=6;case 6:return n.forEach((function(n,o){var a=n[0],l=n[1],s=e[o];i._copyToTileCanvas(s.el,a,l),s.el.pixelData=t[o].pixelData,"pregen"===i.options._hillshadeOptions.hillshadeType&&(s.el.pixelDataHsPregen=r[o].pixelData)})),[2]}}))}))},a.prototype._updateTilesColorscaleOnly=function(){return r(this,void 0,void 0,(function(){var e,t,n,r=this;return o(this,(function(o){if(this.options.debug&&console.log("_updateTilesColorscaleOnly()"),e=this._getActiveTiles(),"pregen"===this.options._hillshadeOptions.hillshadeType)n=e.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),t=e.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataHsPregen}})),this._renderer.renderTilesHsPregen(n,t).forEach((function(t,n){var o=t[0],i=t[1],a=e[n];r._copyToTileCanvas(a.el,o,i)}));else{if("advanced"===this.options._hillshadeOptions.hillshadeType)return this.options.debug&&console.log("_updateTilesColorscaleOnly() with advanced hs"),this.redraw(),[2];n=e.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),this._renderer.renderTiles(n,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(t,n){var o=t[0],i=t[1],a=e[n];r._copyToTileCanvas(a.el,o,i)}))}return[2]}))}))},a.prototype._updateTilesWithTransitions=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,a,l,s,u,f,c,h=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithTransitions()"),n=this._getActiveTiles(),r=n.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),[4,this._getTilesData(n)];case 1:return i=o.sent(),n.forEach((function(e,t){e.el.pixelData=i[t].pixelData})),a=this.options,l=a.colorScale,s=a.sentinelValues,u=void 0===s?[]:s,f=a.transitionTimeMs,c=function(e){e.forEach((function(e,t){var r=e[0],o=e[1],i=n[t];h._copyToTileCanvas(i.el,r,o)}))},JSON.stringify(l)===JSON.stringify(e)&&JSON.stringify(u)===JSON.stringify(t)?this._renderer.renderTilesWithTransition(r,i,f,c):this._renderer.renderTilesWithTransitionAndNewColorScale(r,i,f,c),[2]}}))}))},a.prototype._updateColorscaleWithTransitions=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,a,l,s,u,f,c=this;return o(this,(function(o){return this.options.debug&&console.log("_updateColorscaleWithTransitions()"),n=this._getActiveTiles(),r=n.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),i=this.options,a=i.colorScale,l=i.sentinelValues,s=void 0===l?[]:l,u=i.transitionTimeMs,f=function(e){e.forEach((function(e,t){var r=e[0],o=e[1],i=n[t];c._copyToTileCanvas(i.el,r,o)}))},JSON.stringify(a)===JSON.stringify(e)&&JSON.stringify(s)===JSON.stringify(t)||this._renderer.renderTilesWithTransitionAndNewColorScaleOnly(r,u,f),[2]}))}))},a.prototype._updateTilesWithDiff=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i,a,l,s,u=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithDiff()"),r=this._getActiveTiles(),i=[],a=[],this.options.glOperation!==e||this.options.operationUrlA!==t||this.options.operationUrlB!==n?[3,1]:(this.options.debug&&console.log("_updateTilesWithDiff: both same url. Getting data from existing result"),i=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),[3,7]);case 1:return this.options.operationUrlA===t?[3,3]:(this.options.debug&&console.log("_updateTilesWithDiff: new A url. Downloading new tiles"),[4,this._getTilesData(r,this.options.operationUrlA)]);case 2:return i=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=i[t].pixelData})),[3,4];case 3:this.options.debug&&console.log("_updateTilesWithDiff: same A url. Getting data from existing tiles"),i=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataA}})),o.label=4;case 4:return this.options.operationUrlB===n?[3,6]:(this.options.debug&&console.log("_updateTilesWithDiff: new B url. Downloading new tiles"),[4,this._getTilesData(r,this.options.operationUrlB)]);case 5:return a=o.sent(),r.forEach((function(e,t){e.el.pixelDataB=a[t].pixelData})),[3,7];case 6:this.options.debug&&console.log("_updateTilesWithDiff: same B url. Getting data from existing tiles"),a=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataB}})),o.label=7;case 7:return this.options.glOperation===e&&this.options.operationUrlA===t&&this.options.operationUrlB===n?(this.options.debug&&console.log("_updateTilesWithDiff: both same urls. Running renderTiles()"),this._renderer.renderTiles(i,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,t){var n=e[0],o=e[1],i=r[t];u._copyToTileCanvas(i.el,n,o)}))):(this.options.debug&&console.log("_updateTilesWithDiff: not same urls. Running renderTilesWithDiff()"),l=function(e){e.forEach((function(e,t){var n=e[0],o=e[1],i=r[t];u._copyToTileCanvas(i.el,n,o)}))},s=this._renderer.renderTilesWithDiff(i,a,l),r.forEach((function(e,t){e.el.pixelData=s[t]}))),[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze1=function(e,t,n,i,a,l){return r(this,void 0,void 0,(function(){var r,s,u,f,c,h=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze1()"),r=this._getActiveTiles(),this.options.glOperation!==e||this.options.operationUrlA!==n||this.options.filterLowA!==i||this.options.filterHighA!==a||this.options.multiplierA!==l||this.options.multiLayers!==t?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze1: all same urls. Fetching from existing tiles. Running renderTiles()"),s=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),this._renderer.renderTiles(s,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,t){var n=e[0],o=e[1],i=r[t];h._copyToTileCanvas(i.el,n,o)})),[3,5]);case 1:return u=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return u=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=u[t].pixelData})),[3,4];case 3:u=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataA}})),o.label=4;case 4:f=function(e){e.forEach((function(e,t){var n=e[0],o=e[1],i=r[t];h._copyToTileCanvas(i.el,n,o)}))},c=this._renderer.renderTilesWithMultiAnalyze1(u,this.options.filterLowA,this.options.filterHighA,this.options.multiplierA,f),r.forEach((function(e,t){e.el.pixelData=c[t]})),o.label=5;case 5:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze2=function(e,t,n,i,a,l,s,u,f,c){return r(this,void 0,void 0,(function(){var r,h,p,d,m,g,v=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze2()"),r=this._getActiveTiles(),this.options.glOperation!==e||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.filterLowA!==a||this.options.filterHighA!==l||this.options.filterLowB!==s||this.options.filterHighB!==u||this.options.multiplierA!==f||this.options.multiplierB!==c||this.options.multiLayers!==t?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze2: all same urls. Fetching from existing tiles. Running renderTiles()"),h=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),this._renderer.renderTiles(h,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,t){var n=e[0],o=e[1],i=r[t];v._copyToTileCanvas(i.el,n,o)})),[3,8]);case 1:return p=[],d=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return p=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=p[t].pixelData})),[3,4];case 3:p=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataA}})),o.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return d=o.sent(),r.forEach((function(e,t){e.el.pixelDataB=d[t].pixelData})),[3,7];case 6:d=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataB}})),o.label=7;case 7:m=function(e){e.forEach((function(e,t){var n=e[0],o=e[1],i=r[t];v._copyToTileCanvas(i.el,n,o)}))},g=this._renderer.renderTilesWithMultiAnalyze2(p,d,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.multiplierA,this.options.multiplierB,m),r.forEach((function(e,t){e.el.pixelData=g[t]})),o.label=8;case 8:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze3=function(e,t,n,i,a,l,s,u,f,c,h,p,d,m){return r(this,void 0,void 0,(function(){var r,g,v,b,x,y,_,w=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze3()"),r=this._getActiveTiles(),this.options.glOperation!==e||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.filterLowA!==l||this.options.filterHighA!==s||this.options.filterLowB!==u||this.options.filterHighB!==f||this.options.filterLowC!==c||this.options.filterHighC!==h||this.options.multiplierA!==p||this.options.multiplierB!==d||this.options.multiplierC!==m||this.options.multiLayers!==t?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze3: all same urls. Fetching from existing tiles. Running renderTiles()"),g=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),this._renderer.renderTiles(g,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,t){var n=e[0],o=e[1],i=r[t];w._copyToTileCanvas(i.el,n,o)})),[3,11]);case 1:return v=[],b=[],x=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return v=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=v[t].pixelData})),[3,4];case 3:v=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataA}})),o.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return b=o.sent(),r.forEach((function(e,t){e.el.pixelDataB=b[t].pixelData})),[3,7];case 6:b=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataB}})),o.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return x=o.sent(),r.forEach((function(e,t){e.el.pixelDataC=x[t].pixelData})),[3,10];case 9:x=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataC}})),o.label=10;case 10:y=function(e){e.forEach((function(e,t){var n=e[0],o=e[1],i=r[t];w._copyToTileCanvas(i.el,n,o)}))},_=this._renderer.renderTilesWithMultiAnalyze3(v,b,x,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,y),r.forEach((function(e,t){e.el.pixelData=_[t]})),o.label=11;case 11:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze4=function(e,t,n,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x){return r(this,void 0,void 0,(function(){var r,y,_,w,C,A,T,E,D=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze4()"),r=this._getActiveTiles(),this.options.glOperation!==e||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.filterLowA!==s||this.options.filterHighA!==u||this.options.filterLowB!==f||this.options.filterHighB!==c||this.options.filterLowC!==h||this.options.filterHighC!==p||this.options.filterLowD!==d||this.options.filterHighD!==m||this.options.multiplierA!==g||this.options.multiplierB!==v||this.options.multiplierC!==b||this.options.multiplierD!==x||this.options.multiLayers!==t?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze4: all same urls. Fetching from existing tiles. Running renderTiles()"),y=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),this._renderer.renderTiles(y,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,t){var n=e[0],o=e[1],i=r[t];D._copyToTileCanvas(i.el,n,o)})),[3,14]);case 1:return _=[],w=[],C=[],A=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return _=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=_[t].pixelData})),[3,4];case 3:_=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataA}})),o.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return w=o.sent(),r.forEach((function(e,t){e.el.pixelDataB=w[t].pixelData})),[3,7];case 6:w=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataB}})),o.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return C=o.sent(),r.forEach((function(e,t){e.el.pixelDataC=C[t].pixelData})),[3,10];case 9:C=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataC}})),o.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(r,this.options.operationUrlD)];case 11:return A=o.sent(),r.forEach((function(e,t){e.el.pixelDataD=A[t].pixelData})),[3,13];case 12:A=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataD}})),o.label=13;case 13:T=function(e){e.forEach((function(e,t){var n=e[0],o=e[1],i=r[t];D._copyToTileCanvas(i.el,n,o)}))},E=this._renderer.renderTilesWithMultiAnalyze4(_,w,C,A,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,T),r.forEach((function(e,t){e.el.pixelData=E[t]})),o.label=14;case 14:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze5=function(e,t,n,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y,_,w,C){return r(this,void 0,void 0,(function(){var r,A,T,E,D,L,S,F,B,k=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze5()"),r=this._getActiveTiles(),this.options.glOperation!==e||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.operationUrlE!==s||this.options.filterLowA!==u||this.options.filterHighA!==f||this.options.filterLowB!==c||this.options.filterHighB!==h||this.options.filterLowC!==p||this.options.filterHighC!==d||this.options.filterLowD!==m||this.options.filterHighD!==g||this.options.filterLowE!==v||this.options.filterHighE!==b||this.options.multiplierA!==x||this.options.multiplierB!==y||this.options.multiplierC!==_||this.options.multiplierD!==w||this.options.multiplierE!==C||this.options.multiLayers!==t?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze5: all same urls. Fetching from existing tiles. Running renderTiles()"),A=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),this._renderer.renderTiles(A,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,t){var n=e[0],o=e[1],i=r[t];k._copyToTileCanvas(i.el,n,o)})),[3,17]);case 1:return T=[],E=[],D=[],L=[],S=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return T=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=T[t].pixelData})),[3,4];case 3:T=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataA}})),o.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return E=o.sent(),r.forEach((function(e,t){e.el.pixelDataB=E[t].pixelData})),[3,7];case 6:E=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataB}})),o.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return D=o.sent(),r.forEach((function(e,t){e.el.pixelDataC=D[t].pixelData})),[3,10];case 9:D=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataC}})),o.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(r,this.options.operationUrlD)];case 11:return L=o.sent(),r.forEach((function(e,t){e.el.pixelDataD=L[t].pixelData})),[3,13];case 12:L=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataD}})),o.label=13;case 13:return this.options.operationUrlE===s?[3,15]:[4,this._getTilesData(r,this.options.operationUrlE)];case 14:return S=o.sent(),r.forEach((function(e,t){e.el.pixelDataE=S[t].pixelData})),[3,16];case 15:S=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataE}})),o.label=16;case 16:F=function(e){e.forEach((function(e,t){var n=e[0],o=e[1],i=r[t];k._copyToTileCanvas(i.el,n,o)}))},B=this._renderer.renderTilesWithMultiAnalyze5(T,E,D,L,S,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.filterLowE,this.options.filterHighE,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,this.options.multiplierE,F),r.forEach((function(e,t){e.el.pixelData=B[t]})),o.label=17;case 17:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze6=function(e,t,n,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y,_,w,C,A,T,E,D){return r(this,void 0,void 0,(function(){var r,L,S,F,B,k,M,O,I,R,N=this;return o(this,(function(o){switch(o.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze6()"),r=this._getActiveTiles(),this.options.glOperation!==e||this.options.operationUrlA!==n||this.options.operationUrlB!==i||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.operationUrlE!==s||this.options.operationUrlF!==u||this.options.filterLowA!==f||this.options.filterHighA!==c||this.options.filterLowB!==h||this.options.filterHighB!==p||this.options.filterLowC!==d||this.options.filterHighC!==m||this.options.filterLowD!==g||this.options.filterHighD!==v||this.options.filterLowE!==b||this.options.filterHighE!==x||this.options.filterLowF!==y||this.options.filterHighF!==_||this.options.multiplierA!==w||this.options.multiplierB!==C||this.options.multiplierC!==A||this.options.multiplierD!==T||this.options.multiplierE!==E||this.options.multiplierF!==D||this.options.multiLayers!==t?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze6: all same urls. Fetching from existing tiles. Running renderTiles()"),L=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelData}})),this._renderer.renderTiles(L,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,t){var n=e[0],o=e[1],i=r[t];N._copyToTileCanvas(i.el,n,o)})),[3,20]);case 1:return S=[],F=[],B=[],k=[],M=[],O=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return S=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=S[t].pixelData})),[3,4];case 3:S=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataA}})),o.label=4;case 4:return this.options.operationUrlB===i?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return F=o.sent(),r.forEach((function(e,t){e.el.pixelDataB=F[t].pixelData})),[3,7];case 6:F=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataB}})),o.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return B=o.sent(),r.forEach((function(e,t){e.el.pixelDataC=B[t].pixelData})),[3,10];case 9:B=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataC}})),o.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(r,this.options.operationUrlD)];case 11:return k=o.sent(),r.forEach((function(e,t){e.el.pixelDataD=k[t].pixelData})),[3,13];case 12:k=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataD}})),o.label=13;case 13:return this.options.operationUrlE===s?[3,15]:[4,this._getTilesData(r,this.options.operationUrlE)];case 14:return M=o.sent(),r.forEach((function(e,t){e.el.pixelDataE=M[t].pixelData})),[3,16];case 15:M=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataE}})),o.label=16;case 16:return this.options.operationUrlF===u?[3,18]:[4,this._getTilesData(r,this.options.operationUrlF)];case 17:return O=o.sent(),r.forEach((function(e,t){e.el.pixelDataF=O[t].pixelData})),[3,19];case 18:O=r.map((function(e){return{coords:e.coords,pixelData:e.el.pixelDataF}})),o.label=19;case 19:I=function(e){e.forEach((function(e,t){var n=e[0],o=e[1],i=r[t];N._copyToTileCanvas(i.el,n,o)}))},R=this._renderer.renderTilesWithMultiAnalyze6(S,F,B,k,M,O,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.filterLowE,this.options.filterHighE,this.options.filterLowF,this.options.filterHighF,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,this.options.multiplierE,this.options.multiplierF,I),r.forEach((function(e,t){e.el.pixelData=R[t]})),o.label=20;case 20:return[2]}}))}))},a.prototype._maybePreload=function(e){!e||this._preloadTileCache&&this._preloadTileCache.url===e||this._preloadTiles(e)},a.prototype._maybeLoadExtraLayers=function(e,t,n,i){return r(this,void 0,void 0,(function(){var r,a,l,s,u;return o(this,(function(o){switch(o.label){case 0:return r=[],this.options.extraPixelLayers>=1?(r=this._getActiveTiles(),e===this.options.operationUrlA?[3,2]:[4,this._getTilesData(r,this.options.operationUrlA)]):[3,2];case 1:a=o.sent(),r.forEach((function(e,t){e.el.pixelDataA=a[t].pixelData})),o.label=2;case 2:return this.options.extraPixelLayers>=2?t===this.options.operationUrlB?[3,4]:[4,this._getTilesData(r,this.options.operationUrlB)]:[3,4];case 3:l=o.sent(),r.forEach((function(e,t){e.el.pixelDataB=l[t].pixelData})),o.label=4;case 4:return this.options.extraPixelLayers>=3?n===this.options.operationUrlC?[3,6]:[4,this._getTilesData(r,this.options.operationUrlC)]:[3,6];case 5:s=o.sent(),r.forEach((function(e,t){e.el.pixelDataC=s[t].pixelData})),o.label=6;case 6:return this.options.extraPixelLayers>=4?i===this.options.operationUrlD?[3,8]:[4,this._getTilesData(r,this.options.operationUrlD)]:[3,8];case 7:u=o.sent(),r.forEach((function(e,t){e.el.pixelDataD=u[t].pixelData})),o.label=8;case 8:return[2]}}))}))},a.prototype._preloadTiles=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return t=this._getActiveTiles(),[4,this._fetchTilesData(t,e)];case 1:return n=r.sent(),this._preloadTileCache={url:e,tiles:n},[2]}}))}))},a.prototype._getActiveTiles=function(){return this.options.debug&&console.log("_getActiveTiles()"),this._pruneTiles(),hn(this._tiles).sort((function(e,t){return ri(e.coords,t.coords)}))},a.prototype._getTilesData=function(e,t){return void 0===t&&(t=this.options.url),r(this,void 0,void 0,(function(){var n;return o(this,(function(r){return this.options.debug&&console.log("_getTilesData() with url: "+t),(n=this._preloadTileCache)&&t===n.url&&(o=n.tiles.map((function(e){return e.coords})),i=e.map((function(e){return e.coords})),o.length===i.length&&o.every((function(e,t){return 0===ri(e,i[t])})))?(this._preloadTileCache=void 0,[2,Promise.resolve(n.tiles)]):[2,this._fetchTilesData(e,t)];var o,i}))}))},a.prototype._fetchTilesData=function(e,t){return r(this,void 0,void 0,(function(){var n,r=this;return o(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e.map((function(e){var n=e.coords;return r._fetchTileData(n,t)})))];case 1:return n=o.sent(),this.options.debug&&console.log("_fetchTilesData() with url:"+t),this.fire("load",{url:t}),[2,bn(e,n,(function(e,t){return{coords:e.coords,pixelData:t}}))]}}))}))},a.prototype._fetchTileData=function(e,t,n){return void 0===n&&(n=this.options.tileFormat),r(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return"float32"!==n&&"image"!==n?[3,1]:[2,Qo(this.getTileUrl(e,t),this.options.nodataValue,this._tileSizeAsNumber())];case 1:return"dem"!==n?[3,3]:(r=oi(this.options.nodataValue,this._tileSizeAsNumber()),[4,Qo(this.getTileUrl(e,t),this.options.nodataValue,this._tileSizeAsNumber())]);case 2:return Jo(i=o.sent(),r)?[2,i]:[2,this._renderer.renderConvertDem(i)];case 3:return[2,oi(this.options.nodataValue,this._tileSizeAsNumber())]}}))}))},a.prototype._tileSizeAsNumber=function(){var e=this.options.tileSize;return"number"==typeof e?e:e.x},a.prototype._copyToTileCanvas=function(e,t,n){var r=this._tileSizeAsNumber(),o=e.getContext("2d");if(null===o)throw new Error("Tile canvas 2D context is null.");o.clearRect(0,0,r,r),o.drawImage(this._renderer.canvas,t,n,r,r,0,0,r,r)},a.prototype._getActivetilesBounds=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i;return o(this,(function(o){return e=this._getActiveTiles(),t=e[0].coords.x,n=e[0].coords.x,r=e[0].coords.y,i=e[0].coords.y,e.forEach((function(e){e.coords.x>n&&(n=e.coords.x),e.coords.x<t&&(t=e.coords.x),e.coords.y>i&&(i=e.coords.y),e.coords.y<r&&(r=e.coords.y)})),[2,{xMin:t,xMax:n,yMin:r,yMax:i,xTiles:n-t+1,yTiles:i-r+1}]}))}))},a.prototype._mergePixelData=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,a,l,s,u,f,c,h,p,d,m,g,v,b,x,y;return o(this,(function(o){for(this.options.debug&&console.log("_mergePixelData()"),n=this._tileZoom,r=document.createElement("canvas"),this._contourData.width=e.xTiles*t,this._contourData.height=e.yTiles*t,r.width=this._contourData.width,r.height=this._contourData.height,i=r.getContext("2d"),a=oi(this.options.nodataValue,t),l=0;l<=e.xTiles;l++)for(s=e.xMin+l,u=0;u<=e.yTiles;u++){f=e.yMin+u,c=void 0;try{h=this._tiles[s+":"+f+":"+n].el,c=h.pixelData}catch(e){c=a}p=new Uint8ClampedArray(c),d=new Uint8ClampedArray(p.buffer,0,4*t*t),m=new ImageData(d,t,t),i.putImageData(m,l*t,u*t)}return g=i.getImageData(0,0,e.xTiles*t,e.yTiles*t),v=(v=new Float32Array(g.data.buffer)).map((function(e){return e<-9e5&&(e=NaN),e}),this),b=Array.from(v),x=function(e){return e.reduce((function(e,t){return(isNaN(e)?0:e)+(isNaN(t)?0:t)}),0)},this.options.debug&&(console.log("sum mergedPixelArray"),console.log(x(b))),this.options.contourCanvas?((y=this.options.contourCanvas).width=this._contourData.width,y.height=this._contourData.height,this._contourData.mergedTileArray=b,this._contourData.smoothedTileArray=void 0,[2]):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._maybeUpdateMergedArrayAndDrawContours=function(){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return"none"===this.options.contourType?[2]:(this._map.fire("contourDrawing",{status:!0}),this.options.debug&&console.log("_maybeUpdateMergedArrayAndDrawContours()"),[4,this._clearContours()]);case 1:return t.sent(),fi(50).then((function(){return r(e,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return[4,this._getActivetilesBounds()];case 1:return e=n.sent(),t=this._tileSizeAsNumber(),[4,this._mergePixelData(e,t)];case 2:return n.sent(),this.options.contourSmoothInput&&this._smoothContourInput(),[4,this._calculateAndDrawContours()];case 3:return n.sent(),[4,this._moveContourCanvas(e)];case 4:return n.sent(),[2]}}))}))})),[2]}}))}))},a.prototype._smoothContourInput=function(){this.options.debug&&console.log("_smoothContourInput()");for(var e=this._contourData.mergedTileArray.map((function(e){return isNaN(e)&&(e=this.options.nodataValue),e}),this),t=new Uint8Array(Float32Array.from(e).buffer),n=this._renderer.renderConvolutionSmooth(t,this._contourData.width,this._contourData.height,this.options.contourSmoothInputKernel),r=[],o=0;o<n.length;o+=1){var i=n[o];i===this.options.nodataValue&&(i=NaN),r.push(i)}this._contourData.smoothedTileArray=r},a.prototype._calculateAndDrawContours=function(){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return"none"===this.options.contourType?[2]:(this._map.fire("contourDrawing",{status:!0}),this.options.debug&&console.log("_calculateAndDrawContours()"),[4,this._clearContours()]);case 1:return t.sent(),this._calculateContours(),setTimeout((function(){e._drawContours()}),50),[2]}}))}))},a.prototype._addlabel=function(e,t,n,r){e.save(),e.translate(t.xy[0],t.xy[1]),e.rotate(t.angle+(Math.cos(t.angle)<0?Math.PI:0)),e.textAlign="center",e.fillStyle=n,e.font=r,e.fillText(t.text,-1,4),e.restore()},a.prototype._calculateContours=function(){var e,t=this;this.options.debug&&console.log("_calculateContours()"),e=this.options.contourSmoothInput?this._contourData.smoothedTileArray:this._contourData.mergedTileArray,1!==this.options.contourScaleFactor&&(e=e.map((function(e){return e*t.options.contourScaleFactor}))),this.options.debug&&(console.log("valuesArray"),console.log(e));var n=jf.max(e,(function(e){return e!==t.options.nodataValue?e:NaN})),r=jf.min(e,(function(e){return e!==t.options.nodataValue?e:NaN}));n=Math.ceil(n/this.options.contourInterval)*this.options.contourInterval,r=Math.floor(r/this.options.contourInterval)*this.options.contourInterval,this.options.debug&&(console.log("Contours: max"),console.log(n)),this.options.debug&&(console.log("Contours: min"),console.log(r));for(var o=[],i=r;i<=n;i+=this.options.contourInterval)o.push(i);this.options.debug&&(console.log("Contour thresholds"),console.log(o));var a=jf.contours().size([this._contourData.width,this._contourData.height]);a.thresholds(o),a.smooth(this.options.contourSmoothLines);var l=a(e);this._contourData.contoursGeoData=l,this.options.debug&&(console.log("contoursGeoData"),console.log(l))},a.prototype._clearContours=function(){return r(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){return this.options.debug&&console.log("_clearContours()"),this.options.contourCanvas?(e=this.options.contourCanvas,(t=e.getContext("2d")).setTransform(1,0,0,1,0,0),t.clearRect(0,0,this._contourData.width,this._contourData.height),t.beginPath(),[2]):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._moveContourCanvas=function(t){return r(this,void 0,void 0,(function(){var n,r,i,a,l,s;return o(this,(function(o){return this.options.debug&&console.log("_moveContourCanvas()"),this.options.contourCanvas?(n=this.options.contourCanvas,this.options.contourPane?(r=this.options.contourPane,i=this._map.getZoomScale(this._map.getZoom(),this._level.zoom),a=this._map.getPixelOrigin(),l=this._level.origin.multiplyBy(i).subtract(a),s=this._getTilePos(this._keyToTileCoords(t.xMin+":"+t.yMin+":"+this._level.zoom)),e.DomUtil.setTransform(r,l,i),e.DomUtil.setTransform(n,s),[2]):(console.log("Error: contourPane not specified."),[2])):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._drawContours=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,a,l,s,u,f,c,h,p,d,m,g,v=this;return o(this,(function(o){if(this.options.debug&&console.log("_drawContours()"),e=this._contourData.width,t=this._contourData.height,!this.options.contourCanvas)return console.log("Error: contourCanvas not specified."),[2];if(n=this.options.contourCanvas,r=n.getContext("2d"),i=jf.geoPath().context(r),a=jf.scaleLinear().domain(this.options.contourBathyDomain).range(this.options.contourBathyColors),l=jf.scaleLinear().domain(this.options.contourHypsoDomain).range(this.options.contourHypsoColors).interpolate(jf.interpolateHcl),s=this._contourData.contoursGeoData,u=this.options.contourIndexInterval,f=this.options.contourBathyDomain[this.options.contourBathyDomain.length-1],r.clearRect(0,0,e,t),r.save(),"lines"===this.options.contourType){if(r.lineWidth=this.options.contourLineWeight,r.strokeStyle=this.options.contourLineColor,this.options.contourHypso||this.options.contourBathy?s.forEach((function(e){var t;r.beginPath(),e.value>=f||!this.options.contourBathy?this.options.contourHypso&&(t=l(e.value)):this.options.contourBathy&&(t=a(e.value)),i(e),t&&(r.fillStyle=t,r.fill()),r.stroke()}),this):(r.beginPath(),s.forEach((function(e){0!==u&&e.value%u==0||i(e)})),r.stroke()),0!==this.options.contourIndexInterval)if(this.options.contourIndexLabels)for(c=[],h=function(n){var o=n.value;n.value%p.options.contourIndexInterval==0&&n.coordinates.forEach((function(r){return r.forEach((function(r,i){var a=r.slice(1,1/0),l=jf.range(v.options.contourLabelDistance,1.4*v.options.contourLabelDistance),s=l.map((function(e){return-(a.length-1)%e})),u=l[jf.scan(s)],f=1+jf.scan(a.map((function(e){return(0===i?-1:1)*e[1]})))%u;a.forEach((function(r,i){if(i%u===f&&r[0]>10&&r[0]<e-10&&r[1]>10&&r[1]<t-10){var l=(i-2+a.length)%a.length,s=(i+2)%a.length,h=a[s][0]-a[l][0],p=a[s][1]-a[l][1];if(0===h&&0===p)return;c.push({threshold:o,xy:r.map((function(e){return 1*e})),angle:Math.atan2(p,h),text:""+n.value})}}))}),v)}),p),r.save(),r.beginPath(),r.moveTo(0,0),r.lineTo(e,0),r.lineTo(e,t),r.lineTo(0,t),r.lineTo(0,0);for(var a=0,l=c;a<l.length;a++)for(var s=l[a],u=0;u<2*Math.PI;u+=.2){var f=[20*Math.cos(u),10*-Math.sin(u)],h=Math.cos(s.angle),d=Math.sin(s.angle);r[0===u?"moveTo":"lineTo"](s.xy[0]+f[0]*h-f[1]*d,s.xy[1]+f[1]*h+f[0]*d)}r.clip(),n.value%p.options.contourIndexInterval==0&&(r.beginPath(),r.strokeStyle=p.options.contourLineColor,r.lineWidth=p.options.contourLineIndexWeight,i(n),r.stroke()),r.restore();for(var m=0,g=c;m<g.length;m++){s=g[m];p._addlabel(r,s,p.options.contourLineColor,p.options.contourLabelFont)}},p=this,d=0,m=s;d<m.length;d++)g=m[d],h(g);else r.lineWidth=this.options.contourLineIndexWeight,r.beginPath(),s.forEach((function(e){e.value%u==0&&i(e)})),r.stroke()}else"illuminated"===this.options.contourType&&(r.lineWidth=this.options.contourIlluminatedShadowSize+1,r.shadowBlur=this.options.contourIlluminatedShadowSize,r.shadowOffsetX=this.options.contourIlluminatedShadowSize,r.shadowOffsetY=this.options.contourIlluminatedShadowSize,s.forEach((function(e){r.beginPath(),e.value>=f||!this.options.contourBathy?(r.shadowColor=this.options.contourIlluminatedShadowColor,r.strokeStyle=this.options.contourIlluminatedHighlightColor,this.options.contourHypso&&(r.fillStyle=l(e.value))):(r.shadowColor=this.options.contourBathyShadowColor,r.strokeStyle=this.options.contourBathyHighlightColor,this.options.contourBathy&&(r.fillStyle=a(e.value))),i(e),r.stroke(),(this.options.contourHypso||this.options.contourBathy)&&r.fill()}),this));return r.restore(),this._map.fire("contourDrawing",{status:!1}),[2]}))}))},a.prototype._wrapMouseEventHandler=function(e){var t=this;return function(r){var o,i=r.latlng,a=t._map.project(i,t._tileZoom).floor(),l=t._getTileContainingPoint(a),s=l&&t._getCoordsInTile(l,a);void 0!==s&&(o=4*(s.y*t._tileSizeAsNumber()+s.x));var u={};if(void 0===o)u.pixelValue=void 0;else{var f=l.el.pixelData;u.pixelValue=s&&t._getPixelValue(f,o)}if(void 0!==o&&t.options.extraPixelLayers>=1){var c=l.el.pixelDataA;u.pixelValueA=s&&t._getPixelValue(c,o)}if(void 0!==o&&t.options.extraPixelLayers>=2){var h=l.el.pixelDataB;u.pixelValueB=s&&t._getPixelValue(h,o)}if(void 0!==o&&t.options.extraPixelLayers>=3){var p=l.el.pixelDataC;u.pixelValueC=s&&t._getPixelValue(p,o)}if(void 0!==o&&t.options.extraPixelLayers>=4){var d=l.el.pixelDataD;u.pixelValueD=s&&t._getPixelValue(d,o)}if(void 0!==o&&t.options.extraPixelLayers>=5){var m=l.el.pixelDataE;u.pixelValueE=s&&t._getPixelValue(m,o)}if(void 0!==o&&t.options.extraPixelLayers>=6){var g=l.el.pixelDataF;u.pixelValueF=s&&t._getPixelValue(g,o)}e(n(n({},r),{pixelValues:u}))}},a.prototype._getTileContainingPoint=function(e){var t=this;return hn(this._tiles).find((function(n){return n.coords.z===t._tileZoom&&t._tileBounds(n).contains(e)}))},a.prototype._tileBounds=function(t){var n=t.coords,r=n.x,o=n.y,i=this._tileSizeAsNumber(),a=e.point(r*i,o*i),l=e.point(a.x+(i-1),a.y+(i-1));return e.bounds(a,l)},a.prototype._getCoordsInTile=function(t,n){var r=t.coords,o=r.x,i=r.y,a=this._tileSizeAsNumber();return e.point(n.x-o*a,n.y-i*a)},a.prototype._getPixelValue=function(e,t){if(e){var n=this.options,r=n.nodataValue,o=n.sentinelValues,i=new DataView(e.buffer).getFloat32(t,Gf);if(i!==r)return o&&o.find((function(e){return e.offset===i}))||i}},a.prototype._getPixelScale=function(){var e=1,t=this._getZoomForUrl();return"auto"===this.options.hsAdvPixelScale?e=40075016.686*Math.abs(Math.cos(this._map.getCenter().lat/180*Math.PI))/Math.pow(2,t+8):"number"==typeof this.options.hsAdvPixelScale&&(e=this.options.hsAdvPixelScale/(this._tileSizeAsNumber()*Math.pow(2,t))),e},a.defaultOptions=qf,a}(e.GridLayer)}(L);
//# sourceMappingURL=bundle.min.js.map
