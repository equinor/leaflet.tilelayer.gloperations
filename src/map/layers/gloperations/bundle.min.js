this.L=this.L||{},this.L.TileLayer=this.L.TileLayer||{},this.L.TileLayer.GLOperations=function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};var n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function l(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}s((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}var o="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,l=o||a||Function("return this")(),s=l.Symbol,u=Object.prototype,f=u.hasOwnProperty,c=u.toString,d=s?s.toStringTag:void 0;var h=Object.prototype.toString;var p=s?s.toStringTag:void 0;function g(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":p&&p in Object(t)?function(t){var e=f.call(t,d),n=t[d];try{t[d]=void 0;var r=!0}catch(t){}var i=c.call(t);return r&&(e?t[d]=n:delete t[d]),i}(t):function(t){return h.call(t)}(t)}function b(t){return null!=t&&"object"==typeof t}function m(t){return"symbol"==typeof t||b(t)&&"[object Symbol]"==g(t)}function x(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var v=Array.isArray,y=s?s.prototype:void 0,_=y?y.toString:void 0;function w(t){if("string"==typeof t)return t;if(v(t))return x(t,w)+"";if(m(t))return _?_.call(t):"";var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}function A(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var T=/^\s+|\s+$/g,E=/^[-+]0x[0-9a-f]+$/i,C=/^0b[01]+$/i,B=/^0o[0-7]+$/i,S=parseInt;var L=1/0;function D(t){return t?(t=function(t){if("number"==typeof t)return t;if(m(t))return NaN;if(A(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=A(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(T,"");var n=C.test(t);return n||B.test(t)?S(t.slice(2),n?2:8):E.test(t)?NaN:+t}(t))===L||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function I(t){return t}function F(t){if(!A(t))return!1;var e=g(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var k,N=l["__core-js_shared__"],M=(k=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+k:"";var R=Function.prototype.toString;function O(t){if(null!=t){try{return R.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var H=/^\[object .+?Constructor\]$/,V=Function.prototype,z=Object.prototype,P=V.toString,U=z.hasOwnProperty,G=RegExp("^"+P.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function j(t){return!(!A(t)||(e=t,M&&M in e))&&(F(t)?G:H).test(O(t));var e}function X(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return j(n)?n:void 0}var W=X(l,"WeakMap");function q(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Z(){}var Y=Date.now;var $=function(){try{var t=X(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),K=function(t){var e=0,n=0;return function(){var r=Y(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}($?function(t,e){return $(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:I),Q=/^(?:0|[1-9]\d*)$/;function J(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Q.test(t))&&t>-1&&t%1==0&&t<e}function tt(t,e,n){"__proto__"==e&&$?$(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function et(t,e){return t===e||t!=t&&e!=e}var nt=Object.prototype.hasOwnProperty;function rt(t,e,n){var r=t[e];nt.call(t,e)&&et(r,n)&&(void 0!==n||e in t)||tt(t,e,n)}var it=Math.max;function ot(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function at(t){return null!=t&&ot(t.length)&&!F(t)}var lt=Object.prototype;function st(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||lt)}function ut(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function ft(t){return b(t)&&"[object Arguments]"==g(t)}var ct=Object.prototype,dt=ct.hasOwnProperty,ht=ct.propertyIsEnumerable,pt=ft(function(){return arguments}())?ft:function(t){return b(t)&&dt.call(t,"callee")&&!ht.call(t,"callee")};var gt="object"==typeof exports&&exports&&!exports.nodeType&&exports,bt=gt&&"object"==typeof module&&module&&!module.nodeType&&module,mt=bt&&bt.exports===gt?l.Buffer:void 0,xt=(mt?mt.isBuffer:void 0)||function(){return!1},vt={};vt["[object Float32Array]"]=vt["[object Float64Array]"]=vt["[object Int8Array]"]=vt["[object Int16Array]"]=vt["[object Int32Array]"]=vt["[object Uint8Array]"]=vt["[object Uint8ClampedArray]"]=vt["[object Uint16Array]"]=vt["[object Uint32Array]"]=!0,vt["[object Arguments]"]=vt["[object Array]"]=vt["[object ArrayBuffer]"]=vt["[object Boolean]"]=vt["[object DataView]"]=vt["[object Date]"]=vt["[object Error]"]=vt["[object Function]"]=vt["[object Map]"]=vt["[object Number]"]=vt["[object Object]"]=vt["[object RegExp]"]=vt["[object Set]"]=vt["[object String]"]=vt["[object WeakMap]"]=!1;var yt,_t="object"==typeof exports&&exports&&!exports.nodeType&&exports,wt=_t&&"object"==typeof module&&module&&!module.nodeType&&module,At=wt&&wt.exports===_t&&o.process,Tt=function(){try{var t=wt&&wt.require&&wt.require("util").types;return t||At&&At.binding&&At.binding("util")}catch(t){}}(),Et=Tt&&Tt.isTypedArray,Ct=Et?(yt=Et,function(t){return yt(t)}):function(t){return b(t)&&ot(t.length)&&!!vt[g(t)]},Bt=Object.prototype.hasOwnProperty;function St(t,e){var n=v(t),r=!n&&pt(t),i=!n&&!r&&xt(t),o=!n&&!r&&!i&&Ct(t),a=n||r||i||o,l=a?ut(t.length,String):[],s=l.length;for(var u in t)!e&&!Bt.call(t,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||J(u,s))||l.push(u);return l}function Lt(t,e){return function(n){return t(e(n))}}var Dt=Lt(Object.keys,Object),It=Object.prototype.hasOwnProperty;function Ft(t){if(!st(t))return Dt(t);var e=[];for(var n in Object(t))It.call(t,n)&&"constructor"!=n&&e.push(n);return e}function kt(t){return at(t)?St(t):Ft(t)}var Nt=Object.prototype.hasOwnProperty;function Mt(t){if(!A(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=st(t),n=[];for(var r in t)("constructor"!=r||!e&&Nt.call(t,r))&&n.push(r);return n}function Rt(t){return at(t)?St(t,!0):Mt(t)}var Ot=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ht=/^\w*$/;function Vt(t,e){if(v(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!m(t))||(Ht.test(t)||!Ot.test(t)||null!=e&&t in Object(e))}var zt=X(Object,"create");var Pt=Object.prototype.hasOwnProperty;var Ut=Object.prototype.hasOwnProperty;function Gt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function jt(t,e){for(var n=t.length;n--;)if(et(t[n][0],e))return n;return-1}Gt.prototype.clear=function(){this.__data__=zt?zt(null):{},this.size=0},Gt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Gt.prototype.get=function(t){var e=this.__data__;if(zt){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return Pt.call(e,t)?e[t]:void 0},Gt.prototype.has=function(t){var e=this.__data__;return zt?void 0!==e[t]:Ut.call(e,t)},Gt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=zt&&void 0===e?"__lodash_hash_undefined__":e,this};var Xt=Array.prototype.splice;function Wt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Wt.prototype.clear=function(){this.__data__=[],this.size=0},Wt.prototype.delete=function(t){var e=this.__data__,n=jt(e,t);return!(n<0)&&(n==e.length-1?e.pop():Xt.call(e,n,1),--this.size,!0)},Wt.prototype.get=function(t){var e=this.__data__,n=jt(e,t);return n<0?void 0:e[n][1]},Wt.prototype.has=function(t){return jt(this.__data__,t)>-1},Wt.prototype.set=function(t,e){var n=this.__data__,r=jt(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var qt=X(l,"Map");function Zt(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function Yt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Yt.prototype.clear=function(){this.size=0,this.__data__={hash:new Gt,map:new(qt||Wt),string:new Gt}},Yt.prototype.delete=function(t){var e=Zt(this,t).delete(t);return this.size-=e?1:0,e},Yt.prototype.get=function(t){return Zt(this,t).get(t)},Yt.prototype.has=function(t){return Zt(this,t).has(t)},Yt.prototype.set=function(t,e){var n=Zt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function $t(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new($t.Cache||Yt),n}$t.Cache=Yt;var Kt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qt=/\\(\\)?/g,Jt=function(t){var e=$t(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Kt,(function(t,n,r,i){e.push(r?i.replace(Qt,"$1"):n||t)})),e}));function te(t,e){return v(t)?t:Vt(t,e)?[t]:Jt(function(t){return null==t?"":w(t)}(t))}function ee(t){if("string"==typeof t||m(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}function ne(t,e){for(var n=0,r=(e=te(e,t)).length;null!=t&&n<r;)t=t[ee(e[n++])];return n&&n==r?t:void 0}function re(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var ie=s?s.isConcatSpreadable:void 0;function oe(t){return v(t)||pt(t)||!!(ie&&t&&t[ie])}var ae=Lt(Object.getPrototypeOf,Object);function le(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}var se=Math.ceil,ue=Math.max;function fe(t,e,n){e=(n?function(t,e,n){if(!A(n))return!1;var r=typeof e;return!!("number"==r?at(n)&&J(e,n.length):"string"==r&&e in n)&&et(n[e],t)}(t,e,n):void 0===e)?1:ue(function(t){var e=D(t),n=e%1;return e==e?n?e-n:e:0}(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var i=0,o=0,a=Array(se(r/e));i<r;)a[o++]=le(t,i,i+=e);return a}function ce(t){var e=this.__data__=new Wt(t);this.size=e.size}function de(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function he(){return[]}ce.prototype.clear=function(){this.__data__=new Wt,this.size=0},ce.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ce.prototype.get=function(t){return this.__data__.get(t)},ce.prototype.has=function(t){return this.__data__.has(t)},ce.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Wt){var r=n.__data__;if(!qt||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Yt(r)}return n.set(t,e),this.size=n.size,this};var pe=Object.prototype.propertyIsEnumerable,ge=Object.getOwnPropertySymbols,be=ge?function(t){return null==t?[]:(t=Object(t),de(ge(t),(function(e){return pe.call(t,e)})))}:he,me=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)re(e,be(t)),t=ae(t);return e}:he;function xe(t,e,n){var r=e(t);return v(t)?r:re(r,n(t))}function ve(t){return xe(t,kt,be)}var ye=X(l,"DataView"),_e=X(l,"Promise"),we=X(l,"Set"),Ae="[object Map]",Te="[object Promise]",Ee="[object Set]",Ce="[object WeakMap]",Be="[object DataView]",Se=O(ye),Le=O(qt),De=O(_e),Ie=O(we),Fe=O(W),ke=g;(ye&&ke(new ye(new ArrayBuffer(1)))!=Be||qt&&ke(new qt)!=Ae||_e&&ke(_e.resolve())!=Te||we&&ke(new we)!=Ee||W&&ke(new W)!=Ce)&&(ke=function(t){var e=g(t),n="[object Object]"==e?t.constructor:void 0,r=n?O(n):"";if(r)switch(r){case Se:return Be;case Le:return Ae;case De:return Te;case Ie:return Ee;case Fe:return Ce}return e});var Ne=ke,Me=l.Uint8Array;function Re(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Yt;++e<n;)this.add(t[e])}function Oe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}Re.prototype.add=Re.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Re.prototype.has=function(t){return this.__data__.has(t)};function He(t,e,n,r,i,o){var a=1&n,l=t.length,s=e.length;if(l!=s&&!(a&&s>l))return!1;var u=o.get(t);if(u&&o.get(e))return u==e;var f=-1,c=!0,d=2&n?new Re:void 0;for(o.set(t,e),o.set(e,t);++f<l;){var h=t[f],p=e[f];if(r)var g=a?r(p,h,f,e,t,o):r(h,p,f,t,e,o);if(void 0!==g){if(g)continue;c=!1;break}if(d){if(!Oe(e,(function(t,e){if(a=e,!d.has(a)&&(h===t||i(h,t,n,r,o)))return d.push(e);var a}))){c=!1;break}}else if(h!==p&&!i(h,p,n,r,o)){c=!1;break}}return o.delete(t),o.delete(e),c}function Ve(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function ze(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var Pe=s?s.prototype:void 0,Ue=Pe?Pe.valueOf:void 0;var Ge=Object.prototype.hasOwnProperty;var je="[object Arguments]",Xe="[object Array]",We="[object Object]",qe=Object.prototype.hasOwnProperty;function Ze(t,e,n,r,i,o){var a=v(t),l=v(e),s=a?Xe:Ne(t),u=l?Xe:Ne(e),f=(s=s==je?We:s)==We,c=(u=u==je?We:u)==We,d=s==u;if(d&&xt(t)){if(!xt(e))return!1;a=!0,f=!1}if(d&&!f)return o||(o=new ce),a||Ct(t)?He(t,e,n,r,i,o):function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new Me(t),new Me(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return et(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var l=Ve;case"[object Set]":var s=1&r;if(l||(l=ze),t.size!=e.size&&!s)return!1;var u=a.get(t);if(u)return u==e;r|=2,a.set(t,e);var f=He(l(t),l(e),r,i,o,a);return a.delete(t),f;case"[object Symbol]":if(Ue)return Ue.call(t)==Ue.call(e)}return!1}(t,e,s,n,r,i,o);if(!(1&n)){var h=f&&qe.call(t,"__wrapped__"),p=c&&qe.call(e,"__wrapped__");if(h||p){var g=h?t.value():t,b=p?e.value():e;return o||(o=new ce),i(g,b,n,r,o)}}return!!d&&(o||(o=new ce),function(t,e,n,r,i,o){var a=1&n,l=ve(t),s=l.length;if(s!=ve(e).length&&!a)return!1;for(var u=s;u--;){var f=l[u];if(!(a?f in e:Ge.call(e,f)))return!1}var c=o.get(t);if(c&&o.get(e))return c==e;var d=!0;o.set(t,e),o.set(e,t);for(var h=a;++u<s;){var p=t[f=l[u]],g=e[f];if(r)var b=a?r(g,p,f,e,t,o):r(p,g,f,t,e,o);if(!(void 0===b?p===g||i(p,g,n,r,o):b)){d=!1;break}h||(h="constructor"==f)}if(d&&!h){var m=t.constructor,x=e.constructor;m==x||!("constructor"in t)||!("constructor"in e)||"function"==typeof m&&m instanceof m&&"function"==typeof x&&x instanceof x||(d=!1)}return o.delete(t),o.delete(e),d}(t,e,n,r,i,o))}function Ye(t,e,n,r,i){return t===e||(null==t||null==e||!b(t)&&!b(e)?t!=t&&e!=e:Ze(t,e,n,r,Ye,i))}function $e(t){return t==t&&!A(t)}function Ke(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}function Qe(t){var e=function(t){for(var e=kt(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,$e(i)]}return e}(t);return 1==e.length&&e[0][2]?Ke(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var l=n[i];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++i<o;){var s=(l=n[i])[0],u=t[s],f=l[1];if(a&&l[2]){if(void 0===u&&!(s in t))return!1}else{var c=new ce;if(r)var d=r(u,f,s,t,e,c);if(!(void 0===d?Ye(f,u,3,r,c):d))return!1}}return!0}(n,t,e)}}function Je(t,e){return null!=t&&e in Object(t)}function tn(t,e){return null!=t&&function(t,e,n){for(var r=-1,i=(e=te(e,t)).length,o=!1;++r<i;){var a=ee(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&ot(i)&&J(a,i)&&(v(t)||pt(t))}(t,e,Je)}function en(t,e){return Vt(t)&&$e(e)?Ke(ee(t),e):function(n){var r=function(t,e,n){var r=null==t?void 0:ne(t,e);return void 0===r?n:r}(n,t);return void 0===r&&r===e?tn(n,t):Ye(e,r,3)}}function nn(t){return function(e){return null==e?void 0:e[t]}}function rn(t){return Vt(t)?nn(ee(t)):function(t){return function(e){return ne(e,t)}}(t)}function on(t){return"function"==typeof t?t:null==t?I:"object"==typeof t?v(t)?en(t[0],t[1]):Qe(t):rn(t)}var an,ln=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),a=o.length;a--;){var l=o[an?a:++r];if(!1===e(i[l],l,i))break}return t};function sn(t,e){return t&&ln(t,e,kt)}var un=function(t,e){return function(n,r){if(null==n)return n;if(!at(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Object(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}(sn);function fn(t,e){var n=-1,r=at(t)?Array(t.length):[];return un(t,(function(t,i,o){r[++n]=e(t,i,o)})),r}function cn(t,e){return function t(e,n,r,i,o){var a=-1,l=e.length;for(r||(r=oe),o||(o=[]);++a<l;){var s=e[a];n>0&&r(s)?n>1?t(s,n-1,r,i,o):re(o,s):i||(o[o.length]=s)}return o}(function(t,e){return(v(t)?x:fn)(t,on(e))}(t,e),1)}function dn(t){return null==t?[]:function(t,e){return x(e,(function(e){return t[e]}))}(t,kt(t))}var hn=Object.prototype.hasOwnProperty;function pn(t,e,n,r){if(!A(t))return t;for(var i=-1,o=(e=te(e,t)).length,a=o-1,l=t;null!=l&&++i<o;){var s=ee(e[i]),u=n;if(i!=a){var f=l[s];void 0===(u=r?r(f,s,l):void 0)&&(u=A(f)?f:J(e[i+1])?[]:{})}rt(l,s,u),l=l[s]}return t}function gn(t,e){if(null==t)return{};var n=x(function(t){return xe(t,Rt,me)}(t),(function(t){return[t]}));return e=on(e),function(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],l=ne(t,a);n(l,a)&&pn(o,te(a,t),l)}return o}(t,n,(function(t,n){return e(t,n[0])}))}var bn=Math.max;function mn(t){if(!t||!t.length)return[];var e=0;return t=de(t,(function(t){if(b(n=t)&&at(n))return e=bn(t.length,e),!0;var n})),ut(e,(function(e){return x(t,nn(e))}))}var xn=function(t,e){return K(function(t,e,n){return e=it(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=it(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var l=Array(e+1);++i<e;)l[i]=r[i];return l[e]=n(a),q(t,this,l)}}(t,e,I),t+"")}((function(t){var e=t.length,n=e>1?t[e-1]:void 0;return n="function"==typeof n?(t.pop(),n):void 0,function(t,e){if(!t||!t.length)return[];var n=mn(t);return null==e?n:x(n,(function(t){return q(e,void 0,t)}))}(t,n)}));!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".gl-tilelayer-tile {\n  -ms-interpolation-mode: nearest-neighbor;\n      image-rendering: -moz-crisp-edges;\n      image-rendering: pixelated;\n  image-rendering: crisp-edges;\n}\n");"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function vn(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return yn(null==e&&n.path)}},n.exports),n.exports}function yn(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var _n=vn((function(t,e){t.exports=function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},n="\n";function r(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function o(t,e){t||i(e)}function a(t){return t?": "+t:""}function l(t,e,n){t in e||i("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join())}function s(e,n){t(e)||i("invalid parameter type"+a(n)+". must be a typed array")}function u(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function f(t,e,n){u(t,e)||i("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t)}function c(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+a(e)+". must be a nonnegative integer")}function d(t,e,n){e.indexOf(t)<0&&i("invalid value"+a(n)+". must be one of: "+e)}var h=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function p(t){Object.keys(t).forEach((function(t){h.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+h)}))}function g(t,e){for(t+="";t.length<e;)t=" "+t;return t}function b(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function m(t,e){this.number=t,this.line=e,this.errors=[]}function x(t,e,n){this.file=t,this.line=e,this.message=n}function v(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function y(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function _(t,e){var n=t.split("\n"),i=1,o=0,a={unknown:new b,0:new b};a.unknown.name=a[0].name=e||v(),a.unknown.lines.push(new m(0,""));for(var l=0;l<n.length;++l){var s=n[l],u=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(s);if(u)switch(u[1]){case"line":var f=/(\d+)(\s+\d+)?/.exec(u[2]);f&&(i=0|f[1],f[2]&&((o=0|f[2])in a||(a[o]=new b)));break;case"define":var c=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);c&&(a[o].name=c[1]?r(c[2]):c[2])}a[o].lines.push(new m(i++,s))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function w(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new x(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new x("unknown",0,t))}})),e}function A(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function T(t,e,r,i,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var l=t.getShaderInfoLog(e),s=i===t.FRAGMENT_SHADER?"fragment":"vertex";I(r,"string",s+" shader source must be a string",a);var u=_(r,a),f=w(l);A(u,f),Object.keys(u).forEach((function(t){var e=u[t];if(e.hasErrors){var r=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(g(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+n,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var l=a[1];switch(i=a[2],l){case"assign":l="="}e=Math.max(t.line.indexOf(l,e),0)}else e=0;o(g("| ",6)),o(g("^^^",e+3)+n,"font-weight:bold"),o(g("| ",6)),o(i+n,"font-weight:bold")})),o(g("| ",6)+n)}else o(g(t.number,4)+"|  "),o(t.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(t,e){r.push(t),i.push(e||"")}})),o.raise("Error compiling "+s+" shader, "+u[0].name)}}function E(t,e,r,i,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var l=t.getProgramInfoLog(e),s=_(r,a),u='Error linking program with vertex shader, "'+_(i,a)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+n+"%c"+l,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+n+l),o.raise(u)}}function C(t){t._commandRef=v()}function B(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}C(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var l=t._attributeSet={};o(l,n.static),o(l,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function S(t,e){var n=y();i(t+" in command "+(e||v())+("unknown"===n?"":" called from "+n))}function L(t,e,n){t||S(e,n||v())}function D(t,e,n,r){t in e||S("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join(),r||v())}function I(t,e,n,r){u(t,e)||S("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t,r||v())}function F(t){t()}function k(t,e,n){t.texture?d(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):d(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var N=33071,M=9728,R=9984,O=9985,H=9986,V=9987,z=5121,P=5122,U=5123,G=5124,j=5125,X=5126,W=32819,q=32820,Z=33635,Y=34042,$=36193,K={};function Q(t,e){return t===q||t===W||t===Z?2:t===Y?4:K[t]*e}function J(t){return!(t&t-1||!t)}function tt(t,e,n){var r,i=e.width,a=e.height,l=e.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),t.wrapS===N&&t.wrapT===N||o(J(i)&&J(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==a&&o(t.minFilter!==R&&t.minFilter!==H&&t.minFilter!==O&&t.minFilter!==V,"min filter requires mipmap"):(o(J(i)&&J(a),"texture must be a square power of 2 to support mipmapping"),o(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===X&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(t.minFilter===M&&t.magFilter===M,"filter not supported, must enable oes_texture_float_linear"),o(!t.genMipmaps,"mipmap generation not supported with float textures"));var s=e.images;for(r=0;r<16;++r)if(s[r]){var u=i>>r,f=a>>r;o(e.mipmask&1<<r,"missing mipmap data");var c=s[r];if(o(c.width===u&&c.height===f,"invalid shape for mip images"),o(c.format===e.format&&c.internalformat===e.internalformat&&c.type===e.type,"incompatible type for mip image"),c.compressed);else if(c.data){var d=Math.ceil(Q(c.type,l)*u/c.unpackAlignment)*c.unpackAlignment;o(c.data.byteLength===d*f,"invalid data for image, buffer size is inconsistent with image format")}else c.element||c.copy}else t.genMipmaps||o(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&o(!t.genMipmaps,"mipmap generation for compressed images not supported")}function et(t,e,n,r){var i=t.width,a=t.height,l=t.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(e.wrapS===N&&e.wrapT===N,"wrap mode not supported by cube map");for(var s=0;s<n.length;++s){var u=n[s];o(u.width===i&&u.height===a,"inconsistent cube map face shape"),e.genMipmaps&&(o(!u.compressed,"can not generate mipmap for compressed textures"),o(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var f=u.images,c=0;c<16;++c){var d=f[c];if(d){var h=i>>c,p=a>>c;o(u.mipmask&1<<c,"missing mipmap data"),o(d.width===h&&d.height===p,"invalid shape for mip images"),o(d.format===t.format&&d.internalformat===t.internalformat&&d.type===t.type,"incompatible type for mip image"),d.compressed||(d.data?o(d.data.byteLength===h*p*Math.max(Q(d.type,l),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}K[5120]=K[z]=1,K[P]=K[U]=K[$]=K[Z]=K[W]=K[q]=2,K[G]=K[j]=K[X]=K[Y]=4;var nt=e(o,{optional:F,raise:i,commandRaise:S,command:L,parameter:l,commandParameter:D,constructor:p,type:f,commandType:I,isTypedArray:s,nni:c,oneOf:d,shaderError:T,linkError:E,callSite:y,saveCommandRef:C,saveDrawInfo:B,framebufferFormat:k,guessCommand:v,texture2D:tt,textureCube:et}),rt=0,it=0;function ot(t,e){this.id=rt++,this.type=t,this.data=e}function at(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function lt(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+at(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return lt(t.substr(0,r.index)).concat(lt(r[1])).concat(lt(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+at(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(lt(i[a]));return o}function st(t){return"["+lt(t).join("][")+"]"}function ut(t,e){return new ot(t,st(e+""))}function ft(t){return"function"==typeof t&&!t._reglType||t instanceof ot}function ct(t,e){return"function"==typeof t?new ot(it,t):t}var dt={DynamicVariable:ot,define:ut,isDynamic:ft,unbox:ct,accessor:st},ht={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},pt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function gt(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function bt(t,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(t!==document.body){var a=t.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,e(o.style,{width:n+"px",height:i+"px"})}function l(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}return e(o.style,{border:0,margin:0,padding:0,top:0,left:0}),t.appendChild(o),t===document.body&&(o.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:l}}function mt(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function xt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function vt(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function yt(t){return"string"==typeof t?t.split():(nt(Array.isArray(t),"invalid extension array"),t)}function _t(t){return"string"==typeof t?(nt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function wt(t){var e,n,r,i,o=t||{},a={},l=[],s=[],u="undefined"==typeof window?1:window.devicePixelRatio,f=!1,c=function(t){t&&nt.raise(t)},d=function(){};if("string"==typeof o?(nt("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),e=document.querySelector(o),nt(e,"invalid query string for element")):"object"==typeof o?xt(o)?e=o:vt(o)?r=(i=o).canvas:(nt.constructor(o),"gl"in o?i=o.gl:"canvas"in o?r=_t(o.canvas):"container"in o&&(n=_t(o.container)),"attributes"in o&&(a=o.attributes,nt.type(a,"object","invalid context attributes")),"extensions"in o&&(l=yt(o.extensions)),"optionalExtensions"in o&&(s=yt(o.optionalExtensions)),"onDone"in o&&(nt.type(o.onDone,"function","invalid or missing onDone callback"),c=o.onDone),"profile"in o&&(f=!!o.profile),"pixelRatio"in o&&(u=+o.pixelRatio,nt(u>0,"invalid pixel ratio"))):nt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){nt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=bt(n||document.body,c,u);if(!h)return null;r=h.canvas,d=h.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=mt(r,a)}return i?{gl:i,canvas:r,container:n,extensions:l,optionalExtensions:s,pixelRatio:u,profile:f,onDone:c,onDestroy:d}:(d(),c("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function At(t,e){var n={};function r(e){nt.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=t.getExtension(i)}catch(t){}return!!r}for(var i=0;i<e.extensions.length;++i){var o=e.extensions[i];if(!r(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function Tt(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var Et=5120,Ct=5121,Bt=5122,St=5123,Lt=5124,Dt=5125,It=5126;function Ft(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function kt(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function Nt(){var t=Tt(8,(function(){return[]}));function e(e){var n=Ft(e),r=t[kt(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[kt(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case Et:r=new Int8Array(e(n),0,n);break;case Ct:r=new Uint8Array(e(n),0,n);break;case Bt:r=new Int16Array(e(2*n),0,n);break;case St:r=new Uint16Array(e(2*n),0,n);break;case Lt:r=new Int32Array(e(4*n),0,n);break;case Dt:r=new Uint32Array(e(4*n),0,n);break;case It:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var Mt=Nt();Mt.zero=Nt();var Rt=3408,Ot=3410,Ht=3411,Vt=3412,zt=3413,Pt=3414,Ut=3415,Gt=33901,jt=33902,Xt=3379,Wt=3386,qt=34921,Zt=36347,Yt=36348,$t=35661,Kt=35660,Qt=34930,Jt=36349,te=34076,ee=34024,ne=7936,re=7937,ie=7938,oe=35724,ae=34047,le=36063,se=34852,ue=3553,fe=34067,ce=34069,de=33984,he=6408,pe=5126,ge=5121,be=36160,me=36053,xe=36064,ve=16384,ye=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ae));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(se),i=t.getParameter(le));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(ue,a),t.texImage2D(ue,0,he,1,1,0,he,pe,null);var l=t.createFramebuffer();if(t.bindFramebuffer(be,l),t.framebufferTexture2D(be,xe,ue,a,0),t.bindTexture(ue,null),t.checkFramebufferStatus(be)!==me)o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(ve);var s=Mt.allocType(pe,4);t.readPixels(0,0,1,1,he,pe,s),t.getError()?o=!1:(t.deleteFramebuffer(l),t.deleteTexture(a),o=1===s[0]),Mt.freeType(s)}}var u=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var f=t.createTexture(),c=Mt.allocType(ge,36);t.activeTexture(de),t.bindTexture(fe,f),t.texImage2D(ce,0,he,3,3,0,he,ge,c),Mt.freeType(c),t.bindTexture(fe,null),t.deleteTexture(f),u=!t.getError()}return{colorBits:[t.getParameter(Ot),t.getParameter(Ht),t.getParameter(Vt),t.getParameter(zt)],depthBits:t.getParameter(Pt),stencilBits:t.getParameter(Ut),subpixelBits:t.getParameter(Rt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(Gt),lineWidthDims:t.getParameter(jt),maxViewportDims:t.getParameter(Wt),maxCombinedTextureUnits:t.getParameter($t),maxCubeMapSize:t.getParameter(te),maxRenderbufferSize:t.getParameter(ee),maxTextureUnits:t.getParameter(Qt),maxTextureSize:t.getParameter(Xt),maxAttributes:t.getParameter(qt),maxVertexUniforms:t.getParameter(Zt),maxVertexTextureUnits:t.getParameter(Kt),maxVaryingVectors:t.getParameter(Yt),maxFragmentUniforms:t.getParameter(Jt),glsl:t.getParameter(oe),renderer:t.getParameter(re),vendor:t.getParameter(ne),version:t.getParameter(ie),readFloat:o,npotTextureCube:u}};function _e(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var we=function(t){return Object.keys(t).map((function(e){return t[e]}))},Ae={shape:Le,flatten:Se};function Te(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function Ee(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],l=0;l<n;++l)r[i++]=a[l]}function Ce(t,e,n,r,i,o){for(var a=o,l=0;l<e;++l)for(var s=t[l],u=0;u<n;++u)for(var f=s[u],c=0;c<r;++c)i[a++]=f[c]}function Be(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var l=e[n];if(e.length-n==4){var s=e[n+1],u=e[n+2],f=e[n+3];for(a=0;a<l;++a)Ce(t[a],s,u,f,r,i),i+=o}else for(a=0;a<l;++a)Be(t[a],e,n+1,r,i),i+=o}function Se(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||Mt.allocType(n,i);switch(e.length){case 0:break;case 1:Te(t,e[0],a);break;case 2:Ee(t,e[0],e[1],a);break;case 3:Ce(t,e[0],e[1],e[2],a,0);break;default:Be(t,e,0,a,0)}return a}function Le(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var De={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ie={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Fe={dynamic:35048,stream:35040,static:35044},ke=Ae.flatten,Ne=Ae.shape,Me=35044,Re=35040,Oe=5121,He=5126,Ve=[];function ze(t){return 0|De[Object.prototype.toString.call(t)]}function Pe(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function Ue(t,e,n,r,i,o,a){for(var l=0,s=0;s<n;++s)for(var u=0;u<r;++u)t[l++]=e[i*s+o*u+a]}function Ge(e,n,r,i){var o=0,a={};function l(t){this.id=o++,this.buffer=e.createBuffer(),this.type=t,this.usage=Me,this.byteLength=0,this.dimension=1,this.dtype=Oe,this.persistentData=null,r.profile&&(this.stats={size:0})}l.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},l.prototype.destroy=function(){h(this)};var s=[];function u(t,e){var n=s.pop();return n||(n=new l(t)),n.bind(),d(n,e,Re,0,1,!1),n}function f(t){s.push(t)}function c(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function d(e,n,r,i,o,a){var l,s;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||He,n.length>0)if(Array.isArray(n[0])){l=Ne(n);for(var u=1,f=1;f<l.length;++f)u*=l[f];e.dimension=u,c(e,s=ke(n,l,e.dtype),r),a?e.persistentData=s:Mt.freeType(s)}else if("number"==typeof n[0]){e.dimension=o;var d=Mt.allocType(e.dtype,n.length);Pe(d,n),c(e,d,r),a?e.persistentData=d:Mt.freeType(d)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||ze(n[0])||He,c(e,s=ke(n,[n.length,n[0].length],e.dtype),r),a?e.persistentData=s:Mt.freeType(s)):nt.raise("invalid buffer data")}else if(t(n))e.dtype=i||ze(n),e.dimension=o,c(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(_e(n)){l=n.shape;var h=n.stride,p=n.offset,g=0,b=0,m=0,x=0;1===l.length?(g=l[0],b=1,m=h[0],x=0):2===l.length?(g=l[0],b=l[1],m=h[0],x=h[1]):nt.raise("invalid shape"),e.dtype=i||ze(n.data)||He,e.dimension=b;var v=Mt.allocType(e.dtype,g*b);Ue(v,n.data,g,b,m,x,p),c(e,v,r),a?e.persistentData=v:Mt.freeType(v)}else n instanceof ArrayBuffer?(e.dtype=Oe,e.dimension=o,c(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):nt.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;nt(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete a[t.id]}function p(i,o,s,u){n.bufferCount++;var f=new l(o);function c(n){var i=Me,o=null,a=0,l=0,s=1;return Array.isArray(n)||t(n)||_e(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(nt.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(nt(null===o||Array.isArray(o)||t(o)||_e(o),"invalid data for buffer"),o=n.data),"usage"in n&&(nt.parameter(n.usage,Fe,"invalid buffer usage"),i=Fe[n.usage]),"type"in n&&(nt.parameter(n.type,Ie,"invalid buffer type"),l=Ie[n.type]),"dimension"in n&&(nt.type(n.dimension,"number","invalid dimension"),s=0|n.dimension),"length"in n&&(nt.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),o?d(f,o,i,l,s,u):(a&&e.bufferData(f.type,a,i),f.dtype=l||Oe,f.usage=i,f.dimension=s,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*Ve[f.dtype]),c}function p(t,n){nt(n+t.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),e.bufferSubData(f.type,n,t)}function g(e,n){var r,i=0|(n||0);if(f.bind(),t(e)||e instanceof ArrayBuffer)p(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var o=Mt.allocType(f.dtype,e.length);Pe(o,e),p(o,i),Mt.freeType(o)}else if(Array.isArray(e[0])||t(e[0])){r=Ne(e);var a=ke(e,r,f.dtype);p(a,i),Mt.freeType(a)}else nt.raise("invalid buffer data")}else if(_e(e)){r=e.shape;var l=e.stride,s=0,u=0,d=0,h=0;1===r.length?(s=r[0],u=1,d=l[0],h=0):2===r.length?(s=r[0],u=r[1],d=l[0],h=l[1]):nt.raise("invalid shape");var g=Array.isArray(e.data)?f.dtype:ze(e.data),b=Mt.allocType(g,s*u);Ue(b,e.data,s,u,d,h,e.offset),p(b,i),Mt.freeType(b)}else nt.raise("invalid data for buffer subdata");return c}return a[f.id]=f,s||c(i),c._reglType="buffer",c._buffer=f,c.subdata=g,r.profile&&(c.stats=f.stats),c.destroy=function(){h(f)},c}function g(){we(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:p,createStream:u,destroyStream:f,clear:function(){we(a).forEach(h),s.forEach(h)},getBuffer:function(t){return t&&t._buffer instanceof l?t._buffer:null},restore:g,_initBuffer:d}}Ve[5120]=1,Ve[5122]=2,Ve[5124]=4,Ve[5121]=1,Ve[5123]=2,Ve[5125]=4,Ve[5126]=4;var je={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Xe=0,We=1,qe=4,Ze=5120,Ye=5121,$e=5122,Ke=5123,Qe=5124,Je=5125,tn=34963,en=35040,nn=35044;function rn(e,n,r,i){var o={},a=0,l={uint8:Ye,uint16:Ke};function s(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=qe,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(l.uint32=Je),s.prototype.bind=function(){this.buffer.bind()};var u=[];function f(t){var e=u.pop();return e||(e=new s(r.create(null,tn,!0,!1)._buffer)),d(e,t,en,-1,-1,0,0),e}function c(t){u.push(t)}function d(i,o,a,l,s,u,f){var c;if(i.buffer.bind(),o){var d=f;f||t(o)&&(!_e(o)||t(o.data))||(d=n.oes_element_index_uint?Je:Ke),r._initBuffer(i.buffer,o,a,d,3)}else e.bufferData(tn,u,a),i.buffer.dtype=c||Ye,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=u;if(c=f,!f){switch(i.buffer.dtype){case Ye:case Ze:c=Ye;break;case Ke:case $e:c=Ke;break;case Je:case Qe:c=Je;break;default:nt.raise("unsupported type for element array")}i.buffer.dtype=c}i.type=c,nt(c!==Je||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var h=s;h<0&&(h=i.buffer.byteLength,c===Ke?h>>=1:c===Je&&(h>>=2)),i.vertCount=h;var p=l;if(l<0){p=qe;var g=i.buffer.dimension;1===g&&(p=Xe),2===g&&(p=We),3===g&&(p=qe)}i.primType=p}function h(t){i.elementsCount--,nt(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}function p(e,n){var o=r.create(null,tn,!0),a=new s(o._buffer);function u(e){if(e)if("number"==typeof e)o(e),a.primType=qe,a.vertCount=0|e,a.type=Ye;else{var n=null,r=nn,i=-1,s=-1,f=0,c=0;Array.isArray(e)||t(e)||_e(e)?n=e:(nt.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,nt(Array.isArray(n)||t(n)||_e(n),"invalid data for element buffer")),"usage"in e&&(nt.parameter(e.usage,Fe,"invalid element buffer usage"),r=Fe[e.usage]),"primitive"in e&&(nt.parameter(e.primitive,je,"invalid element buffer primitive"),i=je[e.primitive]),"count"in e&&(nt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),s=0|e.count),"type"in e&&(nt.parameter(e.type,l,"invalid buffer type"),c=l[e.type]),"length"in e?f=0|e.length:(f=s,c===Ke||c===$e?f*=2:c!==Je&&c!==Qe||(f*=4))),d(a,n,r,i,s,f,c)}else o(),a.primType=qe,a.vertCount=0,a.type=Ye;return u}return i.elementsCount++,u(e),u._reglType="elements",u._elements=a,u.subdata=function(t,e){return o.subdata(t,e),u},u.destroy=function(){h(a)},u}return{create:p,createStream:f,destroyStream:c,getElements:function(t){return"function"==typeof t&&t._elements instanceof s?t._elements:null},clear:function(){we(o).forEach(h)}}}var on=new Float32Array(1),an=new Uint32Array(on.buffer),ln=5123;function sn(t){for(var e=Mt.allocType(ln,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{on[0]=t[n];var r=an[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var l=-14-o;e[n]=i+(a+1024>>l)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function un(e){return Array.isArray(e)||t(e)}var fn=function(t){return!(t&t-1||!t)},cn=34467,dn=3553,hn=34067,pn=34069,gn=6408,bn=6406,mn=6407,xn=6409,vn=6410,yn=32854,_n=32855,wn=36194,An=32819,Tn=32820,En=33635,Cn=34042,Bn=6402,Sn=34041,Ln=35904,Dn=35906,In=36193,Fn=33776,kn=33777,Nn=33778,Mn=33779,Rn=35986,On=35987,Hn=34798,Vn=35840,zn=35841,Pn=35842,Un=35843,Gn=36196,jn=5121,Xn=5123,Wn=5125,qn=5126,Zn=10242,Yn=10243,$n=10497,Kn=33071,Qn=33648,Jn=10240,tr=10241,er=9728,nr=9729,rr=9984,ir=9985,or=9986,ar=9987,lr=33170,sr=4352,ur=4353,fr=4354,cr=34046,dr=3317,hr=37440,pr=37441,gr=37443,br=37444,mr=33984,xr=[rr,or,ir,ar],vr=[0,xn,vn,mn,gn],yr={};function _r(t){return"[object "+t+"]"}yr[xn]=yr[bn]=yr[Bn]=1,yr[Sn]=yr[vn]=2,yr[mn]=yr[Ln]=3,yr[gn]=yr[Dn]=4;var wr=_r("HTMLCanvasElement"),Ar=_r("OffscreenCanvas"),Tr=_r("CanvasRenderingContext2D"),Er=_r("ImageBitmap"),Cr=_r("HTMLImageElement"),Br=_r("HTMLVideoElement"),Sr=Object.keys(De).concat([wr,Ar,Tr,Er,Cr,Br]),Lr=[];Lr[jn]=1,Lr[qn]=4,Lr[In]=2,Lr[Xn]=2,Lr[Wn]=4;var Dr=[];function Ir(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Fr(t){return!!Array.isArray(t)&&!(0===t.length||!un(t[0]))}function kr(t){return Object.prototype.toString.call(t)}function Nr(t){return kr(t)===wr}function Mr(t){return kr(t)===Ar}function Rr(t){return kr(t)===Tr}function Or(t){return kr(t)===Er}function Hr(t){return kr(t)===Cr}function Vr(t){return kr(t)===Br}function zr(t){if(!t)return!1;var e=kr(t);return Sr.indexOf(e)>=0||Ir(t)||Fr(t)||_e(t)}function Pr(t){return 0|De[Object.prototype.toString.call(t)]}function Ur(t,e){var n=e.length;switch(t.type){case jn:case Xn:case Wn:case qn:var r=Mt.allocType(t.type,n);r.set(e),t.data=r;break;case In:t.data=sn(e);break;default:nt.raise("unsupported texture type, must specify a typed array")}}function Gr(t,e){return Mt.allocType(t.type===In?qn:t.type,e)}function jr(t,e){t.type===In?(t.data=sn(e),Mt.freeType(e)):t.data=e}function Xr(t,e,n,r,i,o){for(var a=t.width,l=t.height,s=t.channels,u=Gr(t,a*l*s),f=0,c=0;c<l;++c)for(var d=0;d<a;++d)for(var h=0;h<s;++h)u[f++]=e[n*d+r*c+i*h+o];jr(t,u)}function Wr(t,e,n,r,i,o){var a;if(a=void 0!==Dr[t]?Dr[t]:yr[t]*Lr[e],o&&(a*=6),i){for(var l=0,s=n;s>=1;)l+=a*s*s,s/=2;return l}return a*n*r}function qr(n,r,i,o,a,l,s){var u={"don't care":sr,"dont care":sr,nice:fr,fast:ur},f={repeat:$n,clamp:Kn,mirror:Qn},c={nearest:er,linear:nr},d=e({mipmap:ar,"nearest mipmap nearest":rr,"linear mipmap nearest":ir,"nearest mipmap linear":or,"linear mipmap linear":ar},c),h={none:0,browser:br},p={uint8:jn,rgba4:An,rgb565:En,"rgb5 a1":Tn},g={alpha:bn,luminance:xn,"luminance alpha":vn,rgb:mn,rgba:gn,rgba4:yn,"rgb5 a1":_n,rgb565:wn},b={};r.ext_srgb&&(g.srgb=Ln,g.srgba=Dn),r.oes_texture_float&&(p.float32=p.float=qn),r.oes_texture_half_float&&(p.float16=p["half float"]=In),r.webgl_depth_texture&&(e(g,{depth:Bn,"depth stencil":Sn}),e(p,{uint16:Xn,uint32:Wn,"depth stencil":Cn})),r.webgl_compressed_texture_s3tc&&e(b,{"rgb s3tc dxt1":Fn,"rgba s3tc dxt1":kn,"rgba s3tc dxt3":Nn,"rgba s3tc dxt5":Mn}),r.webgl_compressed_texture_atc&&e(b,{"rgb atc":Rn,"rgba atc explicit alpha":On,"rgba atc interpolated alpha":Hn}),r.webgl_compressed_texture_pvrtc&&e(b,{"rgb pvrtc 4bppv1":Vn,"rgb pvrtc 2bppv1":zn,"rgba pvrtc 4bppv1":Pn,"rgba pvrtc 2bppv1":Un}),r.webgl_compressed_texture_etc1&&(b["rgb etc1"]=Gn);var m=Array.prototype.slice.call(n.getParameter(cn));Object.keys(b).forEach((function(t){var e=b[t];m.indexOf(e)>=0&&(g[t]=e)}));var x=Object.keys(g);i.textureFormats=x;var v=[];Object.keys(g).forEach((function(t){var e=g[t];v[e]=t}));var y=[];Object.keys(p).forEach((function(t){var e=p[t];y[e]=t}));var _=[];Object.keys(c).forEach((function(t){var e=c[t];_[e]=t}));var w=[];Object.keys(d).forEach((function(t){var e=d[t];w[e]=t}));var A=[];Object.keys(f).forEach((function(t){var e=f[t];A[e]=t}));var T=x.reduce((function(t,e){var n=g[e];return n===xn||n===bn||n===xn||n===vn||n===Bn||n===Sn||r.ext_srgb&&(n===Ln||n===Dn)?t[n]=n:n===_n||e.indexOf("rgba")>=0?t[n]=gn:t[n]=mn,t}),{});function E(){this.internalformat=gn,this.format=gn,this.type=jn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=br,this.width=0,this.height=0,this.channels=0}function C(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function B(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(nt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(nt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(nt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(nt.parameter(e.colorSpace,h,"invalid colorSpace"),t.colorSpace=h[e.colorSpace]),"type"in e){var n=e.type;nt(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),nt(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),nt(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(n,p,"invalid texture type"),t.type=p[n]}var o=t.width,a=t.height,l=t.channels,s=!1;"shape"in e?(nt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(l=e.shape[2],nt(l>0&&l<=4,"invalid number of channels"),s=!0),nt(o>=0&&o<=i.maxTextureSize,"invalid width"),nt(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,nt(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,nt(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,nt(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(l=e.channels,nt(l>0&&l<=4,"invalid number of channels"),s=!0)),t.width=0|o,t.height=0|a,t.channels=0|l;var u=!1;if("format"in e){var f=e.format;nt(r.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(f,g,"invalid texture format");var c=t.internalformat=g[f];t.format=T[c],f in p&&("type"in e||(t.type=p[f])),f in b&&(t.compressed=!0),u=!0}!s&&u?t.channels=yr[t.format]:s&&!u?t.channels!==vr[t.format]&&(t.format=t.internalformat=vr[t.channels]):u&&s&&nt(t.channels===yr[t.format],"number of channels inconsistent with specified format")}}function S(t){n.pixelStorei(hr,t.flipY),n.pixelStorei(pr,t.premultiplyAlpha),n.pixelStorei(gr,t.colorSpace),n.pixelStorei(dr,t.unpackAlignment)}function L(){E.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function D(e,n){var r=null;if(zr(n)?r=n:n&&(nt.type(n,"object","invalid pixel data type"),B(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),zr(n.data)&&(r=n.data)),nt(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){nt(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,l=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||l-e.yOffset,e.needsCopy=!0,nt(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<l&&e.width>0&&e.width<=o&&e.height>0&&e.height<=l,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||e.type!==jn||(e.type=Pr(r));else if(Ir(r))e.channels=e.channels||4,Ur(e,r),e.alignment=1,e.needsFree=!0;else if(_e(r)){var s=r.data;Array.isArray(s)||e.type!==jn||(e.type=Pr(s));var u,f,c,d,h,p,g=r.shape,b=r.stride;3===g.length?(c=g[2],p=b[2]):(nt(2===g.length,"invalid ndarray pixel data, must be 2 or 3D"),c=1,p=1),u=g[0],f=g[1],d=b[0],h=b[1],e.alignment=1,e.width=u,e.height=f,e.channels=c,e.format=e.internalformat=vr[c],e.needsFree=!0,Xr(e,s,d,h,p,r.offset)}else if(Nr(r)||Mr(r)||Rr(r))Nr(r)||Mr(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(Or(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(Hr(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Vr(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(Fr(r)){var m=e.width||r[0].length,x=e.height||r.length,v=e.channels;v=un(r[0][0])?v||r[0][0].length:v||1;for(var y=Ae.shape(r),_=1,w=0;w<y.length;++w)_*=y[w];var A=Gr(e,_);Ae.flatten(r,y,"",A),jr(e,A),e.alignment=1,e.width=m,e.height=x,e.channels=v,e.format=e.internalformat=vr[v],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===qn?nt(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===In&&nt(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function I(t,e,r){var i=t.element,a=t.data,l=t.internalformat,s=t.format,u=t.type,f=t.width,c=t.height;S(t),i?n.texImage2D(e,r,s,s,u,i):t.compressed?n.compressedTexImage2D(e,r,l,f,c,0,a):t.needsCopy?(o(),n.copyTexImage2D(e,r,s,t.xOffset,t.yOffset,f,c,0)):n.texImage2D(e,r,s,f,c,0,s,u,a||null)}function F(t,e,r,i,a){var l=t.element,s=t.data,u=t.internalformat,f=t.format,c=t.type,d=t.width,h=t.height;S(t),l?n.texSubImage2D(e,a,r,i,f,c,l):t.compressed?n.compressedTexSubImage2D(e,a,r,i,u,d,h,s):t.needsCopy?(o(),n.copyTexSubImage2D(e,a,r,i,t.xOffset,t.yOffset,d,h)):n.texSubImage2D(e,a,r,i,d,h,f,c,s)}var k=[];function N(){return k.pop()||new L}function M(t){t.needsFree&&Mt.freeType(t.data),L.call(t),k.push(t)}function R(){E.call(this),this.genMipmaps=!1,this.mipmapHint=sr,this.mipmask=0,this.images=Array(16)}function O(t,e,n){var r=t.images[0]=N();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function H(t,e){var n=null;if(zr(e))C(n=t.images[0]=N(),t),D(n,e),t.mipmask=1;else if(B(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)C(n=t.images[i]=N(),t),n.width>>=i,n.height>>=i,D(n,r[i]),t.mipmask|=1<<i;else C(n=t.images[0]=N(),t),D(n,e),t.mipmask=1;C(t,t.images[0]),!t.compressed||t.internalformat!==Fn&&t.internalformat!==kn&&t.internalformat!==Nn&&t.internalformat!==Mn||nt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function V(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;I(n[r],e,r)}}var z=[];function P(){var t=z.pop()||new R;E.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function U(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&M(e[n]),e[n]=null;z.push(t)}function G(){this.minFilter=er,this.magFilter=er,this.wrapS=Kn,this.wrapT=Kn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=sr}function j(t,e){if("min"in e){var n=e.min;nt.parameter(n,d),t.minFilter=d[n],xr.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;nt.parameter(r,c),t.magFilter=c[r]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var l=e.wrap;"string"==typeof l?(nt.parameter(l,f),o=a=f[l]):Array.isArray(l)&&(nt.parameter(l[0],f),nt.parameter(l[1],f),o=f[l[0]],a=f[l[1]])}else{if("wrapS"in e){var s=e.wrapS;nt.parameter(s,f),o=f[s]}if("wrapT"in e){var h=e.wrapT;nt.parameter(h,f),a=f[h]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var p=e.anisotropic;nt("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var g=!1;switch(typeof e.mipmap){case"string":nt.parameter(e.mipmap,u,"invalid mipmap hint"),t.mipmapHint=u[e.mipmap],t.genMipmaps=!0,g=!0;break;case"boolean":g=t.genMipmaps=e.mipmap;break;case"object":nt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,g=!0;break;default:nt.raise("invalid mipmap type")}g&&!("min"in e)&&(t.minFilter=rr)}}function X(t,e){n.texParameteri(e,tr,t.minFilter),n.texParameteri(e,Jn,t.magFilter),n.texParameteri(e,Zn,t.wrapS),n.texParameteri(e,Yn,t.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(e,cr,t.anisotropic),t.genMipmaps&&(n.hint(lr,t.mipmapHint),n.generateMipmap(e))}var W=0,q={},Z=i.maxTextureUnits,Y=Array(Z).map((function(){return null}));function $(t){E.call(this),this.mipmask=0,this.internalformat=gn,this.id=W++,this.refCount=1,this.target=t,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new G,s.profile&&(this.stats={size:0})}function K(t){n.activeTexture(mr),n.bindTexture(t.target,t.texture)}function Q(){var t=Y[0];t?n.bindTexture(t.target,t.texture):n.bindTexture(dn,null)}function J(t){var e=t.texture;nt(e,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(n.activeTexture(mr+r),n.bindTexture(i,null),Y[r]=null),n.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete q[t.id],l.textureCount--}function tt(t,e){var r=new $(dn);function o(t,e){var n=r.texInfo;G.call(n);var a=P();return"number"==typeof t?O(a,0|t,"number"==typeof e?0|e:0|t):t?(nt.type(t,"object","invalid arguments to regl.texture"),j(n,t),H(a,t)):O(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,C(r,a),nt.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,K(r),V(a,dn),X(n,dn),Q(),U(a),s.profile&&(r.stats.size=Wr(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=v[r.internalformat],o.type=y[r.type],o.mag=_[n.magFilter],o.min=w[n.minFilter],o.wrapS=A[n.wrapS],o.wrapT=A[n.wrapT],o}function a(t,e,n,i){nt(!!t,"must specify image data");var a=0|e,l=0|n,s=0|i,u=N();return C(u,r),u.width=0,u.height=0,D(u,t),u.width=u.width||(r.width>>s)-a,u.height=u.height||(r.height>>s)-l,nt(r.type===u.type&&r.format===u.format&&r.internalformat===u.internalformat,"incompatible format for texture.subimage"),nt(a>=0&&l>=0&&a+u.width<=r.width&&l+u.height<=r.height,"texture.subimage write out of bounds"),nt(r.mipmask&1<<s,"missing mipmap data"),nt(u.data||u.element||u.needsCopy,"missing image data"),K(r),F(u,dn,a,l,s),Q(),M(u),o}function u(t,e){var i=0|t,a=0|e||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,K(r);for(var l=0;r.mipmask>>l;++l){var u=i>>l,f=a>>l;if(!u||!f)break;n.texImage2D(dn,l,r.format,u,f,0,r.format,r.type,null)}return Q(),s.profile&&(r.stats.size=Wr(r.internalformat,r.type,i,a,!1,!1)),o}return q[r.id]=r,l.textureCount++,o(t,e),o.subimage=a,o.resize=u,o._reglType="texture2d",o._texture=r,s.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o}function et(t,e,r,o,a,u){var f=new $(hn);q[f.id]=f,l.cubeCount++;var c=new Array(6);function d(t,e,n,r,o,a){var l,u=f.texInfo;for(G.call(u),l=0;l<6;++l)c[l]=P();if("number"!=typeof t&&t)if("object"==typeof t)if(e)H(c[0],t),H(c[1],e),H(c[2],n),H(c[3],r),H(c[4],o),H(c[5],a);else if(j(u,t),B(f,t),"faces"in t){var h=t.faces;for(nt(Array.isArray(h)&&6===h.length,"cube faces must be a length 6 array"),l=0;l<6;++l)nt("object"==typeof h[l]&&!!h[l],"invalid input for cube map face"),C(c[l],f),H(c[l],h[l])}else for(l=0;l<6;++l)H(c[l],t);else nt.raise("invalid arguments to cube map");else{var p=0|t||1;for(l=0;l<6;++l)O(c[l],p,p)}for(C(f,c[0]),i.npotTextureCube||nt(fn(f.width)&&fn(f.height),"your browser does not support non power or two texture dimensions"),u.genMipmaps?f.mipmask=(c[0].width<<1)-1:f.mipmask=c[0].mipmask,nt.textureCube(f,u,c,i),f.internalformat=c[0].internalformat,d.width=c[0].width,d.height=c[0].height,K(f),l=0;l<6;++l)V(c[l],pn+l);for(X(u,hn),Q(),s.profile&&(f.stats.size=Wr(f.internalformat,f.type,d.width,d.height,u.genMipmaps,!0)),d.format=v[f.internalformat],d.type=y[f.type],d.mag=_[u.magFilter],d.min=w[u.minFilter],d.wrapS=A[u.wrapS],d.wrapT=A[u.wrapT],l=0;l<6;++l)U(c[l]);return d}function h(t,e,n,r,i){nt(!!e,"must specify image data"),nt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,l=0|i,s=N();return C(s,f),s.width=0,s.height=0,D(s,e),s.width=s.width||(f.width>>l)-o,s.height=s.height||(f.height>>l)-a,nt(f.type===s.type&&f.format===s.format&&f.internalformat===s.internalformat,"incompatible format for texture.subimage"),nt(o>=0&&a>=0&&o+s.width<=f.width&&a+s.height<=f.height,"texture.subimage write out of bounds"),nt(f.mipmask&1<<l,"missing mipmap data"),nt(s.data||s.element||s.needsCopy,"missing image data"),K(f),F(s,pn+t,o,a,l),Q(),M(s),d}function p(t){var e=0|t;if(e!==f.width){d.width=f.width=e,d.height=f.height=e,K(f);for(var r=0;r<6;++r)for(var i=0;f.mipmask>>i;++i)n.texImage2D(pn+r,i,f.format,e>>i,e>>i,0,f.format,f.type,null);return Q(),s.profile&&(f.stats.size=Wr(f.internalformat,f.type,d.width,d.height,!1,!0)),d}}return d(t,e,r,o,a,u),d.subimage=h,d.resize=p,d._reglType="textureCube",d._texture=f,s.profile&&(d.stats=f.stats),d.destroy=function(){f.decRef()},d}function rt(){for(var t=0;t<Z;++t)n.activeTexture(mr+t),n.bindTexture(dn,null),Y[t]=null;we(q).forEach(J),l.cubeCount=0,l.textureCount=0}function it(){for(var t=0;t<Z;++t){var e=Y[t];e&&(e.bindCount=0,e.unit=-1,Y[t]=null)}we(q).forEach((function(t){t.texture=n.createTexture(),n.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(0!=(t.mipmask&1<<e))if(t.target===dn)n.texImage2D(dn,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)n.texImage2D(pn+r,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);X(t.texInfo,t.target)}))}return e($.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var r=0;r<Z;++r){var i=Y[r];if(i){if(i.bindCount>0)continue;i.unit=-1}Y[r]=t,e=r;break}e>=Z&&nt.raise("insufficient number of texture units"),s.profile&&l.maxTextureUnits<e+1&&(l.maxTextureUnits=e+1),t.unit=e,n.activeTexture(mr+e),n.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&J(this)}}),s.profile&&(l.getTotalTextureSize=function(){var t=0;return Object.keys(q).forEach((function(e){t+=q[e].stats.size})),t}),{create2D:tt,createCube:et,clear:rt,getTexture:function(t){return null},restore:it}}Dr[yn]=2,Dr[_n]=2,Dr[wn]=2,Dr[Sn]=4,Dr[Fn]=.5,Dr[kn]=.5,Dr[Nn]=1,Dr[Mn]=1,Dr[Rn]=.5,Dr[On]=1,Dr[Hn]=1,Dr[Vn]=.5,Dr[zn]=.25,Dr[Pn]=.5,Dr[Un]=.25,Dr[Gn]=.5;var Zr=36161,Yr=32854,$r=32855,Kr=36194,Qr=33189,Jr=36168,ti=34041,ei=35907,ni=34836,ri=34842,ii=34843,oi=[];function ai(t,e,n){return oi[t]*e*n}oi[Yr]=2,oi[$r]=2,oi[Kr]=2,oi[Qr]=2,oi[Jr]=1,oi[ti]=4,oi[ei]=4,oi[ni]=16,oi[ri]=8,oi[ii]=6;var li=function(t,e,n,r,i){var o={rgba4:Yr,rgb565:Kr,"rgb5 a1":$r,depth:Qr,stencil:Jr,"depth stencil":ti};e.ext_srgb&&(o.srgba=ei),e.ext_color_buffer_half_float&&(o.rgba16f=ri,o.rgb16f=ii),e.webgl_color_buffer_float&&(o.rgba32f=ni);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var l=0,s={};function u(t){this.id=l++,this.refCount=1,this.renderbuffer=t,this.format=Yr,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function f(e){var n=e.renderbuffer;nt(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(Zr,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete s[e.id],r.renderbufferCount--}function c(e,l){var f=new u(t.createRenderbuffer());function c(e,r){var l=0,s=0,u=Yr;if("object"==typeof e&&e){var d=e;if("shape"in d){var h=d.shape;nt(Array.isArray(h)&&h.length>=2,"invalid renderbuffer shape"),l=0|h[0],s=0|h[1]}else"radius"in d&&(l=s=0|d.radius),"width"in d&&(l=0|d.width),"height"in d&&(s=0|d.height);"format"in d&&(nt.parameter(d.format,o,"invalid renderbuffer format"),u=o[d.format])}else"number"==typeof e?(l=0|e,s="number"==typeof r?0|r:l):e?nt.raise("invalid arguments to renderbuffer constructor"):l=s=1;if(nt(l>0&&s>0&&l<=n.maxRenderbufferSize&&s<=n.maxRenderbufferSize,"invalid renderbuffer size"),l!==f.width||s!==f.height||u!==f.format)return c.width=f.width=l,c.height=f.height=s,f.format=u,t.bindRenderbuffer(Zr,f.renderbuffer),t.renderbufferStorage(Zr,u,l,s),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=ai(f.format,f.width,f.height)),c.format=a[f.format],c}function d(e,r){var o=0|e,a=0|r||o;return o===f.width&&a===f.height||(nt(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),c.width=f.width=o,c.height=f.height=a,t.bindRenderbuffer(Zr,f.renderbuffer),t.renderbufferStorage(Zr,f.format,o,a),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=ai(f.format,f.width,f.height))),c}return s[f.id]=f,r.renderbufferCount++,c(e,l),c.resize=d,c._reglType="renderbuffer",c._renderbuffer=f,i.profile&&(c.stats=f.stats),c.destroy=function(){f.decRef()},c}function d(){we(s).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Zr,e.renderbuffer),t.renderbufferStorage(Zr,e.format,e.width,e.height)})),t.bindRenderbuffer(Zr,null)}return u.prototype.decRef=function(){--this.refCount<=0&&f(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(s).forEach((function(e){t+=s[e].stats.size})),t}),{create:c,clear:function(){we(s).forEach(f)},restore:d}},si=36160,ui=36161,fi=3553,ci=34069,di=36064,hi=36096,pi=36128,gi=33306,bi=36053,mi=36054,xi=36055,vi=36057,yi=36061,_i=36193,wi=5121,Ai=5126,Ti=6407,Ei=6408,Ci=6402,Bi=[Ti,Ei],Si=[];Si[Ei]=4,Si[Ti]=3;var Li=[];Li[wi]=1,Li[Ai]=4,Li[_i]=2;var Di=33189,Ii=36168,Fi=34041,ki=[32854,32855,36194,35907,34842,34843,34836],Ni={};function Mi(t,n,r,i,o,a){var l={cur:null,next:null,dirty:!1,setFBO:null},s=["rgba"],u=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&u.push("srgba"),n.ext_color_buffer_half_float&&u.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&u.push("rgba32f");var f=["uint8"];function c(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function d(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function h(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);nt(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;nt(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(e,n){n&&(n.texture?t.framebufferTexture2D(si,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(si,e,ui,n.renderbuffer._renderbuffer.renderbuffer))}function g(t){var e=fi,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),nt.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,nt(e===fi)):"textureCube"===o?(n=i,nt(e>=ci&&e<ci+6,"invalid cube map target")):"renderbuffer"===o?(r=i,e=ui):nt.raise("invalid regl object for attachment"),new c(e,n,r)}function b(t,e,n,r,a){if(n){var l=i.create2D({width:t,height:e,format:r,type:a});return l._texture.refCount=0,new c(fi,l,null)}var s=o.create({width:t,height:e,format:r});return s._renderbuffer.refCount=0,new c(ui,null,s)}function m(t){return t&&(t.texture||t.renderbuffer)}function x(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}n.oes_texture_half_float&&f.push("half float","float16"),n.oes_texture_float&&f.push("float","float32");var v=0,y={};function _(){this.id=v++,y[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(t){t.colorAttachments.forEach(d),d(t.depthAttachment),d(t.stencilAttachment),d(t.depthStencilAttachment)}function A(e){var n=e.framebuffer;nt(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete y[e.id]}function T(e){var n;t.bindFramebuffer(si,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)p(di+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(si,di+n,fi,null,0);t.framebufferTexture2D(si,gi,fi,null,0),t.framebufferTexture2D(si,hi,fi,null,0),t.framebufferTexture2D(si,pi,fi,null,0),p(hi,e.depthAttachment),p(pi,e.stencilAttachment),p(gi,e.depthStencilAttachment);var o=t.checkFramebufferStatus(si);t.isContextLost()||o===bi||nt.raise("framebuffer configuration not supported, status = "+Ni[o]),t.bindFramebuffer(si,l.next?l.next.framebuffer:null),l.cur=l.next,t.getError()}function E(t,i){var o=new _;function c(t,e){var i;nt(l.next!==o,"can not update framebuffer which is currently in use");var a=0,d=0,p=!0,x=!0,v=null,y=!0,_="rgba",A="uint8",E=1,C=null,B=null,S=null,L=!1;if("number"==typeof t)a=0|t,d=0|e||a;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var D=t;if("shape"in D){var I=D.shape;nt(Array.isArray(I)&&I.length>=2,"invalid shape for framebuffer"),a=I[0],d=I[1]}else"radius"in D&&(a=d=D.radius),"width"in D&&(a=D.width),"height"in D&&(d=D.height);("color"in D||"colors"in D)&&(v=D.color||D.colors,Array.isArray(v)&&nt(1===v.length||n.webgl_draw_buffers,"multiple render targets not supported")),v||("colorCount"in D&&(E=0|D.colorCount,nt(E>0,"invalid color buffer count")),"colorTexture"in D&&(y=!!D.colorTexture,_="rgba4"),"colorType"in D&&(A=D.colorType,y?(nt(n.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),nt(n.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(nt(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==A&&"float32"!==A||(nt(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),nt.oneOf(A,f,"invalid color type")),"colorFormat"in D&&(_=D.colorFormat,s.indexOf(_)>=0?y=!0:u.indexOf(_)>=0?y=!1:y?nt.oneOf(D.colorFormat,s,"invalid color format for texture"):nt.oneOf(D.colorFormat,u,"invalid color format for renderbuffer"))),("depthTexture"in D||"depthStencilTexture"in D)&&(L=!(!D.depthTexture&&!D.depthStencilTexture),nt(!L||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in D&&("boolean"==typeof D.depth?p=D.depth:(C=D.depth,x=!1)),"stencil"in D&&("boolean"==typeof D.stencil?x=D.stencil:(B=D.stencil,p=!1)),"depthStencil"in D&&("boolean"==typeof D.depthStencil?p=x=D.depthStencil:(S=D.depthStencil,p=!1,x=!1))}else a=d=1;var F=null,k=null,N=null,M=null;if(Array.isArray(v))F=v.map(g);else if(v)F=[g(v)];else for(F=new Array(E),i=0;i<E;++i)F[i]=b(a,d,y,_,A);nt(n.webgl_draw_buffers||F.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),nt(F.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||F[0].width,d=d||F[0].height,C?k=g(C):p&&!x&&(k=b(a,d,L,"depth","uint32")),B?N=g(B):x&&!p&&(N=b(a,d,!1,"stencil","uint8")),S?M=g(S):!C&&!B&&x&&p&&(M=b(a,d,L,"depth stencil","depth stencil")),nt(!!C+!!B+!!S<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var R=null;for(i=0;i<F.length;++i)if(h(F[i],a,d),nt(!F[i]||F[i].texture&&Bi.indexOf(F[i].texture._texture.format)>=0||F[i].renderbuffer&&ki.indexOf(F[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),F[i]&&F[i].texture){var O=Si[F[i].texture._texture.format]*Li[F[i].texture._texture.type];null===R?R=O:nt(R===O,"all color attachments much have the same number of bits per pixel.")}return h(k,a,d),nt(!k||k.texture&&k.texture._texture.format===Ci||k.renderbuffer&&k.renderbuffer._renderbuffer.format===Di,"invalid depth attachment for framebuffer object"),h(N,a,d),nt(!N||N.renderbuffer&&N.renderbuffer._renderbuffer.format===Ii,"invalid stencil attachment for framebuffer object"),h(M,a,d),nt(!M||M.texture&&M.texture._texture.format===Fi||M.renderbuffer&&M.renderbuffer._renderbuffer.format===Fi,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=a,o.height=d,o.colorAttachments=F,o.depthAttachment=k,o.stencilAttachment=N,o.depthStencilAttachment=M,c.color=F.map(m),c.depth=m(k),c.stencil=m(N),c.depthStencil=m(M),c.width=o.width,c.height=o.height,T(o),c}function d(t,e){nt(l.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return c;for(var i=o.colorAttachments,a=0;a<i.length;++a)x(i[a],n,r);return x(o.depthAttachment,n,r),x(o.stencilAttachment,n,r),x(o.depthStencilAttachment,n,r),o.width=c.width=n,o.height=c.height=r,T(o),c}return a.framebufferCount++,c(t,i),e(c,{resize:d,_reglType:"framebuffer",_framebuffer:o,destroy:function(){A(o),w(o)},use:function(t){l.setFBO({framebuffer:c},t)}})}function C(t){var o=Array(6);function a(t){var r;nt(o.indexOf(l.next)<0,"can not update framebuffer which is currently in use");var u,c={color:null},d=0,h=null,p="rgba",g="uint8",b=1;if("number"==typeof t)d=0|t;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var m=t;if("shape"in m){var x=m.shape;nt(Array.isArray(x)&&x.length>=2,"invalid shape for framebuffer"),nt(x[0]===x[1],"cube framebuffer must be square"),d=x[0]}else"radius"in m&&(d=0|m.radius),"width"in m?(d=0|m.width,"height"in m&&nt(m.height===d,"must be square")):"height"in m&&(d=0|m.height);("color"in m||"colors"in m)&&(h=m.color||m.colors,Array.isArray(h)&&nt(1===h.length||n.webgl_draw_buffers,"multiple render targets not supported")),h||("colorCount"in m&&(b=0|m.colorCount,nt(b>0,"invalid color buffer count")),"colorType"in m&&(nt.oneOf(m.colorType,f,"invalid color type"),g=m.colorType),"colorFormat"in m&&(p=m.colorFormat,nt.oneOf(m.colorFormat,s,"invalid color format for texture"))),"depth"in m&&(c.depth=m.depth),"stencil"in m&&(c.stencil=m.stencil),"depthStencil"in m&&(c.depthStencil=m.depthStencil)}else d=1;if(h)if(Array.isArray(h))for(u=[],r=0;r<h.length;++r)u[r]=h[r];else u=[h];else{u=Array(b);var v={radius:d,format:p,type:g};for(r=0;r<b;++r)u[r]=i.createCube(v)}for(c.color=Array(u.length),r=0;r<u.length;++r){var y=u[r];nt("function"==typeof y&&"textureCube"===y._reglType,"invalid cube map"),d=d||y.width,nt(y.width===d&&y.height===d,"invalid cube map shape"),c.color[r]={target:ci,data:u[r]}}for(r=0;r<6;++r){for(var _=0;_<u.length;++_)c.color[_].target=ci+r;r>0&&(c.depth=o[0].depth,c.stencil=o[0].stencil,c.depthStencil=o[0].depthStencil),o[r]?o[r](c):o[r]=E(c)}return e(a,{width:d,height:d,color:u})}function u(t){var e,n=0|t;if(nt(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a}return a(t),e(a,{faces:o,resize:u,_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})}function B(){l.cur=null,l.next=null,l.dirty=!0,we(y).forEach((function(e){e.framebuffer=t.createFramebuffer(),T(e)}))}return e(l,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof _)return e}return null},create:E,createCube:C,clear:function(){we(y).forEach(A)},restore:B})}Ni[bi]="complete",Ni[mi]="incomplete attachment",Ni[vi]="incomplete dimensions",Ni[xi]="incomplete, missing attachment",Ni[yi]="unsupported";var Ri=5126,Oi=34962;function Hi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ri,this.offset=0,this.stride=0,this.divisor=0}function Vi(e,n,r,i,o){for(var a=r.maxAttributes,l=new Array(a),s=0;s<a;++s)l[s]=new Hi;var u=0,f={},c={Record:Hi,scope:{},state:l,currentVAO:null,targetVAO:null,restore:h()?y:function(){},createVAO:_,getVAO:g,destroyBuffer:d,setVAO:h()?b:m,clear:h()?x:function(){}};function d(t){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}}function h(){return n.oes_vertex_array_object}function p(){return n.angle_instanced_arrays}function g(t){return"function"==typeof t&&t._vao?t._vao:null}function b(t){if(t!==c.currentVAO){var e=h();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),c.currentVAO=t}}function m(t){if(t!==c.currentVAO){if(t)t.bindAttrs();else for(var n=p(),r=0;r<l.length;++r){var i=l[r];i.buffer?(e.enableVertexAttribArray(r),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}c.currentVAO=t}}function x(){we(f).forEach((function(t){t.destroy()}))}function v(){this.id=++u,this.attributes=[];var t=h();this.vao=t?t.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}function y(){h()&&we(f).forEach((function(t){t.refresh()}))}function _(e){var r=new v;function l(e){nt(Array.isArray(e),"arguments to vertex array constructor must be an array"),nt(e.length<a,"too many attributes"),nt(e.length>0,"must specify at least one attribute");for(var i=0;i<r.buffers.length;++i)r.buffers[i].destroy();r.buffers.length=0;var s=r.attributes;s.length=e.length;for(var u=0;u<e.length;++u){var f=e[u],c=s[u]=new Hi;if(Array.isArray(f)||t(f)||_e(f)){var d=o.create(f,Oi,!1,!0);c.buffer=o.getBuffer(d),c.size=0|c.buffer.dimension,c.normalized=!1,c.type=c.buffer.dtype,c.offset=0,c.stride=0,c.divisor=0,c.state=1,r.buffers.push(d)}else o.getBuffer(f)?(c.buffer=o.getBuffer(f),c.size=0|c.buffer.dimension,c.normalized=!1,c.type=c.buffer.dtype,c.offset=0,c.stride=0,c.divisor=0,c.state=1):o.getBuffer(f.buffer)?(c.buffer=o.getBuffer(f.buffer),c.size=0|(+f.size||c.buffer.dimension),c.normalized=!!f.normalized||!1,"type"in f?(nt.parameter(f.type,Ie,"invalid buffer type"),c.type=Ie[f.type]):c.type=c.buffer.dtype,c.offset=0|(f.offset||0),c.stride=0|(f.stride||0),c.divisor=0|(f.divisor||0),c.state=1,nt(c.size>=1&&c.size<=4,"size must be between 1 and 4"),nt(c.offset>=0,"invalid offset"),nt(c.stride>=0&&c.stride<=255,"stride must be between 0 and 255"),nt(c.divisor>=0,"divisor must be positive"),nt(!c.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in f?(nt(u>0,"first attribute must not be a constant"),c.x=+f.x||0,c.y=+f.y||0,c.z=+f.z||0,c.w=+f.w||0,c.state=2):nt(!1,"invalid attribute spec for location "+u)}return r.refresh(),l}return i.vaoCount+=1,l.destroy=function(){r.destroy()},l._vao=r,l._reglType="vao",l(e)}return v.prototype.bindAttrs=function(){for(var t=p(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(Oi,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)e.disableVertexAttribArray(o)},v.prototype.refresh=function(){var t=h();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),c.currentVAO=this)},v.prototype.destroy=function(){if(this.vao){var t=h();this===c.currentVAO&&(c.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}f[this.id]&&(delete f[this.id],i.vaoCount-=1)},c}var zi=35632,Pi=35633,Ui=35718,Gi=35721;function ji(t,e,n,r){var i={},o={};function a(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function l(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function s(n,r,a){var l=n===zi?i:o,s=l[r];if(!s){var u=e.str(r);s=t.createShader(n),t.shaderSource(s,u),t.compileShader(s),nt.shaderError(t,s,u,n,a),l[r]=s}return s}var u={},f=[],c=0;function d(t,e){this.id=c++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function h(n,i,o){var u,f,c=s(zi,n.fragId),d=s(Pi,n.vertId),h=n.program=t.createProgram();if(t.attachShader(h,c),t.attachShader(h,d),o)for(u=0;u<o.length;++u){var p=o[u];t.bindAttribLocation(h,p[0],p[1])}t.linkProgram(h),nt.linkError(t,h,e.str(n.fragId),e.str(n.vertId),i);var g=t.getProgramParameter(h,Ui);r.profile&&(n.stats.uniformsCount=g);var b=n.uniforms;for(u=0;u<g;++u)if(f=t.getActiveUniform(h,u))if(f.size>1)for(var m=0;m<f.size;++m){var x=f.name.replace("[0]","["+m+"]");l(b,new a(x,e.id(x),t.getUniformLocation(h,x),f))}else l(b,new a(f.name,e.id(f.name),t.getUniformLocation(h,f.name),f));var v=t.getProgramParameter(h,Gi);r.profile&&(n.stats.attributesCount=v);var y=n.attributes;for(u=0;u<v;++u)(f=t.getActiveAttrib(h,u))&&l(y,new a(f.name,e.id(f.name),t.getAttribLocation(h,f.name),f))}function p(){i={},o={};for(var t=0;t<f.length;++t)h(f[t],null,f[t].attributes.map((function(t){return[t.location,t.name]})))}return r.profile&&(n.getMaxUniformsCount=function(){var t=0;return f.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},n.getMaxAttributesCount=function(){var t=0;return f.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);we(i).forEach(e),i={},we(o).forEach(e),o={},f.forEach((function(e){t.deleteProgram(e.program)})),f.length=0,u={},n.shaderCount=0},program:function(t,e,r,i){nt.command(t>=0,"missing vertex shader",r),nt.command(e>=0,"missing fragment shader",r);var o=u[e];o||(o=u[e]={});var a=o[t];if(a&&!i)return a;var l=new d(e,t);return n.shaderCount++,h(l,r,i),a||(o[t]=l),f.push(l),l},restore:p,shader:s,frag:-1,vert:-1}}var Xi=6408,Wi=5121,qi=3333,Zi=5126;function Yi(e,n,r,i,o,a,l){function s(s){var u;null===n.next?(nt(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Wi):(nt(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(nt(u===Wi||u===Zi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),u===Zi&&nt(l.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):nt(u===Wi,"Reading from a framebuffer is only allowed for the type 'uint8'"));var f=0,c=0,d=i.framebufferWidth,h=i.framebufferHeight,p=null;t(s)?p=s:s&&(nt.type(s,"object","invalid arguments to regl.read()"),f=0|s.x,c=0|s.y,nt(f>=0&&f<i.framebufferWidth,"invalid x offset for regl.read"),nt(c>=0&&c<i.framebufferHeight,"invalid y offset for regl.read"),d=0|(s.width||i.framebufferWidth-f),h=0|(s.height||i.framebufferHeight-c),p=s.data||null),p&&(u===Wi?nt(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Zi&&nt(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),nt(d>0&&d+f<=i.framebufferWidth,"invalid width for read pixels"),nt(h>0&&h+c<=i.framebufferHeight,"invalid height for read pixels"),r();var g=d*h*4;return p||(u===Wi?p=new Uint8Array(g):u===Zi&&(p=p||new Float32Array(g))),nt.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),nt(p.byteLength>=g,"data buffer for regl.read() too small"),e.pixelStorei(qi,4),e.readPixels(f,c,d,h,Xi,u,p),p}function u(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=s(t)})),e}function f(t){return t&&"framebuffer"in t?u(t):s(t)}return f}function $i(t){return Array.prototype.slice.call(t)}function Ki(t){return $i(t).join("")}function Qi(){var t=0,n=[],r=[];function i(e){for(var i=0;i<r.length;++i)if(r[i]===e)return n[i];var o="g"+t++;return n.push(o),r.push(e),o}function o(){var n=[];function r(){n.push.apply(n,$i(arguments))}var i=[];function o(){var e="v"+t++;return i.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,$i(arguments)),n.push(";")),e}return e(r,{def:o,toString:function(){return Ki([i.length>0?"var "+i.join(",")+";":"",Ki(n)])}})}function a(){var t=o(),n=o(),r=t.toString,i=n.toString;function a(e,r){n(e,r,"=",t.def(e,r),";")}return e((function(){t.apply(t,$i(arguments))}),{def:t.def,entry:t,exit:n,save:a,set:function(e,n,r){a(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function l(){var t=Ki(arguments),n=a(),r=a(),i=n.toString,o=r.toString;return e(n,{then:function(){return n.apply(n,$i(arguments)),this},else:function(){return r.apply(r,$i(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),Ki(["if(",t,"){",i(),"}",e])}})}var s=o(),u={};function f(t,n){var r=[];function i(){var t="a"+r.length;return r.push(t),t}n=n||0;for(var o=0;o<n;++o)i();var l=a(),s=l.toString;return u[t]=e(l,{arg:i,toString:function(){return Ki(["function(",r.join(),"){",s(),"}"])}})}function c(){var t=['"use strict";',s,"return {"];Object.keys(u).forEach((function(e){t.push('"',e,'":',u[e].toString(),",")})),t.push("}");var e=Ki(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,r)}return{global:s,link:i,block:o,proc:f,scope:a,cond:l,compile:c}}var Ji="xyzw".split(""),to=5121,eo=1,no=2,ro=0,io=1,oo=2,ao=3,lo=4,so="dither",uo="blend.enable",fo="blend.color",co="blend.equation",ho="blend.func",po="depth.enable",go="depth.func",bo="depth.range",mo="depth.mask",xo="colorMask",vo="cull.enable",yo="cull.face",_o="frontFace",wo="lineWidth",Ao="polygonOffset.enable",To="polygonOffset.offset",Eo="sample.alpha",Co="sample.enable",Bo="sample.coverage",So="stencil.enable",Lo="stencil.mask",Do="stencil.func",Io="stencil.opFront",Fo="stencil.opBack",ko="scissor.enable",No="scissor.box",Mo="viewport",Ro="profile",Oo="framebuffer",Ho="vert",Vo="frag",zo="elements",Po="primitive",Uo="count",Go="offset",jo="instances",Xo="vao",Wo="Width",qo="Height",Zo=Oo+Wo,Yo=Oo+qo,$o=Mo+Wo,Ko=Mo+qo,Qo="drawingBuffer",Jo=Qo+Wo,ta=Qo+qo,ea=[ho,co,Do,Io,Fo,Bo,Mo,No,To],na=34962,ra=34963,ia=3553,oa=34067,aa=2884,la=3042,sa=3024,ua=2960,fa=2929,ca=3089,da=32823,ha=32926,pa=32928,ga=5126,ba=35664,ma=35665,xa=35666,va=5124,ya=35667,_a=35668,wa=35669,Aa=35670,Ta=35671,Ea=35672,Ca=35673,Ba=35674,Sa=35675,La=35676,Da=35678,Ia=35680,Fa=4,ka=1028,Na=1029,Ma=2304,Ra=2305,Oa=32775,Ha=32776,Va=519,za=7680,Pa=0,Ua=1,Ga=32774,ja=513,Xa=36160,Wa=36064,qa={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Za=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ya={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$a={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ka={frag:35632,vert:35633},Qa={cw:Ma,ccw:Ra};function Ja(e){return Array.isArray(e)||t(e)||_e(e)}function tl(t){return t.sort((function(t,e){return t===Mo?-1:e===Mo?1:t<e?-1:1}))}function el(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function nl(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function rl(t){return new el(!1,!1,!1,t)}function il(t,e){var n=t.type;if(n===ro){var r=t.data.length;return new el(!0,r>=1,r>=2,e)}if(n===lo){var i=t.data;return new el(i.thisDep,i.contextDep,i.propDep,e)}return new el(n===ao,n===oo,n===io,e)}var ol=new el(!1,!1,!1,(function(){}));function al(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p){var g=u.Record,b={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(b.min=Oa,b.max=Ha);var m=n.angle_instanced_arrays,x=n.webgl_draw_buffers,v={dirty:!0,profile:p.profile},y={},_=[],w={},A={};function T(t){return t.replace(".","_")}function E(t,e,n){var r=T(t);_.push(t),y[r]=v[r]=!!n,w[r]=e}function C(t,e,n){var r=T(t);_.push(t),Array.isArray(n)?(v[r]=n.slice(),y[r]=n.slice()):v[r]=y[r]=n,A[r]=e}E(so,sa),E(uo,la),C(fo,"blendColor",[0,0,0,0]),C(co,"blendEquationSeparate",[Ga,Ga]),C(ho,"blendFuncSeparate",[Ua,Pa,Ua,Pa]),E(po,fa,!0),C(go,"depthFunc",ja),C(bo,"depthRange",[0,1]),C(mo,"depthMask",!0),C(xo,xo,[!0,!0,!0,!0]),E(vo,aa),C(yo,"cullFace",Na),C(_o,_o,Ra),C(wo,wo,1),E(Ao,da),C(To,"polygonOffset",[0,0]),E(Eo,ha),E(Co,pa),C(Bo,"sampleCoverage",[1,!1]),E(So,ua),C(Lo,"stencilMask",-1),C(Do,"stencilFunc",[Va,0,-1]),C(Io,"stencilOpSeparate",[ka,za,za,za]),C(Fo,"stencilOpSeparate",[Na,za,za,za]),E(ko,ca),C(No,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),C(Mo,Mo,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var B={gl:t,context:d,strings:e,next:y,current:v,draw:c,elements:o,buffer:i,shader:f,attributes:u.state,vao:u,uniforms:s,framebuffer:l,extensions:n,timer:h,isBufferArgs:Ja},S={primTypes:je,compareFuncs:Ya,blendFuncs:qa,blendEquations:b,stencilOps:$a,glTypes:Ie,orientationType:Qa};nt.optional((function(){B.isArrayLike=un})),x&&(S.backBuffer=[Na],S.drawBuffer=Tt(r.maxDrawbuffers,(function(t){return 0===t?[0]:Tt(t,(function(t){return Wa+t}))})));var L=0;function D(){var t=Qi(),n=t.link,r=t.global;t.id=L++,t.batchId="0";var i=n(B),o=t.shared={props:"a0"};Object.keys(B).forEach((function(t){o[t]=r.def(i,".",t)})),nt.optional((function(){t.CHECK=n(nt),t.commandStr=nt.guessCommand(),t.command=n(t.commandStr),t.assert=function(t,e,r){t("if(!(",e,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},S.invalidBlendCombinations=Za}));var a=t.next={},l=t.current={};Object.keys(A).forEach((function(t){Array.isArray(v[t])&&(a[t]=r.def(o.next,".",t),l[t]=r.def(o.current,".",t))}));var s=t.constants={};Object.keys(S).forEach((function(t){s[t]=r.def(JSON.stringify(S[t]))})),t.invoke=function(e,r){switch(r.type){case ro:var i=["this",o.context,o.props,t.batchId];return e.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case io:return e.def(o.props,r.data);case oo:return e.def(o.context,r.data);case ao:return e.def("this",r.data);case lo:return r.data.append(t,e),r.data.ref}},t.attribCache={};var f={};return t.scopeAttrib=function(t){var r=e.id(t);if(r in f)return f[r];var i=u.scope[r];return i||(i=u.scope[r]=new g),f[r]=n(i)},t}function I(t){var e,n=t.static,r=t.dynamic;if(Ro in n){var i=!!n[Ro];(e=rl((function(t,e){return i}))).enable=i}else if(Ro in r){var o=r[Ro];e=il(o,(function(t,e){return t.invoke(e,o)}))}return e}function F(t,e){var n=t.static,r=t.dynamic;if(Oo in n){var i=n[Oo];return i?(i=l.getFramebuffer(i),nt.command(i,"invalid framebuffer object"),rl((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+Zo,n+".width"),e.set(o,"."+Yo,n+".height"),n}))):rl((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+Zo,r+"."+Jo),e.set(r,"."+Yo,r+"."+ta),"null"}))}if(Oo in r){var o=r[Oo];return il(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");nt.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var l=r.context;return e.set(l,"."+Zo,a+"?"+a+".width:"+l+"."+Jo),e.set(l,"."+Yo,a+"?"+a+".height:"+l+"."+ta),a}))}return null}function k(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];nt.commandType(o,"object","invalid "+t,n.commandStr);var a,l,s=!0,u=0|o.x,f=0|o.y;return"width"in o?(a=0|o.width,nt.command(a>=0,"invalid "+t,n.commandStr)):s=!1,"height"in o?(l=0|o.height,nt.command(l>=0,"invalid "+t,n.commandStr)):s=!1,new el(!s&&e&&e.thisDep,!s&&e&&e.contextDep,!s&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",Zo,"-",u));var i=l;return"height"in o||(i=e.def(n,".",Yo,"-",f)),[u,f,r,i]}))}if(t in i){var c=i[t],d=il(c,(function(e,n){var r=e.invoke(n,c);nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),l=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Zo,"-",o,")"),s=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Yo,"-",a,")");return nt.optional((function(){e.assert(n,l+">=0&&"+s+">=0","invalid "+t)})),[o,a,l,s]}));return e&&(d.thisDep=d.thisDep||e.thisDep,d.contextDep=d.contextDep||e.contextDep,d.propDep=d.propDep||e.propDep),d}return e?new el(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Zo),e.def(n,".",Yo)]})):null}var a=o(Mo);if(a){var l=a;a=new el(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=l.append(t,e),r=t.shared.context;return e.set(r,"."+$o,n[2]),e.set(r,"."+Ko,n[3]),n}))}return{viewport:a,scissor_box:o(No)}}function N(t,e){var n=t.static;if("string"==typeof n[Vo]&&"string"==typeof n[Ho]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)nt("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}function M(t,n,r){var i=t.static,o=t.dynamic;function a(t){if(t in i){var n=e.id(i[t]);nt.optional((function(){f.shader(Ka[t],n,nt.guessCommand())}));var r=rl((function(){return n}));return r.id=n,r}if(t in o){var a=o[t];return il(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return nt.optional((function(){n(e.shared.shader,".shader(",Ka[t],",",i,",",e.command,");")})),i}))}return null}var l,s=a(Vo),u=a(Ho),c=null;return nl(s)&&nl(u)?(c=f.program(u.id,s.id,null,r),l=rl((function(t,e){return t.link(c)}))):l=new el(s&&s.thisDep||u&&u.thisDep,s&&s.contextDep||u&&u.contextDep,s&&s.propDep||u&&u.propDep,(function(t,e){var n,r=t.shared.shader;n=s?s.append(t,e):e.def(r,".",Vo);var i=r+".program("+(u?u.append(t,e):e.def(r,".",Ho))+","+n;return nt.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:s,vert:u,progVar:l,program:c}}function R(t,e){var n=t.static,r=t.dynamic;function i(){if(zo in n){var t=n[zo];Ja(t)?t=o.getElements(o.create(t,!0)):t&&(t=o.getElements(t),nt.command(t,"invalid elements",e.commandStr));var i=rl((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return i.value=t,i}if(zo in r){var a=r[zo];return il(a,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,o=t.invoke(e,a),l=e.def("null"),s=e.def(r,"(",o,")"),u=t.cond(s).then(l,"=",i,".createStream(",o,");").else(l,"=",i,".getElements(",o,");");return nt.optional((function(){t.assert(u.else,"!"+o+"||"+l,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",l,");")),t.ELEMENTS=l,l}))}return null}var a=i();function l(){if(Po in n){var t=n[Po];return nt.commandParameter(t,je,"invalid primitve",e.commandStr),rl((function(e,n){return je[t]}))}if(Po in r){var i=r[Po];return il(i,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,i);return nt.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(je))})),e.def(n,"[",r,"]")}))}return a?nl(a)?a.value?rl((function(t,e){return e.def(t.ELEMENTS,".primType")})):rl((function(){return Fa})):new el(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",Fa)})):null}function s(t,i){if(t in n){var o=0|n[t];return nt.command(!i||o>=0,"invalid "+t,e.commandStr),rl((function(t,e){return i&&(t.OFFSET=o),o}))}if(t in r){var l=r[t];return il(l,(function(e,n){var r=e.invoke(n,l);return i&&(e.OFFSET=r,nt.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}return i&&a?rl((function(t,e){return t.OFFSET="0",0})):null}var u=s(Go,!0);function f(){if(Uo in n){var t=0|n[Uo];return nt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),rl((function(){return t}))}if(Uo in r){var i=r[Uo];return il(i,(function(t,e){var n=t.invoke(e,i);return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(a){if(nl(a)){if(a)return u?new el(u.thisDep,u.contextDep,u.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return nt.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):rl((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var o=rl((function(){return-1}));return nt.optional((function(){o.MISSING=!0})),o}var l=new el(a.thisDep||u.thisDep,a.contextDep||u.contextDep,a.propDep||u.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return nt.optional((function(){l.DYNAMIC=!0})),l}return null}return{elements:a,primitive:l(),count:f(),instances:s(jo,!1),offset:u}}function O(t,e){var n=t.static,i=t.dynamic,o={};return _.forEach((function(t){var a=T(t);function l(e,r){if(t in n){var l=e(n[t]);o[a]=rl((function(){return l}))}else if(t in i){var s=i[t];o[a]=il(s,(function(t,e){return r(t,e,t.invoke(e,s))}))}}switch(t){case vo:case uo:case so:case So:case po:case ko:case Ao:case Eo:case Co:case mo:return l((function(n){return nt.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return nt.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case go:return l((function(n){return nt.commandParameter(n,Ya,"invalid "+t,e.commandStr),Ya[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return nt.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(Ya))})),n.def(i,"[",r,"]")}));case bo:return l((function(t){return nt.command(un(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case ho:return l((function(t){nt.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return nt.commandParameter(n,qa,a+".srcRGB",e.commandStr),nt.commandParameter(r,qa,a+".srcAlpha",e.commandStr),nt.commandParameter(i,qa,a+".dstRGB",e.commandStr),nt.commandParameter(o,qa,a+".dstAlpha",e.commandStr),nt.command(-1===Za.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[qa[n],qa[i],qa[r],qa[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var l=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return nt.optional((function(){e.assert(n,l+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys(qa))})),l}nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),l=o("dst","RGB");nt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+l+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var s=n.def(i,"[",a,"]"),u=n.def(i,"[",o("src","Alpha"),"]");return[s,n.def(i,"[",l,"]"),u,n.def(i,"[",o("dst","Alpha"),"]")]}));case co:return l((function(n){return"string"==typeof n?(nt.commandParameter(n,b,"invalid "+t,e.commandStr),[b[n],b[n]]):"object"==typeof n?(nt.commandParameter(n.rgb,b,t+".rgb",e.commandStr),nt.commandParameter(n.alpha,b,t+".alpha",e.commandStr),[b[n.rgb],b[n.alpha]]):void nt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),l=e.cond("typeof ",r,'==="string"');return nt.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(b))}n(l.then,t,r),e.assert(l.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(l.else,t+".rgb",r+".rgb"),n(l.else,t+".alpha",r+".alpha")})),l.then(o,"=",a,"=",i,"[",r,"];"),l.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(l),[o,a]}));case fo:return l((function(t){return nt.command(un(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),Tt(4,(function(e){return+t[e]}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Tt(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case Lo:return l((function(t){return nt.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case Do:return l((function(n){nt.commandType(n,"object",a,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return nt.commandParameter(r,Ya,t+".cmp",e.commandStr),nt.commandType(i,"number",t+".ref",e.commandStr),nt.commandType(o,"number",t+".mask",e.commandStr),[Ya[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;return nt.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",za),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Io:case Fo:return l((function(n){nt.commandType(n,"object",a,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return nt.commandParameter(r,$a,t+".fail",e.commandStr),nt.commandParameter(i,$a,t+".zfail",e.commandStr),nt.commandParameter(o,$a,t+".zpass",e.commandStr),[t===Fo?Na:ka,$a[r],$a[i],$a[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return nt.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys($a))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",za)}return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===Fo?Na:ka,o("fail"),o("zfail"),o("zpass")]}));case To:return l((function(t){nt.commandType(t,"object",a,e.commandStr);var n=0|t.factor,r=0|t.units;return nt.commandType(n,"number",a+".factor",e.commandStr),nt.commandType(r,"number",a+".units",e.commandStr),[n,r]}),(function(e,n,r){return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case yo:return l((function(t){var n=0;return"front"===t?n=ka:"back"===t&&(n=Na),nt.command(!!n,a,e.commandStr),n}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',ka,":",Na)}));case wo:return l((function(t){return nt.command("number"==typeof t&&t>=r.lineWidthDims[0]&&t<=r.lineWidthDims[1],"invalid line width, must be a positive number between "+r.lineWidthDims[0]+" and "+r.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+r.lineWidthDims[0]+"&&"+n+"<="+r.lineWidthDims[1],"invalid line width")})),n}));case _o:return l((function(t){return nt.commandParameter(t,Qa,a,e.commandStr),Qa[t]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+Ma+":"+Ra)}));case xo:return l((function(t){return nt.command(un(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Tt(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Bo:return l((function(t){nt.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return nt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),o}function H(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"==typeof o||"boolean"==typeof o)r=rl((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=rl((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(nt.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=rl((function(t){return t.link(o.color[0])}))):nt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else un(o)?r=rl((function(e){return e.global.def("[",Tt(o.length,(function(n){return nt.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]")})):nt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=il(e,(function(t,n){return t.invoke(n,e)}))})),i}function V(t,n){var r=t.static,o=t.dynamic,a={};return Object.keys(r).forEach((function(t){var o=r[t],l=e.id(t),s=new g;if(Ja(o))s.state=eo,s.buffer=i.getBuffer(i.create(o,na,!1,!0)),s.type=0;else{var u=i.getBuffer(o);if(u)s.state=eo,s.buffer=u,s.type=0;else if(nt.command("object"==typeof o&&o,"invalid data for attribute "+t,n.commandStr),"constant"in o){var f=o.constant;s.buffer="null",s.state=no,"number"==typeof f?s.x=f:(nt.command(un(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+t,n.commandStr),Ji.forEach((function(t,e){e<f.length&&(s[t]=f[e])})))}else{u=Ja(o.buffer)?i.getBuffer(i.create(o.buffer,na,!1,!0)):i.getBuffer(o.buffer),nt.command(!!u,'missing buffer for attribute "'+t+'"',n.commandStr);var c=0|o.offset;nt.command(c>=0,'invalid offset for attribute "'+t+'"',n.commandStr);var d=0|o.stride;nt.command(d>=0&&d<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',n.commandStr);var h=0|o.size;nt.command(!("size"in o)||h>0&&h<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',n.commandStr);var p=!!o.normalized,b=0;"type"in o&&(nt.commandParameter(o.type,Ie,"invalid type for attribute "+t,n.commandStr),b=Ie[o.type]);var x=0|o.divisor;"divisor"in o&&(nt.command(0===x||m,'cannot specify divisor for attribute "'+t+'", instancing not supported',n.commandStr),nt.command(x>=0,'invalid divisor for attribute "'+t+'"',n.commandStr)),nt.optional((function(){var e=n.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(o).forEach((function(n){nt.command(r.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",e)}))})),s.buffer=u,s.state=eo,s.size=h,s.normalized=p,s.type=b||u.dtype,s.offset=c,s.stride=d,s.divisor=x}}a[t]=rl((function(t,e){var n=t.attribCache;if(l in n)return n[l];var r={isStream:!1};return Object.keys(s).forEach((function(t){r[t]=s[t]})),s.buffer&&(r.buffer=t.link(s.buffer),r.type=r.type||r.buffer+".dtype"),n[l]=r,r}))})),Object.keys(o).forEach((function(t){var e=o[t];function n(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,l=o.isBufferArgs,s=o.buffer;nt.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+l+"("+i+")||"+s+".getBuffer("+i+")||"+s+".getBuffer("+i+".buffer)||"+l+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var u={isStream:r.def(!1)},f=new g;f.state=eo,Object.keys(f).forEach((function(t){u[t]=r.def(""+f[t])}));var c=u.buffer,d=u.type;function h(t){r(u[t],"=",i,".",t,"|0;")}return r("if(",l,"(",i,")){",u.isStream,"=true;",c,"=",s,".createStream(",na,",",i,");",d,"=",c,".dtype;","}else{",c,"=",s,".getBuffer(",i,");","if(",c,"){",d,"=",c,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",no,";","if(typeof "+i+'.constant === "number"){',u[Ji[0]],"=",i,".constant;",Ji.slice(1).map((function(t){return u[t]})).join("="),"=0;","}else{",Ji.map((function(t,e){return u[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",l,"(",i,".buffer)){",c,"=",s,".createStream(",na,",",i,".buffer);","}else{",c,"=",s,".getBuffer(",i,".buffer);","}",d,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",c,".dtype;",u.normalized,"=!!",i,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),r("}}"),r.exit("if(",u.isStream,"){",s,".destroyStream(",c,");","}"),u}a[t]=il(e,n)})),a}function z(t,e){var n=t.static,r=t.dynamic;if(Xo in n){var i=n[Xo];return null!==i&&null===u.getVAO(i)&&(i=u.createVAO(i)),rl((function(t){return t.link(u.getVAO(i))}))}if(Xo in r){var o=r[Xo];return il(o,(function(t,e){var n=t.invoke(e,o);return e.def(t.shared.vao+".getVAO("+n+")")}))}return null}function P(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=rl((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=il(e,(function(t,n){return t.invoke(n,e)}))})),r}function U(t,e,r,i,o){var a=t.static,l=t.dynamic;nt.optional((function(){var t=[Oo,Ho,Vo,zo,Po,Go,Uo,jo,Ro,Xo].concat(_);function e(e){Object.keys(e).forEach((function(e){nt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',o.commandStr)}))}e(a),e(l)}));var s=N(t,e),f=F(t),c=k(t,f,o),d=R(t,o),h=O(t,o),p=M(t,o,s);function g(t){var e=c[t];e&&(h[t]=e)}g(Mo),g(T(No));var b=Object.keys(h).length>0,m={framebuffer:f,draw:d,shader:p,state:h,dirty:b,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(m.profile=I(t),m.uniforms=H(r,o),m.drawVAO=m.scopeVAO=z(t),!m.drawVAO&&p.program&&!s&&n.angle_instanced_arrays){var x=!0,v=p.program.attributes.map((function(t){var n=e.static[t];return x=x&&!!n,n}));if(x&&v.length>0){var y=u.getVAO(u.createVAO(v));m.drawVAO=new el(null,null,null,(function(t,e){return t.link(y)})),m.useVAO=!0}}return s?m.useVAO=!0:m.attributes=V(e,o),m.context=P(i),m}function G(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(o){e.save(r,"."+o);var a=n[o];i(r,".",o,"=",a.append(t,e),";")})),e(i)}function j(t,e,n,r){var i,o=t.shared,a=o.gl,l=o.framebuffer;x&&(i=e.def(o.extensions,".webgl_draw_buffers"));var s,u=t.constants,f=u.drawBuffer,c=u.backBuffer;s=n?n.append(t,e):e.def(l,".next"),r||e("if(",s,"!==",l,".cur){"),e("if(",s,"){",a,".bindFramebuffer(",Xa,",",s,".framebuffer);"),x&&e(i,".drawBuffersWEBGL(",f,"[",s,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",Xa,",null);"),x&&e(i,".drawBuffersWEBGL(",c,");"),e("}",l,".cur=",s,";"),r||e("}")}function X(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,l=r.current,s=r.next,u=t.cond(l,".dirty");_.forEach((function(e){var r,f,c=T(e);if(!(c in n.state))if(c in a){r=a[c],f=o[c];var d=Tt(v[c].length,(function(t){return u.def(r,"[",t,"]")}));u(t.cond(d.map((function(t,e){return t+"!=="+f+"["+e+"]"})).join("||")).then(i,".",A[c],"(",d,");",d.map((function(t,e){return f+"["+e+"]="+t})).join(";"),";"))}else{r=u.def(s,".",c);var h=t.cond(r,"!==",l,".",c);u(h),c in w?h(t.cond(r).then(i,".enable(",w[c],");").else(i,".disable(",w[c],");"),l,".",c,"=",r,";"):h(i,".",A[c],"(",r,");",l,".",c,"=",r,";")}})),0===Object.keys(n.state).length&&u(l,".dirty=false;"),e(u)}function W(t,e,n,r){var i=t.shared,o=t.current,a=i.current,l=i.gl;tl(Object.keys(n)).forEach((function(i){var s=n[i];if(!r||r(s)){var u=s.append(t,e);if(w[i]){var f=w[i];nl(s)?e(l,u?".enable(":".disable(",f,");"):e(t.cond(u).then(l,".enable(",f,");").else(l,".disable(",f,");")),e(a,".",i,"=",u,";")}else if(un(u)){var c=o[i];e(l,".",A[i],"(",u,");",u.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";")}else e(l,".",A[i],"(",u,");",a,".",i,"=",u,";")}}))}function q(t,e){m&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function Z(t,e,n,r,i){var o,a,l,s=t.shared,u=t.stats,f=s.current,c=s.timer,d=n.profile;function p(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(t){t(o=e.def(),"=",p(),";"),"string"==typeof i?t(u,".count+=",i,";"):t(u,".count++;"),h&&(r?t(a=e.def(),"=",c,".getNumPendingQueries();"):t(c,".beginQuery(",u,");"))}function b(t){t(u,".cpuTime+=",p(),"-",o,";"),h&&(r?t(c,".pushScopeStats(",a,",",c,".getNumPendingQueries(),",u,");"):t(c,".endQuery();"))}function m(t){var n=e.def(f,".profile");e(f,".profile=",t,";"),e.exit(f,".profile=",n,";")}if(d){if(nl(d))return void(d.enable?(g(e),b(e.exit),m("true")):m("false"));m(l=d.append(t,e))}else l=e.def(f,".profile");var x=t.block();g(x),e("if(",l,"){",x,"}");var v=t.block();b(v),e.exit("if(",l,"){",v,"}")}function Y(t,e,n,r,i){var o=t.shared;function a(t){switch(t){case ba:case ya:case Ta:return 2;case ma:case _a:case Ea:return 3;case xa:case wa:case Ca:return 4;default:return 1}}function l(n,r,i){var a=o.gl,l=e.def(n,".location"),s=e.def(o.attributes,"[",l,"]"),u=i.state,f=i.buffer,c=[i.x,i.y,i.z,i.w],d=["buffer","normalized","offset","stride"];function h(){e("if(!",s,".buffer){",a,".enableVertexAttribArray(",l,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",s,".type!==",o,"||",s,".size!==",n,"||",d.map((function(t){return s+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",na,",",f,".buffer);",a,".vertexAttribPointer(",[l,n,o,i.normalized,i.stride,i.offset],");",s,".type=",o,";",s,".size=",n,";",d.map((function(t){return s+"."+t+"="+i[t]+";"})).join(""),"}"),m){var u=i.divisor;e("if(",s,".divisor!==",u,"){",t.instancing,".vertexAttribDivisorANGLE(",[l,u],");",s,".divisor=",u,";}")}}function p(){e("if(",s,".buffer){",a,".disableVertexAttribArray(",l,");",s,".buffer=null;","}if(",Ji.map((function(t,e){return s+"."+t+"!=="+c[e]})).join("||"),"){",a,".vertexAttrib4f(",l,",",c,");",Ji.map((function(t,e){return s+"."+t+"="+c[e]+";"})).join(""),"}")}u===eo?h():u===no?p():(e("if(",u,"===",eo,"){"),h(),e("}else{"),p(),e("}"))}r.forEach((function(r){var o,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;o=u.append(t,e)}else{if(!i(ol))return;var f=t.scopeAttrib(s);nt.optional((function(){t.assert(e,f+".state","missing attribute "+s)})),o={},Object.keys(new g).forEach((function(t){o[t]=e.def(f,".",t)}))}l(t.link(r),a(r.info.type),o)}))}function $(t,n,r,i,o){for(var a,l=t.shared,s=l.gl,u=0;u<i.length;++u){var f,c=i[u],d=c.name,h=c.info.type,p=r.uniforms[d],g=t.link(c)+".location";if(p){if(!o(p))continue;if(nl(p)){var b=p.value;if(nt.command(null!=b,'missing uniform "'+d+'"',t.commandStr),h===Da||h===Ia){nt.command("function"==typeof b&&(h===Da&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||h===Ia&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+d,t.commandStr);var m=t.link(b._texture||b.color[0]._texture);n(s,".uniform1i(",g,",",m+".bind());"),n.exit(m,".unbind();")}else if(h===Ba||h===Sa||h===La){nt.optional((function(){nt.command(un(b),"invalid matrix for uniform "+d,t.commandStr),nt.command(h===Ba&&4===b.length||h===Sa&&9===b.length||h===La&&16===b.length,"invalid length for matrix uniform "+d,t.commandStr)}));var x=t.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),v=2;h===Sa?v=3:h===La&&(v=4),n(s,".uniformMatrix",v,"fv(",g,",false,",x,");")}else{switch(h){case ga:nt.commandType(b,"number","uniform "+d,t.commandStr),a="1f";break;case ba:nt.command(un(b)&&2===b.length,"uniform "+d,t.commandStr),a="2f";break;case ma:nt.command(un(b)&&3===b.length,"uniform "+d,t.commandStr),a="3f";break;case xa:nt.command(un(b)&&4===b.length,"uniform "+d,t.commandStr),a="4f";break;case Aa:nt.commandType(b,"boolean","uniform "+d,t.commandStr),a="1i";break;case va:nt.commandType(b,"number","uniform "+d,t.commandStr),a="1i";break;case Ta:case ya:nt.command(un(b)&&2===b.length,"uniform "+d,t.commandStr),a="2i";break;case Ea:case _a:nt.command(un(b)&&3===b.length,"uniform "+d,t.commandStr),a="3i";break;case Ca:case wa:nt.command(un(b)&&4===b.length,"uniform "+d,t.commandStr),a="4i"}n(s,".uniform",a,"(",g,",",un(b)?Array.prototype.slice.call(b):b,");")}continue}f=p.append(t,n)}else{if(!o(ol))continue;f=n.def(l.uniforms,"[",e.id(d),"]")}h===Da?n("if(",f,"&&",f,'._reglType==="framebuffer"){',f,"=",f,".color[0];","}"):h===Ia&&n("if(",f,"&&",f,'._reglType==="framebufferCube"){',f,"=",f,".color[0];","}"),nt.optional((function(){function e(e,r){t.assert(n,e,'bad data or missing for uniform "'+d+'".  '+r)}function r(t){e("typeof "+f+'==="'+t+'"',"invalid type, expected "+t)}function i(n,r){e(l.isArrayLike+"("+f+")&&"+f+".length==="+n,"invalid vector, should have length "+n,t.commandStr)}function o(n){e("typeof "+f+'==="function"&&'+f+'._reglType==="texture'+(n===ia?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(h){case va:r("number");break;case ya:i(2);break;case _a:i(3);break;case wa:i(4);break;case ga:r("number");break;case ba:i(2);break;case ma:i(3);break;case xa:i(4);break;case Aa:r("boolean");break;case Ta:i(2);break;case Ea:i(3);break;case Ca:case Ba:i(4);break;case Sa:i(9);break;case La:i(16);break;case Da:o(ia);break;case Ia:o(oa)}}));var y=1;switch(h){case Da:case Ia:var _=n.def(f,"._texture");n(s,".uniform1i(",g,",",_,".bind());"),n.exit(_,".unbind();");continue;case va:case Aa:a="1i";break;case ya:case Ta:a="2i",y=2;break;case _a:case Ea:a="3i",y=3;break;case wa:case Ca:a="4i",y=4;break;case ga:a="1f";break;case ba:a="2f",y=2;break;case ma:a="3f",y=3;break;case xa:a="4f",y=4;break;case Ba:a="Matrix2fv";break;case Sa:a="Matrix3fv";break;case La:a="Matrix4fv"}if(n(s,".uniform",a,"(",g,","),"M"===a.charAt(0)){var w=Math.pow(h-Ba+2,2),A=t.global.def("new Float32Array(",w,")");n("false,(Array.isArray(",f,")||",f," instanceof Float32Array)?",f,":(",Tt(w,(function(t){return A+"["+t+"]="+f+"["+t+"]"})),",",A,")")}else n(y>1?Tt(y,(function(t){return f+"["+t+"]"})):f);n(");")}}function K(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,l=r.draw;function s(){var i,s=l.elements,u=e;return s?((s.contextDep&&r.contextDynamic||s.propDep)&&(u=n),i=s.append(t,u)):i=u.def(a,".",zo),i&&u("if("+i+")"+o+".bindBuffer("+ra+","+i+".buffer.buffer);"),i}function u(){var i,o=l.count,s=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(s=n),i=o.append(t,s),nt.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(s,i+">=0","missing vertex count")}))):(i=s.def(a,".",Uo),nt.optional((function(){t.assert(s,i+">=0","missing vertex count")}))),i}var f=s();function c(i){var o=l[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var d,h,p=c(Po),g=c(Go),b=u();if("number"==typeof b){if(0===b)return}else n("if(",b,"){"),n.exit("}");m&&(d=c(jo),h=t.instancing);var x=f+".type",v=l.elements&&nl(l.elements);function y(){function t(){n(h,".drawElementsInstancedANGLE(",[p,b,x,g+"<<(("+x+"-"+to+")>>1)",d],");")}function e(){n(h,".drawArraysInstancedANGLE(",[p,g,b,d],");")}f?v?t():(n("if(",f,"){"),t(),n("}else{"),e(),n("}")):e()}function _(){function t(){n(o+".drawElements("+[p,b,x,g+"<<(("+x+"-"+to+")>>1)"]+");")}function e(){n(o+".drawArrays("+[p,g,b]+");")}f?v?t():(n("if(",f,"){"),t(),n("}else{"),e(),n("}")):e()}m&&("number"!=typeof d||d>=0)?"string"==typeof d?(n("if(",d,">0){"),y(),n("}else if(",d,"<0){"),_(),n("}")):y():_()}function Q(t,e,n,r,i){var o=D(),a=o.proc("body",i);return nt.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),m&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function J(t,e,n,r){q(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),Y(t,e,n,r.attributes,(function(){return!0}))),$(t,e,n,r.uniforms,(function(){return!0})),K(t,e,e,n)}function tt(t,e){var n=t.proc("draw",1);q(t,n),G(t,n,e.context),j(t,n,e.framebuffer),X(t,n,e),W(t,n,e.state),Z(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)J(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return Q(J,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;")}function et(t,e,n,r){function i(){return!0}t.batchId="a1",q(t,e),Y(t,e,n,r.attributes,i),$(t,e,n,r.uniforms,i),K(t,e,e,n)}function rt(t,e,n,r){q(t,e);var i=n.contextDep,o=e.def(),a="a0",l="a1",s=e.def();t.shared.props=s,t.batchId=o;var u=t.scope(),f=t.scope();function c(t){return t.contextDep&&i||t.propDep}function d(t){return!c(t)}if(e(u.entry,"for(",o,"=0;",o,"<",l,";++",o,"){",s,"=",a,"[",o,"];",f,"}",u.exit),n.needsContext&&G(t,f,n.context),n.needsFramebuffer&&j(t,f,n.framebuffer),W(t,f,n.state,c),n.profile&&c(n.profile)&&Z(t,f,n,!1,!0),r)n.useVAO?n.drawVAO?c(n.drawVAO)?f(t.shared.vao,".setVAO(",n.drawVAO.append(t,f),");"):u(t.shared.vao,".setVAO(",n.drawVAO.append(t,u),");"):u(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(u(t.shared.vao,".setVAO(null);"),Y(t,u,n,r.attributes,d),Y(t,f,n,r.attributes,c)),$(t,u,n,r.uniforms,d),$(t,f,n,r.uniforms,c),K(t,u,f,n);else{var h=t.global.def("{}"),p=n.shader.progVar.append(t,f),g=f.def(p,".id"),b=f.def(h,"[",g,"]");f(t.shared.gl,".useProgram(",p,".program);","if(!",b,"){",b,"=",h,"[",g,"]=",t.link((function(e){return Q(et,t,n,e,2)})),"(",p,");}",b,".call(this,a0[",o,"],",o,");")}}function it(t,e){var n=t.proc("batch",2);t.batchId="0",q(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(G(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function l(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||j(t,n,o)):j(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),X(t,n,e),W(t,n,e.state,(function(t){return!l(t)})),e.profile&&l(e.profile)||Z(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var s=e.shader.progVar;if(s.contextDep&&r||s.propDep)rt(t,n,e,null);else{var u=s.append(t,n);if(n(t.shared.gl,".useProgram(",u,".program);"),e.shader.program)rt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var f=t.global.def("{}"),c=n.def(u,".id"),d=n.def(f,"[",c,"]");n(t.cond(d).then(d,".call(this,a0,a1);").else(d,"=",f,"[",c,"]=",t.link((function(n){return Q(rt,t,e,n,2)})),"(",u,");",d,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;")}function ot(t,n){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(e){var o=n.shader[e];o&&r.set(i.shader,"."+e,o.append(t,r))}G(t,r,n.context),n.framebuffer&&n.framebuffer.append(t,r),tl(Object.keys(n.state)).forEach((function(e){var o=n.state[e].append(t,r);un(o)?o.forEach((function(n,i){r.set(t.next[e],"["+i+"]",n)})):r.set(i.next,"."+e,o)})),Z(t,r,n,!0,!0),[zo,Go,Uo,jo,Po].forEach((function(e){var o=n.draw[e];o&&r.set(i.draw,"."+e,""+o.append(t,r))})),Object.keys(n.uniforms).forEach((function(o){r.set(i.uniforms,"["+e.id(o)+"]",n.uniforms[o].append(t,r))})),Object.keys(n.attributes).forEach((function(e){var i=n.attributes[e].append(t,r),o=t.scopeAttrib(e);Object.keys(new g).forEach((function(t){r.set(o,"."+t,i[t])}))})),n.scopeVAO&&r.set(i.vao,".targetVAO",n.scopeVAO.append(t,r)),a(Ho),a(Vo),Object.keys(n.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function at(t){if("object"==typeof t&&!un(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(dt.isDynamic(t[e[n]]))return!0;return!1}}function lt(t,e,n){var r=e.static[n];if(r&&at(r)){var i=t.global,o=Object.keys(r),a=!1,l=!1,s=!1,u=t.global.def("{}");o.forEach((function(e){var n=r[e];if(dt.isDynamic(n)){"function"==typeof n&&(n=r[e]=dt.unbox(n));var o=il(n,null);a=a||o.thisDep,s=s||o.propDep,l=l||o.contextDep}else{switch(i(u,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new dt.DynamicVariable(lo,{thisDep:a,contextDep:l,propDep:s,ref:u,append:f}),delete e.static[n]}function f(t,e){o.forEach((function(n){var i=r[n];if(dt.isDynamic(i)){var o=t.invoke(e,i);e(u,".",n,"=",o,";")}}))}}function st(t,e,n,r,i){var o=D();o.stats=o.link(i),Object.keys(e.static).forEach((function(t){lt(o,e,t)})),ea.forEach((function(e){lt(o,t,e)}));var a=U(t,e,n,r,o);return tt(o,a),ot(o,a),it(o,a),o.compile()}return{next:y,current:v,procs:function(){var t=D(),e=t.proc("poll"),i=t.proc("refresh"),o=t.block();e(o),i(o);var a,l=t.shared,s=l.gl,u=l.next,f=l.current;o(f,".dirty=false;"),j(t,e),j(t,i,null,!0),m&&(a=t.link(m)),n.oes_vertex_array_object&&i(t.link(n.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var c=0;c<r.maxAttributes;++c){var d=i.def(l.attributes,"[",c,"]"),h=t.cond(d,".buffer");h.then(s,".enableVertexAttribArray(",c,");",s,".bindBuffer(",na,",",d,".buffer.buffer);",s,".vertexAttribPointer(",c,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(s,".disableVertexAttribArray(",c,");",s,".vertexAttrib4f(",c,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),i(h),m&&i(a,".vertexAttribDivisorANGLE(",c,",",d,".divisor);")}return i(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(w).forEach((function(n){var r=w[n],a=o.def(u,".",n),l=t.block();l("if(",a,"){",s,".enable(",r,")}else{",s,".disable(",r,")}",f,".",n,"=",a,";"),i(l),e("if(",a,"!==",f,".",n,"){",l,"}")})),Object.keys(A).forEach((function(n){var r,a,l=A[n],c=v[n],d=t.block();if(d(s,".",l,"("),un(c)){var h=c.length;r=t.global.def(u,".",n),a=t.global.def(f,".",n),d(Tt(h,(function(t){return r+"["+t+"]"})),");",Tt(h,(function(t){return a+"["+t+"]="+r+"["+t+"];"})).join("")),e("if(",Tt(h,(function(t){return r+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",d,"}")}else r=o.def(u,".",n),a=o.def(f,".",n),d(r,");",f,".",n,"=",r,";"),e("if(",r,"!==",a,"){",d,"}");i(d)})),t.compile()}(),compile:st}}function ll(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var sl=34918,ul=34919,fl=35007,cl=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var o=[];function a(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(fl,n),o.push(n),h(o.length-1,o.length,t)}function l(){e.ext_disjoint_timer_query.endQueryEXT(fl)}function s(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var u=[];function f(){return u.pop()||new s}function c(t){u.push(t)}var d=[];function h(t,e,n){var r=f();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,d.push(r)}var p=[],g=[];function b(){var t,n,r=o.length;if(0!==r){g.length=Math.max(g.length,r+1),p.length=Math.max(p.length,r+1),p[0]=0,g[0]=0;var a=0;for(t=0,n=0;n<o.length;++n){var l=o[n];e.ext_disjoint_timer_query.getQueryObjectEXT(l,ul)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(l,sl),i(l)):o[t++]=l,p[n+1]=a,g[n+1]=t}for(o.length=t,t=0,n=0;n<d.length;++n){var s=d[n],u=s.startQueryIndex,f=s.endQueryIndex;s.sum+=p[f]-p[u];var h=g[u],b=g[f];b===h?(s.stats.gpuTime+=s.sum/1e6,c(s)):(s.startQueryIndex=h,s.endQueryIndex=b,d[t++]=s)}d.length=t}}return{beginQuery:a,endQuery:l,pushScopeStats:h,update:b,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},dl=16384,hl=256,pl=1024,gl=34962,bl="webglcontextlost",ml="webglcontextrestored",xl=1,vl=2,yl=3;function _l(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function wl(t){var n=wt(t);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),o=r.isContextLost(),a=At(r,n);if(!a)return null;var l=gt(),s=ll(),u=a.extensions,f=cl(r,u),c=pt(),d=r.drawingBufferWidth,h=r.drawingBufferHeight,p={tick:0,time:0,viewportWidth:d,viewportHeight:h,framebufferWidth:d,framebufferHeight:h,drawingBufferWidth:d,drawingBufferHeight:h,pixelRatio:n.pixelRatio},g={},b={elements:null,primitive:4,count:-1,offset:0,instances:-1},m=ye(r,u),x=Ge(r,s,n,y),v=Vi(r,u,m,s,x);function y(t){return v.destroyBuffer(t)}var _=rn(r,u,x,s),w=ji(r,l,s,n),A=qr(r,u,m,(function(){C.procs.poll()}),p,s,n),T=li(r,u,m,s,n),E=Mi(r,u,m,A,T,s),C=al(r,l,u,m,x,_,A,E,g,v,w,b,p,f,n),B=Yi(r,E,C.procs.poll,p,i,u,m),S=C.next,L=r.canvas,D=[],I=[],F=[],k=[n.onDestroy],N=null;function M(){if(0===D.length)return f&&f.update(),void(N=null);N=ht.next(M),q();for(var t=D.length-1;t>=0;--t){var e=D[t];e&&e(p,null,0)}r.flush(),f&&f.update()}function R(){!N&&D.length>0&&(N=ht.next(M))}function O(){N&&(ht.cancel(M),N=null)}function H(t){t.preventDefault(),o=!0,O(),I.forEach((function(t){t()}))}function V(t){r.getError(),o=!1,a.restore(),w.restore(),x.restore(),A.restore(),T.restore(),E.restore(),v.restore(),f&&f.restore(),C.procs.refresh(),R(),F.forEach((function(t){t()}))}function z(){D.length=0,O(),L&&(L.removeEventListener(bl,H),L.removeEventListener(ml,V)),w.clear(),E.clear(),T.clear(),A.clear(),_.clear(),x.clear(),v.clear(),f&&f.clear(),k.forEach((function(t){t()}))}function P(t){function n(t){var n=e({},t);function r(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(r){n[t+"."+r]=e[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(n.vao=t.vao),n}function r(t){var e={},n={};return Object.keys(t).forEach((function(r){var i=t[r];dt.isDynamic(i)?n[r]=dt.unbox(i,r):e[r]=i})),{dynamic:n,static:e}}nt(!!t,"invalid args to regl({...})"),nt.type(t,"object","invalid args to regl({...})");var i=r(t.context||{}),a=r(t.uniforms||{}),l=r(t.attributes||{}),s=r(n(t)),u={gpuTime:0,cpuTime:0,count:0},f=C.compile(s,l,a,i,u),c=f.draw,d=f.batch,h=f.scope,p=[];function g(t){for(;p.length<t;)p.push(null);return p}function b(t,e){var n;if(o&&nt.raise("context lost"),"function"==typeof t)return h.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)h.call(this,null,e,n);else{if(!Array.isArray(t))return h.call(this,t,e,0);for(n=0;n<t.length;++n)h.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return d.call(this,g(0|t),0|t)}else{if(!Array.isArray(t))return c.call(this,t);if(t.length)return d.call(this,t,t.length)}}return e(b,{stats:u})}L&&(L.addEventListener(bl,H,!1),L.addEventListener(ml,V,!1));var U=E.setFBO=P({framebuffer:dt.define.call(null,xl,"framebuffer")});function G(t,e){var n=0;C.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=dl),"depth"in e&&(r.clearDepth(+e.depth),n|=hl),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=pl),nt(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function j(t){if(nt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var n=0;n<6;++n)U(e({framebuffer:t.framebuffer.faces[n]},t),G);else U(t,G);else G(null,t)}function X(t){function e(){var e=_l(D,t);function n(){var t=_l(D,n);D[t]=D[D.length-1],D.length-=1,D.length<=0&&O()}nt(e>=0,"cannot cancel a frame twice"),D[e]=n}return nt.type(t,"function","regl.frame() callback must be a function"),D.push(t),R(),{cancel:e}}function W(){var t=S.viewport,e=S.scissor_box;t[0]=t[1]=e[0]=e[1]=0,p.viewportWidth=p.framebufferWidth=p.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,p.viewportHeight=p.framebufferHeight=p.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function q(){p.tick+=1,p.time=Y(),W(),C.procs.poll()}function Z(){W(),C.procs.refresh(),f&&f.update()}function Y(){return(pt()-c)/1e3}function $(t,e){var n;switch(nt.type(e,"function","listener callback must be a function"),t){case"frame":return X(e);case"lost":n=I;break;case"restore":n=F;break;case"destroy":n=k;break;default:nt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}Z();var K=e(P,{clear:j,prop:dt.define.bind(null,xl),context:dt.define.bind(null,vl),this:dt.define.bind(null,yl),draw:P({}),buffer:function(t){return x.create(t,gl,!1,!1)},elements:function(t){return _.create(t,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:T.create,framebuffer:E.create,framebufferCube:E.createCube,vao:v.createVAO,attributes:i,frame:X,on:$,limits:m,hasExtension:function(t){return m.extensions.indexOf(t.toLowerCase())>=0},read:B,destroy:z,_gl:r,_refresh:Z,poll:function(){q(),f&&f.update()},now:Y,stats:s});return n.onDone(null,K),K}return wl}()})),wn=[0,0,0,0],An={color:wn,offset:0},Tn=1024,En="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\n// use same coords for all textures?\nattribute vec2 texCoordB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Cn="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = texCoord;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Bn="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Sn="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Ln="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\nattribute vec2 texCoordE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  vTexCoordE = texCoordE;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",Dn="#define GLSLIFY 1\nuniform mat4 transformMatrix;\n\nattribute vec2 position;\nattribute vec2 texCoordA;\nattribute vec2 texCoordB;\nattribute vec2 texCoordC;\nattribute vec2 texCoordD;\nattribute vec2 texCoordE;\nattribute vec2 texCoordF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  vTexCoordA = texCoordA;\n  vTexCoordB = texCoordB;\n  vTexCoordC = texCoordC;\n  vTexCoordD = texCoordD;\n  vTexCoordE = texCoordE;\n  vTexCoordE = texCoordF;\n  gl_Position = transformMatrix * vec4(position, 0.0, 1.0);\n}\n",In="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\n\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform sampler2D texture;\nuniform bool littleEndian;\nuniform bool enableSimpleHillshade;\n\nuniform float textureSize;\nuniform float tileSize;\nuniform vec4 textureBounds;\nvarying vec2 vTexCoord;\n\nuniform float offset;\nuniform float slopescale;\nuniform float slopeFactor;\nuniform float deg2rad;\nuniform float azimuth;\nuniform float altitude;\n\nfloat getTexelValue(vec2 pos) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat getRelativeHeight(vec2 pos, float v, vec4 textureBounds) {\n  // if (pos.x < textureBounds[0]) {\n  //   pos = vec2(textureBounds[0], pos.y);\n  // }\n  // if (pos.x > textureBounds[2]) {\n  //   pos = vec2(textureBounds[2], pos.y);\n  // }\n  // if (pos.y < textureBounds[1]) {\n  //   pos = vec2(pos.x, textureBounds[1]);\n  // }\n  // if (pos.y > textureBounds[3]) {\n  //   pos = vec2(pos.x, textureBounds[3]);\n  // }\n  float pixelFloatValue = getTexelValue(pos);\n  float test = step(0.0, pixelFloatValue);\n  float testReturn = ((test * pixelFloatValue) + ((1.0 - test) * v)) * (slopescale*slopeFactor);\n  return testReturn;\n}\n\nfloat hillshade(vec2 pos, float v, float offset, vec4 textureBounds) {\n  float cv = v * (slopescale * slopeFactor);\n  vec4 nv = vec4(\n  getRelativeHeight(vec2(pos.x + offset, pos.y), v, textureBounds),\n  getRelativeHeight(vec2(pos.x - offset, pos.y), v, textureBounds),\n  getRelativeHeight(vec2(pos.x, pos.y + offset), v, textureBounds),\n  getRelativeHeight(vec2(pos.x, pos.y - offset), v, textureBounds)\n  );\n\n  vec2 grad = vec2(\n    (nv[0] - cv) / 2.0 + (cv - nv[1]) / 2.0,\n    (nv[2] - cv) / 2.0 + (cv - nv[3]) / 2.0\n  );\n\n  float slope = max(3.141593 / 2.0 - atan(sqrt(dot(grad, grad))), 0.0);\n  float aspect = atan(-grad.y, grad.x);\n\n  float hs = sin(altitude * deg2rad) * sin(slope) +\n    cos(altitude * deg2rad) * cos(slope) *\n    cos((azimuth * deg2rad) - aspect);\n\n  return clamp(hs, 0.0, 1.0);\n}\n\nvoid main() {\n  float texelFloat = getTexelValue(vTexCoord);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  vec4 clr = computeColor(texelFloat, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n\n  if (enableSimpleHillshade) {\n    float hs = hillshade(vTexCoord, texelFloat, offset, textureBounds);\n    clr.rgb = clr.rgb * hs;\n  }\n\n  gl_FragColor = clr;\n}\n",Fn=vn((function(t,e){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(t[i]=n[i])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){var e,n,r,i,o,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)o=t[e],a.set(o,i),i+=o.length;return a}},o={arraySet:function(t,e,n,r,i){for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,o))},e.setTyped(n)}));function kn(t){for(var e=t.length;--e>=0;)t[e]=0}var Nn=256,Mn=286,Rn=30,On=15,Hn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Vn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],zn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Pn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Un=new Array(576);kn(Un);var Gn=new Array(60);kn(Gn);var jn=new Array(512);kn(jn);var Xn=new Array(256);kn(Xn);var Wn=new Array(29);kn(Wn);var qn,Zn,Yn,$n=new Array(Rn);function Kn(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function Qn(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function Jn(t){return t<256?jn[t]:jn[256+(t>>>7)]}function tr(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function er(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,tr(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function nr(t,e,n){er(t,n[2*e],n[2*e+1])}function rr(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function ir(t,e,n){var r,i,o=new Array(16),a=0;for(r=1;r<=On;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=e;i++){var l=t[2*i+1];0!==l&&(t[2*i]=rr(o[l]++,l))}}function or(t){var e;for(e=0;e<Mn;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Rn;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function ar(t){t.bi_valid>8?tr(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function lr(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function sr(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&lr(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!lr(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function ur(t,e,n){var r,i,o,a,l=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],i=t.pending_buf[t.l_buf+l],l++,0===r?nr(t,i,e):(nr(t,(o=Xn[i])+Nn+1,e),0!==(a=Hn[o])&&er(t,i-=Wn[o],a),nr(t,o=Jn(--r),n),0!==(a=Vn[o])&&er(t,r-=$n[o],a))}while(l<t.last_lit);nr(t,256,e)}function fr(t,e){var n,r,i,o=e.dyn_tree,a=e.stat_desc.static_tree,l=e.stat_desc.has_stree,s=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<s;n++)0!==o[2*n]?(t.heap[++t.heap_len]=u=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[i]=0,t.opt_len--,l&&(t.static_len-=a[2*i+1]);for(e.max_code=u,n=t.heap_len>>1;n>=1;n--)sr(t,o,n);i=s;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],sr(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,sr(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,o,a,l,s=e.dyn_tree,u=e.max_code,f=e.stat_desc.static_tree,c=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(o=0;o<=On;o++)t.bl_count[o]=0;for(s[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)(o=s[2*s[2*(r=t.heap[n])+1]+1]+1)>p&&(o=p,g++),s[2*r+1]=o,r>u||(t.bl_count[o]++,a=0,r>=h&&(a=d[r-h]),l=s[2*r],t.opt_len+=l*(o+a),c&&(t.static_len+=l*(f[2*r+1]+a)));if(0!==g){do{for(o=p-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(o=p;0!==o;o--)for(r=t.bl_count[o];0!==r;)(i=t.heap[--n])>u||(s[2*i+1]!==o&&(t.opt_len+=(o-s[2*i+1])*s[2*i],s[2*i+1]=o),r--)}}(t,e),ir(o,u,t.bl_count)}function cr(t,e,n){var r,i,o=-1,a=e[1],l=0,s=7,u=4;for(0===a&&(s=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=e[2*(r+1)+1],++l<s&&i===a||(l<u?t.bl_tree[2*i]+=l:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,o=i,0===a?(s=138,u=3):i===a?(s=6,u=3):(s=7,u=4))}function dr(t,e,n){var r,i,o=-1,a=e[1],l=0,s=7,u=4;for(0===a&&(s=138,u=3),r=0;r<=n;r++)if(i=a,a=e[2*(r+1)+1],!(++l<s&&i===a)){if(l<u)do{nr(t,i,t.bl_tree)}while(0!=--l);else 0!==i?(i!==o&&(nr(t,i,t.bl_tree),l--),nr(t,16,t.bl_tree),er(t,l-3,2)):l<=10?(nr(t,17,t.bl_tree),er(t,l-3,3)):(nr(t,18,t.bl_tree),er(t,l-11,7));l=0,o=i,0===a?(s=138,u=3):i===a?(s=6,u=3):(s=7,u=4)}}kn($n);var hr=!1;function pr(t,e,n,r){er(t,0+(r?1:0),3),function(t,e,n,r){ar(t),r&&(tr(t,n),tr(t,~n)),Fn.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}var gr={_tr_init:function(t){hr||(!function(){var t,e,n,r,i,o=new Array(16);for(n=0,r=0;r<28;r++)for(Wn[r]=n,t=0;t<1<<Hn[r];t++)Xn[n++]=r;for(Xn[n-1]=r,i=0,r=0;r<16;r++)for($n[r]=i,t=0;t<1<<Vn[r];t++)jn[i++]=r;for(i>>=7;r<Rn;r++)for($n[r]=i<<7,t=0;t<1<<Vn[r]-7;t++)jn[256+i++]=r;for(e=0;e<=On;e++)o[e]=0;for(t=0;t<=143;)Un[2*t+1]=8,t++,o[8]++;for(;t<=255;)Un[2*t+1]=9,t++,o[9]++;for(;t<=279;)Un[2*t+1]=7,t++,o[7]++;for(;t<=287;)Un[2*t+1]=8,t++,o[8]++;for(ir(Un,287,o),t=0;t<Rn;t++)Gn[2*t+1]=5,Gn[2*t]=rr(t,5);qn=new Kn(Un,Hn,257,Mn,On),Zn=new Kn(Gn,Vn,0,Rn,On),Yn=new Kn(new Array(0),zn,0,19,7)}(),hr=!0),t.l_desc=new Qn(t.dyn_ltree,qn),t.d_desc=new Qn(t.dyn_dtree,Zn),t.bl_desc=new Qn(t.bl_tree,Yn),t.bi_buf=0,t.bi_valid=0,or(t)},_tr_stored_block:pr,_tr_flush_block:function(t,e,n,r){var i,o,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<Nn;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),fr(t,t.l_desc),fr(t,t.d_desc),a=function(t){var e;for(cr(t,t.dyn_ltree,t.l_desc.max_code),cr(t,t.dyn_dtree,t.d_desc.max_code),fr(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*Pn[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),i=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==e?pr(t,e,n,r):4===t.strategy||o===i?(er(t,2+(r?1:0),3),ur(t,Un,Gn)):(er(t,4+(r?1:0),3),function(t,e,n,r){var i;for(er(t,e-257,5),er(t,n-1,5),er(t,r-4,4),i=0;i<r;i++)er(t,t.bl_tree[2*Pn[i]+1],3);dr(t,t.dyn_ltree,e-1),dr(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),ur(t,t.dyn_ltree,t.dyn_dtree)),or(t),r&&ar(t)},_tr_tally:function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Xn[n]+Nn+1)]++,t.dyn_dtree[2*Jn(e)]++),t.last_lit===t.lit_bufsize-1},_tr_align:function(t){er(t,2,3),nr(t,256,Un),function(t){16===t.bi_valid?(tr(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}};var br=function(t,e,n,r){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+e[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0};var mr=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();var xr,vr=function(t,e,n,r){var i=mr,o=r+n;t^=-1;for(var a=r;a<o;a++)t=t>>>8^i[255&(t^e[a])];return-1^t},yr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_r=-2,wr=258,Ar=262,Tr=103,Er=113,Cr=666;function Br(t,e){return t.msg=yr[e],e}function Sr(t){return(t<<1)-(t>4?9:0)}function Lr(t){for(var e=t.length;--e>=0;)t[e]=0}function Dr(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(Fn.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function Ir(t,e){gr._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Dr(t.strm)}function Fr(t,e){t.pending_buf[t.pending++]=e}function kr(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function Nr(t,e){var n,r,i=t.max_chain_length,o=t.strstart,a=t.prev_length,l=t.nice_match,s=t.strstart>t.w_size-Ar?t.strstart-(t.w_size-Ar):0,u=t.window,f=t.w_mask,c=t.prev,d=t.strstart+wr,h=u[o+a-1],p=u[o+a];t.prev_length>=t.good_match&&(i>>=2),l>t.lookahead&&(l=t.lookahead);do{if(u[(n=e)+a]===p&&u[n+a-1]===h&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<d);if(r=wr-(d-o),o=d-wr,r>a){if(t.match_start=e,a=r,r>=l)break;h=u[o+a-1],p=u[o+a]}}}while((e=c[e&f])>s&&0!=--i);return a<=t.lookahead?a:t.lookahead}function Mr(t){var e,n,r,i,o,a,l,s,u,f,c=t.w_size;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=c+(c-Ar)){Fn.arraySet(t.window,t.window,c,c,0),t.match_start-=c,t.strstart-=c,t.block_start-=c,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=c?r-c:0}while(--n);e=n=c;do{r=t.prev[--e],t.prev[e]=r>=c?r-c:0}while(--n);i+=c}if(0===t.strm.avail_in)break;if(a=t.strm,l=t.window,s=t.strstart+t.lookahead,u=i,f=void 0,(f=a.avail_in)>u&&(f=u),n=0===f?0:(a.avail_in-=f,Fn.arraySet(l,a.input,a.next_in,f,s),1===a.state.wrap?a.adler=br(a.adler,l,f,s):2===a.state.wrap&&(a.adler=vr(a.adler,l,f,s)),a.next_in+=f,a.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=3)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+3-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Ar&&0!==t.strm.avail_in)}function Rr(t,e){for(var n,r;;){if(t.lookahead<Ar){if(Mr(t),t.lookahead<Ar&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-Ar&&(t.match_length=Nr(t,n)),t.match_length>=3)if(r=gr._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=gr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Ir(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(Ir(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ir(t,!1),0===t.strm.avail_out)?1:2}function Or(t,e){for(var n,r,i;;){if(t.lookahead<Ar){if(Mr(t),t.lookahead<Ar&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Ar&&(t.match_length=Nr(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=gr._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Ir(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((r=gr._tr_tally(t,0,t.window[t.strstart-1]))&&Ir(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=gr._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(Ir(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ir(t,!1),0===t.strm.avail_out)?1:2}function Hr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function Vr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Fn.Buf16(1146),this.dyn_dtree=new Fn.Buf16(122),this.bl_tree=new Fn.Buf16(78),Lr(this.dyn_ltree),Lr(this.dyn_dtree),Lr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Fn.Buf16(16),this.heap=new Fn.Buf16(573),Lr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Fn.Buf16(573),Lr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function zr(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:Er,t.adler=2===e.wrap?0:1,e.last_flush=0,gr._tr_init(e),0):Br(t,_r)}function Pr(t){var e,n=zr(t);return 0===n&&((e=t.state).window_size=2*e.w_size,Lr(e.head),e.max_lazy_match=xr[e.level].max_lazy,e.good_match=xr[e.level].good_length,e.nice_match=xr[e.level].nice_length,e.max_chain_length=xr[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n}function Ur(t,e,n,r,i,o){if(!t)return _r;var a=1;if(-1===e&&(e=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||8!==n||r<8||r>15||e<0||e>9||o<0||o>4)return Br(t,_r);8===r&&(r=9);var l=new Vr;return t.state=l,l.strm=t,l.wrap=a,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Fn.Buf8(2*l.w_size),l.head=new Fn.Buf16(l.hash_size),l.prev=new Fn.Buf16(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Fn.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=o,l.method=n,Pr(t)}xr=[new Hr(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Mr(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,Ir(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-Ar&&(Ir(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Ir(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Ir(t,!1),t.strm.avail_out),1)})),new Hr(4,4,8,4,Rr),new Hr(4,5,16,8,Rr),new Hr(4,6,32,32,Rr),new Hr(4,4,16,16,Or),new Hr(8,16,32,32,Or),new Hr(8,16,128,128,Or),new Hr(8,32,128,256,Or),new Hr(32,128,258,1024,Or),new Hr(32,258,258,4096,Or)];var Gr={deflateInit:function(t,e){return Ur(t,e,8,15,8,0)},deflateInit2:Ur,deflateReset:Pr,deflateResetKeep:zr,deflateSetHeader:function(t,e){return t&&t.state?2!==t.state.wrap?_r:(t.state.gzhead=e,0):_r},deflate:function(t,e){var n,r,i,o;if(!t||!t.state||e>5||e<0)return t?Br(t,_r):_r;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===Cr&&4!==e)return Br(t,0===t.avail_out?-5:_r);if(r.strm=t,n=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,Fr(r,31),Fr(r,139),Fr(r,8),r.gzhead?(Fr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Fr(r,255&r.gzhead.time),Fr(r,r.gzhead.time>>8&255),Fr(r,r.gzhead.time>>16&255),Fr(r,r.gzhead.time>>24&255),Fr(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Fr(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Fr(r,255&r.gzhead.extra.length),Fr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=vr(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Fr(r,0),Fr(r,0),Fr(r,0),Fr(r,0),Fr(r,0),Fr(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Fr(r,3),r.status=Er);else{var a=8+(r.w_bits-8<<4)<<8;a|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(a|=32),a+=31-a%31,r.status=Er,kr(r,a),0!==r.strstart&&(kr(r,t.adler>>>16),kr(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>i&&(t.adler=vr(t.adler,r.pending_buf,r.pending-i,i)),Dr(t),i=r.pending,r.pending!==r.pending_buf_size));)Fr(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(t.adler=vr(t.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=vr(t.adler,r.pending_buf,r.pending-i,i)),Dr(t),i=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Fr(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>i&&(t.adler=vr(t.adler,r.pending_buf,r.pending-i,i)),0===o&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=vr(t.adler,r.pending_buf,r.pending-i,i)),Dr(t),i=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Fr(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>i&&(t.adler=vr(t.adler,r.pending_buf,r.pending-i,i)),0===o&&(r.status=Tr)}else r.status=Tr;if(r.status===Tr&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Dr(t),r.pending+2<=r.pending_buf_size&&(Fr(r,255&t.adler),Fr(r,t.adler>>8&255),t.adler=0,r.status=Er)):r.status=Er),0!==r.pending){if(Dr(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&Sr(e)<=Sr(n)&&4!==e)return Br(t,-5);if(r.status===Cr&&0!==t.avail_in)return Br(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&r.status!==Cr){var l=2===r.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(Mr(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=gr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Ir(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Ir(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ir(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var n,r,i,o,a=t.window;;){if(t.lookahead<=wr){if(Mr(t),t.lookahead<=wr&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=a[i=t.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){o=t.strstart+wr;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);t.match_length=wr-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=gr._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=gr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Ir(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Ir(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ir(t,!1),0===t.strm.avail_out)?1:2}(r,e):xr[r.level].func(r,e);if(3!==l&&4!==l||(r.status=Cr),1===l||3===l)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===l&&(1===e?gr._tr_align(r):5!==e&&(gr._tr_stored_block(r,0,0,!1),3===e&&(Lr(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Dr(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(Fr(r,255&t.adler),Fr(r,t.adler>>8&255),Fr(r,t.adler>>16&255),Fr(r,t.adler>>24&255),Fr(r,255&t.total_in),Fr(r,t.total_in>>8&255),Fr(r,t.total_in>>16&255),Fr(r,t.total_in>>24&255)):(kr(r,t.adler>>>16),kr(r,65535&t.adler)),Dr(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},deflateEnd:function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&e!==Tr&&e!==Er&&e!==Cr?Br(t,_r):(t.state=null,e===Er?Br(t,-3):0):_r},deflateSetDictionary:function(t,e){var n,r,i,o,a,l,s,u,f=e.length;if(!t||!t.state)return _r;if(2===(o=(n=t.state).wrap)||1===o&&42!==n.status||n.lookahead)return _r;for(1===o&&(t.adler=br(t.adler,e,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(Lr(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new Fn.Buf8(n.w_size),Fn.arraySet(u,e,f-n.w_size,n.w_size,0),e=u,f=n.w_size),a=t.avail_in,l=t.next_in,s=t.input,t.avail_in=f,t.next_in=0,t.input=e,Mr(n);n.lookahead>=3;){r=n.strstart,i=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=2,Mr(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=l,t.input=s,t.avail_in=a,n.wrap=o,0},deflateInfo:"pako deflate (from Nodeca project)"},jr=!0,Xr=!0;try{String.fromCharCode.apply(null,[0])}catch(t){jr=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Xr=!1}for(var Wr=new Fn.Buf8(256),qr=0;qr<256;qr++)Wr[qr]=qr>=252?6:qr>=248?5:qr>=240?4:qr>=224?3:qr>=192?2:1;Wr[254]=Wr[254]=1;function Zr(t,e){if(e<65534&&(t.subarray&&Xr||!t.subarray&&jr))return String.fromCharCode.apply(null,Fn.shrinkBuf(t,e));for(var n="",r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n}var Yr=function(t){var e,n,r,i,o,a=t.length,l=0;for(i=0;i<a;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Fn.Buf8(l),o=0,i=0;o<l;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},$r=function(t){return Zr(t,t.length)},Kr=function(t){for(var e=new Fn.Buf8(t.length),n=0,r=e.length;n<r;n++)e[n]=t.charCodeAt(n);return e},Qr=function(t,e){var n,r,i,o,a=e||t.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((i=t[n++])<128)l[r++]=i;else if((o=Wr[i])>4)l[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<a;)i=i<<6|63&t[n++],o--;o>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return Zr(l,r)},Jr=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+Wr[t[n]]>e?n:e};var ti=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},ei=Object.prototype.toString;function ni(t){if(!(this instanceof ni))return new ni(t);this.options=Fn.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ti,this.strm.avail_out=0;var n=Gr.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(yr[n]);if(e.header&&Gr.deflateSetHeader(this.strm,e.header),e.dictionary){var r;if(r="string"==typeof e.dictionary?Yr(e.dictionary):"[object ArrayBuffer]"===ei.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=Gr.deflateSetDictionary(this.strm,r)))throw new Error(yr[n]);this._dict_set=!0}}function ri(t,e){var n=new ni(e);if(n.push(t,!0),n.err)throw n.msg||yr[n.err];return n.result}ni.prototype.push=function(t,e){var n,r,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=e===~~e?e:!0===e?4:0,"string"==typeof t?i.input=Yr(t):"[object ArrayBuffer]"===ei.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new Fn.Buf8(o),i.next_out=0,i.avail_out=o),1!==(n=Gr.deflate(i,r))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData($r(Fn.shrinkBuf(i.output,i.next_out))):this.onData(Fn.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==n);return 4===r?(n=Gr.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==r||(this.onEnd(0),i.avail_out=0,!0)},ni.prototype.onData=function(t){this.chunks.push(t)},ni.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Fn.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ii={Deflate:ni,deflate:ri,deflateRaw:function(t,e){return(e=e||{}).raw=!0,ri(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,ri(t,e)}},oi=function(t,e){var n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w,A,T,E,C;n=t.state,r=t.next_in,E=t.input,i=r+(t.avail_in-5),o=t.next_out,C=t.output,a=o-(e-t.avail_out),l=o+(t.avail_out-257),s=n.dmax,u=n.wsize,f=n.whave,c=n.wnext,d=n.window,h=n.hold,p=n.bits,g=n.lencode,b=n.distcode,m=(1<<n.lenbits)-1,x=(1<<n.distbits)-1;t:do{p<15&&(h+=E[r++]<<p,p+=8,h+=E[r++]<<p,p+=8),v=g[h&m];e:for(;;){if(h>>>=y=v>>>24,p-=y,0===(y=v>>>16&255))C[o++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=g[(65535&v)+(h&(1<<y)-1)];continue e}if(32&y){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}_=65535&v,(y&=15)&&(p<y&&(h+=E[r++]<<p,p+=8),_+=h&(1<<y)-1,h>>>=y,p-=y),p<15&&(h+=E[r++]<<p,p+=8,h+=E[r++]<<p,p+=8),v=b[h&x];n:for(;;){if(h>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=b[(65535&v)+(h&(1<<y)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(w=65535&v,p<(y&=15)&&(h+=E[r++]<<p,(p+=8)<y&&(h+=E[r++]<<p,p+=8)),(w+=h&(1<<y)-1)>s){t.msg="invalid distance too far back",n.mode=30;break t}if(h>>>=y,p-=y,w>(y=o-a)){if((y=w-y)>f&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(A=0,T=d,0===c){if(A+=u-y,y<_){_-=y;do{C[o++]=d[A++]}while(--y);A=o-w,T=C}}else if(c<y){if(A+=u+c-y,(y-=c)<_){_-=y;do{C[o++]=d[A++]}while(--y);if(A=0,c<_){_-=y=c;do{C[o++]=d[A++]}while(--y);A=o-w,T=C}}}else if(A+=c-y,y<_){_-=y;do{C[o++]=d[A++]}while(--y);A=o-w,T=C}for(;_>2;)C[o++]=T[A++],C[o++]=T[A++],C[o++]=T[A++],_-=3;_&&(C[o++]=T[A++],_>1&&(C[o++]=T[A++]))}else{A=o-w;do{C[o++]=C[A++],C[o++]=C[A++],C[o++]=C[A++],_-=3}while(_>2);_&&(C[o++]=C[A++],_>1&&(C[o++]=C[A++]))}break}}break}}while(r<i&&o<l);r-=_=p>>3,h&=(1<<(p-=_<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=o<l?l-o+257:257-(o-l),n.hold=h,n.bits=p},ai=15,li=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],si=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],ui=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],fi=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],ci=function(t,e,n,r,i,o,a,l){var s,u,f,c,d,h,p,g,b,m=l.bits,x=0,v=0,y=0,_=0,w=0,A=0,T=0,E=0,C=0,B=0,S=null,L=0,D=new Fn.Buf16(16),I=new Fn.Buf16(16),F=null,k=0;for(x=0;x<=ai;x++)D[x]=0;for(v=0;v<r;v++)D[e[n+v]]++;for(w=m,_=ai;_>=1&&0===D[_];_--);if(w>_&&(w=_),0===_)return i[o++]=20971520,i[o++]=20971520,l.bits=1,0;for(y=1;y<_&&0===D[y];y++);for(w<y&&(w=y),E=1,x=1;x<=ai;x++)if(E<<=1,(E-=D[x])<0)return-1;if(E>0&&(0===t||1!==_))return-1;for(I[1]=0,x=1;x<ai;x++)I[x+1]=I[x]+D[x];for(v=0;v<r;v++)0!==e[n+v]&&(a[I[e[n+v]]++]=v);if(0===t?(S=F=a,h=19):1===t?(S=li,L-=257,F=si,k-=257,h=256):(S=ui,F=fi,h=-1),B=0,v=0,x=y,d=o,A=w,T=0,f=-1,c=(C=1<<w)-1,1===t&&C>852||2===t&&C>592)return 1;for(;;){p=x-T,a[v]<h?(g=0,b=a[v]):a[v]>h?(g=F[k+a[v]],b=S[L+a[v]]):(g=96,b=0),s=1<<x-T,y=u=1<<A;do{i[d+(B>>T)+(u-=s)]=p<<24|g<<16|b|0}while(0!==u);for(s=1<<x-1;B&s;)s>>=1;if(0!==s?(B&=s-1,B+=s):B=0,v++,0==--D[x]){if(x===_)break;x=e[n+a[v]]}if(x>w&&(B&c)!==f){for(0===T&&(T=w),d+=y,E=1<<(A=x-T);A+T<_&&!((E-=D[A+T])<=0);)A++,E<<=1;if(C+=1<<A,1===t&&C>852||2===t&&C>592)return 1;i[f=B&c]=w<<24|A<<16|d-o|0}}return 0!==B&&(i[d+B]=x-T<<24|64<<16|0),l.bits=w,0},di=-2,hi=12,pi=30;function gi(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function bi(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Fn.Buf16(320),this.work=new Fn.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function mi(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Fn.Buf32(852),e.distcode=e.distdyn=new Fn.Buf32(592),e.sane=1,e.back=-1,0):di}function xi(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,mi(t)):di}function vi(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?di:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,xi(t))):di}function yi(t,e){var n,r;return t?(r=new bi,t.state=r,r.window=null,0!==(n=vi(t,e))&&(t.state=null),n):di}var _i,wi,Ai=!0;function Ti(t){if(Ai){var e;for(_i=new Fn.Buf32(512),wi=new Fn.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ci(1,t.lens,0,288,_i,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ci(2,t.lens,0,32,wi,0,t.work,{bits:5}),Ai=!1}t.lencode=_i,t.lenbits=9,t.distcode=wi,t.distbits=5}function Ei(t,e,n,r){var i,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Fn.Buf8(o.wsize)),r>=o.wsize?(Fn.arraySet(o.window,e,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>r&&(i=r),Fn.arraySet(o.window,e,n-r,i,o.wnext),(r-=i)?(Fn.arraySet(o.window,e,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}var Ci={inflateReset:xi,inflateReset2:vi,inflateResetKeep:mi,inflateInit:function(t){return yi(t,15)},inflateInit2:yi,inflate:function(t,e){var n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w,A,T,E,C=0,B=new Fn.Buf8(4),S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return di;(n=t.state).mode===hi&&(n.mode=13),a=t.next_out,i=t.output,s=t.avail_out,o=t.next_in,r=t.input,l=t.avail_in,u=n.hold,f=n.bits,c=l,d=s,A=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;f<16;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(2&n.wrap&&35615===u){n.check=0,B[0]=255&u,B[1]=u>>>8&255,n.check=vr(n.check,B,2,0),u=0,f=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",n.mode=pi;break}if(8!=(15&u)){t.msg="unknown compression method",n.mode=pi;break}if(f-=4,w=8+(15&(u>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){t.msg="invalid window size",n.mode=pi;break}n.dmax=1<<w,t.adler=n.check=1,n.mode=512&u?10:hi,u=0,f=0;break;case 2:for(;f<16;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(n.flags=u,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=pi;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=pi;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(B[0]=255&u,B[1]=u>>>8&255,n.check=vr(n.check,B,2,0)),u=0,f=0,n.mode=3;case 3:for(;f<32;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}n.head&&(n.head.time=u),512&n.flags&&(B[0]=255&u,B[1]=u>>>8&255,B[2]=u>>>16&255,B[3]=u>>>24&255,n.check=vr(n.check,B,4,0)),u=0,f=0,n.mode=4;case 4:for(;f<16;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(B[0]=255&u,B[1]=u>>>8&255,n.check=vr(n.check,B,2,0)),u=0,f=0,n.mode=5;case 5:if(1024&n.flags){for(;f<16;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(B[0]=255&u,B[1]=u>>>8&255,n.check=vr(n.check,B,2,0)),u=0,f=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=n.length)>l&&(h=l),h&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Fn.arraySet(n.head.extra,r,o,h,w)),512&n.flags&&(n.check=vr(n.check,r,h,o)),l-=h,o+=h,n.length-=h),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===l)break t;h=0;do{w=r[o+h++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&h<l);if(512&n.flags&&(n.check=vr(n.check,r,h,o)),l-=h,o+=h,w)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===l)break t;h=0;do{w=r[o+h++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&h<l);if(512&n.flags&&(n.check=vr(n.check,r,h,o)),l-=h,o+=h,w)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;f<16;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(u!==(65535&n.check)){t.msg="header crc mismatch",n.mode=pi;break}u=0,f=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=hi;break;case 10:for(;f<32;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}t.adler=n.check=gi(u),u=0,f=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=a,t.avail_out=s,t.next_in=o,t.avail_in=l,n.hold=u,n.bits=f,2;t.adler=n.check=1,n.mode=hi;case hi:if(5===e||6===e)break t;case 13:if(n.last){u>>>=7&f,f-=7&f,n.mode=27;break}for(;f<3;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}switch(n.last=1&u,f-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(Ti(n),n.mode=20,6===e){u>>>=2,f-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=pi}u>>>=2,f-=2;break;case 14:for(u>>>=7&f,f-=7&f;f<32;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",n.mode=pi;break}if(n.length=65535&u,u=0,f=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(h=n.length){if(h>l&&(h=l),h>s&&(h=s),0===h)break t;Fn.arraySet(i,r,o,h,a),l-=h,o+=h,s-=h,a+=h,n.length-=h;break}n.mode=hi;break;case 17:for(;f<14;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(n.nlen=257+(31&u),u>>>=5,f-=5,n.ndist=1+(31&u),u>>>=5,f-=5,n.ncode=4+(15&u),u>>>=4,f-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=pi;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;f<3;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}n.lens[S[n.have++]]=7&u,u>>>=3,f-=3}for(;n.have<19;)n.lens[S[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},A=ci(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,A){t.msg="invalid code lengths set",n.mode=pi;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;m=(C=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,x=65535&C,!((b=C>>>24)<=f);){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(x<16)u>>>=b,f-=b,n.lens[n.have++]=x;else{if(16===x){for(E=b+2;f<E;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(u>>>=b,f-=b,0===n.have){t.msg="invalid bit length repeat",n.mode=pi;break}w=n.lens[n.have-1],h=3+(3&u),u>>>=2,f-=2}else if(17===x){for(E=b+3;f<E;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}f-=b,w=0,h=3+(7&(u>>>=b)),u>>>=3,f-=3}else{for(E=b+7;f<E;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}f-=b,w=0,h=11+(127&(u>>>=b)),u>>>=7,f-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=pi;break}for(;h--;)n.lens[n.have++]=w}}if(n.mode===pi)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=pi;break}if(n.lenbits=9,T={bits:n.lenbits},A=ci(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,A){t.msg="invalid literal/lengths set",n.mode=pi;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},A=ci(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,A){t.msg="invalid distances set",n.mode=pi;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(l>=6&&s>=258){t.next_out=a,t.avail_out=s,t.next_in=o,t.avail_in=l,n.hold=u,n.bits=f,oi(t,d),a=t.next_out,i=t.output,s=t.avail_out,o=t.next_in,r=t.input,l=t.avail_in,u=n.hold,f=n.bits,n.mode===hi&&(n.back=-1);break}for(n.back=0;m=(C=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,x=65535&C,!((b=C>>>24)<=f);){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(m&&0==(240&m)){for(v=b,y=m,_=x;m=(C=n.lencode[_+((u&(1<<v+y)-1)>>v)])>>>16&255,x=65535&C,!(v+(b=C>>>24)<=f);){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}u>>>=v,f-=v,n.back+=v}if(u>>>=b,f-=b,n.back+=b,n.length=x,0===m){n.mode=26;break}if(32&m){n.back=-1,n.mode=hi;break}if(64&m){t.msg="invalid literal/length code",n.mode=pi;break}n.extra=15&m,n.mode=22;case 22:if(n.extra){for(E=n.extra;f<E;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;m=(C=n.distcode[u&(1<<n.distbits)-1])>>>16&255,x=65535&C,!((b=C>>>24)<=f);){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(0==(240&m)){for(v=b,y=m,_=x;m=(C=n.distcode[_+((u&(1<<v+y)-1)>>v)])>>>16&255,x=65535&C,!(v+(b=C>>>24)<=f);){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}u>>>=v,f-=v,n.back+=v}if(u>>>=b,f-=b,n.back+=b,64&m){t.msg="invalid distance code",n.mode=pi;break}n.offset=x,n.extra=15&m,n.mode=24;case 24:if(n.extra){for(E=n.extra;f<E;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=pi;break}n.mode=25;case 25:if(0===s)break t;if(h=d-s,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=pi;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),g=n.window}else g=i,p=a-n.offset,h=n.length;h>s&&(h=s),s-=h,n.length-=h;do{i[a++]=g[p++]}while(--h);0===n.length&&(n.mode=21);break;case 26:if(0===s)break t;i[a++]=n.length,s--,n.mode=21;break;case 27:if(n.wrap){for(;f<32;){if(0===l)break t;l--,u|=r[o++]<<f,f+=8}if(d-=s,t.total_out+=d,n.total+=d,d&&(t.adler=n.check=n.flags?vr(n.check,i,d,a-d):br(n.check,i,d,a-d)),d=s,(n.flags?u:gi(u))!==n.check){t.msg="incorrect data check",n.mode=pi;break}u=0,f=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;f<32;){if(0===l)break t;l--,u+=r[o++]<<f,f+=8}if(u!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=pi;break}u=0,f=0}n.mode=29;case 29:A=1;break t;case pi:A=-3;break t;case 31:return-4;case 32:default:return di}return t.next_out=a,t.avail_out=s,t.next_in=o,t.avail_in=l,n.hold=u,n.bits=f,(n.wsize||d!==t.avail_out&&n.mode<pi&&(n.mode<27||4!==e))&&Ei(t,t.output,t.next_out,d-t.avail_out),c-=t.avail_in,d-=t.avail_out,t.total_in+=c,t.total_out+=d,n.total+=d,n.wrap&&d&&(t.adler=n.check=n.flags?vr(n.check,i,d,t.next_out-d):br(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===hi?128:0)+(20===n.mode||15===n.mode?256:0),(0===c&&0===d||4===e)&&0===A&&(A=-5),A},inflateEnd:function(t){if(!t||!t.state)return di;var e=t.state;return e.window&&(e.window=null),t.state=null,0},inflateGetHeader:function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?di:(n.head=e,e.done=!1,0):di},inflateSetDictionary:function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?di:11===n.mode&&br(1,e,r,0)!==n.check?-3:Ei(t,e,r,r)?(n.mode=31,-4):(n.havedict=1,0):di},inflateInfo:"pako inflate (from Nodeca project)"},Bi={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Si=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Li=Object.prototype.toString;function Di(t){if(!(this instanceof Di))return new Di(t);this.options=Fn.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ti,this.strm.avail_out=0;var n=Ci.inflateInit2(this.strm,e.windowBits);if(n!==Bi.Z_OK)throw new Error(yr[n]);if(this.header=new Si,Ci.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Yr(e.dictionary):"[object ArrayBuffer]"===Li.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Ci.inflateSetDictionary(this.strm,e.dictionary))!==Bi.Z_OK))throw new Error(yr[n])}function Ii(t,e){var n=new Di(e);if(n.push(t,!0),n.err)throw n.msg||yr[n.err];return n.result}Di.prototype.push=function(t,e){var n,r,i,o,a,l=this.strm,s=this.options.chunkSize,u=this.options.dictionary,f=!1;if(this.ended)return!1;r=e===~~e?e:!0===e?Bi.Z_FINISH:Bi.Z_NO_FLUSH,"string"==typeof t?l.input=Kr(t):"[object ArrayBuffer]"===Li.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Fn.Buf8(s),l.next_out=0,l.avail_out=s),(n=Ci.inflate(l,Bi.Z_NO_FLUSH))===Bi.Z_NEED_DICT&&u&&(n=Ci.inflateSetDictionary(this.strm,u)),n===Bi.Z_BUF_ERROR&&!0===f&&(n=Bi.Z_OK,f=!1),n!==Bi.Z_STREAM_END&&n!==Bi.Z_OK)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&n!==Bi.Z_STREAM_END&&(0!==l.avail_in||r!==Bi.Z_FINISH&&r!==Bi.Z_SYNC_FLUSH)||("string"===this.options.to?(i=Jr(l.output,l.next_out),o=l.next_out-i,a=Qr(l.output,i),l.next_out=o,l.avail_out=s-o,o&&Fn.arraySet(l.output,l.output,i,o,0),this.onData(a)):this.onData(Fn.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(f=!0)}while((l.avail_in>0||0===l.avail_out)&&n!==Bi.Z_STREAM_END);return n===Bi.Z_STREAM_END&&(r=Bi.Z_FINISH),r===Bi.Z_FINISH?(n=Ci.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Bi.Z_OK):r!==Bi.Z_SYNC_FLUSH||(this.onEnd(Bi.Z_OK),l.avail_out=0,!0)},Di.prototype.onData=function(t){this.chunks.push(t)},Di.prototype.onEnd=function(t){t===Bi.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Fn.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Fi={Inflate:Di,inflate:Ii,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Ii(t,e)},ungzip:Ii},ki={};(0,Fn.assign)(ki,ii,Fi,Bi);var Ni=ki,Mi=vn((function(t){!function(){var e={};t.exports=e,function(t,e){t.toRGBA8=function(e){var n=e.width,r=e.height;if(null==e.tabs.acTL)return[t.toRGBA8.decodeImage(e.data,n,r,e).buffer];var i=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var o,a=new Uint8Array(n*r*4),l=0;l<e.frames.length;l++){var s=e.frames[l],u=s.rect.x,f=s.rect.y,c=s.rect.width,d=s.rect.height,h=t.toRGBA8.decodeImage(s.data,c,d,e);if(0==l?o=h:0==s.blend?t._copyTile(h,c,d,o,n,r,u,f,0):1==s.blend&&t._copyTile(h,c,d,o,n,r,u,f,1),i.push(o.buffer),o=o.slice(0),0==s.dispose);else if(1==s.dispose)t._copyTile(a,c,d,o,n,r,u,f,0);else if(2==s.dispose){for(var p=l-1;2==e.frames[p].dispose;)p--;o=new Uint8Array(i[p]).slice(0)}}return i},t.toRGBA8.decodeImage=function(e,n,r,i){var o=n*r,a=t.decode._getBPP(i),l=Math.ceil(n*a/8),s=new Uint8Array(4*o),u=new Uint32Array(s.buffer),f=i.ctype,c=i.depth,d=t._bin.readUshort;if(6==f){var h=o<<2;if(8==c)for(var p=0;p<h;p++)s[p]=e[p];if(16==c)for(p=0;p<h;p++)s[p]=e[p<<1]}else if(2==f){var g=i.tabs.tRNS,b=-1,m=-1,x=-1;if(g&&(b=g[0],m=g[1],x=g[2]),8==c)for(p=0;p<o;p++){var v=3*p;s[C=p<<2]=e[v],s[C+1]=e[v+1],s[C+2]=e[v+2],s[C+3]=255,-1!=b&&e[v]==b&&e[v+1]==m&&e[v+2]==x&&(s[C+3]=0)}if(16==c)for(p=0;p<o;p++){v=6*p;s[C=p<<2]=e[v],s[C+1]=e[v+2],s[C+2]=e[v+4],s[C+3]=255,-1!=b&&d(e,v)==b&&d(e,v+2)==m&&d(e,v+4)==x&&(s[C+3]=0)}}else if(3==f){var y=i.tabs.PLTE,_=i.tabs.tRNS,w=_?_.length:0;if(1==c)for(var A=0;A<r;A++){var T=A*l,E=A*n;for(p=0;p<n;p++){var C=E+p<<2,B=3*(S=e[T+(p>>3)]>>7-((7&p)<<0)&1);s[C]=y[B],s[C+1]=y[B+1],s[C+2]=y[B+2],s[C+3]=S<w?_[S]:255}}if(2==c)for(A=0;A<r;A++)for(T=A*l,E=A*n,p=0;p<n;p++){C=E+p<<2,B=3*(S=e[T+(p>>2)]>>6-((3&p)<<1)&3);s[C]=y[B],s[C+1]=y[B+1],s[C+2]=y[B+2],s[C+3]=S<w?_[S]:255}if(4==c)for(A=0;A<r;A++)for(T=A*l,E=A*n,p=0;p<n;p++){C=E+p<<2,B=3*(S=e[T+(p>>1)]>>4-((1&p)<<2)&15);s[C]=y[B],s[C+1]=y[B+1],s[C+2]=y[B+2],s[C+3]=S<w?_[S]:255}if(8==c)for(p=0;p<o;p++){var S;C=p<<2,B=3*(S=e[p]);s[C]=y[B],s[C+1]=y[B+1],s[C+2]=y[B+2],s[C+3]=S<w?_[S]:255}}else if(4==f){if(8==c)for(p=0;p<o;p++){C=p<<2;var L=e[D=p<<1];s[C]=L,s[C+1]=L,s[C+2]=L,s[C+3]=e[D+1]}if(16==c)for(p=0;p<o;p++){var D;C=p<<2,L=e[D=p<<2];s[C]=L,s[C+1]=L,s[C+2]=L,s[C+3]=e[D+2]}}else if(0==f){b=i.tabs.tRNS?i.tabs.tRNS:-1;if(1==c)for(p=0;p<o;p++){var I=(L=255*(e[p>>3]>>7-(7&p)&1))==255*b?0:255;u[p]=I<<24|L<<16|L<<8|L}if(2==c)for(p=0;p<o;p++){I=(L=85*(e[p>>2]>>6-((3&p)<<1)&3))==85*b?0:255;u[p]=I<<24|L<<16|L<<8|L}if(4==c)for(p=0;p<o;p++){I=(L=17*(e[p>>1]>>4-((1&p)<<2)&15))==17*b?0:255;u[p]=I<<24|L<<16|L<<8|L}if(8==c)for(p=0;p<o;p++){I=(L=e[p])==b?0:255;u[p]=I<<24|L<<16|L<<8|L}if(16==c)for(p=0;p<o;p++){L=e[p<<1],I=d(e,p<<1)==b?0:255;u[p]=I<<24|L<<16|L<<8|L}}return s},t.decode=function(e){for(var n,r=new Uint8Array(e),i=8,o=t._bin,a=o.readUshort,l=o.readUint,s={tabs:{},frames:[]},u=new Uint8Array(r.length),f=0,c=0,d=[137,80,78,71,13,10,26,10],h=0;h<8;h++)if(r[h]!=d[h])throw"The input is not a PNG file!";for(;i<r.length;){var p=o.readUint(r,i);i+=4;var g=o.readASCII(r,i,4);if(i+=4,"IHDR"==g)t.decode._IHDR(r,i,s);else if("IDAT"==g){for(h=0;h<p;h++)u[f+h]=r[i+h];f+=p}else if("acTL"==g)s.tabs[g]={num_frames:l(r,i),num_plays:l(r,i+4)},n=new Uint8Array(r.length);else if("fcTL"==g){if(0!=c)(T=s.frames[s.frames.length-1]).data=t.decode._decompress(s,n.slice(0,c),T.rect.width,T.rect.height),c=0;var b={x:l(r,i+12),y:l(r,i+16),width:l(r,i+4),height:l(r,i+8)},m=a(r,i+22);m=a(r,i+20)/(0==m?100:m);var x={rect:b,delay:Math.round(1e3*m),dispose:r[i+24],blend:r[i+25]};s.frames.push(x)}else if("fdAT"==g){for(h=0;h<p-4;h++)n[c+h]=r[i+h+4];c+=p-4}else if("pHYs"==g)s.tabs[g]=[o.readUint(r,i),o.readUint(r,i+4),r[i+8]];else if("cHRM"==g){s.tabs[g]=[];for(h=0;h<8;h++)s.tabs[g].push(o.readUint(r,i+4*h))}else if("tEXt"==g){null==s.tabs[g]&&(s.tabs[g]={});var v=o.nextZero(r,i),y=o.readASCII(r,i,v-i),_=o.readASCII(r,v+1,i+p-v-1);s.tabs[g][y]=_}else if("iTXt"==g){null==s.tabs[g]&&(s.tabs[g]={});v=0;var w=i;v=o.nextZero(r,w);y=o.readASCII(r,w,v-w);w=v+1,w+=2,v=o.nextZero(r,w);o.readASCII(r,w,v-w);w=v+1,v=o.nextZero(r,w);o.readUTF8(r,w,v-w);w=v+1;_=o.readUTF8(r,w,p-(w-i));s.tabs[g][y]=_}else if("PLTE"==g)s.tabs[g]=o.readBytes(r,i,p);else if("hIST"==g){var A=s.tabs.PLTE.length/3;s.tabs[g]=[];for(h=0;h<A;h++)s.tabs[g].push(a(r,i+2*h))}else if("tRNS"==g)3==s.ctype?s.tabs[g]=o.readBytes(r,i,p):0==s.ctype?s.tabs[g]=a(r,i):2==s.ctype&&(s.tabs[g]=[a(r,i),a(r,i+2),a(r,i+4)]);else if("gAMA"==g)s.tabs[g]=o.readUint(r,i)/1e5;else if("sRGB"==g)s.tabs[g]=r[i];else if("bKGD"==g)0==s.ctype||4==s.ctype?s.tabs[g]=[a(r,i)]:2==s.ctype||6==s.ctype?s.tabs[g]=[a(r,i),a(r,i+2),a(r,i+4)]:3==s.ctype&&(s.tabs[g]=r[i]);else if("IEND"==g){var T;if(0!=c)(T=s.frames[s.frames.length-1]).data=t.decode._decompress(s,n.slice(0,c),T.rect.width,T.rect.height),c=0;s.data=t.decode._decompress(s,u,s.width,s.height);break}i+=p;o.readUint(r,i);i+=4}return delete s.compress,delete s.interlace,delete s.filter,s},t.decode._decompress=function(e,n,r,i){return 0==e.compress&&(n=t.decode._inflate(n)),0==e.interlace?n=t.decode._filterZero(n,e,0,r,i):1==e.interlace&&(n=t.decode._readInterlace(n,e)),n},t.decode._inflate=function(t){return e.inflate(t)},t.decode._readInterlace=function(e,n){for(var r=n.width,i=n.height,o=t.decode._getBPP(n),a=o>>3,l=Math.ceil(r*o/8),s=new Uint8Array(i*l),u=0,f=[0,0,4,0,2,0,1],c=[0,4,0,2,0,1,0],d=[8,8,8,4,4,2,2],h=[8,8,4,4,2,2,1],p=0;p<7;){for(var g=d[p],b=h[p],m=0,x=0,v=f[p];v<i;)v+=g,x++;for(var y=c[p];y<r;)y+=b,m++;var _=Math.ceil(m*o/8);t.decode._filterZero(e,n,u,m,x);for(var w=0,A=f[p];A<i;){for(var T=c[p],E=u+w*_<<3;T<r;){var C;if(1==o)C=(C=e[E>>3])>>7-(7&E)&1,s[A*l+(T>>3)]|=C<<7-((3&T)<<0);if(2==o)C=(C=e[E>>3])>>6-(7&E)&3,s[A*l+(T>>2)]|=C<<6-((3&T)<<1);if(4==o)C=(C=e[E>>3])>>4-(7&E)&15,s[A*l+(T>>1)]|=C<<4-((1&T)<<2);if(o>=8)for(var B=A*l+T*a,S=0;S<a;S++)s[B+S]=e[(E>>3)+S];E+=o,T+=b}w++,A+=g}m*x!=0&&(u+=x*(1+_)),p+=1}return s},t.decode._getBPP=function(t){return[1,null,3,1,2,null,4][t.ctype]*t.depth},t.decode._filterZero=function(e,n,r,i,o){var a=t.decode._getBPP(n),l=Math.ceil(i*a/8),s=t.decode._paeth;a=Math.ceil(a/8);for(var u=0;u<o;u++){var f=r+u*l,c=f+u+1,d=e[c-1];if(0==d)for(var h=0;h<l;h++)e[f+h]=e[c+h];else if(1==d){for(h=0;h<a;h++)e[f+h]=e[c+h];for(h=a;h<l;h++)e[f+h]=e[c+h]+e[f+h-a]&255}else if(0==u){for(h=0;h<a;h++)e[f+h]=e[c+h];if(2==d)for(h=a;h<l;h++)e[f+h]=255&e[c+h];if(3==d)for(h=a;h<l;h++)e[f+h]=e[c+h]+(e[f+h-a]>>1)&255;if(4==d)for(h=a;h<l;h++)e[f+h]=e[c+h]+s(e[f+h-a],0,0)&255}else{if(2==d)for(h=0;h<l;h++)e[f+h]=e[c+h]+e[f+h-l]&255;if(3==d){for(h=0;h<a;h++)e[f+h]=e[c+h]+(e[f+h-l]>>1)&255;for(h=a;h<l;h++)e[f+h]=e[c+h]+(e[f+h-l]+e[f+h-a]>>1)&255}if(4==d){for(h=0;h<a;h++)e[f+h]=e[c+h]+s(0,e[f+h-l],0)&255;for(h=a;h<l;h++)e[f+h]=e[c+h]+s(e[f+h-a],e[f+h-l],e[f+h-a-l])&255}}}return e},t.decode._paeth=function(t,e,n){var r=t+e-n,i=Math.abs(r-t),o=Math.abs(r-e),a=Math.abs(r-n);return i<=o&&i<=a?t:o<=a?e:n},t.decode._IHDR=function(e,n,r){var i=t._bin;r.width=i.readUint(e,n),n+=4,r.height=i.readUint(e,n),n+=4,r.depth=e[n],n++,r.ctype=e[n],n++,r.compress=e[n],n++,r.filter=e[n],n++,r.interlace=e[n],n++},t._bin={nextZero:function(t,e){for(;0!=t[e];)e++;return e},readUshort:function(t,e){return t[e]<<8|t[e+1]},writeUshort:function(t,e,n){t[e]=n>>8&255,t[e+1]=255&n},readUint:function(t,e){return 16777216*t[e]+(t[e+1]<<16|t[e+2]<<8|t[e+3])},writeUint:function(t,e,n){t[e]=n>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n},readASCII:function(t,e,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(t[e+i]);return r},writeASCII:function(t,e,n){for(var r=0;r<n.length;r++)t[e+r]=n.charCodeAt(r)},readBytes:function(t,e,n){for(var r=[],i=0;i<n;i++)r.push(t[e+i]);return r},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(e,n,r){for(var i,o="",a=0;a<r;a++)o+="%"+t._bin.pad(e[n+a].toString(16));try{i=decodeURIComponent(o)}catch(i){return t._bin.readASCII(e,n,r)}return i}},t._copyTile=function(t,e,n,r,i,o,a,l,s){for(var u=Math.min(e,i),f=Math.min(n,o),c=0,d=0,h=0;h<f;h++)for(var p=0;p<u;p++)if(a>=0&&l>=0?(c=h*e+p<<2,d=(l+h)*i+a+p<<2):(c=(-l+h)*e-a+p<<2,d=h*i+p<<2),0==s)r[d]=t[c],r[d+1]=t[c+1],r[d+2]=t[c+2],r[d+3]=t[c+3];else if(1==s){var g=t[c+3]*(1/255),b=t[c]*g,m=t[c+1]*g,x=t[c+2]*g,v=r[d+3]*(1/255),y=r[d]*v,_=r[d+1]*v,w=r[d+2]*v,A=1-g,T=g+v*A,E=0==T?0:1/T;r[d+3]=255*T,r[d+0]=(b+y*A)*E,r[d+1]=(m+_*A)*E,r[d+2]=(x+w*A)*E}else if(2==s){g=t[c+3],b=t[c],m=t[c+1],x=t[c+2],v=r[d+3],y=r[d],_=r[d+1],w=r[d+2];g==v&&b==y&&m==_&&x==w?(r[d]=0,r[d+1]=0,r[d+2]=0,r[d+3]=0):(r[d]=b,r[d+1]=m,r[d+2]=x,r[d+3]=g)}else if(3==s){g=t[c+3],b=t[c],m=t[c+1],x=t[c+2],v=r[d+3],y=r[d],_=r[d+1],w=r[d+2];if(g==v&&b==y&&m==_&&x==w)continue;if(g<220&&v>20)return!1}return!0},t.encode=function(e,n,r,i,o,a){null==i&&(i=0),null==a&&(a=!1);for(var l=new Uint8Array(e[0].byteLength*e.length+100),s=[137,80,78,71,13,10,26,10],u=0;u<8;u++)l[u]=s[u];var f=8,c=t._bin,d=t.crc.crc,h=c.writeUint,p=c.writeUshort,g=c.writeASCII,b=t.encode.compressPNG(e,n,r,i,a);h(l,f,13),g(l,f+=4,"IHDR"),h(l,f+=4,n),h(l,f+=4,r),l[f+=4]=b.depth,l[++f]=b.ctype,l[++f]=0,l[++f]=0,l[++f]=0,h(l,++f,d(l,f-17,17)),h(l,f+=4,1),g(l,f+=4,"sRGB"),l[f+=4]=1,h(l,++f,d(l,f-5,5)),f+=4;var m=e.length>1;if(m&&(h(l,f,8),g(l,f+=4,"acTL"),h(l,f+=4,e.length),h(l,f+=4,0),h(l,f+=4,d(l,f-12,12)),f+=4),3==b.ctype){h(l,f,3*(C=b.plte.length)),g(l,f+=4,"PLTE"),f+=4;for(u=0;u<C;u++){var x=3*u,v=b.plte[u],y=255&v,_=v>>8&255,w=v>>16&255;l[f+x+0]=y,l[f+x+1]=_,l[f+x+2]=w}if(h(l,f+=3*C,d(l,f-3*C-4,3*C+4)),f+=4,b.gotAlpha){h(l,f,C),g(l,f+=4,"tRNS"),f+=4;for(u=0;u<C;u++)l[f+u]=b.plte[u]>>24&255;h(l,f+=C,d(l,f-C-4,C+4)),f+=4}}for(var A=0,T=0;T<b.frames.length;T++){var E=b.frames[T];m&&(h(l,f,26),g(l,f+=4,"fcTL"),h(l,f+=4,A++),h(l,f+=4,E.rect.width),h(l,f+=4,E.rect.height),h(l,f+=4,E.rect.x),h(l,f+=4,E.rect.y),p(l,f+=4,o[T]),p(l,f+=2,1e3),l[f+=2]=E.dispose,l[++f]=E.blend,h(l,++f,d(l,f-30,30)),f+=4);var C,B=E.cimg;h(l,f,(C=B.length)+(0==T?0:4));var S=f+=4;g(l,f,0==T?"IDAT":"fdAT"),f+=4,0!=T&&(h(l,f,A++),f+=4);for(u=0;u<C;u++)l[f+u]=B[u];h(l,f+=C,d(l,S,f-S)),f+=4}return h(l,f,0),g(l,f+=4,"IEND"),h(l,f+=4,d(l,f-4,4)),f+=4,l.buffer.slice(0,f)},t.encode.compressPNG=function(e,n,r,i,o){for(var a=t.encode.compress(e,n,r,i,!1,o),l=0;l<e.length;l++){var s=a.frames[l],u=(s.rect.width,s.rect.height),f=s.bpl,c=s.bpp,d=new Uint8Array(u*f+u);s.cimg=t.encode._filterZero(s.img,u,c,f,d)}return a},t.encode.compress=function(e,n,r,i,o,a){null==a&&(a=!1);for(var l=6,s=8,u=4,f=255,c=0;c<e.length;c++)for(var d=new Uint8Array(e[c]),h=d.length,p=0;p<h;p+=4)f&=d[p+3];var g=255!=f,b={},m=[];if(0!=e.length&&(b[0]=0,m.push(0),0!=i&&i--),0!=i){var x=t.quantize(e,i,o);e=x.bufs;for(p=0;p<x.plte.length;p++){null==b[y=x.plte[p].est.rgba]&&(b[y]=m.length,m.push(y))}}else for(c=0;c<e.length;c++){var v=new Uint32Array(e[c]);for(h=v.length,p=0;p<h;p++){var y=v[p];if((p<n||y!=v[p-1]&&y!=v[p-n])&&null==b[y]&&(b[y]=m.length,m.push(y),m.length>=300))break}}var _=!!g&&o,w=m.length;w<=256&&0==a&&(s=w<=2?1:w<=4?2:w<=16?4:8,o&&(s=8),g=!0);var A=[];for(c=0;c<e.length;c++){var T=new Uint8Array(e[c]),E=new Uint32Array(T.buffer),C=0,B=0,S=n,L=r,D=0;if(0!=c&&!_){for(var I=o||1==c||2==A[A.length-2].dispose?1:2,F=0,k=1e9,N=0;N<I;N++){for(var M=new Uint8Array(e[c-1-N]),R=new Uint32Array(e[c-1-N]),O=n,H=r,V=-1,z=-1,P=0;P<r;P++)for(var U=0;U<n;U++){E[p=P*n+U]!=R[p]&&(U<O&&(O=U),U>V&&(V=U),P<H&&(H=P),P>z&&(z=P))}var G=-1==V?1:(V-O+1)*(z-H+1);G<k&&(k=G,F=N,-1==V?(C=B=0,S=L=1):(C=O,B=H,S=V-O+1,L=z-H+1))}M=new Uint8Array(e[c-1-F]);1==F&&(A[A.length-1].dispose=2);var j=new Uint8Array(S*L*4);new Uint32Array(j.buffer);t._copyTile(M,n,r,j,S,L,-C,-B,0),t._copyTile(T,n,r,j,S,L,-C,-B,3)?(t._copyTile(T,n,r,j,S,L,-C,-B,2),D=1):(t._copyTile(T,n,r,j,S,L,-C,-B,0),D=0),T=j,E=new Uint32Array(T.buffer)}var X=4*S;if(w<=256&&0==a){X=Math.ceil(s*S/8);for(j=new Uint8Array(X*L),P=0;P<L;P++){p=P*X;var W=P*S;if(8==s)for(U=0;U<S;U++)j[p+U]=b[E[W+U]];else if(4==s)for(U=0;U<S;U++)j[p+(U>>1)]|=b[E[W+U]]<<4-4*(1&U);else if(2==s)for(U=0;U<S;U++)j[p+(U>>2)]|=b[E[W+U]]<<6-2*(3&U);else if(1==s)for(U=0;U<S;U++)j[p+(U>>3)]|=b[E[W+U]]<<7-1*(7&U)}T=j,l=3,u=1}else if(0==g&&1==e.length){j=new Uint8Array(S*L*3);var q=S*L;for(p=0;p<q;p++){var Z=3*p,Y=4*p;j[Z]=T[Y],j[Z+1]=T[Y+1],j[Z+2]=T[Y+2]}T=j,l=2,u=3,X=3*S}A.push({rect:{x:C,y:B,width:S,height:L},img:T,bpl:X,bpp:u,blend:D,dispose:_?1:0})}return{ctype:l,depth:s,plte:m,gotAlpha:g,frames:A}},t.encode._filterZero=function(n,r,i,o,a){for(var l=[],s=0;s<5;s++)if(!(r*o>5e5)||2!=s&&3!=s&&4!=s){for(var u=0;u<r;u++)t.encode._filterLine(a,n,u,o,i,s);if(l.push(e.deflate(a)),1==i)break}for(var f,c=1e9,d=0;d<l.length;d++)l[d].length<c&&(f=d,c=l[d].length);return l[f]},t.encode._filterLine=function(e,n,r,i,o,a){var l=r*i,s=l+r,u=t.decode._paeth;if(e[s]=a,s++,0==a)for(var f=0;f<i;f++)e[s+f]=n[l+f];else if(1==a){for(f=0;f<o;f++)e[s+f]=n[l+f];for(f=o;f<i;f++)e[s+f]=n[l+f]-n[l+f-o]+256&255}else if(0==r){for(f=0;f<o;f++)e[s+f]=n[l+f];if(2==a)for(f=o;f<i;f++)e[s+f]=n[l+f];if(3==a)for(f=o;f<i;f++)e[s+f]=n[l+f]-(n[l+f-o]>>1)+256&255;if(4==a)for(f=o;f<i;f++)e[s+f]=n[l+f]-u(n[l+f-o],0,0)+256&255}else{if(2==a)for(f=0;f<i;f++)e[s+f]=n[l+f]+256-n[l+f-i]&255;if(3==a){for(f=0;f<o;f++)e[s+f]=n[l+f]+256-(n[l+f-i]>>1)&255;for(f=o;f<i;f++)e[s+f]=n[l+f]+256-(n[l+f-i]+n[l+f-o]>>1)&255}if(4==a){for(f=0;f<o;f++)e[s+f]=n[l+f]+256-u(0,n[l+f-i],0)&255;for(f=o;f<i;f++)e[s+f]=n[l+f]+256-u(n[l+f-o],n[l+f-i],n[l+f-o-i])&255}}},t.crc={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var n=e,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;t[e]=n}return t}(),update:function(e,n,r,i){for(var o=0;o<i;o++)e=t.crc.table[255&(e^n[r+o])]^e>>>8;return e},crc:function(e,n,r){return 4294967295^t.crc.update(4294967295,e,n,r)}},t.quantize=function(e,n,r){for(var i=[],o=0,a=0;a<e.length;a++)i.push(t.encode.alphaMul(new Uint8Array(e[a]),r)),o+=e[a].byteLength;var l=new Uint8Array(o),s=new Uint32Array(l.buffer),u=0;for(a=0;a<i.length;a++){for(var f=i[a],c=f.length,d=0;d<c;d++)l[u+d]=f[d];u+=c}var h={i0:0,i1:l.length,bst:null,est:null,tdst:0,left:null,right:null};h.bst=t.quantize.stats(l,h.i0,h.i1),h.est=t.quantize.estats(h.bst);for(var p=[h];p.length<n;){var g=0,b=0;for(a=0;a<p.length;a++)p[a].est.L>g&&(g=p[a].est.L,b=a);if(g<.001)break;var m=p[b],x=t.quantize.splitPixels(l,s,m.i0,m.i1,m.est.e,m.est.eMq255),v={i0:m.i0,i1:x,bst:null,est:null,tdst:0,left:null,right:null};v.bst=t.quantize.stats(l,v.i0,v.i1),v.est=t.quantize.estats(v.bst);var y={i0:x,i1:m.i1,bst:null,est:null,tdst:0,left:null,right:null};y.bst={R:[],m:[],N:m.bst.N-v.bst.N};for(a=0;a<16;a++)y.bst.R[a]=m.bst.R[a]-v.bst.R[a];for(a=0;a<4;a++)y.bst.m[a]=m.bst.m[a]-v.bst.m[a];y.est=t.quantize.estats(y.bst),m.left=v,m.right=y,p[b]=v,p.push(y)}p.sort((function(t,e){return e.bst.N-t.bst.N}));for(var _=0;_<i.length;_++){var w=t.quantize.planeDst,A=new Uint8Array(i[_].buffer),T=new Uint32Array(i[_].buffer),E=A.length;for(a=0;a<E;a+=4){for(var C=A[a]*(1/255),B=A[a+1]*(1/255),S=A[a+2]*(1/255),L=A[a+3]*(1/255),D=h;D.left;)D=w(D.est,C,B,S,L)<=0?D.left:D.right;T[a>>2]=D.est.rgba}i[_]=T.buffer}return{bufs:i,plte:p}},t.quantize.getNearest=function(e,n,r,i,o){if(null==e.left)return e.tdst=t.quantize.dist(e.est.q,n,r,i,o),e;var a=t.quantize.planeDst(e.est,n,r,i,o),l=e.left,s=e.right;a>0&&(l=e.right,s=e.left);var u=t.quantize.getNearest(l,n,r,i,o);if(u.tdst<=a*a)return u;var f=t.quantize.getNearest(s,n,r,i,o);return f.tdst<u.tdst?f:u},t.quantize.planeDst=function(t,e,n,r,i){var o=t.e;return o[0]*e+o[1]*n+o[2]*r+o[3]*i-t.eMq},t.quantize.dist=function(t,e,n,r,i){var o=e-t[0],a=n-t[1],l=r-t[2],s=i-t[3];return o*o+a*a+l*l+s*s},t.quantize.splitPixels=function(e,n,r,i,o,a){var l=t.quantize.vecDot;for(i-=4;r<i;){for(;l(e,r,o)<=a;)r+=4;for(;l(e,i,o)>a;)i-=4;if(r>=i)break;var s=n[r>>2];n[r>>2]=n[i>>2],n[i>>2]=s,r+=4,i-=4}for(;l(e,r,o)>a;)r-=4;return r+4},t.quantize.vecDot=function(t,e,n){return t[e]*n[0]+t[e+1]*n[1]+t[e+2]*n[2]+t[e+3]*n[3]},t.quantize.stats=function(t,e,n){for(var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],o=n-e>>2,a=e;a<n;a+=4){var l=t[a]*(1/255),s=t[a+1]*(1/255),u=t[a+2]*(1/255),f=t[a+3]*(1/255);i[0]+=l,i[1]+=s,i[2]+=u,i[3]+=f,r[0]+=l*l,r[1]+=l*s,r[2]+=l*u,r[3]+=l*f,r[5]+=s*s,r[6]+=s*u,r[7]+=s*f,r[10]+=u*u,r[11]+=u*f,r[15]+=f*f}return r[4]=r[1],r[8]=r[2],r[12]=r[3],r[9]=r[6],r[13]=r[7],r[14]=r[11],{R:r,m:i,N:o}},t.quantize.estats=function(e){var n=e.R,r=e.m,i=e.N,o=r[0],a=r[1],l=r[2],s=r[3],u=0==i?0:1/i,f=[n[0]-o*o*u,n[1]-o*a*u,n[2]-o*l*u,n[3]-o*s*u,n[4]-a*o*u,n[5]-a*a*u,n[6]-a*l*u,n[7]-a*s*u,n[8]-l*o*u,n[9]-l*a*u,n[10]-l*l*u,n[11]-l*s*u,n[12]-s*o*u,n[13]-s*a*u,n[14]-s*l*u,n[15]-s*s*u],c=f,d=t.M4,h=[.5,.5,.5,.5],p=0,g=0;if(0!=i)for(var b=0;b<10&&(h=d.multVec(c,h),g=Math.sqrt(d.dot(h,h)),h=d.sml(1/g,h),!(Math.abs(g-p)<1e-9));b++)p=g;var m=[o*u,a*u,l*u,s*u],x=d.dot(d.sml(255,m),h),v=m[3]<.001?0:1/m[3];return{Cov:f,q:m,e:h,L:p,eMq255:x,eMq:d.dot(h,m),rgba:(Math.round(255*m[3])<<24|Math.round(255*m[2]*v)<<16|Math.round(255*m[1]*v)<<8|Math.round(255*m[0]*v)<<0)>>>0}},t.M4={multVec:function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},sml:function(t,e){return[t*e[0],t*e[1],t*e[2],t*e[3]]}},t.encode.alphaMul=function(t,e){for(var n=new Uint8Array(t.length),r=t.length>>2,i=0;i<r;i++){var o=i<<2,a=t[o+3];e&&(a=a<128?0:255);var l=a*(1/255);n[o+0]=t[o+0]*l,n[o+1]=t[o+1]*l,n[o+2]=t[o+2]*l,n[o+3]=a}return n}}(e,Ni)}()}));function Ri(t){return t.map((function(t){var e=t.color,n=t.offset;return{color:Hi(e),offset:n}}))}var Oi=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/;function Hi(t){if("transparent"===t)return[1,1,1,0];var e=t.match(Oi);if(null===e)throw new Error("'"+t+"' is not a valid RGB color expression.");return[+e[1]/255,+e[2]/255,+e[3]/255,1]}function Vi(){var t=new Uint8Array([170,187]);return 48042===new Uint16Array(t.buffer)[0]}function zi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];return new Array(n).fill(void 0).map((function(t,e){return e}))}var r=t[0],i=(n=t[1],t[2]),o=void 0===i?1:i;if(0===o)throw new Error("Argument step must be nonzero.");for(var a=[],l=r;o>0?l<n:l>n;l+=o)a.push(l);return a}function Pi(t){var e=t[0],n=e.x,r=e.y,i=t[1],o=i.x,a=i.y;return[[n,r],[o,r],[n,a],[o,a]]}function Ui(t){return new Promise((function(e){return setTimeout(e,t)}))}function Gi(t,e){var n=t.z-e.z,r=t.x-e.x,i=t.y-e.y;return 0!==n?n:0!==r?r:i}var ji=$t((function(t,e){void 0===e&&(e=256);var n=new Float32Array(e*e);return n.fill(t),new Uint8Array(n.buffer)}));function Xi(t,e){return Object.keys(e).map((function(t){return"#define "+t+" "+e[t]+"\n"})).join("")+"\n"+t}var Wi=Vi(),qi=function(t,e,n,r,i){void 0===i&&(i=r);for(var o={},a=function(n){for(var a=function(t){o[r+"["+n+"]."+t]=function(r,o){var a=o[i];return n<a.length?a[n][t]:e[t]}},l=0,s=t;l<s.length;l++){a(s[l])}},l=0;l<n;++l)a(l);return o}.bind(null,["color","offset"],An);function Zi(t,e,n,r){return{colorScaleUniforms:qi(e,t),sentinelValuesUniforms:qi(r,n),fragMacros:{SCALE_MAX_LENGTH:e,SENTINEL_MAX_LENGTH:r}}}var Yi=.017453292519943295,$i=.0333334;function Ki(t,e,r){return t(n(n({},e),{vert:Cn,frag:Xi(In,r.fragMacros),uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},texture:function(t,e){return e.texture},enableSimpleHillshade:function(t,e){return e.enableSimpleHillshade},offset:0,azimuth:0,altitude:0,slopescale:0,deg2rad:Yi,slopeFactor:$i,tileSize:0,textureSize:0,textureBounds:[0,0,0,0]}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Pi(e.textureBounds)}})}))}function Qi(t,e,r){return t(n(n({},e),{vert:Cn,frag:Xi(In,r.fragMacros),uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},texture:function(t,e){return e.texture},enableSimpleHillshade:function(t,e){return e.enableSimpleHillshade},azimuth:function(t,e){return e.azimuth},altitude:function(t,e){return e.altitude},slopescale:function(t,e){return e.slopescale},deg2rad:Yi,slopeFactor:$i,offset:function(t,e){return e.offset},textureBounds:function(t,e){var n=e.textureBounds;return[[n[0].x],[n[0].y],[n[1].x],[n[1].y]]},textureSize:function(t,e){return e.textureSize},tileSize:function(t,e){return e.tileSize}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Pi(e.textureBounds)}})}))}function Ji(t,e,r){return t(n(n({},e),{vert:En,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\n\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform sampler2D texture;\nuniform bool littleEndian;\nuniform sampler2D hillshadePregenTexture;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgba = texture2D(texture, vTexCoordA);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  vec4 clr = computeColor(texelFloat, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n\n  // Hillshade\n  float l = texture2D(hillshadePregenTexture, vTexCoordB).r;\n  clr.rgb = l * pow(clr.rgb, vec3(2.0));\n  clr.rgb = pow(clr.rgb, vec3(1.0/2.2));\n\n  gl_FragColor = clr;\n}\n",r.fragMacros),uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},texture:function(t,e){return e.texture},hillshadePregenTexture:function(t,e){return e.hillshadePregenTexture}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBounds)},texCoordB:function(t,e){return Pi(e.textureBoundsHs)}})}))}function to(t,e,r){return t(n(n({},e),{vert:En,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\n\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nbool isSentinelValue(ScaleStop sentinelValues[SENTINEL_MAX_LENGTH], int len, float value) {\n  for (int i = 0; i < SENTINEL_MAX_LENGTH; ++i) {\n    if (i == len) {\n      break;\n    }\n    if (isCloseEnough(sentinelValues[i].offset, value)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nvoid main() {\n  if (interpolationFraction <= 0.0) {\n    vec4 texelRgba = texture2D(textureA, vTexCoordA);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  } else if (interpolationFraction >= 1.0) {\n    vec4 texelRgba = texture2D(textureB, vTexCoordB);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  } else {\n    // retrieve and decode pixel value from both tiles\n    vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n    float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n    vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n    float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n    bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n    bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n    if (aIsNodata && bIsNodata) {\n      discard;\n    } else if (\n      aIsNodata\n      || bIsNodata\n      || colorScaleLength == 0\n      || isSentinelValue(sentinelValues, sentinelValuesLength, texelFloatA)\n      || isSentinelValue(sentinelValues, sentinelValuesLength, texelFloatB)\n    ) {\n      vec4 colorA = (\n        aIsNodata\n        ? TRANSPARENT\n        : computeColor(texelFloatA, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength)\n      );\n      vec4 colorB = (\n        bIsNodata\n        ? TRANSPARENT\n        : computeColor(texelFloatB, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength)\n      );\n      gl_FragColor = mix(colorA, colorB, interpolationFraction);\n    } else {\n      float interpolated = mix(texelFloatA, texelFloatB, interpolationFraction);\n      gl_FragColor = computeColor(interpolated, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n    }\n  }\n}\n",r.fragMacros),uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},interpolationFraction:function(t,e){return e.interpolationFraction}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)}})}))}function eo(t,e,r){return t(n(n({},e),{vert:Cn,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// precision highp sampler2D;\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float multiplierA;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoord);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n\n  if (aIsNodata || texelFloatA < filterLowA || texelFloatA > filterHighA) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA;\n    gl_FragColor = computeColor(texelFloatFinal, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  }\n}\n",r.fragMacros),depth:{enable:!1},uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},multiplierA:function(t,e){return e.multiplierA},textureA:function(t,e){return e.textureA}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Pi(e.textureBoundsA)}})}))}function no(t,e){return t(n(n({},e),{vert:Cn,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float multiplierA;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoord);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n\n  if (aIsNodata || texelFloatA < filterLowA || texelFloatA > filterHighA) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},multiplierA:function(t,e){return e.multiplierA},textureA:function(t,e){return e.textureA}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Pi(e.textureBoundsA)}})}))}function ro(t,e,r){return t(n(n({},e),{vert:En,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// precision highp sampler2D;\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float multiplierA;\nuniform float multiplierB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB;\n    gl_FragColor = computeColor(texelFloatFinal, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  }\n}\n",r.fragMacros),depth:{enable:!1},uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)}})}))}function io(t,e){return t(n(n({},e),{vert:En,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float multiplierA;\nuniform float multiplierB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)}})}))}function oo(t,e,r){return t(n(n({},e),{vert:Bn,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// precision highp float;\n// precision highp sampler2D;\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC;\n    gl_FragColor = computeColor(texelFloatFinal, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  }\n}\n",r.fragMacros),depth:{enable:!1},uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)}})}))}function ao(t,e){return t(n(n({},e),{vert:Bn,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)}})}))}function lo(t,e,r){return t(n(n({},e),{vert:Sn,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// precision highp float;\n// precision highp sampler2D;\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD;\n    gl_FragColor = computeColor(texelFloatFinal, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  }\n}\n",r.fragMacros),depth:{enable:!1},uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)},texCoordD:function(t,e){return Pi(e.textureBoundsD)}})}))}function so(t,e){return t(n(n({},e),{vert:Sn,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)},texCoordD:function(t,e){return Pi(e.textureBoundsD)}})}))}function uo(t,e,r){return t(n(n({},e),{vert:Ln,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE;\n    gl_FragColor = computeColor(texelFloatFinal, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  }\n}\n",r.fragMacros),depth:{enable:!1},uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)},texCoordD:function(t,e){return Pi(e.textureBoundsD)},texCoordE:function(t,e){return Pi(e.textureBoundsE)}})}))}function fo(t,e){return t(n(n({},e),{vert:Ln,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)},texCoordD:function(t,e){return Pi(e.textureBoundsD)},texCoordE:function(t,e){return Pi(e.textureBoundsE)}})}))}function co(t,e,r){return t(n(n({},e),{vert:Dn,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\nuniform sampler2D textureF;\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float filterLowF;\nuniform float filterHighF;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\nuniform float multiplierF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n  vec4 texelRgbaF = texture2D(textureF, vTexCoordF);\n  float texelFloatF = rgbaToFloat(texelRgbaF, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n  bool fIsNodata = isCloseEnough(texelFloatF, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata || fIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE ||\n      texelFloatF < filterLowF || texelFloatF > filterHighF\n      ) {\n    // TODO: Check if we need to disable filtering\n    // https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/discard.php\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE + texelFloatF * multiplierF;\n    gl_FragColor = computeColor(texelFloatFinal, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  }\n}\n",r.fragMacros),depth:{enable:!1},uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},filterLowF:function(t,e){return e.filterLowF},filterHighF:function(t,e){return e.filterHighF},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},multiplierF:function(t,e){return e.multiplierF},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE},textureF:function(t,e){return e.textureF}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)},texCoordD:function(t,e){return Pi(e.textureBoundsD)},texCoordE:function(t,e){return Pi(e.textureBoundsE)},texCoordF:function(t,e){return Pi(e.textureBoundsF)}})}))}function ho(t,e){return t(n(n({},e),{vert:Dn,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform sampler2D textureC;\nuniform sampler2D textureD;\nuniform sampler2D textureE;\nuniform sampler2D textureF;\n\nuniform float nodataValue;\nuniform bool littleEndian;\n\nuniform float filterLowA;\nuniform float filterHighA;\nuniform float filterLowB;\nuniform float filterHighB;\nuniform float filterLowC;\nuniform float filterHighC;\nuniform float filterLowD;\nuniform float filterHighD;\nuniform float filterLowE;\nuniform float filterHighE;\nuniform float filterLowF;\nuniform float filterHighF;\nuniform float multiplierA;\nuniform float multiplierB;\nuniform float multiplierC;\nuniform float multiplierD;\nuniform float multiplierE;\nuniform float multiplierF;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying vec2 vTexCoordC;\nvarying vec2 vTexCoordD;\nvarying vec2 vTexCoordE;\nvarying vec2 vTexCoordF;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  vec4 texelRgbaC = texture2D(textureC, vTexCoordC);\n  float texelFloatC = rgbaToFloat(texelRgbaC, littleEndian);\n  vec4 texelRgbaD = texture2D(textureD, vTexCoordD);\n  float texelFloatD = rgbaToFloat(texelRgbaD, littleEndian);\n  vec4 texelRgbaE = texture2D(textureE, vTexCoordE);\n  float texelFloatE = rgbaToFloat(texelRgbaE, littleEndian);\n  vec4 texelRgbaF = texture2D(textureF, vTexCoordF);\n  float texelFloatF = rgbaToFloat(texelRgbaF, littleEndian);\n\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n  bool cIsNodata = isCloseEnough(texelFloatC, nodataValue);\n  bool dIsNodata = isCloseEnough(texelFloatD, nodataValue);\n  bool eIsNodata = isCloseEnough(texelFloatE, nodataValue);\n  bool fIsNodata = isCloseEnough(texelFloatF, nodataValue);\n\n  if (aIsNodata || bIsNodata || cIsNodata || dIsNodata || eIsNodata || fIsNodata ||\n      texelFloatA < filterLowA || texelFloatA > filterHighA ||\n      texelFloatB < filterLowB || texelFloatB > filterHighB ||\n      texelFloatC < filterLowC || texelFloatC > filterHighC ||\n      texelFloatD < filterLowD || texelFloatD > filterHighD ||\n      texelFloatE < filterLowE || texelFloatE > filterHighE ||\n      texelFloatF < filterLowF || texelFloatF > filterHighF\n      ) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float texelFloatFinal = texelFloatA * multiplierA + texelFloatB * multiplierB + texelFloatC * multiplierC + texelFloatD * multiplierD + texelFloatE * multiplierE + texelFloatF * multiplierF;\n    gl_FragColor = floatToRgba(texelFloatFinal, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{filterLowA:function(t,e){return e.filterLowA},filterHighA:function(t,e){return e.filterHighA},filterLowB:function(t,e){return e.filterLowB},filterHighB:function(t,e){return e.filterHighB},filterLowC:function(t,e){return e.filterLowC},filterHighC:function(t,e){return e.filterHighC},filterLowD:function(t,e){return e.filterLowD},filterHighD:function(t,e){return e.filterHighD},filterLowE:function(t,e){return e.filterLowE},filterHighE:function(t,e){return e.filterHighE},filterLowF:function(t,e){return e.filterLowF},filterHighF:function(t,e){return e.filterHighF},multiplierA:function(t,e){return e.multiplierA},multiplierB:function(t,e){return e.multiplierB},multiplierC:function(t,e){return e.multiplierC},multiplierD:function(t,e){return e.multiplierD},multiplierE:function(t,e){return e.multiplierE},multiplierF:function(t,e){return e.multiplierF},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},textureC:function(t,e){return e.textureC},textureD:function(t,e){return e.textureD},textureE:function(t,e){return e.textureE},textureF:function(t,e){return e.textureF}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)},texCoordC:function(t,e){return Pi(e.textureBoundsC)},texCoordD:function(t,e){return Pi(e.textureBoundsD)},texCoordE:function(t,e){return Pi(e.textureBoundsE)},texCoordF:function(t,e){return Pi(e.textureBoundsF)}})}))}function po(t,e){return t(n(n({},e),{vert:En,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nprecision highp sampler2D;\n#define GLSLIFY 1\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  // vec4 texelRgbaA = texture2D(textureA, vec2(vTexCoordA.x, 1.0 - vTexCoordA.y));\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  // vec4 texelRgbaB = texture2D(textureB, vec2(vTexCoordB.x, 1.0 - vTexCoordB.y));\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata) {\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    float diff = texelFloatB - texelFloatA;\n    gl_FragColor = floatToRgba(diff, littleEndian);\n  }\n}\n",depth:{enable:!1},uniforms:n(n({},e.uniforms),{textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)}})}))}function go(t,e,r){return t(n(n({},e),{vert:En,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength_0,\n  int sentinelValuesLength_0\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength_0 > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength_0) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength_0 > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength_0) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform ScaleStop colorScale[SCALE_MAX_LENGTH];\nuniform int colorScaleLength;\n\nuniform ScaleStop sentinelValues[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLength;\n\nuniform float nodataValue;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform bool littleEndian;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n  float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n  vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n  float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n  bool aIsNodata = isCloseEnough(texelFloatA, nodataValue);\n  bool bIsNodata = isCloseEnough(texelFloatB, nodataValue);\n\n  if (aIsNodata || bIsNodata) {\n    gl_FragColor = TRANSPARENT;\n  } else {\n    float diff = texelFloatB - texelFloatA;\n    gl_FragColor = computeColor(diff, colorScale, sentinelValues, colorScaleLength, sentinelValuesLength);\n  }\n}\n",r.fragMacros),depth:{enable:!1},uniforms:n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),{colorScaleLength:function(t,e){return e.colorScale.length},sentinelValuesLength:function(t,e){return e.sentinelValues.length},textureA:t.prop("textureA"),textureB:t.prop("textureB")}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)}})}))}function bo(t,e,r,i){return t(n(n({},e),{vert:En,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n#define TRANSPARENT vec4(0.0)\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength,\n  int sentinelValuesLength\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D textureA;\nuniform ScaleStop colorScaleA[SCALE_MAX_LENGTH];\nuniform int colorScaleLengthA;\nuniform ScaleStop sentinelValuesA[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLengthA;\n\nuniform sampler2D textureB;\nuniform ScaleStop colorScaleB[SCALE_MAX_LENGTH];\nuniform int colorScaleLengthB;\nuniform ScaleStop sentinelValuesB[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLengthB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\n\nvoid main() {\n  if (interpolationFraction <= 0.0) {\n    vec4 texelRgba = texture2D(textureA, vTexCoordA);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, colorScaleA, sentinelValuesA, colorScaleLengthA, sentinelValuesLengthA);\n  } else if (interpolationFraction >= 1.0) {\n    vec4 texelRgba = texture2D(textureB, vTexCoordB);\n    float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n    if (isCloseEnough(texelFloat, nodataValue)) {\n      discard;\n    }\n    gl_FragColor = computeColor(texelFloat, colorScaleB, sentinelValuesB, colorScaleLengthB, sentinelValuesLengthB);\n  } else {\n    vec4 texelRgbaA = texture2D(textureA, vTexCoordA);\n    float texelFloatA = rgbaToFloat(texelRgbaA, littleEndian);\n    vec4 texelRgbaB = texture2D(textureB, vTexCoordB);\n    float texelFloatB = rgbaToFloat(texelRgbaB, littleEndian);\n    vec4 colorA = (\n      isCloseEnough(texelFloatA, nodataValue)\n      ? TRANSPARENT\n      : computeColor(texelFloatA, colorScaleA, sentinelValuesA, colorScaleLengthA, sentinelValuesLengthA)\n    );\n    vec4 colorB = (\n      isCloseEnough(texelFloatB, nodataValue)\n      ? TRANSPARENT\n      : computeColor(texelFloatB, colorScaleB, sentinelValuesB, colorScaleLengthB, sentinelValuesLengthB)\n    );\n    gl_FragColor = mix(colorA, colorB, interpolationFraction);\n  }\n}",r.fragMacros),uniforms:n(n(n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),i.colorScaleUniforms),i.sentinelValuesUniforms),{colorScaleLengthA:function(t,e){return e.colorScaleA.length},colorScaleLengthB:function(t,e){return e.colorScaleB.length},sentinelValuesLengthA:function(t,e){return e.sentinelValuesA.length},sentinelValuesLengthB:function(t,e){return e.sentinelValuesB.length},textureA:function(t,e){return e.textureA},textureB:function(t,e){return e.textureB},interpolationFraction:function(t,e){return e.interpolationFraction}}),attributes:n(n({},e.attributes),{texCoordA:function(t,e){return Pi(e.textureBoundsA)},texCoordB:function(t,e){return Pi(e.textureBoundsB)}})}))}function mo(t,e,r,i){return t(n(n({},e),{vert:Cn,frag:Xi("#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nstruct ScaleStop {\n  float offset;\n  vec4 color;\n};\n\n#ifndef DEFAULT_COLOR\n#define DEFAULT_COLOR vec4(0.0)\n#endif\n\n#ifndef SCALE_MAX_LENGTH\n#define SCALE_MAX_LENGTH 16\n#endif\n\n#ifndef SENTINEL_MAX_LENGTH\n#define SENTINEL_MAX_LENGTH 16\n#endif\n\nvec4 computeColor(\n  float inputVal,\n  ScaleStop colorScale[SCALE_MAX_LENGTH],\n  ScaleStop sentinelValues[SENTINEL_MAX_LENGTH],\n  int colorScaleLength,\n  int sentinelValuesLength\n) {\n  // Compare the value against any sentinel values, if defined.\n  if (sentinelValuesLength > 0) {\n    for (int i_0 = 0; i_0 < SENTINEL_MAX_LENGTH; ++i_0) {\n      if (i_0 == sentinelValuesLength) {\n        break;\n      }\n      ScaleStop sentinel = sentinelValues[i_0];\n      if (isCloseEnough(inputVal, sentinel.offset)) {\n        return sentinel.color;\n      }\n    }\n  }\n\n  // Do linear interpolation using the color scale, if defined.\n  if (colorScaleLength > 0) {\n    // If value below color scale range, clamp to lowest color stop.\n    if (inputVal < colorScale[0].offset) {\n      return colorScale[0].color;\n    } else {\n      for (int i = 0; i < SCALE_MAX_LENGTH; ++i) {\n        // If value above color scale range, clamp to highest color stop.\n        if (i == colorScaleLength) {\n          return colorScale[i - 1].color;\n        } else if (inputVal <= colorScale[i + 1].offset) {\n          float percent = (inputVal - colorScale[i].offset)\n            / (colorScale[i + 1].offset - colorScale[i].offset);\n          return mix(colorScale[i].color, colorScale[i + 1].color, percent);\n        }\n      }\n    }\n  }\n\n  return DEFAULT_COLOR;\n}\n\nuniform sampler2D texture;\n\nuniform ScaleStop colorScaleA[SCALE_MAX_LENGTH];\nuniform int colorScaleLengthA;\nuniform ScaleStop sentinelValuesA[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLengthA;\n\nuniform ScaleStop colorScaleB[SCALE_MAX_LENGTH];\nuniform int colorScaleLengthB;\nuniform ScaleStop sentinelValuesB[SENTINEL_MAX_LENGTH];\nuniform int sentinelValuesLengthB;\n\nuniform float nodataValue;\nuniform bool littleEndian;\nuniform float interpolationFraction;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec4 texelRgba = texture2D(texture, vTexCoord);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    discard;\n  }\n\n  if (interpolationFraction <= 0.0) {\n    gl_FragColor = computeColor(texelFloat, colorScaleA, sentinelValuesA, colorScaleLengthA, sentinelValuesLengthA);\n  } else if (interpolationFraction >= 1.0) {\n    gl_FragColor = computeColor(texelFloat, colorScaleB, sentinelValuesB, colorScaleLengthB, sentinelValuesLengthB);\n  } else {\n    vec4 colorA = computeColor(texelFloat, colorScaleA, sentinelValuesA, colorScaleLengthA, sentinelValuesLengthA);\n    vec4 colorB = computeColor(texelFloat, colorScaleB, sentinelValuesB, colorScaleLengthB, sentinelValuesLengthB);\n    gl_FragColor = mix(colorA, colorB, interpolationFraction);\n  }\n}",r.fragMacros),uniforms:n(n(n(n(n(n({},e.uniforms),r.colorScaleUniforms),r.sentinelValuesUniforms),i.colorScaleUniforms),i.sentinelValuesUniforms),{colorScaleLengthA:function(t,e){return e.colorScaleA.length},colorScaleLengthB:function(t,e){return e.colorScaleB.length},sentinelValuesLengthA:function(t,e){return e.sentinelValuesA.length},sentinelValuesLengthB:function(t,e){return e.sentinelValuesB.length},texture:function(t,e){return e.texture},interpolationFraction:function(t,e){return e.interpolationFraction}}),attributes:n(n({},e.attributes),{texCoord:function(t,e){return Pi(e.textureBounds)}})}))}function xo(t,e){return t({vert:"#define GLSLIFY 1\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = texCoord;\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n",frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#define GLSLIFY 1\n#endif\n\n// Denormalize 8-bit color channels to integers in the range 0 to 255.\nivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n  ivec4 bytes = ivec4(inputFloats * 255.0);\n  return (\n    littleEndian\n    ? bytes.abgr\n    : bytes\n  );\n}\n\n// Break the four bytes down into an array of 32 bits.\nvoid bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n  for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n    float acc = float(bytes[channelIndex]);\n    for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n      float powerOfTwo = exp2(float(indexInByte));\n      bool bit = acc >= powerOfTwo;\n      bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n      acc = mod(acc, powerOfTwo);\n    }\n  }\n}\n\n// Compute the exponent of the 32-bit float.\nfloat getExponent(bool bits[32]) {\n  const int startIndex = 1;\n  const int bitStringLength = 8;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  float acc = 0.0;\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Compute the mantissa of the 32-bit float.\nfloat getMantissa(bool bits[32], bool subnormal) {\n  const int startIndex = 9;\n  const int bitStringLength = 23;\n  const int endBeforeIndex = startIndex + bitStringLength;\n  // Leading/implicit/hidden bit convention:\n  // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n  float acc = float(!subnormal) * exp2(float(bitStringLength));\n  int pow2 = bitStringLength - 1;\n  for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n    acc += float(bits[bitIndex]) * exp2(float(pow2--));\n  }\n  return acc;\n}\n\n// Parse the float from its 32 bits.\nfloat bitsToFloat(bool bits[32]) {\n  float signBit = float(bits[0]) * -2.0 + 1.0;\n  float exponent = getExponent(bits);\n  bool subnormal = abs(exponent - 0.0) < 0.01;\n  float mantissa = getMantissa(bits, subnormal);\n  float exponentBias = 127.0;\n  return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n}\n\n// Decode a 32-bit float from the RGBA color channels of a texel.\nfloat rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n  ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n  bool bits[32];\n  bytesToBits(rgbaBytes, bits);\n  return bitsToFloat(bits);\n}\n\nfloat shiftRight (float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shiftLeft (float v, float amt) {\n    return floor(v * exp2(amt) + 0.5);\n}\nfloat maskLast (float v, float bits_0) {\n    return mod(v, shiftLeft(1.0, bits_0));\n}\nfloat extractBits (float num, float from, float to) {\n    from = floor(from + 0.5); to = floor(to + 0.5);\n    return maskLast(shiftRight(num, from), to - from);\n}\nvec4 floatToRgba(float texelFloat, bool littleEndian) {\n    if (texelFloat == 0.0) return vec4(0, 0, 0, 0);\n    float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n    texelFloat = abs(texelFloat);\n    float exponent = floor(log2(texelFloat));\n    float biased_exponent = exponent + 127.0;\n    float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n    float t = biased_exponent / 2.0;\n    float last_bit_of_biased_exponent = fract(t) * 2.0;\n    float remaining_bits_of_biased_exponent = floor(t);\n    float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n    float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n    float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n    float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n    return (\n      littleEndian\n      ? vec4(byte4, byte3, byte2, byte1)\n      : vec4(byte1, byte2, byte3, byte4)\n    );\n}\n\n#ifndef RELATIVE_TOLERANCE\n#define RELATIVE_TOLERANCE 0.0001\n#endif\n\nbool isCloseEnough(float a, float b) {\n  return abs(a - b) <= max(abs(a), abs(b)) * RELATIVE_TOLERANCE;\n}\n\nuniform sampler2D texture;\nuniform float textureSize;\nuniform bool littleEndian;\nuniform float nodataValue;\nvarying vec2 vTexCoord;\nuniform int kernelSize;\n\nint kernelEnd = int(kernelSize/2);\nint kernelStart = kernelEnd * -1;\n\nfloat getTexelValue(vec2 pos) {\n  vec4 texelRgba = texture2D(texture, pos);\n  float texelFloat = rgbaToFloat(texelRgba, littleEndian);\n  return texelFloat;\n}\n\nfloat runConvKernel(vec2 pos, vec2 onePixel) {\n  float convKernelWeight = 0.0;\n  float sum = 0.0;\n\n  for (int i = -20; i < 20; i ++) {\n    if (i < kernelStart) continue;\n    if (i > kernelEnd) break;\n    for (int j = -20; j < 20; j ++) {\n      if (j < kernelStart) continue;\n      if (j > kernelEnd) break;\n      float texelValue = getTexelValue(pos + onePixel * vec2(i, j));\n      if (!isCloseEnough(texelValue, nodataValue)) {\n        sum = sum + texelValue;\n        convKernelWeight = convKernelWeight + 1.0;\n      }\n    }\n  }\n  return (sum / convKernelWeight);\n}\n\nvoid main() {\n  float texelFloat = getTexelValue(vTexCoord);\n  if (isCloseEnough(texelFloat, nodataValue)) {\n    // gl_FragColor = vec4(nodataValue);\n    gl_FragColor = floatToRgba(nodataValue, littleEndian);\n  } else {\n    vec2 onePixel = vec2(1.0, 1.0) / textureSize;\n    float texelFloatSmoothed = runConvKernel(vTexCoord, onePixel);\n    // gl_FragColor = vec4(texelFloatSmoothed);\n    gl_FragColor = floatToRgba(texelFloatSmoothed, littleEndian);\n  }\n}\n",uniforms:n(n({},e.uniforms),{texture:t.prop("texture"),textureSize:t.prop("textureSize"),kernelSize:t.prop("kernelSize")}),attributes:{texCoord:[0,1,1,1,0,0,1,0],position:[-1,1,1,1,-1,-1,1,-1]},depth:{enable:!1},primitive:"triangle strip",count:4})}var vo=function(){function t(t,e,n,r){var i=Math.floor(n/e),o=i*e,a=i*i,l=t.texture({width:o,height:o,flipY:r,format:"rgba",type:"uint8"}),s=new Map,u=this.allTextureCoordinates(i,e);Object.assign(this,{tileSize:e,tilesAcross:i,pixelsAcross:o,tileCapacity:a,texture:l,contents:s,available:u})}return t.prototype.addTile=function(t,e){var n=this,r=n.available,i=n.contents,o=n.texture,a=n.tileSize,l=this.hashTileCoordinates(t);if(i.has(l)){var s=i.get(l);return i.delete(l),i.set(l,s),this.formatOutputTextureCoordinates(s)}if(function(t){if(null==t)return!0;if(at(t)&&(v(t)||"string"==typeof t||"function"==typeof t.splice||xt(t)||Ct(t)||pt(t)))return!t.length;var e=Ne(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(st(t))return!Ft(t).length;for(var n in t)if(hn.call(t,n))return!1;return!0}(r)){var u=i.keys().next().value;this.removeByHashKey(u)}var f=r.pop();i.set(l,f);var c=f.x,d=f.y;return o.subimage({data:e,width:a,height:a},c,d),this.formatOutputTextureCoordinates(f)},t.prototype.removeTile=function(t){this.removeByHashKey(this.hashTileCoordinates(t))},t.prototype.clearTiles=function(){for(var t=0,e=Array.from(this.contents.keys());t<e.length;t++){var n=e[t];this.removeByHashKey(n)}},t.prototype.destroy=function(){this.texture.destroy()},t.prototype.removeByHashKey=function(t){if(this.contents.has(t)){var e=this.contents.get(t);this.contents.delete(t),this.available.push(e)}},t.prototype.formatOutputTextureCoordinates=function(t){var e=t.x,n=t.y,r=this.pixelsAcross,i=this.tileSize;return[{x:e/r,y:n/r},{x:(e+i)/r,y:(n+i)/r}]},t.prototype.hashTileCoordinates=function(t){return t.x+":"+t.y+":"+t.z},t.prototype.allTextureCoordinates=function(t,e){return cn(zi(t),(function(n){return zi(t).map((function(t){return{x:n*e,y:t*e}}))}))},t}(),yo=function(){function e(e,n,r,i){var o=t.DomUtil.create("canvas"),a=Tn,l=_n({canvas:o,onDone:function(t,e){t?console.log(t):(e.limits.maxTextureSize>2048?a=2048:e.limits.maxTextureSize>4096&&(a=4096),261===e.limits.maxFragmentUniforms&&console.log("Software rendering detected and not supported with GLOperations plugin. If you have a GPU, check if drivers are installed ok?"))}}),s=function(t,e){return{uniforms:{nodataValue:e,littleEndian:Wi,transformMatrix:function(t){return[2/t.viewportWidth,0,0,0,0,-2/t.viewportHeight,0,0,0,0,1,0,-1,1,0,1]}},attributes:{position:function(e,n){var r=n.canvasCoordinates,i=r[0],o=r[1],a=[i+t,o+t],l=a[0],s=a[1];return[[i,o],[l,o],[i,s],[l,s]]}},depth:{enable:!1},primitive:"triangle strip",count:4,viewport:function(t,e){var n=e.canvasSize;return{width:n[0],height:n[1]}}}}(e,n),u=Zi("colorScale",r,"sentinelValues",i),f=Zi("colorScaleA",r,"sentinelValuesA",i),c=Zi("colorScaleB",r,"sentinelValuesB",i);Object.assign(this,{canvas:o,regl:l,tileSize:e,maxTextureDimension:a,textureManager:new vo(l,e,a,!1),textureManagerA:new vo(l,e,a,!1),textureManagerB:new vo(l,e,a,!1),textureManagerC:new vo(l,e,a,!1),textureManagerD:new vo(l,e,a,!1),textureManagerE:new vo(l,e,a,!1),textureManagerF:new vo(l,e,a,!1),textureManagerHillshade:new vo(l,e,a,!1),drawTile:Ki(l,s,u),drawTileHsSimple:Qi(l,s,u),drawTileHsPregen:Ji(l,s,u),drawTileInterpolateColor:bo(l,s,f,c),drawTileInterpolateColorOnly:mo(l,s,f,c),drawTileInterpolateValue:to(l,s,u),calcTileMultiAnalyze1:no(l,s),drawTileMultiAnalyze1:eo(l,s,u),calcTileMultiAnalyze2:io(l,s),drawTileMultiAnalyze2:ro(l,s,u),calcTileMultiAnalyze3:ao(l,s),drawTileMultiAnalyze3:oo(l,s,u),calcTileMultiAnalyze4:so(l,s),drawTileMultiAnalyze4:lo(l,s,u),calcTileMultiAnalyze5:fo(l,s),drawTileMultiAnalyze5:uo(l,s,u),calcTileMultiAnalyze6:ho(l,s),drawTileMultiAnalyze6:co(l,s,u),drawTileDiff:go(l,s,u),calcTileDiff:po(l,s),convolutionSmooth:xo(l,s)})}return e.prototype.setMaxTextureDimension=function(t){var e=this,n=e.textureManager,r=e.tileSize,i=e.regl;n.destroy(),Object.assign(this,{maxTextureDimension:t,textureManager:new vo(i,r,t,!1)})},e.prototype.findMaxTextureDimension=function(){var t=this.regl,e=Tn;return t.limits.maxTextureSize>2048?e=2048:t.limits.maxTextureSize>4096&&(e=4096),e},e.prototype.renderTile=function(t,e,n,r,i){var o=t.coords,a=t.pixelData;void 0===i&&(i=0);var l=this,s=l.regl,u=l.textureManager,f=l.tileSize;this.setCanvasSize(f,f);var c=u.addTile(o,a);s.clear({color:wn});var d=r.hsSimpleZoomdelta||0,h=Math.max(.5,Math.pow(2,i+d)/2048)/u.texture.width;return"none"===r.hillshadeType?this.drawTile({colorScale:Ri(e),sentinelValues:Ri(n),canvasSize:[f,f],canvasCoordinates:[0,0],textureBounds:c,texture:u.texture,enableSimpleHillshade:!1}):"simple"===r.hillshadeType&&this.drawTileHsSimple({colorScale:Ri(e),sentinelValues:Ri(n),canvasSize:[f,f],canvasCoordinates:[0,0],textureBounds:c,texture:u.texture,textureSize:u.texture.width,tileSize:f,offset:h,enableSimpleHillshade:!0,azimuth:r.hsSimpleAzimuth,altitude:r.hsSimpleAltitude,slopescale:r.hsSimpleSlopescale}),[0,0]},e.prototype.renderTileHsPregen=function(t,e,n,r,i){var o=this,a=o.regl,l=o.textureManager,s=o.textureManagerHillshade,u=o.tileSize;this.setCanvasSize(u,u);var f=l.addTile(t.coords,t.pixelData),c=s.addTile(e.coords,e.pixelData);return a.clear({color:wn}),this.drawTileHsPregen({colorScale:Ri(n),sentinelValues:Ri(r),canvasSize:[u,u],canvasCoordinates:[0,0],textureBounds:f,textureBoundsHs:c,texture:l.texture,hillshadePregenTexture:s.texture}),[0,0]},e.prototype.flipReadPixelsFloat=function(t,e,n){for(var r=e/2|0,i=4*t,o=new Float32Array(4*t),a=0;a<r;++a){var l=a*i,s=(e-a-1)*i;o.set(n.subarray(l,l+i)),n.copyWithin(l,s,s+i),n.set(o,s)}return n},e.prototype.flipReadPixelsUint=function(t,e,n){for(var r=e/2|0,i=4*t,o=new Uint8Array(4*t),a=0;a<r;++a){var l=a*i,s=(e-a-1)*i;o.set(n.subarray(l,l+i)),n.copyWithin(l,s,s+i),n.set(o,s)}return n},e.prototype.renderTileDiff=function(t,e,n,r){var i=this,o=this,a=o.regl,l=o.textureManagerA,s=o.textureManagerB,u=o.tileSize;this.setCanvasSize(u,u);var f=l.addTile(t.coords,t.pixelData),c=s.addTile(e.coords,e.pixelData),d=a.framebuffer({width:u,height:u,depth:!1,colorFormat:"rgba",colorType:"uint8"}),h=new Uint8Array(u*u*4);return d.use((function(){i.calcTileDiff({canvasSize:[u,u],canvasCoordinates:[0,0],textureA:l.texture,textureB:s.texture,textureBoundsA:f,textureBoundsB:c}),a.read({data:h})})),h=this.flipReadPixelsUint(u,u,h),this.drawTileDiff({colorScale:Ri(n),sentinelValues:Ri(r),canvasSize:[u,u],canvasCoordinates:[0,0],textureA:l.texture,textureB:s.texture,textureBoundsA:f,textureBoundsB:c}),d.destroy(),[0,0,h]},e.prototype.renderConvolutionSmooth=function(t,e,n,r){var i=this,o=this.regl;this.setCanvasSize(e,n);var a=o.texture({data:t,width:e,height:n,flipY:!1}),l=o.framebuffer({width:e,height:n,depth:!1,colorFormat:"rgba",colorType:"uint8"}),s=new Uint8Array(e*n*4);return l.use((function(){i.convolutionSmooth({texture:a,textureSize:e,kernelSize:r}),o.read({data:s})})),s=new Float32Array(s.buffer),l.destroy(),s},e.prototype.renderTileMulti1=function(t,e,n,r,i,o){var a=this,l=this,s=l.regl,u=l.textureManagerA,f=l.tileSize;this.setCanvasSize(f,f);var c=u.addTile(t.coords,t.pixelData),d=s.framebuffer({width:f,height:f,depth:!1,colorFormat:"rgba",colorType:"uint8"}),h=new Uint8Array(f*f*4);return d.use((function(){a.calcTileMultiAnalyze1({canvasSize:[f,f],canvasCoordinates:[0,0],textureA:u.texture,textureBoundsA:c,filterLowA:r,filterHighA:i,multiplierA:o}),s.read({data:h})})),h=this.flipReadPixelsUint(f,f,h),this.drawTileMultiAnalyze1({colorScale:Ri(e),sentinelValues:Ri(n),canvasSize:[f,f],canvasCoordinates:[0,0],textureA:u.texture,textureBoundsA:c,filterLowA:r,filterHighA:i,multiplierA:o}),d.destroy(),[0,0,h]},e.prototype.renderTileMulti2=function(t,e,n,r,i,o,a,l,s,u){var f=this,c=this,d=c.regl,h=c.textureManagerA,p=c.textureManagerB,g=c.tileSize;this.setCanvasSize(g,g);var b=h.addTile(t.coords,t.pixelData),m=p.addTile(e.coords,e.pixelData),x=d.framebuffer({width:g,height:g,depth:!1,colorFormat:"rgba",colorType:"uint8"}),v=new Uint8Array(g*g*4);return x.use((function(){f.calcTileMultiAnalyze2({canvasSize:[g,g],canvasCoordinates:[0,0],textureA:h.texture,textureB:p.texture,textureBoundsA:b,textureBoundsB:m,filterLowA:i,filterHighA:o,filterLowB:a,filterHighB:l,multiplierA:s,multiplierB:u}),d.read({data:v})})),v=this.flipReadPixelsUint(g,g,v),this.drawTileMultiAnalyze2({colorScale:Ri(n),sentinelValues:Ri(r),canvasSize:[g,g],canvasCoordinates:[0,0],textureA:h.texture,textureB:p.texture,textureBoundsA:b,textureBoundsB:m,filterLowA:i,filterHighA:o,filterLowB:a,filterHighB:l,multiplierA:s,multiplierB:u}),x.destroy(),[0,0,v]},e.prototype.renderTileMulti3=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h){var p=this,g=this,b=g.regl,m=g.textureManagerA,x=g.textureManagerB,v=g.textureManagerC,y=g.tileSize;this.setCanvasSize(y,y);var _=m.addTile(t.coords,t.pixelData),w=x.addTile(e.coords,e.pixelData),A=v.addTile(n.coords,n.pixelData),T=b.framebuffer({width:y,height:y,depth:!1,colorFormat:"rgba",colorType:"uint8"}),E=new Uint8Array(y*y*4);return T.use((function(){p.calcTileMultiAnalyze3({canvasSize:[y,y],canvasCoordinates:[0,0],textureA:m.texture,textureB:x.texture,textureC:v.texture,textureBoundsA:_,textureBoundsB:w,textureBoundsC:A,filterLowA:o,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:u,filterHighC:f,multiplierA:c,multiplierB:d,multiplierC:h}),b.read({data:E})})),E=this.flipReadPixelsUint(y,y,E),this.drawTileMultiAnalyze3({colorScale:Ri(r),sentinelValues:Ri(i),canvasSize:[y,y],canvasCoordinates:[0,0],textureA:m.texture,textureB:x.texture,textureC:v.texture,textureBoundsA:_,textureBoundsB:w,textureBoundsC:A,filterLowA:o,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:u,filterHighC:f,multiplierA:c,multiplierB:d,multiplierC:h}),T.destroy(),[0,0,E]},e.prototype.renderTileMulti4=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m){var x=this,v=this,y=v.regl,_=v.textureManagerA,w=v.textureManagerB,A=v.textureManagerC,T=v.textureManagerD,E=v.tileSize;this.setCanvasSize(E,E);var C=_.addTile(t.coords,t.pixelData),B=w.addTile(e.coords,e.pixelData),S=A.addTile(n.coords,n.pixelData),L=T.addTile(r.coords,r.pixelData),D=y.framebuffer({width:E,height:E,depth:!1,colorFormat:"rgba",colorType:"uint8"}),I=new Uint8Array(E*E*4);return D.use((function(){x.calcTileMultiAnalyze4({canvasSize:[E,E],canvasCoordinates:[0,0],textureA:_.texture,textureB:w.texture,textureC:A.texture,textureD:T.texture,textureBoundsA:C,textureBoundsB:B,textureBoundsC:S,textureBoundsD:L,filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:u,filterLowC:f,filterHighC:c,filterLowD:d,filterHighD:h,multiplierA:p,multiplierB:g,multiplierC:b,multiplierD:m}),y.read({data:I})})),I=this.flipReadPixelsUint(E,E,I),this.drawTileMultiAnalyze4({colorScale:Ri(i),sentinelValues:Ri(o),canvasSize:[E,E],canvasCoordinates:[0,0],textureA:_.texture,textureB:w.texture,textureC:A.texture,textureD:T.texture,textureBoundsA:C,textureBoundsB:B,textureBoundsC:S,textureBoundsD:L,filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:u,filterLowC:f,filterHighC:c,filterLowD:d,filterHighD:h,multiplierA:p,multiplierB:g,multiplierC:b,multiplierD:m}),D.destroy(),[0,0,I]},e.prototype.renderTileMulti5=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_){var w=this,A=this,T=A.regl,E=A.textureManagerA,C=A.textureManagerB,B=A.textureManagerC,S=A.textureManagerD,L=A.textureManagerE,D=A.tileSize;this.setCanvasSize(D,D);var I=E.addTile(t.coords,t.pixelData),F=C.addTile(e.coords,e.pixelData),k=B.addTile(n.coords,n.pixelData),N=S.addTile(r.coords,r.pixelData),M=L.addTile(i.coords,i.pixelData),R=T.framebuffer({width:D,height:D,depth:!1,colorFormat:"rgba",colorType:"uint8"}),O=new Uint8Array(D*D*4);return R.use((function(){w.calcTileMultiAnalyze5({canvasSize:[D,D],canvasCoordinates:[0,0],textureA:E.texture,textureB:C.texture,textureC:B.texture,textureD:S.texture,textureE:L.texture,textureBoundsA:I,textureBoundsB:F,textureBoundsC:k,textureBoundsD:N,textureBoundsE:M,filterLowA:l,filterHighA:s,filterLowB:u,filterHighB:f,filterLowC:c,filterHighC:d,filterLowD:h,filterHighD:p,filterLowE:g,filterHighE:b,multiplierA:m,multiplierB:x,multiplierC:v,multiplierD:y,multiplierE:_}),T.read({data:O})})),O=this.flipReadPixelsUint(D,D,O),this.drawTileMultiAnalyze5({colorScale:Ri(o),sentinelValues:Ri(a),canvasSize:[D,D],canvasCoordinates:[0,0],textureA:E.texture,textureB:C.texture,textureC:B.texture,textureD:S.texture,textureE:L.texture,textureBoundsA:I,textureBoundsB:F,textureBoundsC:k,textureBoundsD:N,textureBoundsE:M,filterLowA:l,filterHighA:s,filterLowB:u,filterHighB:f,filterLowC:c,filterHighC:d,filterLowD:h,filterHighD:p,filterLowE:g,filterHighE:b,multiplierA:m,multiplierB:x,multiplierC:v,multiplierD:y,multiplierE:_}),R.destroy(),[0,0,O]},e.prototype.renderTileMulti6=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w,A,T,E){var C=this,B=this,S=B.regl,L=B.textureManagerA,D=B.textureManagerB,I=B.textureManagerC,F=B.textureManagerD,k=B.textureManagerE,N=B.textureManagerF,M=B.tileSize;this.setCanvasSize(M,M);var R=L.addTile(t.coords,t.pixelData),O=D.addTile(e.coords,e.pixelData),H=I.addTile(n.coords,n.pixelData),V=F.addTile(r.coords,r.pixelData),z=k.addTile(i.coords,i.pixelData),P=k.addTile(o.coords,o.pixelData),U=S.framebuffer({width:M,height:M,depth:!1,colorFormat:"rgba",colorType:"uint8"}),G=new Uint8Array(M*M*4);return U.use((function(){C.calcTileMultiAnalyze6({canvasSize:[M,M],canvasCoordinates:[0,0],textureA:L.texture,textureB:D.texture,textureC:I.texture,textureD:F.texture,textureE:k.texture,textureF:N.texture,textureBoundsA:R,textureBoundsB:O,textureBoundsC:H,textureBoundsD:V,textureBoundsE:z,textureBoundsF:P,filterLowA:s,filterHighA:u,filterLowB:f,filterHighB:c,filterLowC:d,filterHighC:h,filterLowD:p,filterHighD:g,filterLowE:b,filterHighE:m,filterLowF:x,filterHighF:v,multiplierA:y,multiplierB:_,multiplierC:w,multiplierD:A,multiplierE:T,multiplierF:E}),S.read({data:G})})),G=this.flipReadPixelsUint(M,M,G),this.drawTileMultiAnalyze6({colorScale:Ri(a),sentinelValues:Ri(l),canvasSize:[M,M],canvasCoordinates:[0,0],textureA:L.texture,textureB:D.texture,textureC:I.texture,textureD:F.texture,textureE:k.texture,textureF:N.texture,textureBoundsA:R,textureBoundsB:O,textureBoundsC:H,textureBoundsD:V,textureBoundsE:z,textureBoundsF:P,filterLowA:s,filterHighA:u,filterLowB:f,filterHighB:c,filterLowC:d,filterHighC:h,filterLowD:p,filterHighD:g,filterLowE:b,filterHighE:m,filterLowF:x,filterHighF:v,multiplierA:y,multiplierB:_,multiplierC:w,multiplierD:A,multiplierE:T,multiplierF:E}),U.destroy(),[0,0,G]},e.prototype.renderTiles=function(t,e,r,i,o){void 0===o&&(o=0);var a=this,l=a.regl,s=a.textureManager,u=a.tileSize,f=this.computeRequiredCanvasDimensions(t.length),c=f[0],d=f[1];this.setCanvasSize(c,d);var h=this.getCanvasCoordinates(c,d,t.length),p=xn(t,h,(function(t,e){return n(n({},t),{canvasCoords:e})})),g=Ri(e),b=Ri(r),m=[c,d];s.clearTiles(),l.clear({color:wn});for(var x=fe(p,s.tileCapacity),v=i.hsSimpleZoomdelta||0,y=function(t){var e=t.map((function(t){var e=t.coords,n=t.pixelData;return s.addTile(e,n)})),n=Math.max(.5,Math.pow(2,o+v)/2048)/s.texture.width;"none"===i.hillshadeType?_.drawTile(t.map((function(t,n){var r=t.canvasCoords;return{colorScale:g,sentinelValues:b,canvasSize:m,canvasCoordinates:r,textureBounds:e[n],texture:s.texture,enableSimpleHillshade:!1}}))):"simple"===i.hillshadeType&&_.drawTileHsSimple(t.map((function(t,r){var o=t.canvasCoords;return{colorScale:g,sentinelValues:b,canvasSize:m,canvasCoordinates:o,textureBounds:e[r],textureSize:s.texture.width,texture:s.texture,tileSize:u,offset:n,enableSimpleHillshade:!0,azimuth:i.hsSimpleAzimuth,altitude:i.hsSimpleAltitude,slopescale:i.hsSimpleSlopescale}})))},_=this,w=0,A=x;w<A.length;w++){y(A[w])}return h},e.prototype.renderTilesHsPregen=function(t,e,n,r,i){var o=this,a=o.regl,l=o.textureManager,s=o.textureManagerHillshade,u=this.computeRequiredCanvasDimensions(t.length),f=u[0],c=u[1];this.setCanvasSize(f,c);var d=this.getCanvasCoordinates(f,c,t.length),h=xn(t,e,d,(function(t,e,n){return{coords:t.coords,tilesPixelData:t.pixelData,tilesHsPixelData:e.pixelData,canvasCoords:n}})),p=Ri(n),g=Ri(r),b=[f,c];l.clearTiles(),s.clearTiles(),a.clear({color:wn});for(var m=fe(h,l.tileCapacity),x=function(t){var e=t.map((function(t){var e=t.coords,n=t.tilesPixelData;return l.addTile(e,n)})),n=t.map((function(t){var e=t.coords,n=t.tilesHsPixelData;return s.addTile(e,n)}));v.drawTileHsPregen(t.map((function(t,r){var i=t.canvasCoords;return{colorScale:p,sentinelValues:g,canvasSize:b,canvasCoordinates:i,textureBounds:e[r],textureBoundsHs:n[r],texture:l.texture,hillshadePregenTexture:s.texture}})))},v=this,y=0,_=m;y<_.length;y++){x(_[y])}return d},e.prototype.renderTilesWithDiff=function(t,e,n,r,i){var o=this,a=this,l=a.regl,s=a.textureManagerA,u=a.textureManagerB,f=a.tileSize,c=this.computeRequiredCanvasDimensions(t.length),d=c[0],h=c[1];this.setCanvasSize(d,h);var p=this.getCanvasCoordinates(d,h,t.length),g=xn(t,e,p,(function(t,e,n){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,canvasCoords:n}})),b=Ri(n),m=Ri(r),x=[];return function(){var t=fe(g,s.tileCapacity);l.clear({color:wn});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return s.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return u.addTile(e,n)}));t.forEach((function(t,i){var a=t.canvasCoords,d=l.framebuffer({width:f,height:f,depth:!1,colorFormat:"rgba",colorType:"uint8"}),h=new Uint8Array(f*f*4);d.use((function(){o.calcTileDiff({canvasSize:[f,f],canvasCoordinates:[0,0],textureA:s.texture,textureB:u.texture,textureBoundsA:n[i],textureBoundsB:r[i]}),l.read({data:h})})),h=o.flipReadPixelsUint(f,f,h),x[e]=h,e+=1,o.drawTileDiff({colorScale:b,sentinelValues:m,canvasSize:c,canvasCoordinates:a,textureA:s.texture,textureB:u.texture,textureBoundsA:n[i],textureBoundsB:r[i]}),d.destroy()}))},r=0,a=t;r<a.length;r++){n(a[r])}i(p)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerA=new vo(l,f,Tn,!1),this.textureManagerB=new vo(l,f,Tn,!1),x},e.prototype.renderTilesWithMultiAnalyze1=function(t,e,n,r,i,o,a){var l=this,s=this,u=s.regl,f=s.textureManagerA,c=s.tileSize,d=this.computeRequiredCanvasDimensions(t.length),h=d[0],p=d[1];this.setCanvasSize(h,p);var g=this.getCanvasCoordinates(h,p,t.length),b=xn(t,g,(function(t,e){return{coords:t.coords,tilesAPixelData:t.pixelData,canvasCoords:e}})),m=Ri(e),x=Ri(n),v=[];return function(){var t=fe(b,f.tileCapacity);u.clear({color:wn});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return f.addTile(e,n)}));t.forEach((function(t,a){var s=t.canvasCoords,h=u.framebuffer({width:c,height:c,depth:!1,colorFormat:"rgba",colorType:"uint8"}),p=new Uint8Array(c*c*4);h.use((function(){l.calcTileMultiAnalyze1({canvasSize:[c,c],canvasCoordinates:[0,0],textureA:f.texture,textureBoundsA:n[a],filterLowA:r,filterHighA:i,multiplierA:o}),u.read({data:p})})),p=l.flipReadPixelsUint(c,c,p),v[e]=p,e+=1,l.drawTileMultiAnalyze1({colorScale:m,sentinelValues:x,canvasSize:d,canvasCoordinates:s,textureA:f.texture,textureBoundsA:n[a],filterLowA:r,filterHighA:i,multiplierA:o}),h.destroy()}))},s=0,h=t;s<h.length;s++){n(h[s])}a(g)}(),this.textureManagerA.destroy(),this.textureManagerA=new vo(u,c,Tn,!1),v},e.prototype.renderTilesWithMultiAnalyze2=function(t,e,n,r,i,o,a,l,s,u,f){var c=this,d=this,h=d.regl,p=d.textureManagerA,g=d.textureManagerB,b=d.tileSize,m=this.computeRequiredCanvasDimensions(t.length),x=m[0],v=m[1];this.setCanvasSize(x,v);var y=this.getCanvasCoordinates(x,v,t.length),_=xn(t,e,y,(function(t,e,n){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,canvasCoords:n}})),w=Ri(n),A=Ri(r),T=[];return function(){var t=fe(_,p.tileCapacity);h.clear({color:wn});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return p.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return g.addTile(e,n)}));t.forEach((function(t,f){var d=t.canvasCoords,x=h.framebuffer({width:b,height:b,depth:!1,colorFormat:"rgba",colorType:"uint8"}),v=new Uint8Array(b*b*4);x.use((function(){c.calcTileMultiAnalyze2({canvasSize:[b,b],canvasCoordinates:[0,0],textureA:p.texture,textureB:g.texture,textureBoundsA:n[f],textureBoundsB:r[f],filterLowA:i,filterHighA:o,filterLowB:a,filterHighB:l,multiplierA:s,multiplierB:u}),h.read({data:v})})),v=c.flipReadPixelsUint(b,b,v),T[e]=v,e+=1,c.drawTileMultiAnalyze2({colorScale:w,sentinelValues:A,canvasSize:m,canvasCoordinates:d,textureA:p.texture,textureB:g.texture,textureBoundsA:n[f],textureBoundsB:r[f],filterLowA:i,filterHighA:o,filterLowB:a,filterHighB:l,multiplierA:s,multiplierB:u}),x.destroy()}))},r=0,d=t;r<d.length;r++){n(d[r])}f(y)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerA=new vo(h,b,Tn,!1),this.textureManagerB=new vo(h,b,Tn,!1),T},e.prototype.renderTilesWithMultiAnalyze3=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p){var g=this,b=this,m=b.regl,x=b.textureManagerA,v=b.textureManagerB,y=b.textureManagerC,_=b.tileSize,w=this.computeRequiredCanvasDimensions(t.length),A=w[0],T=w[1];this.setCanvasSize(A,T);var E=this.getCanvasCoordinates(A,T,t.length),C=xn(t,e,n,E,(function(t,e,n,r){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,canvasCoords:r}})),B=Ri(r),S=Ri(i),L=[];return function(){var t=fe(C,x.tileCapacity);m.clear({color:wn});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return x.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return v.addTile(e,n)})),i=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return y.addTile(e,n)}));t.forEach((function(t,p){var b=t.canvasCoords,A=m.framebuffer({width:_,height:_,depth:!1,colorFormat:"rgba",colorType:"uint8"}),T=new Uint8Array(_*_*4);A.use((function(){g.calcTileMultiAnalyze3({canvasSize:[_,_],canvasCoordinates:[0,0],textureA:x.texture,textureB:v.texture,textureC:y.texture,textureBoundsA:n[p],textureBoundsB:r[p],textureBoundsC:i[p],filterLowA:o,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:u,filterHighC:f,multiplierA:c,multiplierB:d,multiplierC:h}),m.read({data:T})})),T=g.flipReadPixelsUint(_,_,T),L[e]=T,e+=1,g.drawTileMultiAnalyze3({colorScale:B,sentinelValues:S,canvasSize:w,canvasCoordinates:b,textureA:x.texture,textureB:v.texture,textureC:y.texture,textureBoundsA:n[p],textureBoundsB:r[p],textureBoundsC:i[p],filterLowA:o,filterHighA:a,filterLowB:l,filterHighB:s,filterLowC:u,filterHighC:f,multiplierA:c,multiplierB:d,multiplierC:h}),A.destroy()}))},r=0,i=t;r<i.length;r++){n(i[r])}p(E)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerA=new vo(m,_,Tn,!1),this.textureManagerB=new vo(m,_,Tn,!1),this.textureManagerC=new vo(m,_,Tn,!1),L},e.prototype.renderTilesWithMultiAnalyze4=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m,x){var v=this,y=this,_=y.regl,w=y.textureManagerA,A=y.textureManagerB,T=y.textureManagerC,E=y.textureManagerD,C=y.tileSize,B=this.computeRequiredCanvasDimensions(t.length),S=B[0],L=B[1];this.setCanvasSize(S,L);var D=this.getCanvasCoordinates(S,L,t.length),I=xn(t,e,n,r,D,(function(t,e,n,r,i){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:r.pixelData,canvasCoords:i}})),F=Ri(i),k=Ri(o),N=[];return function(){var t=fe(I,w.tileCapacity);_.clear({color:wn});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return w.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return A.addTile(e,n)})),i=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return T.addTile(e,n)})),o=t.map((function(t){var e=t.coords,n=t.tilesDPixelData;return E.addTile(e,n)}));t.forEach((function(t,x){var y=t.canvasCoords,S=_.framebuffer({width:C,height:C,depth:!1,colorFormat:"rgba",colorType:"uint8"}),L=new Uint8Array(C*C*4);S.use((function(){v.calcTileMultiAnalyze4({canvasSize:[C,C],canvasCoordinates:[0,0],textureA:w.texture,textureB:A.texture,textureC:T.texture,textureD:E.texture,textureBoundsA:n[x],textureBoundsB:r[x],textureBoundsC:i[x],textureBoundsD:o[x],filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:u,filterLowC:f,filterHighC:c,filterLowD:d,filterHighD:h,multiplierA:p,multiplierB:g,multiplierC:b,multiplierD:m}),_.read({data:L})})),L=v.flipReadPixelsUint(C,C,L),N[e]=L,e+=1,v.drawTileMultiAnalyze4({colorScale:F,sentinelValues:k,canvasSize:B,canvasCoordinates:y,textureA:w.texture,textureB:A.texture,textureC:T.texture,textureD:E.texture,textureBoundsA:n[x],textureBoundsB:r[x],textureBoundsC:i[x],textureBoundsD:o[x],filterLowA:a,filterHighA:l,filterLowB:s,filterHighB:u,filterLowC:f,filterHighC:c,filterLowD:d,filterHighD:h,multiplierA:p,multiplierB:g,multiplierC:b,multiplierD:m}),S.destroy()}))},r=0,i=t;r<i.length;r++){n(i[r])}x(D)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerA=new vo(_,C,Tn,!1),this.textureManagerB=new vo(_,C,Tn,!1),this.textureManagerC=new vo(_,C,Tn,!1),this.textureManagerD=new vo(_,C,Tn,!1),N},e.prototype.renderTilesWithMultiAnalyze5=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w){var A=this,T=this,E=T.regl,C=T.textureManagerA,B=T.textureManagerB,S=T.textureManagerC,L=T.textureManagerD,D=T.textureManagerE,I=T.tileSize,F=this.computeRequiredCanvasDimensions(t.length),k=F[0],N=F[1];this.setCanvasSize(k,N);var M=this.getCanvasCoordinates(k,N,t.length),R=xn(t,e,n,r,i,M,(function(t,e,n,r,i,o){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:r.pixelData,tilesEPixelData:i.pixelData,canvasCoords:o}})),O=Ri(o),H=Ri(a),V=[];return function(){var t=fe(R,C.tileCapacity);E.clear({color:wn});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return C.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return B.addTile(e,n)})),i=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return S.addTile(e,n)})),o=t.map((function(t){var e=t.coords,n=t.tilesDPixelData;return L.addTile(e,n)})),a=t.map((function(t){var e=t.coords,n=t.tilesEPixelData;return D.addTile(e,n)}));t.forEach((function(t,w){var T=t.canvasCoords,k=E.framebuffer({width:I,height:I,depth:!1,colorFormat:"rgba",colorType:"uint8"}),N=new Uint8Array(I*I*4);k.use((function(){A.calcTileMultiAnalyze5({canvasSize:[I,I],canvasCoordinates:[0,0],textureA:C.texture,textureB:B.texture,textureC:S.texture,textureD:L.texture,textureE:D.texture,textureBoundsA:n[w],textureBoundsB:r[w],textureBoundsC:i[w],textureBoundsD:o[w],textureBoundsE:a[w],filterLowA:l,filterHighA:s,filterLowB:u,filterHighB:f,filterLowC:c,filterHighC:d,filterLowD:h,filterHighD:p,filterLowE:g,filterHighE:b,multiplierA:m,multiplierB:x,multiplierC:v,multiplierD:y,multiplierE:_}),E.read({data:N})})),N=A.flipReadPixelsUint(I,I,N),V[e]=N,e+=1,A.drawTileMultiAnalyze5({colorScale:O,sentinelValues:H,canvasSize:F,canvasCoordinates:T,textureA:C.texture,textureB:B.texture,textureC:S.texture,textureD:L.texture,textureE:D.texture,textureBoundsA:n[w],textureBoundsB:r[w],textureBoundsC:i[w],textureBoundsD:o[w],textureBoundsE:a[w],filterLowA:l,filterHighA:s,filterLowB:u,filterHighB:f,filterLowC:c,filterHighC:d,filterLowD:h,filterHighD:p,filterLowE:g,filterHighE:b,multiplierA:m,multiplierB:x,multiplierC:v,multiplierD:y,multiplierE:_}),k.destroy()}))},r=0,i=t;r<i.length;r++){n(i[r])}w(M)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerE.destroy(),this.textureManagerA=new vo(E,I,Tn,!1),this.textureManagerB=new vo(E,I,Tn,!1),this.textureManagerC=new vo(E,I,Tn,!1),this.textureManagerD=new vo(E,I,Tn,!1),this.textureManagerE=new vo(E,I,Tn,!1),V},e.prototype.renderTilesWithMultiAnalyze6=function(t,e,n,r,i,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w,A,T,E,C){var B=this,S=this,L=S.regl,D=S.textureManagerA,I=S.textureManagerB,F=S.textureManagerC,k=S.textureManagerD,N=S.textureManagerE,M=S.textureManagerF,R=S.tileSize,O=this.computeRequiredCanvasDimensions(t.length),H=O[0],V=O[1];this.setCanvasSize(H,V);var z=this.getCanvasCoordinates(H,V,t.length),P=xn(t,e,n,r,i,o,z,(function(t,e,n,r,i,o,a){return{coords:t.coords,tilesAPixelData:t.pixelData,tilesBPixelData:e.pixelData,tilesCPixelData:n.pixelData,tilesDPixelData:r.pixelData,tilesEPixelData:i.pixelData,tilesFPixelData:o.pixelData,canvasCoords:a}})),U=Ri(a),G=Ri(l),j=[];return function(){var t=fe(P,D.tileCapacity);L.clear({color:wn});for(var e=0,n=function(t){var n=t.map((function(t){var e=t.coords,n=t.tilesAPixelData;return D.addTile(e,n)})),r=t.map((function(t){var e=t.coords,n=t.tilesBPixelData;return I.addTile(e,n)})),i=t.map((function(t){var e=t.coords,n=t.tilesCPixelData;return F.addTile(e,n)})),o=t.map((function(t){var e=t.coords,n=t.tilesDPixelData;return k.addTile(e,n)})),a=t.map((function(t){var e=t.coords,n=t.tilesEPixelData;return N.addTile(e,n)})),l=t.map((function(t){var e=t.coords,n=t.tilesFPixelData;return M.addTile(e,n)}));t.forEach((function(t,C){var S=t.canvasCoords,H=L.framebuffer({width:R,height:R,depth:!1,colorFormat:"rgba",colorType:"uint8"}),V=new Uint8Array(R*R*4);H.use((function(){B.calcTileMultiAnalyze6({canvasSize:[R,R],canvasCoordinates:[0,0],textureA:D.texture,textureB:I.texture,textureC:F.texture,textureD:k.texture,textureE:N.texture,textureF:M.texture,textureBoundsA:n[C],textureBoundsB:r[C],textureBoundsC:i[C],textureBoundsD:o[C],textureBoundsE:a[C],textureBoundsF:l[C],filterLowA:s,filterHighA:u,filterLowB:f,filterHighB:c,filterLowC:d,filterHighC:h,filterLowD:p,filterHighD:g,filterLowE:b,filterHighE:m,filterLowF:x,filterHighF:v,multiplierA:y,multiplierB:_,multiplierC:w,multiplierD:A,multiplierE:T,multiplierF:E}),L.read({data:V})})),V=B.flipReadPixelsUint(R,R,V),j[e]=V,e+=1,B.drawTileMultiAnalyze6({colorScale:U,sentinelValues:G,canvasSize:O,canvasCoordinates:S,textureA:D.texture,textureB:I.texture,textureC:F.texture,textureD:k.texture,textureE:N.texture,textureF:M.texture,textureBoundsA:n[C],textureBoundsB:r[C],textureBoundsC:i[C],textureBoundsD:o[C],textureBoundsE:a[C],textureBoundsF:l[C],filterLowA:s,filterHighA:u,filterLowB:f,filterHighB:c,filterLowC:d,filterHighC:h,filterLowD:p,filterHighD:g,filterLowE:b,filterHighE:m,filterLowF:x,filterHighF:v,multiplierA:y,multiplierB:_,multiplierC:w,multiplierD:A,multiplierE:T,multiplierF:E}),H.destroy()}))},r=0,i=t;r<i.length;r++){n(i[r])}C(z)}(),this.textureManagerA.destroy(),this.textureManagerB.destroy(),this.textureManagerC.destroy(),this.textureManagerD.destroy(),this.textureManagerE.destroy(),this.textureManagerF.destroy(),this.textureManagerA=new vo(L,R,Tn,!1),this.textureManagerB=new vo(L,R,Tn,!1),this.textureManagerC=new vo(L,R,Tn,!1),this.textureManagerD=new vo(L,R,Tn,!1),this.textureManagerE=new vo(L,R,Tn,!1),this.textureManagerF=new vo(L,R,Tn,!1),j},e.prototype.renderTilesWithTransition=function(t,e,n,o,a,l){return r(this,void 0,void 0,(function(){var r,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w,A=this;return i(this,(function(i){switch(i.label){case 0:return s=(r=this).regl,u=r.textureManager,f=r.tileSize,c=r.maxTextureDimension,d=this.computeRequiredCanvasDimensions(t.length),h=d[0],p=d[1],this.setCanvasSize(h,p),g=this.getCanvasCoordinates(h,p,t.length),b=xn(t,e,g,(function(t,e,n){return{coords:t.coords,oldPixelData:t.pixelData,newPixelData:e.pixelData,canvasCoords:n}})),m=new vo(s,f,c,!1),x=Ri(n),v=Ri(o),y=s.now(),_=function(t){var e=fe(b,u.tileCapacity);s.clear({color:wn});for(var n=function(e){var n=e.map((function(t){var e=t.coords,n=t.oldPixelData;return u.addTile(e,n)})),r=e.map((function(t){var e=t.coords,n=t.newPixelData;return m.addTile(e,n)}));A.drawTileInterpolateValue(e.map((function(e,i){var o=e.canvasCoords;return{colorScale:x,sentinelValues:v,canvasSize:d,canvasCoordinates:o,textureA:u.texture,textureB:m.texture,textureBoundsA:n[i],textureBoundsB:r[i],interpolationFraction:t}})))},r=0,i=e;r<i.length;r++){n(i[r])}l(g)},w=s.frame((function(t){var e=t.time;_(1e3*(e-y)/a)})),[4,Ui(a)];case 1:return i.sent(),w.cancel(),_(1),this.textureManager.destroy(),this.textureManager=m,[2]}}))}))},e.prototype.renderTilesWithTransitionAndNewColorScale=function(t,e,n,o,a,l,s,u){return r(this,void 0,void 0,(function(){var r,f,c,d,h,p,g,b,m,x,v,y,_,w,A,T,E,C,B=this;return i(this,(function(i){switch(i.label){case 0:return f=(r=this).regl,c=r.textureManager,d=r.tileSize,h=r.maxTextureDimension,p=this.computeRequiredCanvasDimensions(t.length),g=p[0],b=p[1],this.setCanvasSize(g,b),m=this.getCanvasCoordinates(g,b,t.length),x=xn(t,e,m,(function(t,e,n){return{coords:t.coords,oldPixelData:t.pixelData,newPixelData:e.pixelData,canvasCoords:n}})),v=new vo(f,d,h,!1),y=Ri(n),_=Ri(o),w=Ri(a),A=Ri(l),T=f.now(),E=function(t){var e=fe(x,c.tileCapacity);f.clear({color:wn});for(var n=function(e){var n=e.map((function(t){var e=t.coords,n=t.oldPixelData;return c.addTile(e,n)})),r=e.map((function(t){var e=t.coords,n=t.newPixelData;return v.addTile(e,n)}));B.drawTileInterpolateColor(e.map((function(e,i){var o=e.canvasCoords;return{colorScaleA:y,colorScaleB:_,sentinelValuesA:w,sentinelValuesB:A,canvasSize:p,canvasCoordinates:o,textureA:c.texture,textureB:v.texture,textureBoundsA:n[i],textureBoundsB:r[i],interpolationFraction:t}})))},r=0,i=e;r<i.length;r++){n(i[r])}u(m)},C=f.frame((function(t){var e=t.time;E(1e3*(e-T)/s)})),[4,Ui(s)];case 1:return i.sent(),C.cancel(),E(1),this.textureManager.destroy(),this.textureManager=v,[2]}}))}))},e.prototype.renderTilesWithTransitionAndNewColorScaleOnly=function(t,e,o,a,l,s,u){return r(this,void 0,void 0,(function(){var r,f,c,d,h,p,g,b,m,x,v,y,_,w,A,T,E,C,B=this;return i(this,(function(i){switch(i.label){case 0:return f=(r=this).regl,c=r.textureManager,d=r.tileSize,h=r.maxTextureDimension,p=this.computeRequiredCanvasDimensions(t.length),g=p[0],b=p[1],this.setCanvasSize(g,b),m=this.getCanvasCoordinates(g,b,t.length),x=xn(t,m,(function(t,e){return n(n({},t),{canvasCoords:e})})),v=new vo(f,d,h,!1),y=Ri(e),_=Ri(o),w=Ri(a),A=Ri(l),T=f.now(),E=function(t){var e=fe(x,c.tileCapacity);f.clear({color:wn});for(var n=function(e){var n=e.map((function(t){var e=t.coords,n=t.pixelData;return c.addTile(e,n)}));B.drawTileInterpolateColorOnly(e.map((function(e,r){var i=e.canvasCoords;return{colorScaleA:y,colorScaleB:_,sentinelValuesA:w,sentinelValuesB:A,canvasSize:p,canvasCoordinates:i,texture:c.texture,textureBounds:n[r],interpolationFraction:t}})))},r=0,i=e;r<i.length;r++){n(i[r])}u(m)},C=f.frame((function(t){var e=t.time;E(1e3*(e-T)/s)})),[4,Ui(s)];case 1:return i.sent(),C.cancel(),E(1),this.textureManager.destroy(),this.textureManager=v,[2]}}))}))},e.prototype.removeTile=function(t){this.textureManager.removeTile(t)},e.prototype.setCanvasSize=function(t,e){Object.assign(this.canvas,{width:t,height:e})},e.prototype.computeRequiredCanvasDimensions=function(t){var e=this.tileSize,n=Math.ceil(Math.sqrt(t));return[n*e,Math.ceil(t/n)*e]},e.prototype.getCanvasCoordinates=function(t,e,n){var r=this.tileSize;return cn(zi(0,e,r),(function(e){return zi(0,t,r).map((function(t){return[t,e]}))})).slice(0,n)},e}(),_o="http://www.w3.org/1999/xhtml",wo={svg:"http://www.w3.org/2000/svg",xhtml:_o,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ao(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),wo.hasOwnProperty(e)?{space:wo[e],local:t}:t}function To(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===_o&&e.documentElement.namespaceURI===_o?e.createElement(t):e.createElementNS(n,t)}}function Eo(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Co(t){var e=Ao(t);return(e.local?Eo:To)(e)}function Bo(){}function So(t){return null==t?Bo:function(){return this.querySelector(t)}}function Lo(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Do(){return[]}function Io(t){return function(e){return e.matches(t)}}var Fo=Array.prototype.find;function ko(){return this.firstElementChild}var No=Array.prototype.filter;function Mo(){return this.children}function Ro(t){return new Array(t.length)}function Oo(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function Ho(t){return function(){return t}}function Vo(t,e,n,r,i,o){for(var a,l=0,s=e.length,u=o.length;l<u;++l)(a=e[l])?(a.__data__=o[l],r[l]=a):n[l]=new Oo(t,o[l]);for(;l<s;++l)(a=e[l])&&(i[l]=a)}function zo(t,e,n,r,i,o,a){var l,s,u,f=new Map,c=e.length,d=o.length,h=new Array(c);for(l=0;l<c;++l)(s=e[l])&&(h[l]=u=a.call(s,s.__data__,l,e)+"",f.has(u)?i[l]=s:f.set(u,s));for(l=0;l<d;++l)u=a.call(t,o[l],l,o)+"",(s=f.get(u))?(r[l]=s,s.__data__=o[l],f.delete(u)):n[l]=new Oo(t,o[l]);for(l=0;l<c;++l)(s=e[l])&&f.get(h[l])===s&&(i[l]=s)}function Po(t){return t.__data__}function Uo(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Go(t){return function(){this.removeAttribute(t)}}function jo(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Xo(t,e){return function(){this.setAttribute(t,e)}}function Wo(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function qo(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Zo(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Yo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function $o(t){return function(){this.style.removeProperty(t)}}function Ko(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Qo(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Jo(t,e){return t.style.getPropertyValue(e)||Yo(t).getComputedStyle(t,null).getPropertyValue(e)}function ta(t){return function(){delete this[t]}}function ea(t,e){return function(){this[t]=e}}function na(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function ra(t){return t.trim().split(/^|\s+/)}function ia(t){return t.classList||new oa(t)}function oa(t){this._node=t,this._names=ra(t.getAttribute("class")||"")}function aa(t,e){for(var n=ia(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function la(t,e){for(var n=ia(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function sa(t){return function(){aa(this,t)}}function ua(t){return function(){la(this,t)}}function fa(t,e){return function(){(e.apply(this,arguments)?aa:la)(this,t)}}function ca(){this.textContent=""}function da(t){return function(){this.textContent=t}}function ha(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function pa(){this.innerHTML=""}function ga(t){return function(){this.innerHTML=t}}function ba(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function ma(){this.nextSibling&&this.parentNode.appendChild(this)}function xa(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function va(){return null}function ya(){var t=this.parentNode;t&&t.removeChild(this)}function _a(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function wa(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Aa(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Ta(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function Ea(t,e,n){return function(){var r,i=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var a=0,l=i.length;a<l;++a)if((r=i[a]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=e);this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Ca(t,e,n){var r=Yo(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Ba(t,e){return function(){return Ca(this,t,e)}}function Sa(t,e){return function(){return Ca(this,t,e.apply(this,arguments))}}Oo.prototype={constructor:Oo,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},oa.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var La=[null];function Da(t,e){this._groups=t,this._parents=e}function Ia(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}Da.prototype=function(){return new Da([[document.documentElement]],La)}.prototype={constructor:Da,select:function(t){"function"!=typeof t&&(t=So(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,l=e[i],s=l.length,u=r[i]=new Array(s),f=0;f<s;++f)(o=l[f])&&(a=t.call(o,o.__data__,f,l))&&("__data__"in o&&(a.__data__=o.__data__),u[f]=a);return new Da(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:Lo(e)}}(t):function(t){return null==t?Do:function(){return this.querySelectorAll(t)}}(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,l=e[o],s=l.length,u=0;u<s;++u)(a=l[u])&&(r.push(t.call(a,a.__data__,u,l)),i.push(a));return new Da(r,i)},selectChild:function(t){return this.select(null==t?ko:function(t){return function(){return Fo.call(this.children,t)}}("function"==typeof t?t:Io(t)))},selectChildren:function(t){return this.selectAll(null==t?Mo:function(t){return function(){return No.call(this.children,t)}}("function"==typeof t?t:Io(t)))},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],l=a.length,s=r[i]=[],u=0;u<l;++u)(o=a[u])&&t.call(o,o.__data__,u,a)&&s.push(o);return new Da(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,Po);var n=e?zo:Vo,r=this._parents,i=this._groups;"function"!=typeof t&&(t=Ho(t));for(var o=i.length,a=new Array(o),l=new Array(o),s=new Array(o),u=0;u<o;++u){var f=r[u],c=i[u],d=c.length,h=Lo(t.call(f,f&&f.__data__,u,r)),p=h.length,g=l[u]=new Array(p),b=a[u]=new Array(p),m=s[u]=new Array(d);n(f,c,g,b,m,h,e);for(var x,v,y=0,_=0;y<p;++y)if(x=g[y]){for(y>=_&&(_=y+1);!(v=b[_])&&++_<p;);x._next=v||null}}return(a=new Da(a,r))._enter=l,a._exit=s,a},enter:function(){return new Da(this._enter||this._groups.map(Ro),this._parents)},exit:function(){return new Da(this._exit||this._groups.map(Ro),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,o=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=e&&(i=e(i)),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(t){if(!(t instanceof Da))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),l=0;l<o;++l)for(var s,u=e[l],f=n[l],c=u.length,d=a[l]=new Array(c),h=0;h<c;++h)(s=u[h]||f[h])&&(d[h]=s);for(;l<r;++l)a[l]=e[l];return new Da(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Uo);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,l=n[o],s=l.length,u=i[o]=new Array(s),f=0;f<s;++f)(a=l[f])&&(u[f]=a);u.sort(e)}return new Da(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,l=o.length;a<l;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=Ao(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?jo:Go:"function"==typeof e?n.local?Zo:qo:n.local?Wo:Xo)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?$o:"function"==typeof e?Qo:Ko)(t,e,null==n?"":n)):Jo(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?ta:"function"==typeof e?na:ea)(t,e)):this.node()[t]},classed:function(t,e){var n=ra(t+"");if(arguments.length<2){for(var r=ia(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?fa:e?sa:ua)(n,e))},text:function(t){return arguments.length?this.each(null==t?ca:("function"==typeof t?ha:da)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?pa:("function"==typeof t?ba:ga)(t)):this.node().innerHTML},raise:function(){return this.each(ma)},lower:function(){return this.each(xa)},append:function(t){var e="function"==typeof t?t:Co(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Co(t),r=null==e?va:"function"==typeof e?e:So(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(ya)},clone:function(t){return this.select(t?wa:_a)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=Aa(t+""),a=o.length;if(!(arguments.length<2)){for(l=e?Ea:Ta,r=0;r<a;++r)this.each(l(o[r],e,n));return this}var l=this.node().__on;if(l)for(var s,u=0,f=l.length;u<f;++u)for(r=0,s=l[u];r<a;++r)if((i=o[r]).type===s.type&&i.name===s.name)return s.value},dispatch:function(t,e){return this.each(("function"==typeof e?Sa:Ba)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};var Fa=function(t){let e=t,n=t;function r(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const o=r+i>>>1;n(t[o],e)<0?r=o+1:i=o}return r}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>Ia(t(e),n)}(t)),{left:r,center:function(t,n,i,o){null==i&&(i=0),null==o&&(o=t.length);const a=r(t,n,i,o);return a>i&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const o=r+i>>>1;n(t[o],e)>0?i=o:r=o+1}return r}}}(Ia).right;class ka{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=e[r],o=t+i,a=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(e=o,n=t[--i],o=e+n,r=n-(o-e),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(n=2*r,e=o+n,n==e-o&&(o=e))}return o}}function Na(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}var Ma=Math.sqrt(50),Ra=Math.sqrt(10),Oa=Math.sqrt(2);function Ha(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=Ma?10:o>=Ra?5:o>=Oa?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=Ma?10:o>=Ra?5:o>=Oa?2:1)}function Va(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=Ma?i*=10:o>=Ra?i*=5:o>=Oa&&(i*=2),e<t?-i:i}function za(t){return Math.ceil(Math.log(function(t,e){let n=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++n;else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&++n}return n}(t))/Math.LN2)+1}function Pa(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Ua(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Ga(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ja(){}var Xa=.7,Wa=1/Xa,qa="\\s*([+-]?\\d+)\\s*",Za="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ya="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$a=/^#([0-9a-f]{3,8})$/,Ka=new RegExp("^rgb\\("+[qa,qa,qa]+"\\)$"),Qa=new RegExp("^rgb\\("+[Ya,Ya,Ya]+"\\)$"),Ja=new RegExp("^rgba\\("+[qa,qa,qa,Za]+"\\)$"),tl=new RegExp("^rgba\\("+[Ya,Ya,Ya,Za]+"\\)$"),el=new RegExp("^hsl\\("+[Za,Ya,Ya]+"\\)$"),nl=new RegExp("^hsla\\("+[Za,Ya,Ya,Za]+"\\)$"),rl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function il(){return this.rgb().formatHex()}function ol(){return this.rgb().formatRgb()}function al(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=$a.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?ll(e):3===n?new cl(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?sl(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?sl(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Ka.exec(t))?new cl(e[1],e[2],e[3],1):(e=Qa.exec(t))?new cl(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ja.exec(t))?sl(e[1],e[2],e[3],e[4]):(e=tl.exec(t))?sl(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=el.exec(t))?gl(e[1],e[2]/100,e[3]/100,1):(e=nl.exec(t))?gl(e[1],e[2]/100,e[3]/100,e[4]):rl.hasOwnProperty(t)?ll(rl[t]):"transparent"===t?new cl(NaN,NaN,NaN,0):null}function ll(t){return new cl(t>>16&255,t>>8&255,255&t,1)}function sl(t,e,n,r){return r<=0&&(t=e=n=NaN),new cl(t,e,n,r)}function ul(t){return t instanceof ja||(t=al(t)),t?new cl((t=t.rgb()).r,t.g,t.b,t.opacity):new cl}function fl(t,e,n,r){return 1===arguments.length?ul(t):new cl(t,e,n,null==r?1:r)}function cl(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function dl(){return"#"+pl(this.r)+pl(this.g)+pl(this.b)}function hl(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function pl(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function gl(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ml(t,e,n,r)}function bl(t){if(t instanceof ml)return new ml(t.h,t.s,t.l,t.opacity);if(t instanceof ja||(t=al(t)),!t)return new ml;if(t instanceof ml)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,l=o-i,s=(o+i)/2;return l?(a=e===o?(n-r)/l+6*(n<r):n===o?(r-e)/l+2:(e-n)/l+4,l/=s<.5?o+i:2-o-i,a*=60):l=s>0&&s<1?0:a,new ml(a,l,s,t.opacity)}function ml(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function xl(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function vl(t){return function(){return t}}function yl(t){return 1==(t=+t)?_l:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):vl(isNaN(e)?n:e)}}function _l(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):vl(isNaN(t)?e:t)}Ua(ja,al,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:il,formatHex:il,formatHsl:function(){return bl(this).formatHsl()},formatRgb:ol,toString:ol}),Ua(cl,fl,Ga(ja,{brighter:function(t){return t=null==t?Wa:Math.pow(Wa,t),new cl(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Xa:Math.pow(Xa,t),new cl(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dl,formatHex:dl,formatRgb:hl,toString:hl})),Ua(ml,(function(t,e,n,r){return 1===arguments.length?bl(t):new ml(t,e,n,null==r?1:r)}),Ga(ja,{brighter:function(t){return t=null==t?Wa:Math.pow(Wa,t),new ml(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Xa:Math.pow(Xa,t),new ml(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new cl(xl(t>=240?t-240:t+120,i,r),xl(t,i,r),xl(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var wl=function t(e){var n=yl(e);function r(t,e){var r=n((t=fl(t)).r,(e=fl(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=_l(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function Al(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function Tl(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=Il(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function El(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Cl(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Bl(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Il(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var Sl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ll=new RegExp(Sl.source,"g");function Dl(t,e){var n,r,i,o=Sl.lastIndex=Ll.lastIndex=0,a=-1,l=[],s=[];for(t+="",e+="";(n=Sl.exec(t))&&(r=Ll.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),l[a]?l[a]+=i:l[++a]=i),(n=n[0])===(r=r[0])?l[a]?l[a]+=r:l[++a]=r:(l[++a]=null,s.push({i:a,x:Cl(n,r)})),o=Ll.lastIndex;return o<e.length&&(i=e.slice(o),l[a]?l[a]+=i:l[++a]=i),l.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)l[(n=s[r]).i]=n.x(t);return l.join("")})}function Il(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?vl(e):("number"===i?Cl:"string"===i?(n=al(e))?(e=n,wl):Dl:e instanceof al?wl:e instanceof Date?El:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?Tl:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Bl:Cl:Al))(t,e)}function Fl(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function kl(t){return+t}var Nl=[0,1];function Ml(t){return t}function Rl(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Ol(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=Rl(i,r),o=n(a,o)):(r=Rl(r,i),o=n(o,a)),function(t){return o(r(t))}}function Hl(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=Rl(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=Fa(t,e,1,r)-1;return o[n](i[n](e))}}function Vl(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function zl(){var t,e,n,r,i,o,a=Nl,l=Nl,s=Il,u=Ml;function f(){var t,e,n,s=Math.min(a.length,l.length);return u!==Ml&&(t=a[0],e=a[s-1],t>e&&(n=t,t=e,e=n),u=function(n){return Math.max(t,Math.min(e,n))}),r=s>2?Hl:Ol,i=o=null,c}function c(e){return isNaN(e=+e)?n:(i||(i=r(a.map(t),l,s)))(t(u(e)))}return c.invert=function(n){return u(e((o||(o=r(l,a.map(t),Cl)))(n)))},c.domain=function(t){return arguments.length?(a=Array.from(t,kl),f()):a.slice()},c.range=function(t){return arguments.length?(l=Array.from(t),f()):l.slice()},c.rangeRound=function(t){return l=Array.from(t),s=Fl,f()},c.clamp=function(t){return arguments.length?(u=!!t||Ml,f()):u!==Ml},c.interpolate=function(t){return arguments.length?(s=t,f()):s},c.unknown=function(t){return arguments.length?(n=t,c):n},function(n,r){return t=n,e=r,f()}}function Pl(){return zl()(Ml,Ml)}function Ul(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Gl(t){return(t=Ul(Math.abs(t)))?t[1]:NaN}var jl,Xl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wl(t){if(!(e=Xl.exec(t)))throw new Error("invalid format: "+t);var e;return new ql({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function ql(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Zl(t,e){var n=Ul(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Wl.prototype=ql.prototype,ql.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Yl={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Zl(100*t,e),r:Zl,s:function(t,e){var n=Ul(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(jl=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ul(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function $l(t){return t}var Kl,Ql,Jl,ts=Array.prototype.map,es=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ns(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?$l:(e=ts.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,l=e[0],s=0;i>0&&l>0&&(s+l+1>r&&(l=Math.max(1,r-s)),o.push(t.substring(i-=l,i+l)),!((s+=l+1)>r));)l=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?$l:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(ts.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"−":t.minus+"",f=void 0===t.nan?"NaN":t.nan+"";function c(t){var e=(t=Wl(t)).fill,n=t.align,c=t.sign,d=t.symbol,h=t.zero,p=t.width,g=t.comma,b=t.precision,m=t.trim,x=t.type;"n"===x?(g=!0,x="g"):Yl[x]||(void 0===b&&(b=12),m=!0,x="g"),(h||"0"===e&&"="===n)&&(h=!0,e="0",n="=");var v="$"===d?i:"#"===d&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",y="$"===d?o:/[%p]/.test(x)?s:"",_=Yl[x],w=/[defgprs%]/.test(x);function A(t){var i,o,s,d=v,A=y;if("c"===x)A=_(t)+A,t="";else{var T=(t=+t)<0||1/t<0;if(t=isNaN(t)?f:_(Math.abs(t),b),m&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),T&&0==+t&&"+"!==c&&(T=!1),d=(T?"("===c?c:u:"-"===c||"("===c?"":c)+d,A=("s"===x?es[8+jl/3]:"")+A+(T&&"("===c?")":""),w)for(i=-1,o=t.length;++i<o;)if(48>(s=t.charCodeAt(i))||s>57){A=(46===s?a+t.slice(i+1):t.slice(i))+A,t=t.slice(0,i);break}}g&&!h&&(t=r(t,1/0));var E=d.length+t.length+A.length,C=E<p?new Array(p-E+1).join(e):"";switch(g&&h&&(t=r(C+t,C.length?p-A.length:1/0),C=""),n){case"<":t=d+t+A+C;break;case"=":t=d+C+t+A;break;case"^":t=C.slice(0,E=C.length>>1)+d+t+A+C.slice(E);break;default:t=C+d+t+A}return l(t)}return b=void 0===b?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b)),A.toString=function(){return t+""},A}return{format:c,formatPrefix:function(t,e){var n=c(((t=Wl(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Gl(e)/3))),i=Math.pow(10,-r),o=es[8+r/3];return function(t){return n(i*t)+o}}}}function rs(t,e,n,r){var i,o=Va(t,e,n);switch((r=Wl(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Gl(e)/3)))-Gl(Math.abs(t)))}(o,a))||(r.precision=i),Jl(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Gl(e)-Gl(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Gl(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return Ql(r)}function is(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var r,i,o,a,l=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=Ha(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++l<i;)o[l]=(t+l)*a;else for(a=-a,t=Math.ceil(t*a),e=Math.floor(e*a),o=new Array(i=Math.ceil(e-t+1));++l<i;)o[l]=(t+l)/a;return r&&o.reverse(),o}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return rs(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,o=e(),a=0,l=o.length-1,s=o[a],u=o[l],f=10;for(u<s&&(i=s,s=u,u=i,i=a,a=l,l=i);f-- >0;){if((i=Ha(s,u,n))===r)return o[a]=s,o[l]=u,e(o);if(i>0)s=Math.floor(s/i)*i,u=Math.ceil(u/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,u=Math.floor(u*i)/i}r=i}return t},t}Kl=ns({thousands:",",grouping:[3],currency:["$",""]}),Ql=Kl.format,Jl=Kl.formatPrefix;var os=2*Math.PI,as=Math.abs,ls=Math.sqrt;function ss(){}function us(t,e){t&&cs.hasOwnProperty(t.type)&&cs[t.type](t,e)}var fs={Feature:function(t,e){us(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)us(n[r].geometry,e)}},cs={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){ds(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)ds(n[r],e,0)},Polygon:function(t,e){hs(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)hs(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)us(n[r],e)}};function ds(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function hs(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)ds(t[n],e,1);e.polygonEnd()}function ps(t,e){t&&fs.hasOwnProperty(t.type)?fs[t.type](t,e):us(t,e)}var gs,bs,ms,xs,vs=t=>t,ys=new ka,_s=new ka,ws={point:ss,lineStart:ss,lineEnd:ss,polygonStart:function(){ws.lineStart=As,ws.lineEnd=Cs},polygonEnd:function(){ws.lineStart=ws.lineEnd=ws.point=ss,ys.add(as(_s)),_s=new ka},result:function(){var t=ys/2;return ys=new ka,t}};function As(){ws.point=Ts}function Ts(t,e){ws.point=Es,gs=ms=t,bs=xs=e}function Es(t,e){_s.add(xs*t-ms*e),ms=t,xs=e}function Cs(){Es(gs,bs)}var Bs=1/0,Ss=Bs,Ls=-Bs,Ds=Ls,Is={point:function(t,e){t<Bs&&(Bs=t);t>Ls&&(Ls=t);e<Ss&&(Ss=e);e>Ds&&(Ds=e)},lineStart:ss,lineEnd:ss,polygonStart:ss,polygonEnd:ss,result:function(){var t=[[Bs,Ss],[Ls,Ds]];return Ls=Ds=-(Ss=Bs=1/0),t}};var Fs,ks,Ns,Ms,Rs=0,Os=0,Hs=0,Vs=0,zs=0,Ps=0,Us=0,Gs=0,js=0,Xs={point:Ws,lineStart:qs,lineEnd:$s,polygonStart:function(){Xs.lineStart=Ks,Xs.lineEnd=Qs},polygonEnd:function(){Xs.point=Ws,Xs.lineStart=qs,Xs.lineEnd=$s},result:function(){var t=js?[Us/js,Gs/js]:Ps?[Vs/Ps,zs/Ps]:Hs?[Rs/Hs,Os/Hs]:[NaN,NaN];return Rs=Os=Hs=Vs=zs=Ps=Us=Gs=js=0,t}};function Ws(t,e){Rs+=t,Os+=e,++Hs}function qs(){Xs.point=Zs}function Zs(t,e){Xs.point=Ys,Ws(Ns=t,Ms=e)}function Ys(t,e){var n=t-Ns,r=e-Ms,i=ls(n*n+r*r);Vs+=i*(Ns+t)/2,zs+=i*(Ms+e)/2,Ps+=i,Ws(Ns=t,Ms=e)}function $s(){Xs.point=Ws}function Ks(){Xs.point=Js}function Qs(){tu(Fs,ks)}function Js(t,e){Xs.point=tu,Ws(Fs=Ns=t,ks=Ms=e)}function tu(t,e){var n=t-Ns,r=e-Ms,i=ls(n*n+r*r);Vs+=i*(Ns+t)/2,zs+=i*(Ms+e)/2,Ps+=i,Us+=(i=Ms*t-Ns*e)*(Ns+t),Gs+=i*(Ms+e),js+=3*i,Ws(Ns=t,Ms=e)}function eu(t){this._context=t}eu.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,os)}},result:ss};var nu,ru,iu,ou,au,lu=new ka,su={point:ss,lineStart:function(){su.point=uu},lineEnd:function(){nu&&fu(ru,iu),su.point=ss},polygonStart:function(){nu=!0},polygonEnd:function(){nu=null},result:function(){var t=+lu;return lu=new ka,t}};function uu(t,e){su.point=fu,ru=ou=t,iu=au=e}function fu(t,e){ou-=t,au-=e,lu.add(ls(ou*ou+au*au)),ou=t,au=e}function cu(){this._string=[]}function du(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}cu.prototype={_radius:4.5,_circle:du(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=du(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var hu=Array.prototype.slice;function pu(t,e){return t-e}var gu=t=>()=>t;function bu(t,e){for(var n,r=-1,i=e.length;++r<i;)if(n=mu(t,e[r]))return n;return 0}function mu(t,e){for(var n=e[0],r=e[1],i=-1,o=0,a=t.length,l=a-1;o<a;l=o++){var s=t[o],u=s[0],f=s[1],c=t[l],d=c[0],h=c[1];if(xu(s,c,e))return 0;f>r!=h>r&&n<(d-u)*(r-f)/(h-f)+u&&(i=-i)}return i}function xu(t,e,n){var r;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&function(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}(t[r=+(t[0]===e[0])],n[r],e[r])}function vu(){}var yu=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];var _u="$";function wu(){}function Au(t,e){var n=new wu;if(t instanceof wu)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}function Tu(){}wu.prototype=Au.prototype={constructor:wu,has:function(t){return _u+t in this},get:function(t){return this[_u+t]},set:function(t,e){return this[_u+t]=e,this},remove:function(t){var e=_u+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===_u&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===_u&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===_u&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===_u&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===_u&&++t;return t},empty:function(){for(var t in this)if(t[0]===_u)return!1;return!0},each:function(t){for(var e in this)e[0]===_u&&t(this[e],e.slice(1),this)}};var Eu=Au.prototype;Tu.prototype=function(t,e){var n=new Tu;if(t instanceof Tu)t.each((function(t){n.add(t)}));else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}.prototype={constructor:Tu,has:Eu.has,add:function(t){return this[_u+(t+="")]=t,this},remove:Eu.remove,clear:Eu.clear,values:Eu.keys,size:Eu.size,empty:Eu.empty,each:Eu.each};var Cu={value:function(){}};function Bu(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Su(r)}function Su(t){this._=t}function Lu(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function Du(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function Iu(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Cu,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Su.prototype=Bu.prototype={constructor:Su,on:function(t,e){var n,r=this._,i=Lu(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=Iu(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Iu(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=Du(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Su(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var Fu,ku,Nu=(Fu="application/json",ku=function(t){return JSON.parse(t.responseText)},function(t,e){var n=function(t,e){var n,r,i,o,a=Bu("beforesend","progress","load","error"),l=Au(),s=new XMLHttpRequest,u=null,f=null,c=0;function d(t){var e,r=s.status;if(!r&&function(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}(s)||r>=200&&r<300||304===r){if(i)try{e=i.call(n,s)}catch(t){return void a.call("error",n,t)}else e=s;a.call("load",n,e)}else a.call("error",n,t)}if("undefined"!=typeof XDomainRequest&&!("withCredentials"in s)&&/^(http(s)?:)?\/\//.test(t)&&(s=new XDomainRequest),"onload"in s?s.onload=s.onerror=s.ontimeout=d:s.onreadystatechange=function(t){s.readyState>3&&d(t)},s.onprogress=function(t){a.call("progress",n,t)},n={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?l.get(t):(null==e?l.remove(t):l.set(t,e+""),n)},mimeType:function(t){return arguments.length?(r=null==t?null:t+"",n):r},responseType:function(t){return arguments.length?(o=t,n):o},timeout:function(t){return arguments.length?(c=+t,n):c},user:function(t){return arguments.length<1?u:(u=null==t?null:t+"",n)},password:function(t){return arguments.length<1?f:(f=null==t?null:t+"",n)},response:function(t){return i=t,n},get:function(t,e){return n.send("GET",t,e)},post:function(t,e){return n.send("POST",t,e)},send:function(e,i,d){return s.open(e,t,!0,u,f),null==r||l.has("accept")||l.set("accept",r+",*/*"),s.setRequestHeader&&l.each((function(t,e){s.setRequestHeader(e,t)})),null!=r&&s.overrideMimeType&&s.overrideMimeType(r),null!=o&&(s.responseType=o),c>0&&(s.timeout=c),null==d&&"function"==typeof i&&(d=i,i=null),null!=d&&1===d.length&&(d=function(t){return function(e,n){t(null==e?n:null)}}(d)),null!=d&&n.on("error",d).on("load",(function(t){d(null,t)})),a.call("beforesend",n,s),s.send(null==i?null:i),n},abort:function(){return s.abort(),n},on:function(){var t=a.on.apply(a,arguments);return t===a?n:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return n.get(e)}return n}(t).mimeType(Fu).response(ku);if(null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return n.get(e)}return n});function Mu(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Ru(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ou(){}var Hu=.7,Vu=1/Hu,zu="\\s*([+-]?\\d+)\\s*",Pu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Uu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gu=/^#([0-9a-f]{3,8})$/,ju=new RegExp("^rgb\\("+[zu,zu,zu]+"\\)$"),Xu=new RegExp("^rgb\\("+[Uu,Uu,Uu]+"\\)$"),Wu=new RegExp("^rgba\\("+[zu,zu,zu,Pu]+"\\)$"),qu=new RegExp("^rgba\\("+[Uu,Uu,Uu,Pu]+"\\)$"),Zu=new RegExp("^hsl\\("+[Pu,Uu,Uu]+"\\)$"),Yu=new RegExp("^hsla\\("+[Pu,Uu,Uu,Pu]+"\\)$"),$u={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ku(){return this.rgb().formatHex()}function Qu(){return this.rgb().formatRgb()}function Ju(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Gu.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?tf(e):3===n?new rf(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ef(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ef(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=ju.exec(t))?new rf(e[1],e[2],e[3],1):(e=Xu.exec(t))?new rf(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Wu.exec(t))?ef(e[1],e[2],e[3],e[4]):(e=qu.exec(t))?ef(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Zu.exec(t))?sf(e[1],e[2]/100,e[3]/100,1):(e=Yu.exec(t))?sf(e[1],e[2]/100,e[3]/100,e[4]):$u.hasOwnProperty(t)?tf($u[t]):"transparent"===t?new rf(NaN,NaN,NaN,0):null}function tf(t){return new rf(t>>16&255,t>>8&255,255&t,1)}function ef(t,e,n,r){return r<=0&&(t=e=n=NaN),new rf(t,e,n,r)}function nf(t){return t instanceof Ou||(t=Ju(t)),t?new rf((t=t.rgb()).r,t.g,t.b,t.opacity):new rf}function rf(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function of(){return"#"+lf(this.r)+lf(this.g)+lf(this.b)}function af(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function lf(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function sf(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ff(t,e,n,r)}function uf(t){if(t instanceof ff)return new ff(t.h,t.s,t.l,t.opacity);if(t instanceof Ou||(t=Ju(t)),!t)return new ff;if(t instanceof ff)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,l=o-i,s=(o+i)/2;return l?(a=e===o?(n-r)/l+6*(n<r):n===o?(r-e)/l+2:(e-n)/l+4,l/=s<.5?o+i:2-o-i,a*=60):l=s>0&&s<1?0:a,new ff(a,l,s,t.opacity)}function ff(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function cf(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Mu(Ou,Ju,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Ku,formatHex:Ku,formatHsl:function(){return uf(this).formatHsl()},formatRgb:Qu,toString:Qu}),Mu(rf,(function(t,e,n,r){return 1===arguments.length?nf(t):new rf(t,e,n,null==r?1:r)}),Ru(Ou,{brighter:function(t){return t=null==t?Vu:Math.pow(Vu,t),new rf(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Hu:Math.pow(Hu,t),new rf(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:of,formatHex:of,formatRgb:af,toString:af})),Mu(ff,(function(t,e,n,r){return 1===arguments.length?uf(t):new ff(t,e,n,null==r?1:r)}),Ru(Ou,{brighter:function(t){return t=null==t?Vu:Math.pow(Vu,t),new ff(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Hu:Math.pow(Hu,t),new ff(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new rf(cf(t>=240?t-240:t+120,i,r),cf(t,i,r),cf(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const df=Math.PI/180,hf=180/Math.PI,pf=.96422,gf=.82521,bf=4/29,mf=6/29,xf=3*mf*mf;function vf(t){if(t instanceof yf)return new yf(t.l,t.a,t.b,t.opacity);if(t instanceof Bf)return Sf(t);t instanceof rf||(t=nf(t));var e,n,r=Tf(t.r),i=Tf(t.g),o=Tf(t.b),a=_f((.2225045*r+.7168786*i+.0606169*o)/1);return r===i&&i===o?e=n=a:(e=_f((.4360747*r+.3850649*i+.1430804*o)/pf),n=_f((.0139322*r+.0971045*i+.7141733*o)/gf)),new yf(116*a-16,500*(e-a),200*(a-n),t.opacity)}function yf(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function _f(t){return t>.008856451679035631?Math.pow(t,1/3):t/xf+bf}function wf(t){return t>mf?t*t*t:xf*(t-bf)}function Af(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Tf(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ef(t){if(t instanceof Bf)return new Bf(t.h,t.c,t.l,t.opacity);if(t instanceof yf||(t=vf(t)),0===t.a&&0===t.b)return new Bf(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*hf;return new Bf(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Cf(t,e,n,r){return 1===arguments.length?Ef(t):new Bf(t,e,n,null==r?1:r)}function Bf(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function Sf(t){if(isNaN(t.h))return new yf(t.l,0,0,t.opacity);var e=t.h*df;return new yf(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Mu(yf,(function(t,e,n,r){return 1===arguments.length?vf(t):new yf(t,e,n,null==r?1:r)}),Ru(Ou,{brighter:function(t){return new yf(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new yf(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new rf(Af(3.1338561*(e=pf*wf(e))-1.6168667*(t=1*wf(t))-.4906146*(n=gf*wf(n))),Af(-.9787684*e+1.9161415*t+.033454*n),Af(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),Mu(Bf,Cf,Ru(Ou,{brighter:function(t){return new Bf(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Bf(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Sf(this).rgb()}}));var Lf=t=>()=>t;function Df(t,e){return function(n){return t+n*e}}function If(t,e){var n=e-t;return n?Df(t,n):Lf(isNaN(t)?e:t)}var Ff={select:function(t){return"string"==typeof t?new Da([[document.querySelector(t)]],[document.documentElement]):new Da([[t]],La)},selectAll:function(t){return"string"==typeof t?new Da([document.querySelectorAll(t)],[document.documentElement]):new Da([null==t?[]:Lo(t)],La)},scaleLinear:function t(){var e=Pl();return e.copy=function(){return Vl(e,t())},Pa.apply(e,arguments),is(e)},geoPath:function(t,e){var n,r,i=4.5;function o(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),ps(t,n(r))),r.result()}return o.area=function(t){return ps(t,n(ws)),ws.result()},o.measure=function(t){return ps(t,n(su)),su.result()},o.bounds=function(t){return ps(t,n(Is)),Is.result()},o.centroid=function(t){return ps(t,n(Xs)),Xs.result()},o.projection=function(e){return arguments.length?(n=null==e?(t=null,vs):(t=e).stream,o):t},o.context=function(t){return arguments.length?(r=null==t?(e=null,new cu):new eu(e=t),"function"!=typeof i&&r.pointRadius(i),o):e},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),o):i},o.projection(t).context(e)},contours:function(){var t=1,e=1,n=za,r=l;function i(t){var e=n(t);if(Array.isArray(e))e=e.slice().sort(pu);else{var r=function(t,e){let n,r;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=r=e):(n>e&&(n=e),r<e&&(r=e)));else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}(t),i=r[0],a=r[1];e=Va(i,a,e),e=Na(Math.floor(i/e)*e,Math.floor(a/e)*e,e)}return e.map((function(e){return o(t,e)}))}function o(n,i){var o=[],l=[];return function(n,r,i){var o,l,s,u,f,c,d=new Array,h=new Array;o=l=-1,u=n[0]>=r,yu[u<<1].forEach(p);for(;++o<t-1;)s=u,u=n[o+1]>=r,yu[s|u<<1].forEach(p);yu[u<<0].forEach(p);for(;++l<e-1;){for(o=-1,u=n[l*t+t]>=r,f=n[l*t]>=r,yu[u<<1|f<<2].forEach(p);++o<t-1;)s=u,u=n[l*t+t+o+1]>=r,c=f,f=n[l*t+o+1]>=r,yu[s|u<<1|f<<2|c<<3].forEach(p);yu[u|f<<3].forEach(p)}o=-1,f=n[l*t]>=r,yu[f<<2].forEach(p);for(;++o<t-1;)c=f,f=n[l*t+o+1]>=r,yu[f<<2|c<<3].forEach(p);function p(t){var e,n,r=[t[0][0]+o,t[0][1]+l],s=[t[1][0]+o,t[1][1]+l],u=a(r),f=a(s);(e=h[u])?(n=d[f])?(delete h[e.end],delete d[n.start],e===n?(e.ring.push(s),i(e.ring)):d[e.start]=h[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete h[e.end],e.ring.push(s),h[e.end=f]=e):(e=d[f])?(n=h[u])?(delete d[e.start],delete h[n.end],e===n?(e.ring.push(s),i(e.ring)):d[n.start]=h[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete d[e.start],e.ring.unshift(r),d[e.start=u]=e):d[u]=h[f]={start:u,end:f,ring:[r,s]}}yu[f<<3].forEach(p)}(n,i,(function(t){r(t,n,i),function(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}(t)>0?o.push([t]):l.push(t)})),l.forEach((function(t){for(var e,n=0,r=o.length;n<r;++n)if(-1!==bu((e=o[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(e){return 2*e[0]+e[1]*(t+1)*4}function l(n,r,i){n.forEach((function(n){var o,a=n[0],l=n[1],s=0|a,u=0|l,f=r[u*t+s];a>0&&a<t&&s===a&&(o=r[u*t+s-1],n[0]=a+(i-o)/(f-o)-.5),l>0&&l<e&&u===l&&(o=r[(u-1)*t+s],n[1]=l+(i-o)/(f-o)-.5)}))}return i.contour=o,i.size=function(n){if(!arguments.length)return[t,e];var r=Math.floor(n[0]),o=Math.floor(n[1]);if(!(r>=0&&o>=0))throw new Error("invalid size");return t=r,e=o,i},i.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?gu(hu.call(t)):gu(t),i):n},i.smooth=function(t){return arguments.length?(r=t?l:vu,i):r===l},i},interpolateHcl:function(t){return function(e,n){var r=t((e=Cf(e)).h,(n=Cf(n)).h),i=If(e.c,n.c),o=If(e.l,n.l),a=If(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}((function(t,e){var n=e-t;return n?Df(t,n>180||n<-180?n-360*Math.round(n/360):n):Lf(isNaN(t)?e:t)})),json:Nu,min:function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n},max:function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n},scan:function(t,e){const n=function(t,e=Ia){if(1===e.length)return function(t,e){let n,r=-1,i=-1;if(void 0===e)for(const e of t)++i,null!=e&&(n>e||void 0===n&&e>=e)&&(n=e,r=i);else for(let o of t)null!=(o=e(o,++i,t))&&(n>o||void 0===n&&o>=o)&&(n=o,r=i);return r}(t,e);let n,r=-1,i=-1;for(const o of t)++i,(r<0?0===e(o,o):e(o,n)<0)&&(n=o,r=i);return r}(t,e);return n<0?void 0:n},range:Na},kf=Vi(),Nf={colorScale:[],sentinelValues:[],transitions:!1,transitionTimeMs:800,debug:!1,extraPixelLayers:0,colorscaleMaxLength:16,sentinelMaxLength:16,minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,glOperation:"none",multiLayers:0,operationUrlA:"",operationUrlB:"",operationUrlC:"",operationUrlD:"",operationUrlE:"",operationUrlF:"",filterLowA:0,filterHighA:1e5,filterLowB:0,filterHighB:1e5,filterLowC:0,filterHighC:1e5,filterLowD:0,filterHighD:1e5,filterLowE:0,filterHighE:1e5,filterLowF:0,filterHighF:1e5,multiplierA:1,multiplierB:1,multiplierC:1,multiplierD:1,multiplierE:1,multiplierF:1,hillshadeType:"none",hsElevationScale:1,hsSimpleZoomdelta:0,hsSimpleSlopescale:3,hsSimpleAzimuth:315,hsSimpleAltitude:70,hsAdvSoftIterations:128,hsAdvAmbientIterations:40,hsAdvSunRadiusMultiplier:100,hsAdvFinalSoftMultiplier:4,hsAdvFinalAmbientMultiplier:.25,hsPregenUrl:"",_hillshadeOptions:{hillshadeType:"none"},contourType:"none",contourSmoothLines:!1,contourSmoothInput:!1,contourSmoothInputKernel:7,contourScaleFactor:1,contourInterval:25,contourIndexInterval:100,contourLineColor:"#000000",contourIlluminatedHighlightColor:"rgba(177,174,164,.5)",contourIlluminatedShadowColor:"#5b5143",contourIlluminatedShadowSize:2,contourLineWeight:.5,contourLineIndexWeight:2,contourIndexLabels:!1,contourLabelFont:"12px Arial",contourLabelDistance:250,contourHypso:!1,contourHypsoDomain:[0,1e3,2e3],contourHypsoColors:["#486341","#e5d9c9","#dddddd"],contourBathy:!1,contourBathyDomain:[-2e3,0],contourBathyColors:["#315d9b","#d5f2ff"],contourBathyShadowColor:"#4e5c66",contourBathyHighlightColor:"rgba(224, 242, 255, .5)"};return function(o){function a(t){var e=o.call(this,Object.assign({},Nf,t))||this;e._contourData={},e._checkColorScaleAndSentinels();var n=e.options,a=n.nodataValue,l=n.preloadUrl,s=e._tileSizeAsNumber(),u=new yo(s,a,e.options.colorscaleMaxLength,e.options.sentinelMaxLength);return Object.assign(e,{_renderer:u,_preloadTileCache:void 0}),e._maybePreload(l),e.on("tileunload",e._onTileRemove.bind(e)),e.on("load",(function(t){return setTimeout((function(){e.options.debug&&console.log("all tiles loaded. Updating contours if enabled."),e._maybeUpdateMergedArrayAndDrawContours()}),300)})),setTimeout((function(){e._map.on("zoomend",(function(t){return setTimeout((function(){return r(e,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return"none"===this.options.contourType?[3,2]:(this.options.debug&&console.log("zoom changed. Moving contour canvas."),[4,this._getActivetilesBounds()]);case 1:t=e.sent(),this._moveContourCanvas(t),e.label=2;case 2:return[2]}}))}))}),50)}))}),300),e}return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(a,o),a.prototype.updateOptions=function(e){var n=this,o=this.options,a=o.url,l=o.glOperation,s=o.operationUrlA,u=o.operationUrlB,f=o.operationUrlC,c=o.operationUrlD,d=o.operationUrlE,h=o.operationUrlF,p=o.colorScale,g=o.sentinelValues,b=o.filterLowA,m=o.filterHighA,x=o.filterLowB,v=o.filterHighB,y=o.filterLowC,_=o.filterHighC,w=o.filterLowD,A=o.filterHighD,T=o.filterLowE,E=o.filterHighE,C=o.filterLowF,B=o.filterHighF,S=o.multiplierA,L=o.multiplierB,D=o.multiplierC,I=o.multiplierD,F=o.multiplierE,k=o.multiplierF,N=o.multiLayers,M=o.hsPregenUrl,R=o.hillshadeType,O=o.hsSimpleSlopescale,H=o.contourInterval,V=o.contourIndexInterval,z=o.contourLineColor,P=o.contourLineWeight,U=o.contourLineIndexWeight,G=o.contourType,j=o.contourSmoothLines,X=o.contourSmoothInput,W=o.contourSmoothInputKernel,q=o.contourIlluminatedHighlightColor,Z=o.contourIlluminatedShadowColor,Y=o.contourIlluminatedShadowSize,$=o.contourHypso,K=o.contourHypsoDomain,Q=o.contourHypsoColors,J=o.contourBathy,tt=o.contourBathyDomain,et=o.contourBathyColors,nt=o.contourBathyShadowColor,rt=o.contourBathyHighlightColor,it=o.contourIndexLabels,ot=o.contourLabelFont,at=o.contourLabelDistance,lt=o.colorscaleMaxLength,st=o.sentinelMaxLength;if(t.Util.setOptions(this,e),this.options.colorscaleMaxLength!==lt||this.options.sentinelMaxLength!==st){this.options.debug&&console.log("Creating new renderer");var ut=this._tileSizeAsNumber(),ft=new yo(ut,this.options.nodataValue,this.options.colorscaleMaxLength,this.options.sentinelMaxLength);this._renderer.regl.destroy(),delete this._renderer,Object.assign(this,{_renderer:ft})}if(this._checkColorScaleAndSentinels(),this._maybePreload(this.options.preloadUrl),this.options._hillshadeOptions={hillshadeType:this.options.hillshadeType,hsElevationScale:this.options.hsElevationScale,hsSimpleSlopescale:this.options.hsSimpleSlopescale,hsSimpleAzimuth:this.options.hsSimpleAzimuth,hsSimpleAltitude:this.options.hsSimpleAltitude,hsSimpleZoomdelta:this.options.hsSimpleZoomdelta,hsAdvSoftIterations:this.options.hsAdvSoftIterations,hsAdvAmbientIterations:this.options.hsAdvAmbientIterations,hsAdvSunRadiusMultiplier:this.options.hsAdvSunRadiusMultiplier,hsAdvFinalSoftMultiplier:this.options.hsAdvFinalSoftMultiplier,hsAdvFinalAmbientMultiplier:this.options.hsAdvFinalAmbientMultiplier,hsPregenUrl:this.options.hsPregenUrl},this.options.extraPixelLayers>0&&"none"===this.options.glOperation&&this._maybeLoadExtraLayers(s,u,f,c),this.options.hillshadeType!==R)if("simple"===this.options.hillshadeType)this._renderer.setMaxTextureDimension(this._tileSizeAsNumber());else if("simple"===R){var ct=this._renderer.findMaxTextureDimension();this._renderer.setMaxTextureDimension(ct)}"none"===this.options.glOperation?this.options.transitions?this.options.url!==a?(this._updateTilesWithTransitions(p,g),this.options.debug&&console.log("Running GLOperations with transition on tiles")):this.options.url===a&&(this._updateColorscaleWithTransitions(p,g),this.options.debug&&console.log("Running GLOperations with transition on colorscale only")):this.options.url!==a||this.options.hillshadeType!==R||this.options.hsPregenUrl!==M||this.options.hsSimpleSlopescale!==O?(this._updateTiles(),this.options.debug&&console.log("Running GLOperations with new url, no transition and no operation")):JSON.stringify(this.options.colorScale)!==JSON.stringify(p)&&(this._updateTilesColorscaleOnly(),this.options.debug&&console.log("Running GLOperations with same url, no transition and no operation")):"multi"===this.options.glOperation?(1===this.options.multiLayers?this._updateTilesWithMultiAnalyze1(l,N,s,b,m,S):2===this.options.multiLayers?this._updateTilesWithMultiAnalyze2(l,N,s,u,b,m,x,v,S,L):3===this.options.multiLayers?this._updateTilesWithMultiAnalyze3(l,N,s,u,f,b,m,x,v,y,_,S,L,D):4===this.options.multiLayers?this._updateTilesWithMultiAnalyze4(l,N,s,u,f,c,b,m,x,v,y,_,w,A,S,L,D,I):5===this.options.multiLayers?this._updateTilesWithMultiAnalyze5(l,N,s,u,f,c,d,b,m,x,v,y,_,w,A,T,E,S,L,D,I,F):6===this.options.multiLayers&&this._updateTilesWithMultiAnalyze6(l,N,s,u,f,c,d,h,b,m,x,v,y,_,w,A,T,E,C,B,S,L,D,I,F,k),this.options.debug&&console.log("Running GLOperations with multiAnalyze")):"diff"===this.options.glOperation&&(this._updateTilesWithDiff(l,s,u),this.options.debug&&console.log("Running GLOperations with diff")),"none"!==this.options.contourType?this.options.contourType!==G&&"none"===G?this._contourData.mergedTileArray?setTimeout((function(){n._calculateAndDrawContours()}),50):setTimeout((function(){n._maybeUpdateMergedArrayAndDrawContours()}),50):!this.options.contourSmoothInput||this.options.contourSmoothInput===X&&this.options.contourSmoothInputKernel===W?this.options.contourInterval!==H||this.options.contourIndexInterval!==V||this.options.contourSmoothLines!==j||this.options.contourSmoothInput!==X?setTimeout((function(){n._calculateAndDrawContours()}),50):this.options.contourType===G&&this.options.contourLineColor===z&&this.options.contourLineWeight===P&&this.options.contourLineIndexWeight===U&&this.options.contourIlluminatedHighlightColor===q&&this.options.contourIlluminatedShadowColor===Z&&this.options.contourIlluminatedShadowSize===Y&&this.options.contourHypso===$&&this.options.contourHypsoDomain===K&&this.options.contourHypsoColors===Q&&this.options.contourBathy===J&&this.options.contourBathyDomain===tt&&this.options.contourBathyColors===et&&this.options.contourBathyShadowColor===nt&&this.options.contourBathyHighlightColor===rt&&this.options.contourIndexLabels===it&&this.options.contourLabelFont===ot&&this.options.contourLabelDistance===at||this._drawContours():setTimeout((function(){return r(n,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._smoothContourInput()];case 1:return t.sent(),this._calculateAndDrawContours(),[2]}}))}))}),50):this.options.contourType!==G&&"none"===this.options.contourType&&(this._clearContours(),this._contourData.mergedTileArray=void 0)},a.prototype.getEvents=function(){var e=this,r=this.options,i=gn({click:r.onclick,dblclick:r.ondblclick,mousedown:r.onmousedown,mouseup:r.onmouseup,mouseover:r.onmouseover,mouseout:r.onmouseout,mousemove:r.onmousemove,contextmenu:r.oncontextmenu},(function(t){return!(void 0===t)}));return n(n({},t.GridLayer.prototype.getEvents.call(this)),function(t,e){var n={};return e=on(e),sn(t,(function(t,r,i){tt(n,r,e(t,r,i))})),n}(i,(function(t){return t&&e._wrapMouseEventHandler(t)})))},a.prototype.getTileUrl=function(e,n){var r={r:t.Browser.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-e.y;this.options.tms&&(r.y=i),r["-y"]=i}return t.Util.template(n,t.Util.extend(r,this.options))},a.prototype.redraw=function(){return this._map&&(this.options.debug&&console.log("redraw() called"),this._removeAllTiles(),this._update()),this},a.prototype.createTile=function(e,n){var r=this,i=this.options,o=i.colorScale,a=i.sentinelValues,l=i.extraPixelLayers,s=i.tileSize,u=i.url,f=i.hsPregenUrl,c=i.operationUrlA,d=i.operationUrlB,h=i.operationUrlC,p=i.operationUrlD,g=i.operationUrlE,b=i.operationUrlF,m=i.filterLowA,x=i.filterHighA,v=i.filterLowB,y=i.filterHighB,_=i.filterLowC,w=i.filterHighC,A=i.filterLowD,T=i.filterHighD,E=i.filterLowE,C=i.filterHighE,B=i.filterLowF,S=i.filterHighF,L=i.multiplierA,D=i.multiplierB,I=i.multiplierC,F=i.multiplierD,k=i.multiplierE,N=i.multiplierF;this.options.debug&&console.log("createTile");var M=t.DomUtil.create("canvas");return Object.assign(M,{className:"gl-tilelayer-tile",width:s,height:s}),"none"===this.options.glOperation?(1===l&&this._fetchTileData(e,c).then((function(t){r.options.debug&&console.log("createTile - extraPixelLayers === 1"),M.pixelDataA=t})),"pregen"===this.options._hillshadeOptions.hillshadeType?Promise.all([this._fetchTileData(e,u),this._fetchTileData(e,f)]).then((function(t){r.options.debug&&console.log("_fetchTileData with pregen hs");var i=t[0],l=t[1],s=r._renderer.renderTileHsPregen({coords:e,pixelData:i},{coords:e,pixelData:l},o,a,r.options._hillshadeOptions),u=s[0],f=s[1];M.pixelData=i,M.pixelDataHsPregen=l,r._copyToTileCanvas(M,u,f),n(void 0,M)})):this._fetchTileData(e,u).then((function(t){r.options.debug&&console.log("_fetchTileData with no operation");var i=r._renderer.renderTile({coords:e,pixelData:t},o,a,r.options._hillshadeOptions,r._getZoomForUrl()),l=i[0],s=i[1];M.pixelData=t,r._copyToTileCanvas(M,l,s),n(void 0,M)}))):"diff"===this.options.glOperation?Promise.all([this._fetchTileData(e,c),this._fetchTileData(e,d)]).then((function(t){r.options.debug&&console.log("_fetchTileData with diff");var i=t[0],l=t[1],s=r._renderer.renderTileDiff({coords:e,pixelData:i},{coords:e,pixelData:l},o,a),u=s[0],f=s[1],c=s[2];M.pixelData=c,M.pixelDataA=i,M.pixelDataB=l,r._copyToTileCanvas(M,u,f),n(void 0,M)})):"multi"===this.options.glOperation&&1===this.options.multiLayers?Promise.all([this._fetchTileData(e,c)]).then((function(t){r.options.debug&&console.log("_fetchTileData with multi");var i=t[0],l=r._renderer.renderTileMulti1({coords:e,pixelData:i},o,a,m,x,L),s=l[0],u=l[1],f=l[2];M.pixelData=f,M.pixelDataA=i,r._copyToTileCanvas(M,s,u),n(void 0,M)})):"multi"===this.options.glOperation&&2===this.options.multiLayers?Promise.all([this._fetchTileData(e,c),this._fetchTileData(e,d)]).then((function(t){r.options.debug&&console.log("_fetchTileData with multi");var i=t[0],l=t[1],s=r._renderer.renderTileMulti2({coords:e,pixelData:i},{coords:e,pixelData:l},o,a,m,x,v,y,L,D),u=s[0],f=s[1],c=s[2];M.pixelData=c,M.pixelDataA=i,M.pixelDataB=l,r._copyToTileCanvas(M,u,f),n(void 0,M)})):"multi"===this.options.glOperation&&3===this.options.multiLayers?Promise.all([this._fetchTileData(e,c),this._fetchTileData(e,d),this._fetchTileData(e,h)]).then((function(t){r.options.debug&&console.log("_fetchTileData with multi");var i=t[0],l=t[1],s=t[2],u=r._renderer.renderTileMulti3({coords:e,pixelData:i},{coords:e,pixelData:l},{coords:e,pixelData:s},o,a,m,x,v,y,_,w,L,D,I),f=u[0],c=u[1],d=u[2];M.pixelData=d,M.pixelDataA=i,M.pixelDataB=l,M.pixelDataC=s,r._copyToTileCanvas(M,f,c),n(void 0,M)})):"multi"===this.options.glOperation&&4===this.options.multiLayers?Promise.all([this._fetchTileData(e,c),this._fetchTileData(e,d),this._fetchTileData(e,h),this._fetchTileData(e,p)]).then((function(t){r.options.debug&&console.log("_fetchTileData with multi");var i=t[0],l=t[1],s=t[2],u=t[3],f=r._renderer.renderTileMulti4({coords:e,pixelData:i},{coords:e,pixelData:l},{coords:e,pixelData:s},{coords:e,pixelData:u},o,a,m,x,v,y,_,w,A,T,L,D,I,F),c=f[0],d=f[1],h=f[2];M.pixelData=h,M.pixelDataA=i,M.pixelDataB=l,M.pixelDataC=s,M.pixelDataD=u,r._copyToTileCanvas(M,c,d),n(void 0,M)})):"multi"===this.options.glOperation&&5===this.options.multiLayers?Promise.all([this._fetchTileData(e,c),this._fetchTileData(e,d),this._fetchTileData(e,h),this._fetchTileData(e,p),this._fetchTileData(e,g)]).then((function(t){r.options.debug&&console.log("_fetchTileData with multi");var i=t[0],l=t[1],s=t[2],u=t[3],f=t[4],c=r._renderer.renderTileMulti5({coords:e,pixelData:i},{coords:e,pixelData:l},{coords:e,pixelData:s},{coords:e,pixelData:u},{coords:e,pixelData:f},o,a,m,x,v,y,_,w,A,T,E,C,L,D,I,F,k),d=c[0],h=c[1],p=c[2];M.pixelData=p,M.pixelDataA=i,M.pixelDataB=l,M.pixelDataC=s,M.pixelDataD=u,M.pixelDataE=f,r._copyToTileCanvas(M,d,h),n(void 0,M)})):"multi"===this.options.glOperation&&6===this.options.multiLayers&&Promise.all([this._fetchTileData(e,c),this._fetchTileData(e,d),this._fetchTileData(e,h),this._fetchTileData(e,p),this._fetchTileData(e,g),this._fetchTileData(e,b)]).then((function(t){r.options.debug&&console.log("_fetchTileData with multi");var i=t[0],l=t[1],s=t[2],u=t[3],f=t[4],c=t[5],d=r._renderer.renderTileMulti6({coords:e,pixelData:i},{coords:e,pixelData:l},{coords:e,pixelData:s},{coords:e,pixelData:u},{coords:e,pixelData:f},{coords:e,pixelData:c},o,a,m,x,v,y,_,w,A,T,E,C,B,S,L,D,I,F,k,N),h=d[0],p=d[1],g=d[2];M.pixelData=g,M.pixelDataA=i,M.pixelDataB=l,M.pixelDataC=s,M.pixelDataD=u,M.pixelDataE=f,M.pixelDataF=c,r._copyToTileCanvas(M,h,p),n(void 0,M)})),M},a.prototype._checkColorScaleAndSentinels=function(){var t=this.options,e=t.colorScale,n=t.sentinelValues,r=t.colorscaleMaxLength,i=t.sentinelMaxLength;if(0===e.length&&0===n.length)throw new Error("Either `colorScale` or `sentinelValues` must be of non-zero length.");if(e.length>r)throw new Error("Color scale length "+e.length+" exceeds the maximum, "+r+".");if(n.length>i)throw new Error("Sentinel values length "+n.length+" exceeds the maximum, "+i+".")},a.prototype._getSubdomain=function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},a.prototype._getZoomForUrl=function(){var t=this.options,e=t.maxZoom,n=t.zoomReverse,r=t.zoomOffset,i=this._tileZoom;return(n?e-i:i)+r},a.prototype._onTileRemove=function(e){var n=e.coords,r=e.tile;this.options.debug&&console.log("_onTileRemove()"),t.Browser.android||(r.onload=Z),this._renderer.removeTile(n)},a.prototype._updateTiles=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,a,l,s,u=this;return i(this,(function(i){switch(i.label){case 0:return t=this._getActiveTiles(),[4,this._getTilesData(t)];case 1:return e=i.sent(),this.options.debug&&console.log("_updateTiles() with url "+this.options.url),n=this.options,r=n.colorScale,o=n.sentinelValues,a=void 0===o?[]:o,"pregen"!==this.options._hillshadeOptions.hillshadeType?[3,3]:[4,this._getTilesData(t,this.options.hsPregenUrl)];case 2:return s=i.sent(),l=this._renderer.renderTilesHsPregen(e,s,r,a,this.options._hillshadeOptions),[3,4];case 3:l=this._renderer.renderTiles(e,r,a,this.options._hillshadeOptions,this._getZoomForUrl()),i.label=4;case 4:return l.forEach((function(n,r){var i=n[0],o=n[1],a=t[r];u._copyToTileCanvas(a.el,i,o),a.el.pixelData=e[r].pixelData,"pregen"===u.options._hillshadeOptions.hillshadeType&&(a.el.pixelDataHsPregen=s[r].pixelData)})),[2]}}))}))},a.prototype._updateTilesColorscaleOnly=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,a,l,s=this;return i(this,(function(i){return this.options.debug&&console.log("_updateTilesColorscaleOnly()"),t=this._getActiveTiles(),e=this.options,n=e.colorScale,r=e.sentinelValues,o=void 0===r?[]:r,"pregen"===this.options._hillshadeOptions.hillshadeType?(l=t.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),a=t.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataHsPregen}})),this._renderer.renderTilesHsPregen(l,a,n,o,this.options._hillshadeOptions).forEach((function(e,n){var r=e[0],i=e[1],o=t[n];s._copyToTileCanvas(o.el,r,i)}))):(l=t.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(l,n,o,this.options._hillshadeOptions,this._getZoomForUrl()).forEach((function(e,n){var r=e[0],i=e[1],o=t[n];s._copyToTileCanvas(o.el,r,i)}))),[2]}))}))},a.prototype._updateTilesWithTransitions=function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,a,l,s,u,f,c,d=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithTransitions()"),n=this._getActiveTiles(),r=n.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),[4,this._getTilesData(n)];case 1:return o=i.sent(),n.forEach((function(t,e){t.el.pixelData=o[e].pixelData})),a=this.options,l=a.colorScale,s=a.sentinelValues,u=void 0===s?[]:s,f=a.transitionTimeMs,c=function(t){t.forEach((function(t,e){var r=t[0],i=t[1],o=n[e];d._copyToTileCanvas(o.el,r,i)}))},JSON.stringify(l)===JSON.stringify(t)&&JSON.stringify(u)===JSON.stringify(e)?this._renderer.renderTilesWithTransition(r,o,l,u,f,c):this._renderer.renderTilesWithTransitionAndNewColorScale(r,o,t,l,e,u,f,c),[2]}}))}))},a.prototype._updateColorscaleWithTransitions=function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,a,l,s,u,f,c=this;return i(this,(function(i){return this.options.debug&&console.log("_updateColorscaleWithTransitions()"),n=this._getActiveTiles(),r=n.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),o=this.options,a=o.colorScale,l=o.sentinelValues,s=void 0===l?[]:l,u=o.transitionTimeMs,f=function(t){t.forEach((function(t,e){var r=t[0],i=t[1],o=n[e];c._copyToTileCanvas(o.el,r,i)}))},JSON.stringify(a)===JSON.stringify(t)&&JSON.stringify(s)===JSON.stringify(e)||this._renderer.renderTilesWithTransitionAndNewColorScaleOnly(r,t,a,e,s,u,f),[2]}))}))},a.prototype._updateTilesWithDiff=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o,a,l,s,u,f,c,d,h=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithDiff()"),r=this._getActiveTiles(),o=[],a=[],this.options.glOperation!==t||this.options.operationUrlA!==e||this.options.operationUrlB!==n?[3,1]:(this.options.debug&&console.log("_updateTilesWithDiff: both same url. Getting data from existing result"),o=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),[3,7]);case 1:return this.options.operationUrlA===e?[3,3]:(this.options.debug&&console.log("_updateTilesWithDiff: new A url. Downloading new tiles"),[4,this._getTilesData(r,this.options.operationUrlA)]);case 2:return o=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=o[e].pixelData})),[3,4];case 3:this.options.debug&&console.log("_updateTilesWithDiff: same A url. Getting data from existing tiles"),o=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),i.label=4;case 4:return this.options.operationUrlB===n?[3,6]:(this.options.debug&&console.log("_updateTilesWithDiff: new B url. Downloading new tiles"),[4,this._getTilesData(r,this.options.operationUrlB)]);case 5:return a=i.sent(),r.forEach((function(t,e){t.el.pixelDataB=a[e].pixelData})),[3,7];case 6:this.options.debug&&console.log("_updateTilesWithDiff: same B url. Getting data from existing tiles"),a=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),i.label=7;case 7:return l=this.options,s=l.colorScale,u=l.sentinelValues,f=void 0===u?[]:u,this.options.glOperation===t&&this.options.operationUrlA===e&&this.options.operationUrlB===n?(this.options.debug&&console.log("_updateTilesWithDiff: both same urls. Running renderTiles()"),this._renderer.renderTiles(o,s,f,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],i=t[1],o=r[e];h._copyToTileCanvas(o.el,n,i)}))):(this.options.debug&&console.log("_updateTilesWithDiff: not same urls. Running renderTilesWithDiff()"),c=function(t){t.forEach((function(t,e){var n=t[0],i=t[1],o=r[e];h._copyToTileCanvas(o.el,n,i)}))},d=this._renderer.renderTilesWithDiff(o,a,s,f,c),r.forEach((function(t,e){t.el.pixelData=d[e]}))),[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze1=function(t,e,n,o,a,l){return r(this,void 0,void 0,(function(){var r,s,u,f,c,d,h,p,g,b=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze1()"),r=this._getActiveTiles(),s=this.options,u=s.colorScale,f=s.sentinelValues,c=void 0===f?[]:f,this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.filterLowA!==o||this.options.filterHighA!==a||this.options.multiplierA!==l||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze1: all same urls. Fetching from existing tiles. Running renderTiles()"),d=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(d,u,c,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],i=t[1],o=r[e];b._copyToTileCanvas(o.el,n,i)})),[3,5]);case 1:return h=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return h=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=h[e].pixelData})),[3,4];case 3:h=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),i.label=4;case 4:p=function(t){t.forEach((function(t,e){var n=t[0],i=t[1],o=r[e];b._copyToTileCanvas(o.el,n,i)}))},g=this._renderer.renderTilesWithMultiAnalyze1(h,u,c,this.options.filterLowA,this.options.filterHighA,this.options.multiplierA,p),r.forEach((function(t,e){t.el.pixelData=g[e]})),i.label=5;case 5:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze2=function(t,e,n,o,a,l,s,u,f,c){return r(this,void 0,void 0,(function(){var r,d,h,p,g,b,m,x,v,y,_=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze2()"),r=this._getActiveTiles(),d=this.options,h=d.colorScale,p=d.sentinelValues,g=void 0===p?[]:p,this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==o||this.options.filterLowA!==a||this.options.filterHighA!==l||this.options.filterLowB!==s||this.options.filterHighB!==u||this.options.multiplierA!==f||this.options.multiplierB!==c||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze2: all same urls. Fetching from existing tiles. Running renderTiles()"),b=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(b,h,g,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],i=t[1],o=r[e];_._copyToTileCanvas(o.el,n,i)})),[3,8]);case 1:return m=[],x=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return m=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=m[e].pixelData})),[3,4];case 3:m=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),i.label=4;case 4:return this.options.operationUrlB===o?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return x=i.sent(),r.forEach((function(t,e){t.el.pixelDataB=x[e].pixelData})),[3,7];case 6:x=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),i.label=7;case 7:v=function(t){t.forEach((function(t,e){var n=t[0],i=t[1],o=r[e];_._copyToTileCanvas(o.el,n,i)}))},y=this._renderer.renderTilesWithMultiAnalyze2(m,x,h,g,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.multiplierA,this.options.multiplierB,v),r.forEach((function(t,e){t.el.pixelData=y[e]})),i.label=8;case 8:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze3=function(t,e,n,o,a,l,s,u,f,c,d,h,p,g){return r(this,void 0,void 0,(function(){var r,b,m,x,v,y,_,w,A,T,E,C=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze3()"),r=this._getActiveTiles(),b=this.options,m=b.colorScale,x=b.sentinelValues,v=void 0===x?[]:x,this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==o||this.options.operationUrlC!==a||this.options.filterLowA!==l||this.options.filterHighA!==s||this.options.filterLowB!==u||this.options.filterHighB!==f||this.options.filterLowC!==c||this.options.filterHighC!==d||this.options.multiplierA!==h||this.options.multiplierB!==p||this.options.multiplierC!==g||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze3: all same urls. Fetching from existing tiles. Running renderTiles()"),y=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(y,m,v,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],i=t[1],o=r[e];C._copyToTileCanvas(o.el,n,i)})),[3,11]);case 1:return _=[],w=[],A=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return _=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=_[e].pixelData})),[3,4];case 3:_=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),i.label=4;case 4:return this.options.operationUrlB===o?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return w=i.sent(),r.forEach((function(t,e){t.el.pixelDataB=w[e].pixelData})),[3,7];case 6:w=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),i.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return A=i.sent(),r.forEach((function(t,e){t.el.pixelDataC=A[e].pixelData})),[3,10];case 9:A=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),i.label=10;case 10:T=function(t){t.forEach((function(t,e){var n=t[0],i=t[1],o=r[e];C._copyToTileCanvas(o.el,n,i)}))},E=this._renderer.renderTilesWithMultiAnalyze3(_,w,A,m,v,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,T),r.forEach((function(t,e){t.el.pixelData=E[e]})),i.label=11;case 11:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze4=function(t,e,n,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v){return r(this,void 0,void 0,(function(){var r,y,_,w,A,T,E,C,B,S,L,D,I=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze4()"),r=this._getActiveTiles(),y=this.options,_=y.colorScale,w=y.sentinelValues,A=void 0===w?[]:w,this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==o||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.filterLowA!==s||this.options.filterHighA!==u||this.options.filterLowB!==f||this.options.filterHighB!==c||this.options.filterLowC!==d||this.options.filterHighC!==h||this.options.filterLowD!==p||this.options.filterHighD!==g||this.options.multiplierA!==b||this.options.multiplierB!==m||this.options.multiplierC!==x||this.options.multiplierD!==v||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze4: all same urls. Fetching from existing tiles. Running renderTiles()"),T=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(T,_,A,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],i=t[1],o=r[e];I._copyToTileCanvas(o.el,n,i)})),[3,14]);case 1:return E=[],C=[],B=[],S=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return E=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=E[e].pixelData})),[3,4];case 3:E=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),i.label=4;case 4:return this.options.operationUrlB===o?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return C=i.sent(),r.forEach((function(t,e){t.el.pixelDataB=C[e].pixelData})),[3,7];case 6:C=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),i.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return B=i.sent(),r.forEach((function(t,e){t.el.pixelDataC=B[e].pixelData})),[3,10];case 9:B=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),i.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(r,this.options.operationUrlD)];case 11:return S=i.sent(),r.forEach((function(t,e){t.el.pixelDataD=S[e].pixelData})),[3,13];case 12:S=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataD}})),i.label=13;case 13:L=function(t){t.forEach((function(t,e){var n=t[0],i=t[1],o=r[e];I._copyToTileCanvas(o.el,n,i)}))},D=this._renderer.renderTilesWithMultiAnalyze4(E,C,B,S,_,A,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,L),r.forEach((function(t,e){t.el.pixelData=D[e]})),i.label=14;case 14:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze5=function(t,e,n,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w,A){return r(this,void 0,void 0,(function(){var r,T,E,C,B,S,L,D,I,F,k,N,M,R=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze5()"),r=this._getActiveTiles(),T=this.options,E=T.colorScale,C=T.sentinelValues,B=void 0===C?[]:C,this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==o||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.operationUrlE!==s||this.options.filterLowA!==u||this.options.filterHighA!==f||this.options.filterLowB!==c||this.options.filterHighB!==d||this.options.filterLowC!==h||this.options.filterHighC!==p||this.options.filterLowD!==g||this.options.filterHighD!==b||this.options.filterLowE!==m||this.options.filterHighE!==x||this.options.multiplierA!==v||this.options.multiplierB!==y||this.options.multiplierC!==_||this.options.multiplierD!==w||this.options.multiplierE!==A||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze5: all same urls. Fetching from existing tiles. Running renderTiles()"),S=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(S,E,B,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],i=t[1],o=r[e];R._copyToTileCanvas(o.el,n,i)})),[3,17]);case 1:return L=[],D=[],I=[],F=[],k=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return L=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=L[e].pixelData})),[3,4];case 3:L=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),i.label=4;case 4:return this.options.operationUrlB===o?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return D=i.sent(),r.forEach((function(t,e){t.el.pixelDataB=D[e].pixelData})),[3,7];case 6:D=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),i.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return I=i.sent(),r.forEach((function(t,e){t.el.pixelDataC=I[e].pixelData})),[3,10];case 9:I=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),i.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(r,this.options.operationUrlD)];case 11:return F=i.sent(),r.forEach((function(t,e){t.el.pixelDataD=F[e].pixelData})),[3,13];case 12:F=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataD}})),i.label=13;case 13:return this.options.operationUrlE===s?[3,15]:[4,this._getTilesData(r,this.options.operationUrlE)];case 14:return k=i.sent(),r.forEach((function(t,e){t.el.pixelDataE=k[e].pixelData})),[3,16];case 15:k=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataE}})),i.label=16;case 16:N=function(t){t.forEach((function(t,e){var n=t[0],i=t[1],o=r[e];R._copyToTileCanvas(o.el,n,i)}))},M=this._renderer.renderTilesWithMultiAnalyze5(L,D,I,F,k,E,B,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.filterLowE,this.options.filterHighE,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,this.options.multiplierE,N),r.forEach((function(t,e){t.el.pixelData=M[e]})),i.label=17;case 17:return[2]}}))}))},a.prototype._updateTilesWithMultiAnalyze6=function(t,e,n,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y,_,w,A,T,E,C,B){return r(this,void 0,void 0,(function(){var r,S,L,D,I,F,k,N,M,R,O,H,V,z,P=this;return i(this,(function(i){switch(i.label){case 0:return this.options.debug&&console.log("_updateTilesWithMultiAnalyze6()"),r=this._getActiveTiles(),S=this.options,L=S.colorScale,D=S.sentinelValues,I=void 0===D?[]:D,this.options.glOperation!==t||this.options.operationUrlA!==n||this.options.operationUrlB!==o||this.options.operationUrlC!==a||this.options.operationUrlD!==l||this.options.operationUrlE!==s||this.options.operationUrlF!==u||this.options.filterLowA!==f||this.options.filterHighA!==c||this.options.filterLowB!==d||this.options.filterHighB!==h||this.options.filterLowC!==p||this.options.filterHighC!==g||this.options.filterLowD!==b||this.options.filterHighD!==m||this.options.filterLowE!==x||this.options.filterHighE!==v||this.options.filterLowF!==y||this.options.filterHighF!==_||this.options.multiplierA!==w||this.options.multiplierB!==A||this.options.multiplierC!==T||this.options.multiplierD!==E||this.options.multiplierE!==C||this.options.multiplierF!==B||this.options.multiLayers!==e?[3,1]:(this.options.debug&&console.log("_updateTilesWithMultiAnalyze6: all same urls. Fetching from existing tiles. Running renderTiles()"),F=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelData}})),this._renderer.renderTiles(F,L,I,this.options._hillshadeOptions).forEach((function(t,e){var n=t[0],i=t[1],o=r[e];P._copyToTileCanvas(o.el,n,i)})),[3,20]);case 1:return k=[],N=[],M=[],R=[],O=[],H=[],this.options.operationUrlA===n?[3,3]:[4,this._getTilesData(r,this.options.operationUrlA)];case 2:return k=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=k[e].pixelData})),[3,4];case 3:k=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataA}})),i.label=4;case 4:return this.options.operationUrlB===o?[3,6]:[4,this._getTilesData(r,this.options.operationUrlB)];case 5:return N=i.sent(),r.forEach((function(t,e){t.el.pixelDataB=N[e].pixelData})),[3,7];case 6:N=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataB}})),i.label=7;case 7:return this.options.operationUrlC===a?[3,9]:[4,this._getTilesData(r,this.options.operationUrlC)];case 8:return M=i.sent(),r.forEach((function(t,e){t.el.pixelDataC=M[e].pixelData})),[3,10];case 9:M=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataC}})),i.label=10;case 10:return this.options.operationUrlD===l?[3,12]:[4,this._getTilesData(r,this.options.operationUrlD)];case 11:return R=i.sent(),r.forEach((function(t,e){t.el.pixelDataD=R[e].pixelData})),[3,13];case 12:R=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataD}})),i.label=13;case 13:return this.options.operationUrlE===s?[3,15]:[4,this._getTilesData(r,this.options.operationUrlE)];case 14:return O=i.sent(),r.forEach((function(t,e){t.el.pixelDataE=O[e].pixelData})),[3,16];case 15:O=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataE}})),i.label=16;case 16:return this.options.operationUrlF===u?[3,18]:[4,this._getTilesData(r,this.options.operationUrlF)];case 17:return H=i.sent(),r.forEach((function(t,e){t.el.pixelDataF=H[e].pixelData})),[3,19];case 18:H=r.map((function(t){return{coords:t.coords,pixelData:t.el.pixelDataF}})),i.label=19;case 19:V=function(t){t.forEach((function(t,e){var n=t[0],i=t[1],o=r[e];P._copyToTileCanvas(o.el,n,i)}))},z=this._renderer.renderTilesWithMultiAnalyze6(k,N,M,R,O,H,L,I,this.options.filterLowA,this.options.filterHighA,this.options.filterLowB,this.options.filterHighB,this.options.filterLowC,this.options.filterHighC,this.options.filterLowD,this.options.filterHighD,this.options.filterLowE,this.options.filterHighE,this.options.filterLowF,this.options.filterHighF,this.options.multiplierA,this.options.multiplierB,this.options.multiplierC,this.options.multiplierD,this.options.multiplierE,this.options.multiplierF,V),r.forEach((function(t,e){t.el.pixelData=z[e]})),i.label=20;case 20:return[2]}}))}))},a.prototype._maybePreload=function(t){!t||this._preloadTileCache&&this._preloadTileCache.url===t||this._preloadTiles(t)},a.prototype._maybeLoadExtraLayers=function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,a,l,s,u;return i(this,(function(i){switch(i.label){case 0:return r=[],this.options.extraPixelLayers>=1?(r=this._getActiveTiles(),t===this.options.operationUrlA?[3,2]:[4,this._getTilesData(r,this.options.operationUrlA)]):[3,2];case 1:a=i.sent(),r.forEach((function(t,e){t.el.pixelDataA=a[e].pixelData})),i.label=2;case 2:return this.options.extraPixelLayers>=2?e===this.options.operationUrlB?[3,4]:[4,this._getTilesData(r,this.options.operationUrlB)]:[3,4];case 3:l=i.sent(),r.forEach((function(t,e){t.el.pixelDataB=l[e].pixelData})),i.label=4;case 4:return this.options.extraPixelLayers>=3?n===this.options.operationUrlC?[3,6]:[4,this._getTilesData(r,this.options.operationUrlC)]:[3,6];case 5:s=i.sent(),r.forEach((function(t,e){t.el.pixelDataC=s[e].pixelData})),i.label=6;case 6:return this.options.extraPixelLayers>=4?o===this.options.operationUrlD?[3,8]:[4,this._getTilesData(r,this.options.operationUrlD)]:[3,8];case 7:u=i.sent(),r.forEach((function(t,e){t.el.pixelDataD=u[e].pixelData})),i.label=8;case 8:return[2]}}))}))},a.prototype._preloadTiles=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return e=this._getActiveTiles(),[4,this._fetchTilesData(e,t)];case 1:return n=r.sent(),this._preloadTileCache={url:t,tiles:n},[2]}}))}))},a.prototype._getActiveTiles=function(){return this.options.debug&&console.log("_getActiveTiles()"),this._pruneTiles(),dn(this._tiles).sort((function(t,e){return Gi(t.coords,e.coords)}))},a.prototype._getTilesData=function(t,e){return void 0===e&&(e=this.options.url),r(this,void 0,void 0,(function(){var n;return i(this,(function(r){return this.options.debug&&console.log("_getTilesData() with url: "+e),(n=this._preloadTileCache)&&e===n.url&&(i=n.tiles.map((function(t){return t.coords})),o=t.map((function(t){return t.coords})),i.length===o.length&&i.every((function(t,e){return 0===Gi(t,o[e])})))?(this._preloadTileCache=void 0,[2,Promise.resolve(n.tiles)]):[2,this._fetchTilesData(t,e)];var i,o}))}))},a.prototype._fetchTilesData=function(t,e){return r(this,void 0,void 0,(function(){var n,r=this;return i(this,(function(i){switch(i.label){case 0:return[4,Promise.all(t.map((function(t){var n=t.coords;return r._fetchTileData(n,e)})))];case 1:return n=i.sent(),this.options.debug&&console.log("_fetchTilesData() with url:"+e),this.fire("load",{url:e}),[2,xn(t,n,(function(t,e){return{coords:t.coords,pixelData:e}}))]}}))}))},a.prototype._fetchTileData=function(t,e){return function(t,e,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.addEventListener("load",(function(){e(r.response)})),r.addEventListener("error",n),r.send(null)})).then((function(t){return new Uint8Array(Mi.decode(t).data)})).catch((function(){return ji(e,n)}))]}))}))}(this.getTileUrl(t,e),this.options.nodataValue,this._tileSizeAsNumber())},a.prototype._tileSizeAsNumber=function(){var t=this.options.tileSize;return"number"==typeof t?t:t.x},a.prototype._copyToTileCanvas=function(t,e,n){this.options.debug&&console.log("_copyToTileCanvas()");var r=this._tileSizeAsNumber(),i=t.getContext("2d");if(null===i)throw new Error("Tile canvas 2D context is null.");i.clearRect(0,0,r,r),i.drawImage(this._renderer.canvas,e,n,r,r,0,0,r,r)},a.prototype._getActivetilesBounds=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o;return i(this,(function(i){return t=this._getActiveTiles(),e=t[0].coords.x,n=t[0].coords.x,r=t[0].coords.y,o=t[0].coords.y,t.forEach((function(t){t.coords.x>n&&(n=t.coords.x),t.coords.x<e&&(e=t.coords.x),t.coords.y>o&&(o=t.coords.y),t.coords.y<r&&(r=t.coords.y)})),[2,{xMin:e,xMax:n,yMin:r,yMax:o,xTiles:n-e+1,yTiles:o-r+1}]}))}))},a.prototype._mergePixelData=function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,a,l,s,u,f,c,d,h,p,g,b,m,x,v,y;return i(this,(function(i){for(this.options.debug&&console.log("_mergePixelData()"),n=this._tileZoom,r=document.createElement("canvas"),this._contourData.width=t.xTiles*e,this._contourData.height=t.yTiles*e,r.width=this._contourData.width,r.height=this._contourData.height,o=r.getContext("2d"),a=ji(this.options.nodataValue,e),l=0;l<=t.xTiles;l++)for(s=t.xMin+l,u=0;u<=t.yTiles;u++){f=t.yMin+u,c=void 0;try{d=this._tiles[s+":"+f+":"+n].el,c=d.pixelData}catch(t){c=a}h=new Uint8ClampedArray(c),p=new Uint8ClampedArray(h.buffer,0,4*e*e),g=new ImageData(p,e,e),o.putImageData(g,l*e,u*e)}return b=o.getImageData(0,0,t.xTiles*e,t.yTiles*e),m=(m=new Float32Array(b.data.buffer)).map((function(t){return t<-9e5&&(t=NaN),t}),this),x=Array.from(m),v=function(t){return t.reduce((function(t,e){return(isNaN(t)?0:t)+(isNaN(e)?0:e)}),0)},this.options.debug&&(console.log("sum mergedPixelArray"),console.log(v(x))),this.options.contourCanvas?((y=this.options.contourCanvas).width=this._contourData.width,y.height=this._contourData.height,this._contourData.mergedTileArray=x,this._contourData.smoothedTileArray=void 0,[2]):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._maybeUpdateMergedArrayAndDrawContours=function(){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(e){switch(e.label){case 0:return"none"===this.options.contourType?[2]:(this._map.fire("contourDrawing",{status:!0}),this.options.debug&&console.log("_maybeUpdateMergedArrayAndDrawContours()"),[4,this._clearContours()]);case 1:return e.sent(),setTimeout((function(){return r(t,void 0,void 0,(function(){var t,e;return i(this,(function(n){switch(n.label){case 0:return[4,this._getActivetilesBounds()];case 1:return t=n.sent(),e=this._tileSizeAsNumber(),[4,this._mergePixelData(t,e)];case 2:return n.sent(),this.options.contourSmoothInput?[4,this._smoothContourInput()]:[3,4];case 3:n.sent(),n.label=4;case 4:return[4,this._calculateAndDrawContours()];case 5:return n.sent(),[4,this._moveContourCanvas(t)];case 6:return n.sent(),[2]}}))}))}),50),[2]}}))}))},a.prototype._smoothContourInput=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,a,l;return i(this,(function(i){for(this.options.debug&&console.log("_smoothContourInput()"),t=this._contourData.mergedTileArray,e=t.map((function(t){return isNaN(t)&&(t=this.options.nodataValue),t}),this),n=new Uint8Array(Float32Array.from(e).buffer),r=this._renderer.renderConvolutionSmooth(n,this._contourData.width,this._contourData.height,this.options.contourSmoothInputKernel),o=[],a=0;a<r.length;a+=1)(l=r[a])===this.options.nodataValue&&(l=NaN),o.push(l);return this._contourData.smoothedTileArray=o,[2]}))}))},a.prototype._calculateAndDrawContours=function(){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(e){switch(e.label){case 0:return"none"===this.options.contourType?[2]:(this._map.fire("contourDrawing",{status:!0}),this.options.debug&&console.log("_calculateAndDrawContours()"),[4,this._clearContours()]);case 1:return e.sent(),[4,this._calculateContours()];case 2:return e.sent(),setTimeout((function(){t._drawContours()}),50),[2]}}))}))},a.prototype._addlabel=function(t,e,n,r){t.save(),t.translate(e.xy[0],e.xy[1]),t.rotate(e.angle+(Math.cos(e.angle)<0?Math.PI:0)),t.textAlign="center",t.fillStyle=n,t.font=r,t.fillText(e.text,-1,4),t.restore()},a.prototype._calculateContours=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,a,l,s=this;return i(this,(function(i){for(this.options.debug&&console.log("_calculateContours()"),t=this.options.contourSmoothInput?this._contourData.smoothedTileArray:this._contourData.mergedTileArray,1!==this.options.contourScaleFactor&&(t=t.map((function(t){return t*s.options.contourScaleFactor}))),this.options.debug&&(console.log("valuesArray"),console.log(t)),e=Ff.max(t,(function(t){return t!==s.options.nodataValue?t:NaN})),n=Ff.min(t,(function(t){return t!==s.options.nodataValue?t:NaN})),e=Math.ceil(e/this.options.contourInterval)*this.options.contourInterval,n=Math.floor(n/this.options.contourInterval)*this.options.contourInterval,this.options.debug&&(console.log("Contours: max"),console.log(e)),this.options.debug&&(console.log("Contours: min"),console.log(n)),r=[],o=n;o<=e;o+=this.options.contourInterval)r.push(o);return this.options.debug&&(console.log("Contour thresholds"),console.log(r)),(a=Ff.contours().size([this._contourData.width,this._contourData.height])).thresholds(r),a.smooth(this.options.contourSmoothLines),l=a(t),this._contourData.contoursGeoData=l,this.options.debug&&(console.log("contoursGeoData"),console.log(l)),[2]}))}))},a.prototype._clearContours=function(){return r(this,void 0,void 0,(function(){var t,e;return i(this,(function(n){return this.options.debug&&console.log("_clearContours()"),this.options.contourCanvas?(t=this.options.contourCanvas,(e=t.getContext("2d")).setTransform(1,0,0,1,0,0),e.clearRect(0,0,this._contourData.width,this._contourData.height),e.beginPath(),[2]):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._moveContourCanvas=function(e){return r(this,void 0,void 0,(function(){var n,r,o,a,l,s;return i(this,(function(i){return this.options.debug&&console.log("_moveContourCanvas()"),this.options.contourCanvas?(n=this.options.contourCanvas,this.options.contourPane?(r=this.options.contourPane,o=this._map.getZoomScale(this._map.getZoom(),this._level.zoom),a=this._map.getPixelOrigin(),l=this._level.origin.multiplyBy(o).subtract(a),s=this._getTilePos(this._keyToTileCoords(e.xMin+":"+e.yMin+":"+this._level.zoom)),t.DomUtil.setTransform(r,l,o),t.DomUtil.setTransform(n,s),[2]):(console.log("Error: contourPane not specified."),[2])):(console.log("Error: contourCanvas not specified."),[2])}))}))},a.prototype._drawContours=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,a,l,s,u,f,c,d,h,p,g,b,m=this;return i(this,(function(i){if(this.options.debug&&console.log("_drawContours()"),t=this._contourData.width,e=this._contourData.height,!this.options.contourCanvas)return console.log("Error: contourCanvas not specified."),[2];if(n=this.options.contourCanvas,r=n.getContext("2d"),o=Ff.geoPath().context(r),a=Ff.scaleLinear().domain(this.options.contourBathyDomain).range(this.options.contourBathyColors),l=Ff.scaleLinear().domain(this.options.contourHypsoDomain).range(this.options.contourHypsoColors).interpolate(Ff.interpolateHcl),s=this._contourData.contoursGeoData,u=this.options.contourIndexInterval,f=this.options.contourBathyDomain[this.options.contourBathyDomain.length-1],r.clearRect(0,0,t,e),r.save(),"lines"==this.options.contourType){if(r.lineWidth=this.options.contourLineWeight,r.strokeStyle=this.options.contourLineColor,this.options.contourHypso||this.options.contourBathy?s.forEach((function(t){var e;r.beginPath(),t.value>=f||!this.options.contourBathy?this.options.contourHypso&&(e=l(t.value)):this.options.contourBathy&&(e=a(t.value)),o(t),e&&(r.fillStyle=e,r.fill()),r.stroke()}),this):(r.beginPath(),s.forEach((function(t){0!=u&&t.value%u==0||o(t)})),r.stroke()),0!=this.options.contourIndexInterval)if(this.options.contourIndexLabels)for(c=[],d=function(n){var i=n.value;n.value%h.options.contourIndexInterval==0&&n.coordinates.forEach((function(r){return r.forEach((function(r,o){var a=r.slice(1,1/0),l=Ff.range(m.options.contourLabelDistance,1.4*m.options.contourLabelDistance),s=l.map((function(t){return-(a.length-1)%t})),u=l[Ff.scan(s)],f=1+Ff.scan(a.map((function(t){return(0===o?-1:1)*t[1]})))%u;a.forEach((function(r,o){if(o%u===f&&r[0]>10&&r[0]<t-10&&r[1]>10&&r[1]<e-10){var l=(o-2+a.length)%a.length,s=(o+2)%a.length,d=a[s][0]-a[l][0],h=a[s][1]-a[l][1];if(0===d&&0===h)return;c.push({threshold:i,xy:r.map((function(t){return 1*t})),angle:Math.atan2(h,d),text:""+n.value})}}))}),m)}),h),r.save(),r.beginPath(),r.moveTo(0,0),r.lineTo(t,0),r.lineTo(t,e),r.lineTo(0,e),r.lineTo(0,0);for(var a=0,l=c;a<l.length;a++)for(var s=l[a],u=0;u<2*Math.PI;u+=.2){var f=[20*Math.cos(u),10*-Math.sin(u)],d=Math.cos(s.angle),p=Math.sin(s.angle);r[0===u?"moveTo":"lineTo"](s.xy[0]+f[0]*d-f[1]*p,s.xy[1]+f[1]*d+f[0]*p)}r.clip(),n.value%h.options.contourIndexInterval==0&&(r.beginPath(),r.strokeStyle=h.options.contourLineColor,r.lineWidth=h.options.contourLineIndexWeight,o(n),r.stroke()),r.restore();for(var g=0,b=c;g<b.length;g++){s=b[g];h._addlabel(r,s,h.options.contourLineColor,h.options.contourLabelFont)}},h=this,p=0,g=s;p<g.length;p++)b=g[p],d(b);else r.lineWidth=this.options.contourLineIndexWeight,r.beginPath(),s.forEach((function(t){t.value%u==0&&o(t)})),r.stroke()}else"illuminated"==this.options.contourType&&(r.lineWidth=this.options.contourIlluminatedShadowSize+1,r.shadowBlur=this.options.contourIlluminatedShadowSize,r.shadowOffsetX=this.options.contourIlluminatedShadowSize,r.shadowOffsetY=this.options.contourIlluminatedShadowSize,s.forEach((function(t){r.beginPath(),t.value>=f||!this.options.contourBathy?(r.shadowColor=this.options.contourIlluminatedShadowColor,r.strokeStyle=this.options.contourIlluminatedHighlightColor,this.options.contourHypso&&(r.fillStyle=l(t.value))):(r.shadowColor=this.options.contourBathyShadowColor,r.strokeStyle=this.options.contourBathyHighlightColor,this.options.contourBathy&&(r.fillStyle=a(t.value))),o(t),r.stroke(),(this.options.contourHypso||this.options.contourBathy)&&r.fill()}),this));return r.restore(),this._map.fire("contourDrawing",{status:!1}),[2]}))}))},a.prototype._wrapMouseEventHandler=function(t){var e=this;return function(r){var i=r.latlng,o=e._map.project(i,e._tileZoom).floor(),a=e._getTileContainingPoint(o),l=a&&e._getCoordsInTile(a,o),s=void 0;void 0!==l&&(s=4*(l.y*e._tileSizeAsNumber()+l.x));var u={};if(void 0===s)u.pixelValue=void 0;else{var f=a.el.pixelData;u.pixelValue=l&&e._getPixelValue(f,s)}if(void 0!==s&&e.options.extraPixelLayers>=1){var c=a.el.pixelDataA;u.pixelValueA=l&&e._getPixelValue(c,s)}if(void 0!==s&&e.options.extraPixelLayers>=2){var d=a.el.pixelDataB;u.pixelValueB=l&&e._getPixelValue(d,s)}if(void 0!==s&&e.options.extraPixelLayers>=3){var h=a.el.pixelDataC;u.pixelValueC=l&&e._getPixelValue(h,s)}if(void 0!==s&&e.options.extraPixelLayers>=4){var p=a.el.pixelDataD;u.pixelValueD=l&&e._getPixelValue(p,s)}if(void 0!==s&&e.options.extraPixelLayers>=5){var g=a.el.pixelDataE;u.pixelValueE=l&&e._getPixelValue(g,s)}if(void 0!==s&&e.options.extraPixelLayers>=6){var b=a.el.pixelDataF;u.pixelValueF=l&&e._getPixelValue(b,s)}t(n(n({},r),{pixelValues:u}))}},a.prototype._getTileContainingPoint=function(t){var e=this;return dn(this._tiles).find((function(n){return n.coords.z===e._tileZoom&&e._tileBounds(n).contains(t)}))},a.prototype._tileBounds=function(e){var n=e.coords,r=n.x,i=n.y,o=this._tileSizeAsNumber(),a=t.point(r*o,i*o),l=t.point(a.x+(o-1),a.y+(o-1));return t.bounds(a,l)},a.prototype._getCoordsInTile=function(e,n){var r=e.coords,i=r.x,o=r.y,a=this._tileSizeAsNumber();return t.point(n.x-i*a,n.y-o*a)},a.prototype._getPixelValue=function(t,e){if(t){var n=this.options,r=n.nodataValue,i=n.sentinelValues,o=new DataView(t.buffer).getFloat32(e,kf);if(o!==r)return i&&i.find((function(t){return t.offset===o}))||o}},a.defaultOptions=Nf,a}(t.GridLayer)}(L);
//# sourceMappingURL=bundle.min.js.map
